
3GPP TS 24.301 V15.8.0 (2019-12)
Technical Specification
3rd Generation Partnership Project;
Technical Specification Group Core Network and Terminals;
Non-Access-Stratum (NAS) protocol
 for Evolved Packet System (EPS);
Stage 3
(Release 15)

[pic]	[pic]
The present document has been developed within the 3rd Generation Partnership Project (3GPP TM) and may be further elaborated for the purposes of 3GPP.
The present document has not been subject to any approval process by the 3GPP Organisational Partners and shall not be implemented.
This Specification is provided for future development work within 3GPP only. The Organisational Partners accept no liability for any use of this Specification.
Specifications and reports for implementation of the 3GPP TM system should be obtained via the 3GPP Organisational Partners' Publications Offices.





                      Keywords
                      UMTS, GSM, EPS, GPRS, stage 3, radio, layer 3, user equipment, network, LTE


                      3GPP

                      Postal address



                      3GPP support office address
                      650 Route des Lucioles - Sophia Antipolis
                      Valbonne - FRANCE
                      Tel.: +33 4 92 94 42 00 Fax: +33 4 93 65 47 16

                      Internet
                      http://www.3gpp.org


Copyright Notification

No part may be reproduced except as authorized by written permission.
The copyright and the foregoing restriction extend to reproduction in all media.

© 2019, 3GPP Organizational Partners (ARIB, ATIS, CCSA, ETSI, TSDSI, TTA, TTC).
All rights reserved.

UMTS™ is a Trade Mark of ETSI registered for the benefit of its members
3GPP™ is a Trade Mark of ETSI registered for the benefit of its Members and of the 3GPP Organizational Partners
LTE™ is a Trade Mark of ETSI registered for the benefit of its Members and of the 3GPP Organizational Partners
GSM® and the GSM logo are registered and owned by the GSM Association

         Contents


Foreword	20

1	Scope	21

2	References	21

3	Definitions and abbreviations	24
3.1	Definitions	24
3.2	Abbreviations	31

4	General	32
4.1	Overview	32
4.2	Linkage between the protocols for EPS mobility management and EPS session management	33
4.2A	Handling of NAS signalling low priority indication	33
4.3	UE mode of operation	34
4.3.1	General	34
4.3.2	Change of UE mode of operation	35
4.3.2.1	General	35
4.3.2.2	Change of UE's usage setting	37
4.3.2.3	Change of voice domain preference for E-UTRAN	38
4.3.2.4	Change or determination of IMS registration status	39
4.3.2.5	Change of configuration regarding the use of SMS.	41
4.4	NAS security	42
4.4.1	General	42
4.4.2	Handling of EPS security contexts	42
4.4.2.1	General	42
4.4.2.2	Establishment of a mapped EPS security context during intersystem handover	44
4.4.2.3	Establishment of secure exchange of NAS messages	44
4.4.2.4	Change of security keys	46
4.4.2.5	Derivation of keys at CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode	46
4.4.3	Handling of NAS COUNT and NAS sequence number	47
4.4.3.1	General	47
4.4.3.2	Replay protection	48
4.4.3.3	Integrity protection and verification	49
4.4.3.4	Ciphering and deciphering	49
4.4.3.5	NAS COUNT wrap around	49
4.4.4	Integrity protection of NAS signalling messages	50
4.4.4.1	General	50
4.4.4.2	Integrity checking of NAS signalling messages in the UE	50
4.4.4.3	Integrity checking of NAS signalling messages in the MME	51
4.4.5	Ciphering of NAS signalling messages	53
4.5	Disabling and re-enabling of UE's E-UTRA capability	53
4.6	Applicability of procedures	55
4.6.1	Relay nodes	55
4.7	EPS mobility management and EPS session management in NB-S1 mode	56
4.8	EPS mobility management and EPS session management in WB-S1 mode for IoT	56
4.9	Disabling and re-enabling of UE's NB-IoT capability	57

5	Elementary procedures for EPS mobility management	58
5.1	Overview	58
5.1.1	General	58
5.1.2	Types of EMM procedures	58
5.1.3	EMM sublayer states	59
5.1.3.1	General	59
5.1.3.2	EMM sublayer states in the UE	59
5.1.3.2.1	General	59
5.1.3.2.2	Main states	60
5.1.3.2.2.1	EMM-NULL	60
5.1.3.2.2.2	EMM-DEREGISTERED	60
5.1.3.2.2.3	EMM-REGISTERED-INITIATED	60
5.1.3.2.2.4	EMM-REGISTERED	60
5.1.3.2.2.5	EMM-DEREGISTERED-INITIATED	60
5.1.3.2.2.6	EMM-TRACKING-AREA-UPDATING-INITIATED	60
5.1.3.2.2.7	EMM-SERVICE-REQUEST-INITIATED	60
5.1.3.2.3	Substates of state EMM-DEREGISTERED	61
5.1.3.2.3.1	General	61
5.1.3.2.3.2	EMM-DEREGISTERED.NORMAL-SERVICE	61
5.1.3.2.3.3	EMM-DEREGISTERED.LIMITED-SERVICE	61
5.1.3.2.3.4	EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH	62
5.1.3.2.3.5	EMM-DEREGISTERED.PLMN-SEARCH	62
5.1.3.2.3.6	EMM-DEREGISTERED.NO-IMSI	62
5.1.3.2.3.7	EMM-DEREGISTERED.ATTACH-NEEDED	62
5.1.3.2.3.8	EMM-DEREGISTERED.NO-CELL-AVAILABLE	62
5.1.3.2.3.9	EMM-DEREGISTERED.eCALL-INACTIVE	62
5.1.3.2.4	Substates of state EMM-REGISTERED	62
5.1.3.2.4.1	General	62
5.1.3.2.4.2	EMM-REGISTERED.NORMAL-SERVICE	62
5.1.3.2.4.3	EMM-REGISTERED.ATTEMPTING-TO-UPDATE	63
5.1.3.2.4.4	EMM-REGISTERED.LIMITED-SERVICE	63
5.1.3.2.4.5	EMM-REGISTERED.PLMN-SEARCH	63
5.1.3.2.4.6	EMM-REGISTERED.UPDATE-NEEDED	63
5.1.3.2.4.7	EMM-REGISTERED.NO-CELL-AVAILABLE	63
5.1.3.2.4.8	EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM	63
5.1.3.2.4.9	EMM-REGISTERED.IMSI-DETACH-INITIATED	63
5.1.3.3	EPS update status	63
5.1.3.4	EMM sublayer states in the MME	64
5.1.3.4.1	EMM-DEREGISTERED	64
5.1.3.4.2	EMM-COMMON-PROCEDURE-INITIATED	64
5.1.3.4.3	EMM-REGISTERED	64
5.1.3.4.4	EMM-DEREGISTERED-INITIATED	64
5.1.4	Coordination between EMM and GMM	65
5.1.5	Coordination between EMM and MM	66
5.2	Behaviour of the UE in state EMM-DEREGISTERED and state EMM-REGISTERED	66
5.2.1	General	66
5.2.2	UE behaviour in state EMM-DEREGISTERED	66
5.2.2.1	General	66
5.2.2.2	Primary substate selection	67
5.2.2.2.1	Selection of the substate after power on	67
5.2.2.3	Detailed description of UE behaviour in state EMM-DEREGISTERED	67
5.2.2.3.1	NORMAL-SERVICE	67
5.2.2.3.2	LIMITED-SERVICE	67
5.2.2.3.3	ATTEMPTING-TO-ATTACH	67
5.2.2.3.4	PLMN-SEARCH	68
5.2.2.3.5	NO-IMSI	68
5.2.2.3.6	ATTACH-NEEDED	68
5.2.2.3.7	NO-CELL-AVAILABLE	68
5.2.2.3.8	eCALL-INACTIVE	69
5.2.2.4	Substate when back to state EMM-DEREGISTERED from another EMM state	69
5.2.3	UE behaviour in state EMM-REGISTERED	69
5.2.3.1	General	69
5.2.3.2	Detailed description of UE behaviour in state EMM-REGISTERED	70
5.2.3.2.1	NORMAL-SERVICE	70
5.2.3.2.2	ATTEMPTING-TO-UPDATE	70
5.2.3.2.3	LIMITED-SERVICE	71
5.2.3.2.4	PLMN-SEARCH	71
5.2.3.2.5	UPDATE-NEEDED	71
5.2.3.2.6	NO-CELL-AVAILABLE	71
5.2.3.2.7	ATTEMPTING-TO-UPDATE-MM	71
5.2.3.2.8	IMSI-DETACH-INITIATED	72
5.3	General on elementary EMM procedures	72
5.3.1	EMM modes and NAS signalling connection	72
5.3.1.1	Establishment of the NAS signalling connection	72
5.3.1.2	Release of the NAS signalling connection	73
5.3.1.2.1	General	73
5.3.1.2.2	UE is using EPS services with control plane CIoT EPS optimization	76
5.3.1.3	Suspend and resume of the NAS signalling connection	76
5.3.2	Lists of forbidden tracking areas	77
5.3.3	List of forbidden PLMNs for attach in S101 mode	77
5.3.3a	Forbidden PLMNs for EPS services	78
5.3.4	Equivalent PLMNs list	78
5.3.5	Handling of the periodic tracking area update timer and mobile reachable timer (S1 mode only)	78
5.3.6	Handling of timer T3402	80
5.3.7	Handling of the Local Emergency Numbers List and the Extended Local Emergency Numbers List	80
5.3.7a	Specific requirements for UE configured to use timer T3245	81
5.3.7b	Specific requirements for UE when receiving non-integrity protected reject messages	82
5.3.8	Abnormal cases in the UE	84
5.3.9	Handling of NAS level mobility management congestion control	84
5.3.9A	Handling of congestion control for transport of user data via the control plane	85
5.3.10	Access class control	86
5.3.11	Power saving mode	86
5.3.12	Extended idle-mode DRX cycle	87
5.3.13	Interaction between power saving mode and extended idle mode DRX cycle	88
5.3.14	Dedicated core network	88
5.3.15	CIoT EPS optimizations	88
5.3.16	Restriction on use of enhanced coverage	89
5.3.17	Service Gap Control	90
5.4	EMM common procedures	91
5.4.1	GUTI reallocation procedure	91
5.4.1.1	General	91
5.4.1.2	GUTI reallocation initiation by the network	91
5.4.1.3	GUTI reallocation completion by the UE	92
5.4.1.4	GUTI reallocation completion by the network	92
5.4.1.5	Abnormal cases in the UE	92
5.4.1.6	Abnormal cases on the network side	92
5.4.2	Authentication procedure	94
5.4.2.1	General	94
5.4.2.2	Authentication initiation by the network	94
5.4.2.3	Authentication response by the UE	95
5.4.2.4	Authentication completion by the network	96
5.4.2.5	Authentication not accepted by the network	96
5.4.2.6	Authentication not accepted by the UE	97
5.4.2.7	Abnormal cases	98
5.4.3	Security mode control procedure	102
5.4.3.1	General	102
5.4.3.2	NAS security mode control initiation by the network	103
5.4.3.3	NAS security mode command accepted by the UE	104
5.4.3.4	NAS security mode control completion by the network	106
5.4.3.5	NAS security mode command not accepted by the UE	106
5.4.3.6	Abnormal cases in the UE	106
5.4.3.7	Abnormal cases on the network side	107
5.4.4	Identification procedure	107
5.4.4.1	General	107
5.4.4.2	Identification initiation by the network	107
5.4.4.3	Identification response by the UE	108
5.4.4.4	Identification completion by the network	108
5.4.4.5	Abnormal cases in the UE	108
5.4.4.6	Abnormal cases on the network side	108
5.4.5	EMM information procedure	110
5.4.5.1	General	110
5.4.5.2	EMM information procedure initiation by the network	110
5.4.5.3	EMM information procedure in the UE	110
5.4.5.4	Abnormal cases on the network side	110
5.5	EMM specific procedures	110
5.5.1	Attach procedure	110
5.5.1.1	General	110
5.5.1.2	Attach procedure for EPS services	112
5.5.1.2.1	General	112
5.5.1.2.2	Attach procedure initiation	112
5.5.1.2.3	EMM common procedure initiation	116
5.5.1.2.4	Attach accepted by the network	116
5.5.1.2.4A	Attach successful for EPS services and not accepted for SMS services	121
5.5.1.2.5	Attach not accepted by the network	122
5.5.1.2.5A	Attach for emergency bearer services not accepted by the network	127
5.5.1.2.5B	Attach for initiating a PDN connection for emergency bearer services not accepted by the network	128
5.5.1.2.6	Abnormal cases in the UE	129
5.5.1.2.6A	Abnormal cases in the UE, SMS services not accepted	133
5.5.1.2.7	Abnormal cases on the network side	133
5.5.1.3	Combined attach procedure for EPS services and non-EPS services (S1 mode only)	135
5.5.1.3.1	General	135
5.5.1.3.2	Combined attach procedure initiation	135
5.5.1.3.3	EMM common procedure initiation	135
5.5.1.3.4	Combined attach accepted by the network	135
5.5.1.3.4.1	General	135
5.5.1.3.4.2	Combined attach successful	135
5.5.1.3.4.3	Combined attach successful for EPS services only	137
5.5.1.3.5	Combined attach not accepted by the network	138
5.5.1.3.6	Abnormal cases in the UE	142
5.5.1.3.7	Abnormal cases on the network side	143
5.5.2	Detach procedure	143
5.5.2.1	General	143
5.5.2.2	UE initiated detach procedure	144
5.5.2.2.1	UE initiated detach procedure initiation	144
5.5.2.2.2	UE initiated detach procedure completion for EPS services only	145
5.5.2.2.3	UE initiated combined detach procedure completion	146
5.5.2.2.4	Abnormal cases in the UE	146
5.5.2.2.5	Abnormal cases on the network side	148
5.5.2.3	Network initiated detach procedure	149
5.5.2.3.1	Network initiated detach procedure initiation	149
5.5.2.3.2	Network initiated detach procedure completion by the UE	149
5.5.2.3.3	Network initiated detach procedure completion by the network	153
5.5.2.3.4	Abnormal cases in the UE	153
5.5.2.3.5	Abnormal cases on the network side	154
5.5.3	Tracking area updating procedure (S1 mode only)	155
5.5.3.1	General	155
5.5.3.2	Normal and periodic tracking area updating procedure	157
5.5.3.2.1	General	157
5.5.3.2.2	Normal and periodic tracking area updating procedure initiation	157
5.5.3.2.3	EMM common procedure initiation	163
5.5.3.2.4	Normal and periodic tracking area updating procedure accepted by the network	163
5.5.3.2.4A	Tracking area updating successful for EPS services and not accepted for SMS services	172
5.5.3.2.5	Normal and periodic tracking area updating procedure not accepted by the network	173
5.5.3.2.5A	Tracking area updating procedure for initiating a PDN connection for emergency bearer services not accepted by the network	179
5.5.3.2.6	Abnormal cases in the UE	179
5.5.3.2.6A	Abnormal cases in the UE, SMS services not accepted	185
5.5.3.2.7	Abnormal cases on the network side	185
5.5.3.3	Combined tracking area updating procedure	187
5.5.3.3.1	General	187
5.5.3.3.2	Combined tracking area updating procedure initiation	187
5.5.3.3.3	EMM common procedure initiation	189
5.5.3.3.4	Combined tracking area updating procedure accepted by the network	189
5.5.3.3.4.1	General	189
5.5.3.3.4.2	Combined tracking area updating successful	189
5.5.3.3.4.3	Combined tracking area updating successful for EPS services only	191
5.5.3.3.5	Combined tracking area updating procedure not accepted by the network	192
5.5.3.3.6	Abnormal cases in the UE	199
5.5.3.3.7	Abnormal cases on the network side	200
5.5.4	eCall inactivity procedure	200
5.5.5	Tracking area update request message (for N1 mode only)	201
5.6	EMM connection management procedures (S1 mode only)	201
5.6.1	Service request procedure	201
5.6.1.1	General	201
5.6.1.2	Service request procedure initiation	205
5.6.1.2.1	UE is not using EPS services with control plane CIoT EPS optimization	205
5.6.1.2.2	UE is using EPS services with control plane CIoT EPS optimization	205
5.6.1.3	EMM common procedure initiation	206
5.6.1.4	Service request procedure accepted by the network	206
5.6.1.4.1	UE is not using EPS services with control plane CIoT EPS optimization	206
5.6.1.4.2	UE is using EPS services with control plane CIoT EPS optimization	208
5.6.1.5	Service request procedure not accepted by the network	212
5.6.1.5A	Service request procedure for initiating a PDN connection for emergency bearer services not accepted by the network	220
5.6.1.6	Abnormal cases in the UE	221
5.6.1.7	Abnormal cases on the network side	228
5.6.2	Paging procedure	229
5.6.2.1	General	229
5.6.2.2	Paging for EPS services	229
5.6.2.2.1	Paging for EPS services through E-UTRAN using S-TMSI	229
5.6.2.2.1.1	General	229
5.6.2.2.1.2	Abnormal cases on the network side	231
5.6.2.2.2	Paging for EPS services through E-UTRAN using IMSI	231
5.6.2.3	Paging for CS fallback to A/Gb or Iu mode	232
5.6.2.3.1	General	232
5.6.2.3.2	Abnormal cases in the UE	233
5.6.2.3.3	Abnormal cases on the network side	233
5.6.2.4	Paging for SMS	233
5.6.3	Transport of NAS messages procedure	234
5.6.3.1	General	234
5.6.3.2	UE initiated transport of NAS messages	234
5.6.3.3	Network initiated transport of NAS messages	234
5.6.3.4	Abnormal cases in the UE	234
5.6.3.5	Abnormal cases on the network side	235
5.6.4	Generic transport of NAS messages procedure	235
5.6.4.1	General	235
5.6.4.2	UE initiated generic transport of NAS messages	235
5.6.4.3	Network initiated transport of NAS messages	235
5.6.4.4	Abnormal cases in the UE	236
5.6.4.5	Abnormal cases on the network side	236
5.7	Reception of an EMM STATUS message by an EMM entity	236

6	Elementary procedures for EPS session management	237
6.1	Overview	237
6.1.1	General	237
6.1.2	Types of ESM procedures	237
6.1.3	ESM sublayer states	239
6.1.3.1	General	239
6.1.3.2	ESM sublayer states in the UE	239
6.1.3.2.1	BEARER CONTEXT INACTIVE	239
6.1.3.2.2	BEARER CONTEXT ACTIVE	239
6.1.3.2.3	PROCEDURE TRANSACTION INACTIVE	239
6.1.3.2.4	PROCEDURE TRANSACTION PENDING	239
6.1.3.3	ESM sublayer states in the MME	240
6.1.3.3.1	BEARER CONTEXT INACTIVE	240
6.1.3.3.2	BEARER CONTEXT ACTIVE PENDING	240
6.1.3.3.3	BEARER CONTEXT ACTIVE	240
6.1.3.3.4	BEARER CONTEXT INACTIVE PENDING	240
6.1.3.3.5	BEARER CONTEXT MODIFY PENDING	240
6.1.3.3.6	PROCEDURE TRANSACTION INACTIVE	240
6.1.3.3.7	PROCEDURE TRANSACTION PENDING	240
6.1.4	Coordination between ESM and SM	241
6.1.4A	Coordination between ESM and 5GSM	242
6.1.5	Coordination between ESM and EMM for supporting ISR	242
6.2	IP address allocation	242
6.2.1	General	242
6.2.2	IP address allocation via NAS signalling	243
6.2A	IP header compression	244
6.3	General on elementary ESM procedures	245
6.3.1	Services provided by lower layers	245
6.3.2	Principles of address handling for ESM procedures	245
6.3.3	Abnormal cases in the UE	247
6.3.4	Abnormal cases in the network	248
6.3.5	Handling of APN based congestion control	248
6.3.5A	Handling of group specific session management congestion control	249
6.3.6	Handling of network rejection not due to APN based congestion control	249
6.3.7	Handling of WLAN offload control	250
6.3.8	Handling of serving PLMN rate control	250
6.3.9	Handling of APN rate control	250
6.3.10	Handling of 3GPP PS data off	250
6.3.11	Handling of Reliable Data Service	251
6.4	Network initiated ESM procedures	252
6.4.1	Default EPS bearer context activation procedure	252
6.4.1.1	General	252
6.4.1.2	Default EPS bearer context activation initiated by the network	252
6.4.1.3	Default EPS bearer context activation accepted by the UE	253
6.4.1.4	Default EPS bearer context activation not accepted by the UE	254
6.4.1.5	Abnormal cases in the UE	254
6.4.1.6	Abnormal cases on the network side	254
6.4.2	Dedicated EPS bearer context activation procedure	255
6.4.2.1	General	255
6.4.2.2	Dedicated EPS bearer context activation initiated by the network	255
6.4.2.3	Dedicated EPS bearer context activation accepted by the UE	255
6.4.2.4	Dedicated EPS bearer context activation not accepted by the UE	256
6.4.2.5	Abnormal cases in the UE	258
6.4.2.6	Abnormal cases on the network side	258
6.4.3	EPS bearer context modification procedure	259
6.4.3.1	General	259
6.4.3.2	EPS bearer context modification initiated by the network	259
6.4.3.3	EPS bearer context modification accepted by the UE	260
6.4.3.4	EPS bearer context modification not accepted by the UE	261
6.4.3.5	Abnormal cases in the UE	263
6.4.3.6	Abnormal cases on the network side	263
6.4.4	EPS bearer context deactivation procedure	264
6.4.4.1	General	264
6.4.4.2	EPS bearer context deactivation initiated by the network	264
6.4.4.3	EPS bearer context deactivation accepted by the UE	265
6.4.4.4	Abnormal cases in the UE	267
6.4.4.5	Abnormal cases on the network side	267
6.4.4.6	Local EPS bearer context deactivation without NAS signalling	268
6.5	UE requested ESM procedures	269
6.5.0	General	269
6.5.1	UE requested PDN connectivity procedure	270
6.5.1.1	General	270
6.5.1.2	UE requested PDN connectivity procedure initiation	270
6.5.1.3	UE requested PDN connectivity procedure accepted by the network	272
6.5.1.4	UE requested PDN connectivity procedure not accepted by the network	274
6.5.1.4.1	General	274
6.5.1.4.2	Handling of network rejection due to ESM cause #26	275
6.5.1.4.3	Handling of network rejection due to ESM cause other than ESM cause #26	278
6.5.1.4A	Handling the maximum number of active EPS bearer contexts	283
6.5.1.4B	Void	284
6.5.1.5	Abnormal cases in the UE	284
6.5.1.6	Abnormal cases on the network side	284
6.5.1.7	Handling PDN connectivity request for UE configured for dual priority	285
6.5.2	UE requested PDN disconnect procedure	286
6.5.2.1	General	286
6.5.2.2	UE requested PDN disconnection procedure initiation	286
6.5.2.3	UE requested PDN disconnection procedure accepted by the network	286
6.5.2.4	UE requested PDN disconnection procedure not accepted by the network	287
6.5.2.5	Abnormal cases in the UE	287
6.5.2.6	Abnormal cases on the network side	288
6.5.3	UE requested bearer resource allocation procedure	288
6.5.3.1	General	288
6.5.3.2	UE requested bearer resource allocation procedure initiation	288
6.5.3.3	UE requested bearer resource allocation procedure accepted by the network	289
6.5.3.4	UE requested bearer resource allocation procedure not accepted by the network	289
6.5.3.4.1	General	289
6.5.3.4.2	Handling of network rejection due to ESM cause #26	291
6.5.3.4.3	Handling of network rejection due to ESM cause other than ESM cause #26	292
6.5.3.4A	Handling the maximum number of active EPS bearer contexts	294
6.5.3.5	Abnormal cases in the UE	295
6.5.3.6	Abnormal cases on the network side	295
6.5.4	UE requested bearer resource modification procedure	295
6.5.4.1	General	295
6.5.4.2	UE requested bearer resource modification procedure initiation	296
6.5.4.3	UE requested bearer resource modification procedure accepted by the network	297
6.5.4.4	UE requested bearer resource modification procedure not accepted by the network	298
6.5.4.4.1	General	298
6.5.4.4.2	Handling of network rejection due to ESM cause #26	301
6.5.4.4.3	Handling of network rejection due to ESM cause other than ESM cause #26	302
6.5.4.5	Abnormal cases in the UE	304
6.5.4.6	Abnormal cases on the network side	305
6.5.5	Handling session management request for UE configured for dual priority	305
6.6	Miscellaneous procedures	306
6.6.1	Exchange of protocol configuration options	306
6.6.1.1	General	306
6.6.1.2	ESM information request procedure	307
6.6.1.2.1	General	307
6.6.1.2.2	ESM information request initiated by the network	307
6.6.1.2.3	ESM information request completion by the UE	307
6.6.1.2.4	ESM information request completion by the network	307
6.6.1.2.5	Abnormal cases in the UE	307
6.6.1.2.6	Abnormal cases on the network side	307
6.6.1.3	Exchange of protocol configuration options in other messages	308
6.6.2	Notification procedure	308
6.6.2.1	General	308
6.6.2.2	Notification procedure initiation by the network	308
6.6.2.3	Notification procedure in the UE	308
6.6.2.4	Abnormal cases on the network side	309
6.6.3	Remote UE Report procedure	309
6.6.3.1	General	309
6.6.3.2	Remote UE Report initiated by the UE	309
6.6.3.3	Remote UE Report completion by the network	309
6.6.3.4	Remote UE Report completion by the UE	310
6.6.3.5	Abnormal cases in the UE	310
6.6.3.6	Abnormal cases on the network side	310
6.6.4	Transport of user data via the control plane procedure	310
6.6.4.1	General	310
6.6.4.2	UE initiated transport of user data via the control plane	310
6.6.4.3	Network initiated transport of user data via the control plane	311
6.6.4.4	Abnormal cases in the UE	311
6.6.4.5	Abnormal cases on the network side	312
6.7	Reception of an ESM STATUS message by an ESM entity	312

7	Handling of unknown, unforeseen, and erroneous protocol data	313
7.1	General	313
7.2	Message too short	313
7.3	Unknown or unforeseen procedure transaction identity or EPS bearer identity	314
7.3.1	Procedure transaction identity	314
7.3.2	EPS bearer identity	315
7.4	Unknown or unforeseen message type	317
7.5	Non-semantical mandatory information element errors	317
7.5.1	Common procedures	317
7.5.2	EPS mobility management	317
7.5.3	EPS session management	318
7.6	Unknown and unforeseen IEs in the non-imperative message part	318
7.6.1	IEIs unknown in the message	318
7.6.2	Out of sequence IEs	318
7.6.3	Repeated IEs	319
7.7	Non-imperative message part errors	319
7.7.1	Syntactically incorrect optional IEs	319
7.7.2	Conditional IE errors	319
7.8	Messages with semantically incorrect contents	319

8	Message functional definitions and contents	320
8.1	Overview	320
8.2	EPS mobility management messages	321
8.2.1	Attach accept	321
8.2.1.1	Message definition	321
8.2.1.2	GUTI	323
8.2.1.3	Location area identification	323
8.2.1.4	MS identity	323
8.2.1.5	EMM cause	323
8.2.1.6	T3402 value	323
8.2.1.7	T3423 value	323
8.2.1.8	Equivalent PLMNs	323
8.2.1.9	Emergency number list	323
8.2.1.9A	Extended emergency number list	323
8.2.1.10	EPS network feature support	323
8.2.1.11	Additional update result	323
8.2.1.12	T3412 extended value	324
8.2.1.13	T3324 value	324
8.2.1.14	Extended DRX parameters	324
8.2.1.15	DCN-ID	324
8.2.1.16	SMS services status	324
8.2.1.17	Non-3GPP NW provided policies	324
8.2.1.18	T3448 value	324
8.2.1.19	Network policy	324
8.2.1.20	T3447 value	324
8.2.1.21	Ciphering key data	325
8.2.2	Attach complete	325
8.2.3	Attach reject	325
8.2.3.1	Message definition	325
8.2.3.2	ESM message container	326
8.2.3.3	T3346 value	326
8.2.3.4	T3402 value	326
8.2.3.5	Extended EMM cause	326
8.2.4	Attach request	326
8.2.4.1	Message definition	326
8.2.4.2	Old P-TMSI signature	328
8.2.4.3	Additional GUTI	328
8.2.4.4	Last visited registered TAI	328
8.2.4.5	DRX parameter	328
8.2.4.6	MS network capability	328
8.2.4.7	Old location area identification	328
8.2.4.8	TMSI status	328
8.2.4.9	Mobile station classmark 2	328
8.2.4.10	Mobile station classmark 3	328
8.2.4.11	Supported Codecs	328
8.2.4.12	Additional update type	328
8.2.4.13	Voice domain preference and UE's usage setting	329
8.2.4.14	Device properties	329
8.2.4.15	Old GUTI type	329
8.2.4.16	MS network feature support	329
8.2.4.17	TMSI based NRI container	329
8.2.4.18	T3324 value	329
8.2.4.19	T3412 extended value	329
8.2.4.20	Extended DRX parameters	329
8.2.4.21	UE additional security capability	329
8.2.4.22	UE status	329
8.2.4.23	Additional information requested	329
8.2.5	Authentication failure	330
8.2.5.1	Message definition	330
8.2.5.2	Authentication failure parameter	330
8.2.6	Authentication reject	330
8.2.7	Authentication request	330
8.2.8	Authentication response	331
8.2.9	CS service notification	331
8.2.9.1	Message definition	331
8.2.9.2	CLI	332
8.2.9.3	SS Code	332
8.2.9.4	LCS indicator	332
8.2.9.5	LCS client identity	332
8.2.10	Detach accept	332
8.2.10.1	Detach accept (UE originating detach)	332
8.2.10.2	Detach accept (UE terminated detach)	333
8.2.11	Detach request	333
8.2.11.1	Detach request (UE originating detach)	333
8.2.11.2	Detach request (UE terminated detach)	334
8.2.11.2.1	Message definition	334
8.2.11.2.2	EMM cause	334
8.2.12	Downlink NAS Transport	334
8.2.13	EMM information	335
8.2.13.1	Message definition	335
8.2.13.2	Full name for network	335
8.2.13.3	Short name for network	335
8.2.13.4	Local time zone	335
8.2.13.5	Universal time and local time zone	336
8.2.13.6	Network daylight saving time	336
8.2.14	EMM status	336
8.2.15	Extended service request	336
8.2.15.1	Message definition	336
8.2.15.2	CSFB response	337
8.2.15.3	EPS bearer context status	337
8.2.15.4	Device properties	337
8.2.16	GUTI reallocation command	337
8.2.16.1	Message definition	337
8.2.16.2	TAI list	338
8.2.16.3	DCN-ID	338
8.2.17	GUTI reallocation complete	338
8.2.18	Identity request	338
8.2.19	Identity response	339
8.2.20	Security mode command	339
8.2.20.1	Message definition	339
8.2.20.2	IMEISV request	340
8.2.20.3	Replayed nonceUE	340
8.2.20.4	NonceMME	340
8.2.20.5	HashMME	340
8.2.20.6	Replayed UE additional security capability	340
8.2.21	Security mode complete	341
8.2.21.1	Message definition	341
8.2.21.2	IMEISV	341
8.2.21.3	Replayed NAS message container	341
8.2.22	Security mode reject	341
8.2.23	Security protected NAS message	342
8.2.24	Service reject	342
8.2.24.1	Message definition	342
8.2.24.2	T3442 value	343
8.2.24.3	T3346 value	343
8.2.24.4	T3448 value	343
8.2.25	Service request	343
8.2.26	Tracking area update accept	344
8.2.26.1	Message definition	344
8.2.26.2	T3412 value	346
8.2.26.3	GUTI	346
8.2.26.4	TAI list	346
8.2.26.5	EPS bearer context status	346
8.2.26.6	Location area identification	346
8.2.26.7	MS identity	346
8.2.26.8	EMM cause	346
8.2.26.9	T3402 value	346
8.2.26.10	T3423 value	346
8.2.26.11	Equivalent PLMNs	346
8.2.26.12	Emergency number list	347
8.2.26.12A	Extended emergency number list	347
8.2.26.13	EPS network feature support	347
8.2.26.14	Additional update result	347
8.2.26.15	T3412 extended value	347
8.2.26.16	T3324 value	347
8.2.26.17	Extended DRX parameters	347
8.2.26.18	DCN-ID	347
8.2.26.19	SMS services status	347
8.2.26.20	Non-3GPP NW provided policies	348
8.2.26.21	T3448 value	348
8.2.26.22	Network policy	348
8.2.26.23	T3447 value	348
8.2.26.24	Ciphering key data	348
8.2.27	Tracking area update complete	348
8.2.28	Tracking area update reject	348
8.2.28.1	Message definition	348
8.2.28.2	T3346 value	349
8.2.28.3	Extended EMM cause	349
8.2.29	Tracking area update request	349
8.2.29.1	Message definition	349
8.2.29.2	Non-current native NAS key set identifier	351
8.2.29.3	GPRS ciphering key sequence number	351
8.2.29.4	Old P-TMSI signature	351
8.2.29.5	Additional GUTI	351
8.2.29.6	NonceUE	351
8.2.29.7	UE network capability	351
8.2.29.8	Last visited registered TAI	351
8.2.29.9	DRX parameter	351
8.2.29.10	UE radio capability information update needed	351
8.2.29.11	EPS bearer context status	352
8.2.29.12	MS network capability	352
8.2.29.13	Old location area identification	352
8.2.29.14	TMSI status	352
8.2.29.15	Mobile station classmark 2	352
8.2.29.16	Mobile station classmark 3	352
8.2.29.17	Supported Codecs	352
8.2.29.18	Additional update type	352
8.2.29.19	Voice domain preference and UE's usage setting	352
8.2.29.20	Old GUTI type	352
8.2.29.21	Device properties	352
8.2.29.22	MS network feature support	352
8.2.29.23	TMSI based NRI container	353
8.2.29.24	T3324 value	353
8.2.29.25	T3412 extended value	353
8.2.29.26	Extended DRX parameters	353
8.2.29.27	UE additional security capability	353
8.2.29.28	UE status	353
8.2.29.29	Additional information requested	353
8.2.30	Uplink NAS Transport	353
8.2.31	Downlink generic NAS transport	354
8.2.31.1	Message definition	354
8.2.31.2	Additional information	354
8.2.32	Uplink generic NAS transport	354
8.2.32.1	Message definition	354
8.2.32.2	Additional information	355
8.2.33	CONTROL PLANE SERVICE REQUEST	355
8.2.33.1	Message definition	355
8.2.33.2	ESM message container	355
8.2.33.3	NAS message container	356
8.2.33.4	EPS bearer context status	356
8.2.33.5	Device properties	356
8.2.34	Service Accept	356
8.2.34.1	Message definition	356
8.2.34.2	EPS bearer context status	356
8.2.34.3	T3448 value	356
8.3	EPS session management messages	357
8.3.1	Activate dedicated EPS bearer context accept	357
8.3.1.1	Message definition	357
8.3.1.2	Protocol configuration options	357
8.3.1.3	NBIFOM container	357
8.3.1.4	Extended protocol configuration options	357
8.3.2	Activate dedicated EPS bearer context reject	358
8.3.2.1	Message definition	358
8.3.2.2	Protocol configuration options	358
8.3.2.3	NBIFOM container	358
8.3.2.4	Extended protocol configuration options	358
8.3.3	Activate dedicated EPS bearer context request	358
8.3.3.1	Message definition	358
8.3.3.2	Transaction identifier	359
8.3.3.3	Negotiated QoS	359
8.3.3.4	Negotiated LLC SAPI	359
8.3.3.5	Radio priority	360
8.3.3.6	Packet flow identifier	360
8.3.3.7	Protocol configuration options	360
8.3.3.8	WLAN offload indication	360
8.3.3.9	NBIFOM container	360
8.3.3.10	Extended protocol configuration options	360
8.3.3.11	Extended EPS QoS	360
8.3.4	Activate default EPS bearer context accept	360
8.3.4.1	Message definition	360
8.3.4.2	Protocol configuration options	361
8.3.4.3	Extended protocol configuration options	361
8.3.5	Activate default EPS bearer context reject	361
8.3.5.1	Message definition	361
8.3.5.2	Protocol configuration options	362
8.3.5.3	Extended protocol configuration options	362
8.3.6	Activate default EPS bearer context request	362
8.3.6.1	Message definition	362
8.3.6.2	Transaction identifier	363
8.3.6.3	Negotiated QoS	363
8.3.6.4	Negotiated LLC SAPI	364
8.3.6.5	Radio priority	364
8.3.6.6	Packet flow identifier	364
8.3.6.7	APN-AMBR	364
8.3.6.8	ESM cause	364
8.3.6.9	Protocol configuration options	364
8.3.6.10	Connectivity type	364
8.3.6.11	WLAN offload indication	364
8.3.6.12	NBIFOM container	364
8.3.6.13	Header compression configuration	364
8.3.6.14	Control plane only indication	365
8.3.6.15	Extended protocol configuration options	365
8.3.6.16	Serving PLMN rate control	365
8.3.6.17	Extended APN aggregate maximum bit rate	365
8.3.7	Bearer resource allocation reject	365
8.3.7.1	Message definition	365
8.3.7.2	Protocol configuration options	366
8.3.7.3	Back-off timer value	366
8.3.7.4	Re-attempt indicator	366
8.3.7.5	NBIFOM container	366
8.3.7.6	Extended protocol configuration options	366
8.3.8	Bearer resource allocation request	367
8.3.8.1	Message definition	367
8.3.8.2	Protocol configuration options	367
8.3.8.3	Device properties	367
8.3.8.4	NBIFOM container	367
8.3.8.5	Extended protocol configuration options	368
8.3.8.6	Extended EPS QoS	368
8.3.9	Bearer resource modification reject	368
8.3.9.1	Message definition	368
8.3.9.2	Protocol configuration options	368
8.3.9.3	Back-off timer value	369
8.3.9.4	Re-attempt indicator	369
8.3.9.5	NBIFOM container	369
8.3.9.6	Extended protocol configuration options	369
8.3.10	Bearer resource modification request	369
8.3.10.1	Message definition	369
8.3.10.2	Required traffic flow QoS	370
8.3.10.3	ESM cause	370
8.3.10.4	Protocol configuration options	370
8.3.10.5	Device properties	370
8.3.10.6	NBIFOM container	370
8.3.10.7	Header compression configuration	371
8.3.10.8	Extended protocol configuration options	371
8.3.10.9	Extended EPS QoS	371
8.3.11	Deactivate EPS bearer context accept	371
8.3.11.1	Message definition	371
8.3.11.2	Protocol configuration options	371
8.3.11.3	Void	372
8.3.11.4	Extended protocol configuration options	372
8.3.12	Deactivate EPS bearer context request	372
8.3.12.1	Message definition	372
8.3.12.2	Protocol configuration options	372
8.3.12.3	T3396 value	372
8.3.12.4	WLAN offload indication	373
8.3.12.5	NBIFOM container	373
8.3.12.6	Extended protocol configuration options	373
8.3.12A	ESM dummy message	373
8.3.13	ESM information request	373
8.3.14	ESM information response	374
8.3.14.1	Message definition	374
8.3.14.2	Access point name	374
8.3.14.3	Protocol configuration options	374
8.3.14.4	Extended protocol configuration options	375
8.3.15	ESM status	375
8.3.16	Modify EPS bearer context accept	375
8.3.16.1	Message definition	375
8.3.16.2	Protocol configuration options	376
8.3.16.3	NBIFOM container	376
8.3.16.4	Extended protocol configuration options	376
8.3.17	Modify EPS bearer context reject	376
8.3.17.1	Message definition	376
8.3.17.2	Protocol configuration options	377
8.3.17.3	NBIFOM container	377
8.3.17.4	Extended protocol configuration options	377
8.3.18	Modify EPS bearer context request	377
8.3.18.1	Message definition	377
8.3.18.2	New EPS QoS	378
8.3.18.3	TFT	378
8.3.18.4	New QoS	378
8.3.18.5	Negotiated LLC SAPI	379
8.3.18.6	Radio priority	379
8.3.18.7	Packet flow identifier	379
8.3.18.8	APN-AMBR	379
8.3.18.9	Protocol configuration options	379
8.3.18.10	WLAN offload indication	379
8.3.18.11	NBIFOM container	379
8.3.18.12	Header compression configuration	379
8.3.18.13	Extended protocol configuration options	379
8.3.18.14	Extended APN-AMBR	379
8.3.18.15	Extended EPS QoS	380
8.3.18A	Notification	380
8.3.19	PDN connectivity reject	380
8.3.19.1	Message definition	380
8.3.19.2	Protocol configuration options	381
8.3.19.3	Back-off timer value	381
8.3.19.4	Re-attempt indicator	381
8.3.19.5	Extended protocol configuration options	381
8.3.20	PDN connectivity request	382
8.3.20.1	Message definition	382
8.3.20.2	ESM information transfer flag	382
8.3.20.3	Access point name	382
8.3.20.4	Protocol configuration options	383
8.3.20.5	Device properties	383
8.3.20.6	NBIFOM container	383
8.3.20.7	Header compression configuration	383
8.3.20.8	Extended protocol configuration options	383
8.3.21	PDN disconnect reject	383
8.3.21.1	Message definition	383
8.3.21.2	Protocol configuration options	384
8.3.21.3	Extended protocol configuration options	384
8.3.22	PDN disconnect request	384
8.3.22.1	Message definition	384
8.3.22.2	Protocol configuration options	385
8.3.22.3	Extended protocol configuration options	385
8.3.23	Remote UE report	385
8.3.23.1	Message definition	385
8.3.23.2	Remote UE Context Connected	386
8.3.23.3	Remote UE Context Disconnected	386
8.3.23.4	ProSe Key Management Function Address	386
8.3.24	Remote UE report response	386
8.3.24.1	Message definition	386
8.3.25	ESM DATA TRANSPORT	387
8.3.25.1	Message definition	387
8.3.25.2	Release assistance indication	387

9	General message format and information elements coding	388
9.1	Overview	388
9.2	Protocol discriminator	389
9.3	Security header type and EPS bearer identity	389
9.3.1	Security header type	389
9.3.2	EPS bearer identity	390
9.4	Procedure transaction identity	390
9.5	Message authentication code	391
9.6	Sequence number	391
9.7	NAS message	391
9.8	Message type	391
9.9	Other information elements	393
9.9.1	General	393
9.9.2	Common information elements	394
9.9.2.0	Additional information	394
9.9.2.0A	Device properties	394
9.9.2.1	EPS bearer context status	394
9.9.2.2	Location area identification	395
9.9.2.3	Mobile identity	395
9.9.2.4	Mobile station classmark 2	395
9.9.2.5	Mobile station classmark 3	395
9.9.2.6	NAS security parameters from E-UTRA	395
9.9.2.7	NAS security parameters to E-UTRA	396
9.9.2.8	PLMN list	397
9.9.2.9	Spare half octet	397
9.9.2.10	Supported codec list	397
9.9.3	EPS Mobility Management (EMM) information elements	397
9.9.3.0A	Additional update result	397
9.9.3.0B	Additional update type	398
9.9.3.1	Authentication failure parameter	399
9.9.3.2	Authentication parameter AUTN	399
9.9.3.3	Authentication parameter RAND	399
9.9.3.4	Authentication response parameter	399
9.9.3.4A	Ciphering key sequence number	400
9.9.3.4B	SMS services status	400
9.9.3.5	CSFB response	401
9.9.3.6	Daylight saving time	401
9.9.3.7	Detach type	401
9.9.3.8	DRX parameter	402
9.9.3.9	EMM cause	402
9.9.3.10	EPS attach result	403
9.9.3.11	EPS attach type	404
9.9.3.12	EPS mobile identity	404
9.9.3.12A	EPS network feature support	406
9.9.3.13	EPS update result	410
9.9.3.14	EPS update type	410
9.9.3.15	ESM message container	411
9.9.3.16	GPRS timer	411
9.9.3.16A	GPRS timer 2	412
9.9.3.16B	GPRS timer 3	412
9.9.3.17	Identity type 2	412
9.9.3.18	IMEISV request	412
9.9.3.19	KSI and sequence number	412
9.9.3.20	MS network capability	412
9.9.3.20A	MS network feature support	412
9.9.3.21	NAS key set identifier	413
9.9.3.22	NAS message container	413
9.9.3.23	NAS security algorithms	414
9.9.3.24	Network name	414
9.9.3.24A	Network resource identifier container	415
9.9.3.25	Nonce	415
9.9.3.25A	Paging identity	415
9.9.3.26	P-TMSI signature	416
9.9.3.26A	Extended EMM cause	416
9.9.3.27	Service type	416
9.9.3.28	Short MAC	417
9.9.3.29	Time zone	417
9.9.3.30	Time zone and time	418
9.9.3.31	TMSI status	418
9.9.3.32	Tracking area identity	418
9.9.3.33	Tracking area identity list	419
9.9.3.34	UE network capability	423
9.9.3.35	UE radio capability information update needed	428
9.9.3.36	UE security capability	428
9.9.3.37	Emergency Number List	432
9.9.3.37A	Extended emergency number list	432
9.9.3.38	CLI	434
9.9.3.39	SS Code	435
9.9.3.40	LCS indicator	435
9.9.3.41	LCS client identity	435
9.9.3.42	Generic message container type	436
9.9.3.43	Generic message container	436
9.9.3.44	Voice domain preference and UE's usage setting	437
9.9.3.45	GUTI type	437
9.9.3.46	Extended DRX parameters	437
9.9.3.47	Control plane service type	438
9.9.3.48	DCN-ID	438
9.9.3.49	Non-3GPP NW provided policies	438
9.9.3.50	HashMME	438
9.9.3.51	Replayed NAS message container	439
9.9.3.52	Network policy	440
9.9.3.53	UE additional security capability	440
9.9.3.54	UE status	443
9.9.3.55	Additional information requested	443
9.9.3.56	Ciphering key data	443
9.9.4	EPS Session Management (ESM) information elements	447
9.9.4.1	Access point name	447
9.9.4.2	APN aggregate maximum bit rate	447
9.9.4.2A	Connectivity type	450
9.9.4.3	EPS quality of service	450
9.9.4.4	ESM cause	456
9.9.4.5	ESM information transfer flag	459
9.9.4.6	Linked EPS bearer identity	459
9.9.4.7	LLC service access point identifier	460
9.9.4.7A	Notification indicator	460
9.9.4.8	Packet flow identifier	461
9.9.4.9	PDN address	461
9.9.4.10	PDN type	462
9.9.4.11	Protocol configuration options	463
9.9.4.12	Quality of service	463
9.9.4.13	Radio priority	463
9.9.4.13A	Re-attempt indicator	463
9.9.4.14	Request type	464
9.9.4.15	Traffic flow aggregate description	464
9.9.4.16	Traffic flow template	464
9.9.4.17	Transaction identifier	464
9.9.4.18	WLAN offload acceptability	464
9.9.4.19	NBIFOM container	465
9.9.4.20	Remote UE context list	465
9.9.4.21	PKMF address	468
9.9.4.22	Header compression configuration	468
9.9.4.23	Control plane only indication	471
9.9.4.24	User data container	471
9.9.4.25	Release assistance indication	472
9.9.4.26	Extended protocol configuration options	472
9.9.4.27	Header compression configuration status	472
9.9.4.28	Serving PLMN rate control	473
9.9.4.29	Extended APN aggregate maximum bit rate	473
9.9.4.30	Extended quality of service	475

10	List of system parameters	477
10.1	General	477
10.2	Timers of EPS mobility management	478
10.3	Timers of EPS session management	487

Annex A (informative): Cause values for EPS mobility management	489

A.1	Causes related to UE identification	489

A.2	Cause related to subscription options	489

A.3	Causes related to PLMN specific network failures and congestion/authentication failures	490

A.4	Causes related to nature of request	491

A.5	Causes related to invalid messages	491

Annex B (informative): Cause values for EPS session management	493

B.1	Causes related to nature of request	493

B.2	Protocol errors (e.g., unknown message) class	496

Annex C (normative): Storage of EMM information	497

Annex D (normative): Establishment cause (S1 mode only)	498

D.1	Mapping of NAS procedure to RRC establishment cause (S1 mode only)	498

Annex E (informative): Guidelines for enhancements to MS network capability IE and UE network capability IE	507

Annex F (normative): Application specific Congestion control for Data Communication (ACDC)	508

Annex G (informative): Change history	509



         Foreword

This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).

The contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:

  Version x.y.z

  where:

    x	the first digit:

       1	presented to TSG for information;

       2	presented to TSG for approval;

       3	or greater indicates TSG approved document under change control.

    y	the second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.

    z	the third digit is incremented when editorial only changes have been incorporated in the document.



         1	Scope

The present document specifies the procedures used by the protocols for mobility management and session management between User Equipment (UE) and Mobility Management Entity (MME) in the Evolved Packet System (EPS). These protocols belong to the non-access stratum (NAS).

The EPS Mobility Management (EMM) protocol defined in the present document provides procedures for the control of mobility when the User Equipment (UE) is using the Evolved UMTS Terrestrial Radio Access Network (E-UTRAN). The EMM protocol also provides control of security for the NAS protocols.

The EPS Session Management (ESM) protocol defined in the present document provides procedures for the handling of EPS bearer contexts. Together with the bearer control provided by the access stratum, this protocol is used for the control of user plane bearers.

For both NAS protocols the present document specifies procedures for the support of inter-system mobility between E-UTRAN and other 3GPP or non-3GPP access networks:

  -	For inter-system mobility between E-UTRAN and GERAN, UTRAN or NG-RAN, this includes rules for a mapping between parameters and procedures used by the NAS protocols defined in the present document and the NAS protocols specified in 3GPP TS 24.008 [13] for GERAN and UTRAN, and 3GPP TS 24.501 [54] for NG-RAN.

  -	For inter-system mobility between E-UTRAN and generic non-3GPP access networks, this includes specific NAS procedures to maintain IP connectivity to the PDN Gateway and to provide parameters needed by the UE when using mobility management based on Dual-Stack Mobile IPv6 (see 3GPP TS 24.303 [14]) or MIPv4 (see 3GPP TS 24.304 [15]).

The present document is applicable to the UE and to the Mobility Management Entity (MME) in the EPS.

The present document is also applicable to the relay node in the EPS (see 3GPP TS 23.401 [10]).

The present document also specifies NAS signalling enhancement for the support of efficient transport of IP, non-IP and SMS data of CIoT capable devices.


2	References

The following documents contain provisions which, through reference in this text, constitute provisions of the present document.

  -	References are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.

  -	For a specific reference, subsequent revisions do not apply.

  -	For a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.

  [1]	3GPP TR 21.905: "Vocabulary for 3GPP Specifications".

  [1A]	3GPP TS 22.011: "Service accessibility".

  [1B]	Void.

  [1C]	3GPP TS 22.278: "Service requirements for the Evolved Packet System (EPS)".

  [2]	3GPP TS 23.003: "Numbering, addressing and identification".

  [3]	3GPP TS 23.038: "Alphabets and language-specific information".

  [4]	3GPP TS 23.060: "General Packet Radio Service (GPRS); Service Description; Stage 2".

  [5]	3GPP TS 23.107: "Quality of Service (QoS) concept and architecture".

  [6]	3GPP TS 23.122: "Non-Access-Stratum functions related to Mobile Station (MS) in idle mode".

  [7]	3GPP TS 23.203: "Policy and charging control architecture".

  [8]	3GPP TS 23.216: "Single Radio Voice Call Continuity (SRVCC); Stage 2".

  [8A]	3GPP TS 23.221: "Architectural requirements".

  [8B]	3GPP TS 23.251: "Network Sharing; Architecture and Functional Description".

  [9]	3GPP TS 23.272: "Circuit Switched Fallback in Evolved Packet System; Stage 2".

  [10]	3GPP TS 23.401: "GPRS enhancements for E-UTRAN access".

  [11]	3GPP TS 23.402: "GPRS architecture enhancements for non-3GPP accesses".

  [11A]	3GPP TS 23.682: "Architecture enhancements to facilitate communications with packet data networks and applications".

  [12]	3GPP TS 24.007: "Mobile radio interface signalling layer 3; General aspects".

  [13]	3GPP TS 24.008: "Mobile Radio Interface Layer 3 specification; Core Network Protocols; Stage 3".

  [13A]	3GPP TS 24.011: "Point-to-Point Short Message Service (SMS) support on mobile radio interface".

  [13B]	3GPP TS 24.167: "3GPP IMS Management Object (MO); Stage 3".

  [13C]	3GPP TS 24.171: "NAS Signalling for Control Plane LCS in Evolved Packet System (EPS)".

  [13D]	3GPP TS 24.229: "IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3".

  [13E]	3GPP TS 24.173: "IMS Multimedia telephony communication service and supplementary services; Stage 3".

  [14]	3GPP TS 24.303: "Mobility Management based on DSMIPv6; User Equipment (UE) to network protocols; Stage 3".

  [15]	3GPP TS 24.304: "Mobility management based on Mobile IPv4; User Equipment (UE) - foreign agent interface; Stage 3".

  [15A]	3GPP TS 24.368: "Non-Access Stratum (NAS) configuration Management Object (MO)".

  [15B]	3GPP TS 25.304: "User Equipment (UE) procedures in idle mode and procedures for cell reselection in connected mode".

  [15C]	3GPP TS 29.002: "Mobile Application Part (MAP) specification".

  [15D]	3GPP TS 24.341: "Support of SMS over IP networks; Stage 3".

  [16]	3GPP TS 29.061: "Interworking between the Public Land Mobile Network (PLMN) supporting packet based services and Packet Data Networks (PDN)".

  [16A]	3GPP TS 29.118: "Mobility Management Entity (MME) – Visitor Location Register (VLR) SGs interface specification".

  [16B]	3GPP TS 29.212: "Policy and Charging Control (PCC); Reference points".

  [16C]	3GPP TS 29.272: "Evolved Packet System (EPS); Mobility Management Entity (MME) and Serving GPRS Support Node (SGSN) related interfaces based on Diameter protocol".

  [16D]	3GPP TS 29.274: "Evolved Packet System (EPS); Evolved General Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C); Stage 3".

  [17]	3GPP TS 31.102: "Characteristics of the Universal Subscriber Identity Module (USIM) application".

  [18]	3GPP TS 33.102: "3G security; Security architecture".

  [19]	3GPP TS 33.401: "3GPP System Architecture Evolution; Security architecture".

  [20]	3GPP TS 36.300: "Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall description".

  [21]	3GPP TS 36.304: "Evolved Universal Terrestrial Radio Access (E-UTRA); User Equipment (UE) procedures in idle mode".

  [22]	3GPP TS 36.331: "Evolved Universal Terrestrial Radio Access (E-UTRA); Radio Resource Control (RRC) protocol specification".

  [22A]	3GPP TS 36.355: "Evolved Universal Terrestrial Radio Access (E-UTRA); LTE Positioning Protocol (LPP)".

  [23]	3GPP TS 36.413: "Evolved Universal Terrestrial Access Network (E-UTRAN); S1 Application Protocol (S1AP)".

  [23A]	3GPP TS 45.008: "Radio Access Network; Radio subsystem link control".

  [24]	Void.

  [24A]	IETF RFC 3633: "IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6".

  [25]	Void.

  [26]	Void.

  [27]	Void.

  [28]	Void.

  [29]	ISO/IEC 10646: "Information technology – Universal Multiple-Octet Coded Character Set (UCS)".

  [30]	ITU-T Recommendation E.212: "The international identification plan for mobile terminals and mobile users".

  [31]	3GPP TS 23.303: "Proximity-based services (ProSe); Stage 2".

  [32]	3GPP TS 24.334: "Proximity-services (ProSe) User Equipment (UE) to Proximity-services (ProSe) Function Protocol aspects; Stage 3".

  [33]	3GPP TS 23.380: "IMS restoration procedures".

  [34]	3GPP TS 23.161: "Network-Based IP Flow Mobility (NBIFOM); Stage 2".

  [35]	3GPP TS 24.105: "Application specific Congestion control for Data Communication (ACDC) Management Object (MO)".

  [36]	3GPP TS 24.161: "Network-Based IP Flow Mobility (NBIFOM); Stage 3".

  [37]	IETF RFC 5795: "The RObust Header Compression (ROHC) Framework".

  [38]	3GPP TS 36.323: "Evolved Universal Terrestrial Radio Access (E-UTRA); Packet Data Convergence Protocol (PDCP) specification".

  [39]	IETF RFC 6846: "RObust Header Compression (ROHC): A Profile for TCP/IP (ROHC-TCP)".

  [40]	IETF RFC 3095: "RObust Header Compression (ROHC): Framework and four profiles: RTP, UDP, ESP and uncompressed".

  [41]	IETF RFC 3843: "RObust Header Compression (ROHC): A Compression Profile for IP".

  [42]	IETF RFC 4815: "RObust Header Compression (ROHC): Corrections and Clarifications to RFC 3095".

  [43]	IETF RFC 5225: "RObust Header Compression (ROHC) Version 2: Profiles for RTP, UDP, IP, ESP and UDP Lite".

  [44]	3GPP TS 36.306: "Evolved Universal Terrestrial Radio Access (E-UTRA); User Equipment (UE) radio access capabilities".

  [45]	3GPP TS 23.167: "IP Multimedia Subsystem (IMS) emergency sessions".

  [46]	3GPP TS 22.101: "Service aspects; Service principles".

  [47]	3GPP TS 23.285: "Architecture enhancements for V2X services".

  [48]	3GPP TS 24.302: "Access to the 3GPP Evolved Packet Core (EPC) via non-3GPP access networks; Stage 3".

  [49]	3GPP TS 36.321: "Evolved Universal Terrestrial Radio Access (E-UTRA); Medium Access Control (MAC) protocol specification".

  [50]	3GPP TS 24.623: "Extensive Markup Language (XML) Configuration Access Protocol (XCAP) over the Ut interface for Manipulating Supplementary Services".

  [51]	3GPP TS 24.250: "Protocol for Reliable Data Service between UE and SCEF; Stage 3".

  [52]	3GPP TR 38.913: "Study on Scenarios and Requirements for Next Generation Access Technologies".

  [53]	3GPP TS 38.323: "NR; Packet Data Convergence Protocol (PDCP) specification".

  [54]	3GPP TS 24.501: "Non-Access-Stratum (NAS) protocol for 5G System (5GS); Stage 3".

  [55]	IETF RFC 5031: "A Uniform Resource Name (URN) for Emergency and Other Well-Known Services".

  [56]	3GPP TS 33.501: "Security architecture and procedures for 5G System".

  [57]	3GPP TS 23.040: "Technical realization of the Short Message Service (SMS)".


3	Definitions and abbreviations


3.1	Definitions

For the purposes of the present document, the terms and definitions given in 3GPP TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [1].

The term "mobile station" (MS) in the present document is synonymous with the term "user equipment" (UE) as defined in 3GPP TR 21.905 [1].

1x CS fallback capable UE: A UE that uses a CS infrastructure for a voice call and other CS-domain services by falling back to cdma2000® 1x access network if the UE is served by E-UTRAN when a CS service is requested.

5G-EA: 5GS encryption algorithms. The term 5G-EA, 5G-EA0, 128-5G-EA1-3 and 5G-EA4-7 used in the present document corresponds to the term NEA, NEA0, NEA1-3 and NEA4-7 defined in 3GPP TS 33.501 [56].

5G-IA: 5GS integrity algorithms. The term 5G-IA, 5G-IA0, 128-5G-IA1-3 and 5G-IA4-7 used in the present document corresponds to the term NIA, NIA0, NIA1-3 and NIA4-7 defined in 3GPP TS 33.501 [56].

Aggregate maximum bit rate: The maximum bit rate that limits the aggregate bit rate of a set of non-GBR bearers of a UE. Definition derived from 3GPP TS 23.401 [10].

APN based congestion control: Congestion control in session management where the network can reject session management requests from UEs or deactivate PDN connections when the associated APN is congested.

Attached for emergency bearer services: A UE is attached for emergency bearer services if it has only a PDN connection for emergency bearer services established.

Chosen PLMN: The same as selected PLMN as specified in 3GPP TS 23.122 [6].

Control plane CIoT EPS optimization: signalling optimizations to enable efficient transport of user data (IP, non-IP or SMS) over control plane via the MME including optional header compression of IP data.

User plane CIoT EPS optimization: signalling optimizations to enable efficient transport of user data (IP or non-IP) over the user plane.

UE supporting CIoT EPS optimizations: A UE that supports control plane CIoT EPS optimization or user plane CIoT EPS optimization and one or more other CIoT EPS optimizations when the UE is in S1 mode.

Attached for EPS services with CP-CIoT EPS optimization: A UE supporting CIoT EPS optimizations is attached for EPS services, and control plane CIoT EPS optimization along with one or more other CIoT EPS optimizations have been accepted by the network.

Attached for EPS services with User plane CIoT EPS optimization: A UE supporting CIoT EPS optimizations is attached for EPS services, and user plane CIoT EPS optimization along with one or more other CIoT EPS optimizations have been accepted by the network.

Attached for EPS services with CIoT EPS optimization: A UE is attached for EPS services with CP-CIoT EPS optimization or attached for EPS services with user plane CIoT EPS optimization.

CS fallback cancellation request: A request received from the MM sublayer to cancel a mobile originating CS fallback.

CS fallback capable UE: A UE that uses a CS infrastructure for a voice call and other CS-domain services by falling back to A/Gb or Iu mode if the UE is served by E-UTRAN when a CS service is requested.

CSG cell: A cell in which only members of the CSG can get normal service. Depending on local regulation, the CSG cell can provide emergency bearer services also to subscribers who are not member of the CSG. Definition derived from 3GPP TS 23.401 [10].

CSG ID: A CSG ID is a unique identifier within the scope of one PLMN defined in 3GPP TS 23.003 [2] which identifies a Closed Subscriber Group (CSG) in the PLMN associated with a cell or group of cells to which access is restricted to members of the CSG.

CSG selection: A UE supporting CSG selection selects CSG cell either automatically based on the list of allowed CSG identities or manually based on user selection of CSG on indication of list of available CSGs. Definition derived from 3GPP TS 23.122 [6].

Dedicated bearer: An EPS bearer that is associated with uplink packet filters in the UE and downlink packet filters in the PDN GW where the filters only match certain packets. Definition derived from 3GPP TS 23.401 [10].

Default bearer: An EPS bearer that gets established with every new PDN connection. Its context remains established throughout the lifetime of that PDN connection. A default EPS bearer is a non-GBR bearer. Definition derived from 3GPP TS 23.401 [10].

Emergency EPS bearer context: A default EPS bearer context which was activated with request type "emergency" or "handover of emergency bearer services", or any dedicated EPS bearer context associated to this default EPS bearer context.

EMM context: An EMM context is established in the UE and the MME when an attach procedure is successfully completed.

EMM-CONNECTED mode: A UE is in EMM-CONNECTED mode when a NAS signalling connection between UE and network is established. The term EMM-CONNECTED mode used in the present document corresponds to the term ECM-CONNECTED state used in 3GPP TS 23.401 [10].

EMM-IDLE mode: A UE is in EMM-IDLE mode when no NAS signalling connection between UE and network exists or when RRC connection suspend has been indicated by lower layers. The term EMM-IDLE mode used in the present document corresponds to the term ECM-IDLE state used in 3GPP TS 23.401 [10].

EPS security context: In the present specification, EPS security context is used as a synonym for EPS NAS security context specified in 3GPP TS 33.401 [19].

EPS services: Services provided by PS domain. Within the context of this specification, EPS services is used as a synonym for GPRS services in 3GPP TS 24.008 [13].

Evolved packet core network: The successor to the 3GPP Release 7 packet-switched core network, developed by 3GPP within the framework of the 3GPP System Architecture Evolution (SAE).

Evolved packet system: The evolved packet system (EPS) or evolved 3GPP packet-switched domain consists of the evolved packet core network and the evolved universal terrestrial radio access network. Definition derived from 3GPP TS 23.401 [10].

GBR bearer: An EPS bearer that uses dedicated network resources related to a guaranteed bit rate (GBR) value, which are permanently allocated at EPS bearer establishment/modification. Definition derived from 3GPP TS 23.401 [10].

General NAS level mobility management congestion control: The type of congestion control that is applied at a general overload or congestion situation in the network, e.g. lack of processing resources.

Group specific session management congestion control: Type of congestion control at session management level that is applied to reject session management requests from UEs belonging to a particular group when one or more group congestion criteria as specified in 3GPP TS 23.401 [10] are met.

Highest ranked ACDC category: The ACDC category with the lowest value as defined in 3GPP TS 24.105 [35].

Initial NAS message: A NAS message is considered as an initial NAS message, if this NAS message can trigger the establishment of a NAS signalling connection. For instance, the ATTACH REQUEST message is an initial NAS message.

IPv4v6 capability: Capability of the IP stack associated with a UE to support a dual stack configuration with both an IPv4 address and an IPv6 address allocated.

Kilobit: 1000 bits.

Last Visited Registered TAI: A TAI which is contained in the TAI list that the UE registered to the network and which identifies the tracking area last visited by the UE.

Linked Bearer Identity: This identity indicates to which default bearer the additional bearer resource is linked.

LIPA PDN connection: A PDN connection, for which the default EPS bearer context or default PDP context was activated with an APN authorized to use LIPA. The network authorizes an APN for using LIPA based on the subscription profile (see 3GPP TS 29.272 [16C]) and subsequently the network considers this PDN connection a LIPA PDN connection.

Lower layer failure: A failure reported by the AS to the NAS that cannot be corrected on AS level. When the AS indicates a lower layer failure to NAS, the NAS signalling connection is not available.

Mapped EPS security context: A mapped security context to be used in EPS. Definition derived from 3GPP TS 33.401 [19].

Mapped GUTI: A GUTI which is mapped from a P-TMSI and an RAI allocated previously by an SGSN. Mapping rules are defined in 3GPP TS 23.003 [2]. Definition derived from 3GPP TS 23.401 [10].

Megabit: 1,000,000 bits.

Message header: A standard L3 message header as defined in 3GPP TS 24.007 [12].

MME area: An area containing tracking areas served by an MME.

MO MMTEL voice call is started: the MO-MMTEL-voice-started indication was received from upper layers (see 3GPP TS 24.173 [13E]) and after reception of the MO-MMTEL-voice-started indication, the MO-MMTEL-voice-ended indication has not been received.

MO MMTEL video call is started: the MO-MMTEL-video-started indication was received from upper layers (see 3GPP TS 24.173 [13E]) and after reception of the MO-MMTEL-video-started indication, the MO-MMTEL-video-ended indication has not been received.

MO SMSoIP is started: the MO-SMSoIP-attempt-started indication was received from upper layers (see 3GPP TS 24.341 [15D]) and after reception of the MO-SMSoIP-attempt-started indication, the MO-SMSoIP-attempt-ended indication has not been received.

NAS level mobility management congestion control: Congestion control mechanism in the network in mobility management. "NAS level mobility management congestion control" consists of "subscribed APN based congestion control" and "general NAS level mobility management congestion control".

NAS signalling connection: A peer to peer S1 mode connection between UE and MME. A NAS signalling connection consists of the concatenation of an RRC connection via the "LTE-Uu" interface and an S1AP connection via the S1 interface. Additionally, for the purpose of optimized handover or idle mode mobility from cdma2000® HRPD access to E-UTRAN (see 3GPP TS 23.402 [11]), the NAS signalling connection can consist of a concatenation of an S101-AP connection and a signalling tunnel over a cdma2000® HRPD access network.

  NOTE 1:	cdma2000® is a registered trademark of the Telecommunications Industry Association (TIA-USA).

NAS signalling connection recovery: A mechanism initiated by the NAS to restore the NAS signalling connection on indication of "RRC connection failure" by the lower layers.

Native GUTI: A GUTI previously allocated by an MME. Definition derived from 3GPP TS 23.401 [10].

Non-access stratum protocols: The protocols between UE and MSC or SGSN that are not terminated in the UTRAN, and the protocols between UE and MME that are not terminated in the E-UTRAN. Definition derived from 3GPP TR 21.905 [1].

Non-emergency EPS bearer context: Any EPS bearer context which is not an emergency EPS bearer context.

Non-EPS services: Services provided by CS domain. Within the context of this specification, non-EPS services is used as a synonym for non-GPRS services in 3GPP TS 24.008 [13]. A UE which camps on E-UTRAN can attach to both EPS services and non-EPS services.

Non-GBR bearer: An EPS bearer that uses network resources that are not related to a guaranteed bit rate (GBR) value. Definition derived from 3GPP TS 23.401 [10].

PDN address: An IP address assigned to the UE by the Packet Data Network Gateway (PDN GW).

PDN connection for emergency bearer services: A PDN connection for which the default EPS bearer context or default PDP context was activated with request type "emergency" or "handover of emergency bearer services".

Plain NAS message: A NAS message with a header including neither a message authentication code nor a sequence number.

Persistent EPS bearer context: either a non-emergency EPS bearer context representing a GBR bearer with QoS equivalent to QoS of teleservice 11 and where there is a radio bearer associated with that context, or an emergency EPS bearer context where there is a radio bearer associated with that context.

  NOTE 2:	An example of a persistent EPS bearer context is a non-emergency EPS bearer context with QCI = 1 where there is a radio bearer associated with that context.

Procedure Transaction Identity: An identity which is dynamically allocated by the UE for the UE requested ESM procedures. The procedure transaction identity is released when the procedure is completed.

RAT-related TMSI: When the UE is camping on an E-UTRAN cell, the RAT-related TMSI is the GUTI; when it is camping on a GERAN or UTRAN cell, the RAT-related TMSI is the P-TMSI.

Registered PLMN: The PLMN on which the UE is registered. The identity of the registered PLMN is provided to the UE within the GUTI.

Relay node: A network element in the E-UTRAN, wirelessly connected to an eNode B and providing relaying function to UEs served by the E-UTRAN. Definition derived from 3GPP TS 23.401 [10].

Removal of eCall only mode restriction: All the limitations as described in 3GPP TS 22.101 [46] for the eCall only mode do not apply any more.

The label (S1 mode only) indicates that this subclause or paragraph applies only to a system which operates in S1 mode, i.e. with a functional division that is in accordance with the use of an S1 interface between the radio access network and the core network. The S1 mode includes WB-S1 mode and NB-S1 mode. In a multi-access system this case is determined by the current serving radio access network.

In NB-S1 mode: Indicates this paragraph applies only to a system which operates in NB-S1 mode. For a multi-access system this case applies if the current serving radio access network provides access to network services via E-UTRA by NB-IoT (see 3GPP TS 36.300 [20], 3GPP TS 36.331 [22], 3GPP TS 36.306 [44]).

In WB-S1 mode: Indicates this paragraph applies only to a system which operates in WB-S1 mode. For a multi-access system this case applies if the system operates in S1 mode, but not in NB-S1 mode.

In WB-S1/CE mode: Indicates this paragraph applies only when a UE, which is a CE mode B capable UE (see 3GPP TS 36.306 [44]), is operating in CE mode A or B in WB-S1 mode.

SCEF PDN Connection: A PDN connection established between the UE and the Service Capability Exposure Function (SCEF) for transmitting the UE's non-IP data related to a specific application.

SGi PDN Connection: A PDN connection established between the UE and the Packet Gateway (P-GW) for transmitting the UE's IP or non-IP data related to a specific application.

S101 mode: Applies to a system that operates with a functional division that is in accordance with the use of an S101 interface. For the definition of the S101 reference point, see 3GPP TS 23.402 [11].

SIPTO at the local network PDN connection: A PDN connection, for which the default EPS bearer context or default PDP context was activated with an APN authorized to use SIPTO at the local network and it was activated such that the traffic of the PDN connection will be using an L-GW. The network authorizes an APN for using SIPTO at the local network based on the subscription profile (see 3GPP TS 29.272 [16C]) and subsequently the network considers this PDN connection a SIPTO at the local network PDN connection.

SIPTO at the local network PDN connection with a collocated L-GW: A SIPTO at the local network PDN connection which is established to a L-GW function collocated with the (H)(e)NodeB. The core-network entity (i.e. the MME or the SGSN) can be aware of whether the SIPTO at the local network PDN connection with a collocated L-GW is used when the PDN connection is established.

SIPTO at the local network PDN connection with a stand-alone GW: A SIPTO at the local network PDN connection which is established to a stand-alone GW (with collocated L-GW and S-GW). The core-network entity (i.e. the MME or the SGSN) can be aware of whether the SIPTO at the local network PDN connection with a stand-alone GW is used when the PDN connection is established.

"SMS only": A subset of services which includes only Short Message Service. A UE camping on E-UTRAN can attach to both EPS services and "SMS only".

SMS over NAS: refers to SMS in MME or SMS over SGs.

SMS over S102: refers to SMS which uses 1xCS procedures in EPS as defined in 3GPP TS 23.272 [9].

Subscribed APN based congestion control: Congestion control in mobility management where the network can reject attach requests from UEs with a certain APN in the subscription.

TAI list: A list of TAIs that identify the tracking areas that the UE can enter without performing a tracking area updating procedure. The TAIs in a TAI list assigned by an MME to a UE pertain to the same MME area.

Traffic flow aggregate: A temporary aggregate of packet filters that are included in a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure and that is inserted into a traffic flow template (TFT) for an EPS bearer context by the network once the UE requested bearer resource allocation procedure or UE requested bearer resource modification procedure is completed.

UE configured for dual priority: A UE which provides dual priority support is configured for NAS signalling low priority and also configured to override the NAS signalling low priority indicator (see 3GPP TS 24.368 [15A], 3GPP TS 31.102 [17]).

UE configured to use AC11 – 15 in selected PLMN: A UE configured with at least one access class in the range 11-15 on the USIM, and the access class is applicable in the selected PLMN according to 3GPP TS 22.011 [1A].

UE's availability for voice calls in the IMS: The indication of this availability or non-availability is provided by the upper layers of the UE as specified in 3GPP TS 24.229 [13D] in the annex relevant to the IP-Connectivity Access Network in use or determined in the NAS layer, as specified in subclause 4.3.1. If availability is indicated, the UE uses the IM CN Subsystem and can terminate or originate requests for SIP sessions including an audio component with codecs suited for voice.

UE's usage setting: This is a UE setting that indicates whether the UE has preference for voice services over data services or vice-versa. If a UE has preference for voice services, then the UE's usage setting is "voice centric". If a UE has preference for data services, then the UE's usage setting is "data centric". A UE whose setting is "data centric" may still require access to voice services. A UE whose setting is "voice centric" may still require access to data services. This definition is derived from 3GPP TS 23.221 [8A] and it applies to voice capable UEs. If the UE is capable of both S1 mode and N1 mode, there is a single UE's usage setting which applies to both 5GS and EPS (see 3GPP TS 24.501 [54]).

UE using EPS services with control plane CIoT EPS optimization: A UE that is attached for EPS services with the control plane CIOT EPS optimization accepted by the network.

For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.401 [10] apply:

  Cellular IoT (CIoT)
  DCN-ID
  eCall only mode
  NarrowBand-IoT
  Dedicated core network
  PDN connection
  Service Gap Control
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.272 [9] apply:

  CS fallback
  SMS in MME
  SMS over SGs
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.682 [11A] apply:

  SCEF
For the purposes of the present document, the following terms and definitions given in 3GPP TS 24.008 [13] apply:

  A/Gb mode
  Access domain selection
  Default PDP context
  Extended idle-mode DRX cycle
  Iu mode
  Power saving mode
  PS signalling connection
  RR connection
  TFT
For the purposes of the present document, the following terms and definitions given in 3GPP TS 33.102 [18] apply:

  UMTS security context
For the purposes of the present document, the following terms and definitions given in 3GPP TS 33.401 [19] apply:

  Current EPS security context
  Full native EPS security context
  KASME
  K'ASME
  Mapped security context
  Native EPS security context
  Non-current EPS security context
  Partial native EPS security context
  Data via MME
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.122 [6] apply:

  Country
  EHPLMN
  HPLMN
  Shared Network
  Suitable Cell
  VPLMN
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.216 [8] apply:

  SRVCC
  vSRVCC
For the purposes of the present document, the following terms and definitions given in 3GPP TS 22.011 [1A] apply:

  Extended Access Barring
  Application specific Congestion control for Data Communication (ACDC)
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.003 [10] apply:

  Local Home Network Identifier
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.303 [31] apply:

  ProSe direct communication
  ProSe direct discovery
  ProSe UE-to-Network Relay
For the purposes of the present document, the following terms and definitions given in 3GPP TS 24.161 [36] apply:

  Multi-access PDN connection
  NBIFOM
For the purposes of the present document, the following terms and definitions given in 3GPP TS 23.167 [45] apply:

  eCall over IMS
For the purposes of the present document, the following terms and definitions given in 3GPP TS 24.501 [54] apply:

  N1 mode

3.2	Abbreviations

For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].

  5G-GUTI	5G-Globally Unique Temporary Identifier
  5GMM	5GS Mobility Management
  5GS	5G System
  ACDC	Application specific Congestion control for Data Communication
  AKA	Authentication and Key Agreement
  AMBR	Aggregate Maximum Bit Rate
  APN	Access Point Name
  APN-AMBR	APN Aggregate Maximum Bit Rate
  ARP	Allocation Retention Priority
  BCM	Bearer Control Mode
  CIoT	Cellular IoT
  CP-CIoT	Control Plane CIoT
  CP-EDT	Control Plane EDTCSG	Closed Subscriber Group
  E-UTRA	Evolved Universal Terrestrial Radio Access
  E-UTRAN	Evolved Universal Terrestrial Radio Access Network
  EAB	Extended Access Barring
  ECM	EPS Connection Management
  eDRX	Extended idle-mode DRX cycle
  EDT	Early Data Transmission
  EENLV	Extended Emergency Number List Validity
  eKSI	Key Set Identifier for E-UTRAN
  EMM	EPS Mobility Management
  eNode B	Evolved Node B
  EPC	Evolved Packet Core Network
  EPS	Evolved Packet System
  ESM	EPS Session Management
  GBR	Guaranteed Bit Rate
  GUMMEI	Globally Unique MME Identifier
  GUTI	Globally Unique Temporary Identifier
  HeNB	Home eNode B
  HRPD	High Rate Packet Data
  IoT	Internet of Things
  IP-CAN	IP-Connectivity Access Network
  ISR	Idle mode Signalling Reduction
  kbps	Kilobits per second
  KSI	Key Set Identifier
  L-GW	Local PDN Gateway
  LHN-ID	Local Home Network Identifier
  LIPA	Local IP Access
  M-TMSI	M-Temporary Mobile Subscriber Identity
  Mbps	Megabits per second
  MBR	Maximum Bit Rate
  MME	Mobility Management Entity
  MMEC	MME Code
  NB-IoT	Narrowband IoT
  NR	New Radio
  NSSAI	Network Slice Selection Assistance Information
  PD	Protocol Discriminator
  PDN GW	Packet Data Network Gateway
  ProSe	Proximity-based Services
  PSM	Power Saving Mode
  PTI	Procedure Transaction Identity
  QCI	QoS Class Identifier
  QoS	Quality of Service
  ROHC	RObust Header Compression
  RRC	Radio Resource Control
  S-NSSAI	Single NSSAI
  S-TMSI	S-Temporary Mobile Subscriber Identity
  S101-AP	S101 Application Protocol
  S1AP	S1 Application Protocol
  SAE	System Architecture Evolution
  SCEF	Service Capability Exposure Function
  SGC	Service Gap Control
  SIPTO	Selected IP Traffic Offload
  TA	Tracking Area
  TAC	Tracking Area Code
  TAI	Tracking Area Identity
  TFT	Traffic Flow Template
  TI	Transaction Identifier
  TIN	Temporary Identity used in Next update
  URN	Uniform Resource Name
  V2X	Vehicle-to-Everything

4	General


4.1	Overview

The non-access stratum (NAS) described in the present document forms the highest stratum of the control plane between UE and MME at the radio interface (reference point "LTE-Uu"; see 3GPP TS 23.401 [10]).

Main functions of the protocols that are part of the NAS are:

  -	the support of mobility of the user equipment (UE); and

  -	the support of session management procedures to establish and maintain IP connectivity between the UE and a packet data network gateway (PDN GW).

NAS security is an additional function of the NAS providing services to the NAS protocols, e.g. integrity protection and ciphering of NAS signalling messages.

For the support of the above functions, the following procedures are supplied within this specification:

  -	elementary procedures for EPS mobility management in clause 5; and

  -	elementary procedures for EPS session management in clause 6.

Complete NAS transactions consist of specific sequences of elementary procedures. Examples of such specific sequences can be found in 3GPP TS 23.401 [10].

The NAS for EPS follows the protocol architecture model for layer 3 as described in 3GPP TS 24.007 [12]; however, due to the objective of EPS to provide the subscriber with a "ready-to-use" IP connectivity and an "always-on" experience, the protocol supports a linkage between mobility management and session management procedures during the attach procedure (see subclause 4.2).

Signalling procedures for the control of NAS security are described as part of the EPS mobility management in clause 5. In addition to that, principles for the handing of EPS security contexts and for the activation of ciphering and integrity protection, when a NAS signalling connection is established, are provided in subclause 4.4.


4.2	Linkage between the protocols for EPS mobility management and EPS session management

During the EPS attach procedure, the network can activate a default EPS bearer context (i.e. if the UE requests PDN connectivity in the attach request). Additionally, the network can activate one or several dedicated EPS bearer contexts in parallel for PDN connections of IP PDN type. To this purpose the EPS session management messages for the default EPS bearer context activation can be transmitted in an information element in the EPS mobility management messages. In this case, the UE and the network execute the attach procedure, the default EPS bearer context activation procedure, and the dedicated EPS bearer context activation procedure in parallel. The UE and network shall complete the combined default EPS bearer context activation procedure and the attach procedure before the dedicated EPS bearer context activation procedure is completed. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, then the success of the attach procedure is dependent on the success of the default EPS bearer context activation procedure. If the attach procedure fails, then the ESM procedures also fail.

A UE using EPS services with control plane CIoT EPS optimization can initiate transport of user data via the control plane. For this purpose a UE in EMM-IDLE mode can initiate the service request procedure and transmit the ESM DATA TRANSPORT message in an information element in the CONTROL PLANE SERVICE REQUEST message.

Except for the attach procedure and the service request procedure, during EMM procedures the MME shall suspend the transmission of ESM messages. During the service request procedure the MME may suspend the transmission of ESM messages.

Except for the attach procedure and the service request procedure for UE initiated transport of user data via the control plane, during EMM procedures the UE shall suspend the transmission of ESM messages.


4.2A	Handling of NAS signalling low priority indication

A UE configured for NAS signalling low priority (see 3GPP TS 24.368 [15A], 3GPP TS 31.102 [17]) indicates this by including the Device properties IE in the appropriate NAS message and setting the low priority indicator to "MS is configured for NAS signalling low priority", except for the following cases in which the UE shall set the low priority indicator to "MS is not configured for NAS signalling low priority":

  -	the UE is performing an attach for emergency bearer services;

  -	the UE has a PDN connection for emergency bearer services established and is performing EPS mobility management procedures, or is establishing a PDN connection for emergency bearer services;

  -	the UE configured for dual priority is requested by the upper layers to establish a PDN connection with the low priority indicator set to "MS is not configured for NAS signalling low priority";

  -	the UE configured for dual priority is performing EPS session management procedures related to the PDN connection established with low priority indicator set to "MS is not configured for NAS signalling low priority";

  -	the UE configured for dual priority has a PDN connection established by setting the low priority indicator to "MS is not configured for NAS signalling low priority" and is performing EPS mobility management procedures;

  -	the UE is performing a service request procedure for a CS fallback emergency call or 1xCS fallback emergency call;

  -	the UE is a UE configured to use AC11 – 15 in selected PLMN; or

  -	the UE is responding to paging.

The network may use the NAS signalling low priority indication for NAS level mobility management congestion control and APN based congestion control.

If the NAS signalling low priority indication is provided in a PDN CONNECTIVITY REQUEST message, the MME stores the NAS signalling low priority indication within the default EPS bearer context activated due to the PDN connectivity request procedure.


4.3	UE mode of operation


4.3.1	General

A UE attached for EPS services shalloperate in one of the following operation modes:

  -	PS mode 1 of operation: the UE registers only to EPS services, and UE's usage setting is "voice centric";

  -	PS mode 2 of operation: the UE registers only to EPS services, and UE's usage setting is "data centric";

  -	CS/PS mode 1 of operation: the UE registers to both EPS and non-EPS services, and UE's usage setting is "voice centric"; and

  -	CS/PS mode 2 of operation: the UE registers to both EPS and non-EPS services, and UE's usage setting is "data centric".

A UE configured to use CS fallback, shall operate in CS/PS mode 1 or CS/PS mode 2. Such UE may also be configured to use IMS, in which case the voice domain preference for E-UTRAN as defined in 3GPP TS 24.167 [13B] shall be used for the selection of the domain for originating voice communication services.

  NOTE 1:	The domain selected for originating voice communication services can be ignored by attempting a CS emergency call.

Upon request from upper layers to establish a CS emergency call:

  -	if the UE needs to initiate a CS fallback emergency call but it is unable to perform CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology, and a UE with "IMS voice not available" should disable the E-UTRA capability (see subclause 4.5) to allow a potential callback, and then progress the CS emergency call establishment;

  -	if the UE needs to initiate a 1xCS fallback emergency call but it is unable to perform 1xCS fallback, the UE shall attempt to select cdma2000® 1x radio access technology to establish the call.

  NOTE 2:	Unable to perform CS fallback or 1xCS fallback means that either the UE was not allowed to attempt CS fallback or 1xCS fallback, or CS fallback or 1xCS fallback attempt failed.

A UE configured to use SMS over SGs shall operate in CS/PS mode 1 or CS/PS mode 2.

The behaviour of the UE in CS/PS mode 1 of operation, upon failure to access the CS domain or upon reception of a "CS fallback not preferred" or "SMS only" indication, will depend on the availability of voice over IMS. In the present document, "IMS voice not available" refers to one of the following conditions:

  a)	the UE is not configured to use IMS;

  b)	the UE is not configured to use IMS voice, i.e. when the voice domain preference for E-UTRAN, as defined in 3GPP TS 24.167 [13B], indicates that voice communication services are allowed to be invoked only over the CS domain;

  c)	the UE is configured to use IMS voice, but the network indicates in the ATTACH ACCEPT message or the TRACKING AREA UPDATE ACCEPT message that IMS voice over PS sessions are not supported; or

  d)	the UE is configured to use IMS voice, the network indicates in the ATTACH ACCEPT message or the TRACKING AREA UPDATE ACCEPT message that IMS voice over PS sessions are supported, but the upper layers:

    -	provide no indication that the UE is available for voice call in the IMS within a manufacturer determined period of time; or

    -	indicate that the UE is not available for voice calls in the IMS.

  NOTE 3:	If conditions a, b and c evaluate to false, the upper layers need time to attempt IMS registration. In the event an indication from the upper layers that the UE is available for voice calls in the IMS takes longer than the manufacturer determined period of time (e.g. due to delay when attempting IMS registration or due to delay obtaining an EPS bearer context for SIP signalling), the NAS layer assumes the UE is not available for voice calls in the IMS.

Other conditions may exist but these are implementation specific.

In the present document, "IMS voice available" refers to the conditions a, b, c and d, and other implementation specific conditions for "IMS voice not available" evaluate to false.


4.3.2	Change of UE mode of operation


4.3.2.1	General

The UE mode of operation can change as a result of e.g.:

  -	a change of UE's usage setting for a CS voice capable UE;

  -	a change of voice domain preference for E-UTRAN as defined in 3GPP TS 24.167 [13B] for a CS voice capable UE;

  -	a change in the UE's availability for voice calls in the IMS; or

  -	a change in UE configuration regarding the use of SMS as defined in 3GPP TS 24.167 [13B].

Figure 4.3.2.1.1 and figure 4.3.2.1.2 illustrate the transitions between different UE mode of operations when UE's usage settings, voice domain preference for E-UTRAN or configuration regarding SMS changes.

[pic]

  NOTE 1:	The UE may transit from CS/PS mode 1 to PS mode 1 or from CS/PS mode 2 to PS mode 2 if "CS domain not available" is received. After the transition to PS mode 1 or PS mode 2 due to "CS domain not available", the UE can transit back to CS/PS mode 1 or CS/PS mode 2, e.g. due to change of PLMN which is not in the list of the equivalent PLMNs.
  NOTE 2:	Not all possible transitions are shown in this figure.


Figure 4.3.2.1.1: Change of UE mode of operation for a CS voice capable UE

[pic]

  NOTE:	Not all possible transitions are shown in this figure.


Figure 4.3.2.1.2: Change of UE mode of operation for a UE with no CS voice capability


4.3.2.2	Change of UE's usage setting

Whenever the UE's usage setting changes, the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.2.1 and table 4.3.2.2.2:

  a)	The UE is operating in PS mode 1 or PS mode 2

Table 4.3.2.2.1: Change of UE's usage setting for a UE in PS mode 1 or PS mode 2

|UE's usage setting change       |Procedure to execute                                                                        |
|From data centric to voice      |Disable the E-UTRA capability if voice domain selection results in a selection to a         |
|centric and "IMS voice not      |different RAT (see subclause 4.5), or combined tracking area update with IMSI attach if     |
|available"                      |voice domain selection results in attempt to stay in E-UTRAN.                               |
|From voice centric to data      |Re-enable the E-UTRA capability (see subclause 4.5)                                         |
|centric and E-UTRA is disabled  |                                                                                            |


  b)	The UE is operating in CS/PS mode 1 or CS/PS mode 2

Table 4.3.2.2.2: Change of UE's usage setting for a UE in CS/PS mode 1 or CS/PS mode 2

|UE's usage setting change       |Procedure to execute                                                                        |
|From data centric to voice      |Disable the E-UTRA capability (see subclause 4.5)                                           |
|centric, "CS fallback is not    |                                                                                            |
|available" and "IMS voice not   |                                                                                            |
|available" (NOTE 1)             |                                                                                            |
|From data centric to voice      |Disable the E-UTRA capability (see subclause 4.5)                                           |
|centric, "IMS voice not         |                                                                                            |
|available" and the UE received a|                                                                                            |
|"CS fallback not preferred" or  |                                                                                            |
|"SMS only" indication during the|                                                                                            |
|last successful combined attach |                                                                                            |
|or combined tracking area       |                                                                                            |
|updating procedure              |                                                                                            |
|From voice centric to data      |Re-enable the E-UTRA capability (see subclause 4.5)                                         |
|centric and E-UTRA is disabled  |                                                                                            |
|NOTE 1: "CS fallback is not available" includes EMM causes #16, #17, and #18                                                 |



4.3.2.3	Change of voice domain preference for E-UTRAN

Whenever the voice domain preference for E-UTRAN changes, the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.3.1 and table 4.3.2.3.2:

  a)	The UE is operating in PS mode 1 or PS mode 2

Table 4.3.2.3.1: Change of voice domain preference for E-UTRAN for a UE in PS mode 1 or PS mode 2

|Voice domain preference for     |Procedure to execute                                                                        |
|E-UTRAN change                  |                                                                                            |
|From "IMS PS voice only" to "CS |Transit from PS mode 1 to CS/PS mode 1 or from PS mode 2 to CS/PS mode 2. Combined tracking |
|voice only" or "CS voice        |area update with IMSI attach                                                                |
|preferred, IMS PS Voice as      |                                                                                            |
|secondary"                      |                                                                                            |
|From "IMS PS voice preferred, CS|Transit from PS mode 1 to CS/PS mode 1 or from PS mode 2 to CS/PS mode 2. Combined tracking |
|Voice as secondary" to "CS voice|area update with IMSI attach                                                                |
|only" or "CS voice preferred,   |                                                                                            |
|IMS PS Voice as secondary"      |                                                                                            |


  b)	The UE is operating in CS/PS mode 1 or CS/PS mode 2

Table 4.3.2.3.2: Change of voice domain preference for E-UTRAN for a UE in CS/PS mode 1 or CS/PS mode 2

|Voice domain preference for     |Procedure to execute                                                                        |
|E-UTRAN change                  |                                                                                            |
|From any configuration to "IMS  |May:                                                                                        |
|PS voice only", UE is configured|- transit from CS/PS mode 1 to PS mode 1 or from CS/PS mode 2 to PS mode 2; and             |
|to prefer SMS over IP networks  |- detach for non-EPS services                                                               |
|and the UE is available for     |                                                                                            |
|voice calls in the IMS.         |                                                                                            |
|From any configuration to "CS   |Disable the E-UTRA capability (see subclause 4.5)                                           |
|voice only", UE is in CS/PS mode|                                                                                            |
|1 of operation and "CS fallback |                                                                                            |
|is not available"(NOTE 1)       |                                                                                            |
|From any configuration to "CS   |Disable the E-UTRA capability (see subclause 4.5)                                           |
|voice only", UE is in CS/PS mode|                                                                                            |
|1 of operation and the UE       |                                                                                            |
|received a "CS fallback not     |                                                                                            |
|preferred" or "SMS only"        |                                                                                            |
|indication during the last      |                                                                                            |
|successful combined attach or   |                                                                                            |
|combined tracking area updating |                                                                                            |
|procedure.                      |                                                                                            |
|NOTE 1: "CS fallback is not available" includes EMM causes #16, #17, and #18                                                 |



4.3.2.4	Change or determination of IMS registration status

Whenever the UE's availability for voice calls in the IMS is determined or changes (e.g. whenever the IMS registration status is determined or changes), the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.4.1, 4.3.2.4.2 or 4.3.2.4.3:

  a)	The UE is operating in PS mode 1

Table 4.3.2.4.1: Change of IMS registration status for a UE in PS mode 1

|Change of IMS registration      |Procedure to execute                                                                        |
|status                          |                                                                                            |
|UE is not available for voice   |Transit to CS/PS mode 1. Combined tracking area update with IMSI attach                     |
|calls in the IMS indication and |                                                                                            |
|voice domain preference for     |                                                                                            |
|E-UTRAN is "IMS PS voice        |                                                                                            |
|preferred, CS Voice as          |                                                                                            |
|secondary"                      |                                                                                            |
|UE is not available for voice   |Disable the E-UTRA capability (see subclause 4.5)                                           |
|calls in the IMS indication, SMS|                                                                                            |
|configuration is set to prefer  |                                                                                            |
|to use SMS over IP networks, and|                                                                                            |
|voice domain preference for     |                                                                                            |
|E-UTRAN is "IMS PS voice only"  |                                                                                            |
|UE is not available for voice   |May disable the E-UTRA capability (see subclause 4.5)                                       |
|calls in the IMS indication, SMS|                                                                                            |
|configuration is set to prefer  |                                                                                            |
|to use SMS over IP networks, and|                                                                                            |
|UE is not CS voice capable      |                                                                                            |


  NOTE 1:	If the UE in PS mode 1 transits to CS/PS mode 1 according to table 4.3.2.4.1, then the UE can return to PS mode 1 when the upper layer indicates the status of being available for voice over PS.

  b)	The UE is operating in PS mode 2

Table 4.3.2.4.2: Change of IMS registration status for a UE in PS mode 2

|Change of IMS registration      |Procedure to execute                                                                        |
|status                          |                                                                                            |
|UE is not available for voice   |Transit to CS/PS mode 2. Combined tracking area update with IMSI attach                     |
|calls in the IMS indication and |                                                                                            |
|voice domain preference for     |                                                                                            |
|E-UTRAN is "IMS PS voice        |                                                                                            |
|preferred, CS Voice as          |                                                                                            |
|secondary"                      |                                                                                            |
|Unsuccessful IMS registration   |Transit to CS/PS mode 2. Combined tracking area update with "SMS only"                      |
|indication from upper layers,   |                                                                                            |
|SMS configuration is set to     |                                                                                            |
|prefer to use SMS over IP       |                                                                                            |
|networks, and voice domain      |                                                                                            |
|preference for E-UTRAN is "IMS  |                                                                                            |
|PS voice only"                  |                                                                                            |
|Unsuccessful IMS registration   |Transit to CS/PS mode 2. Combined tracking area update with "SMS only"                      |
|indication from upper layers,   |                                                                                            |
|SMS configuration is set to     |                                                                                            |
|prefer to use SMS over IP       |                                                                                            |
|networks, and UE is not CS voice|                                                                                            |
|capable                         |                                                                                            |


  NOTE 2:	If the UE in PS mode 2 transits to CS/PS mode 2 according to table 4.3.2.4.2, then the UE can return to PS mode 2 when the upper layer indicates the status of being available for voice over PS.

  c)	The UE is operating in CS/PS mode 1

Table 4.3.2.4.3: Change of IMS registration status for a UE in CS/PS mode 1

|Change of IMS registration      |Procedure to execute                                                                        |
|status                          |                                                                                            |
|UE is not available for voice   |Disable the E-UTRA capability (see subclause 4.5)                                           |
|calls in the IMS indication, and|                                                                                            |
|any of:                         |                                                                                            |
|- "CS fallback is not available"|                                                                                            |
|(NOTE 1); or                    |                                                                                            |
|- the UE received a "CS fallback|                                                                                            |
|not preferred" or "SMS only"    |                                                                                            |
|indication during the last      |                                                                                            |
|successful combined attach or   |                                                                                            |
|combined tracking area updating |                                                                                            |
|procedure                       |                                                                                            |
|UE is not available for voice   |May disable the E-UTRA capability (see subclause 4.5)                                       |
|calls in the IMS indication,    |                                                                                            |
|UE is in state                  |                                                                                            |
|EMM-REGISTERED.ATTEMPTING-TO-UPD|                                                                                            |
|ATE-MM and timer T3402 is       |                                                                                            |
|running                         |                                                                                            |
|NOTE 1: "CS fallback is not available" includes EMM causes #16, #17, and #18                                                 |



4.3.2.5	Change of configuration regarding the use of SMS.

Whenever the UE's configuration on use of SMS changes, the UE dependent on its mode of operation shall execute procedures according to table 4.3.2.5.1 and table 4.3.2.5.2:

  a)	The UE is operating in PS mode 1 or PS mode 2

Table 4.3.2.5.1: Change of configuration regarding the use of SMS in PS mode 1 or PS mode 2

|SMS configuration change                                     |Procedure to execute                                           |
|Change to "SMS service is not preferred to be invoked over IP|Transit from PS mode 1 to CS/PS mode 1 or from PS mode 2 to    |
|networks" or the UE is unable to use SMS using IMS (see      |CS/PS mode 2. Combined tracking area update with IMSI attach,  |
|3GPP TS 24.229 [13D]).                                       |(with or without "SMS only")                                   |


  b)	The UE is operating in CS/PS mode 1 or CS/PS mode 2

Table 4.3.2.5.2: Change of configuration regarding the use of SMS in CS/PS mode 1 or CS/PS mode 2

|SMS configuration change                                     |Procedure to execute                                           |
|Change to "SMS service is preferred to be invoked over IP    |May:                                                           |
|networks", the UE is able to use SMS using IMS (see          |- transit from CS/PS mode 1 to PS mode 1 or from CS/PS mode 2  |
|3GPP TS 24.229 [13D]), and UE has no CS voice capability     |to PS mode 2; and                                              |
|                                                             |- detach for non-EPS services                                  |
|Change to "SMS service is preferred to be invoked over IP    |May:                                                           |
|networks", UE is able to use SMS using IMS (see              |- transit from CS/PS mode 1 to PS mode 1 or from CS/PS mode 2  |
|3GPP TS 24.229 [13D]), and the voice domain preference for   |to PS mode 2; and                                              |
|E-UTRAN is "IMS PS voice only"                               |- detach for non-EPS services                                  |



4.4	NAS security


4.4.1	General

This clause describes the principles for the handling of EPS security contexts in the UE and in the MME and the procedures used for the security protection of EPS NAS messages between UE and MME. Security protection involves integrity protection and ciphering of the EMM and ESM NAS messages.

The signalling procedures for the control of NAS security are part of the EMM protocol and are described in detail in clause 5.

  NOTE:	The use of ciphering in a network is an operator option. In this subclause, for the ease of description, it is assumed that ciphering is used, unless explicitly indicated otherwise. Operation of a network without ciphering is achieved by configuring the MME so that it always selects the "null ciphering algorithm", EEA0.


4.4.2	Handling of EPS security contexts


4.4.2.1	General

The security parameters for authentication, integrity protection and ciphering are tied together in an EPS security context and identified by a key set identifier for E-UTRAN (eKSI). The relationship between the security parameters is defined in 3GPP TS 33.401 [19].

Before security can be activated, the MME and the UE need to establish an EPS security context. Usually, the EPS security context is created as the result of an EPS authentication procedure between MME and UE. Alternatively:

  -	during inter-system handover from A/Gb mode to S1 mode or from Iu mode to S1 mode, the MME and the UE derive a mapped EPS security context from a UMTS security context that has been established while the UE was in A/Gb mode or Iu mode; or

  -	during CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode, the MME and the UE derive a mapped EPS security context from a CS UMTS security context that has been established while the UE was in A/Gb mode or Iu mode.

The EPS security context is taken into use by the UE and the MME, when the MME initiates a security mode control procedure or during the inter-system handover procedure from A/Gb mode to S1 mode or Iu mode to S1 mode. The EPS security context which has been taken into use by the network most recently is called current EPS security context. This current EPS security context can be of type native or mapped, i.e. originating from a native EPS security context or mapped EPS security context.

The key set identifier eKSI is assigned by the MME either during the EPS authentication procedure or, for the mapped EPS security context, during the inter-system handover procedure. The eKSI consists of a value and a type of security context parameter indicating whether an EPS security context is a native EPS security context or a mapped EPS security context. When the EPS security context is a native EPS security context, the eKSI has the value of KSIASME, and when the current EPS security context is of type mapped, the eKSI has the value of KSISGSN.

The EPS security context which is indicated by an eKSI can be taken into use to establish the secure exchange of NAS messages when a new NAS signalling connection is established without executing a new EPS authentication procedure (see subclause 4.4.2.3) or when the MME initiates a security mode control procedure. For this purpose the initial NAS messages (i.e. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, DETACH REQUEST, SERVICE REQUEST, EXTENDED SERVICE REQUEST, and CONTROL PLANE SERVICE REQUEST) and the SECURITY MODE COMMAND message contain an eKSI in the NAS key set identifier IE or the value part of eKSI in the KSI and sequence number IE indicating the current EPS security context used to integrity protect the NAS message.

In the present document, when the UE is required to delete an eKSI, the UE shall set the eKSI to the value "no key is available" and consider also the associated keys KASME or K'ASME, EPS NAS ciphering key and EPS NAS integrity key invalid (i.e. the EPS security context associated with the eKSI as no longer valid).

  NOTE:	In some specifications the term ciphering key sequence number might be used instead of the term Key Set Identifier (KSI).

The UE and the MME need to be able to maintain two EPS security contexts simultaneously, i.e. a current EPS security context and a non-current EPS security context, since:

  -	after an EPS re-authentication, the UE and the MME can have both a current EPS security context and a non-current EPS security context which has not yet been taken into use (i.e. a partial native EPS security context); and

  -	after an inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the UE and the MME can have both a mapped EPS security context, which is the current EPS security context, and a non-current native EPS security context that was created during a previous access in S1 mode or S101 mode.

The number of EPS security contexts that need to be maintained simultaneously by the UE and the MME is limited by the following requirements:

  -	After a successful EPS (re-)authentication, which creates a new partial native EPS security context, the MME and the UE shall delete the non-current EPS security context, if any.

  -	When a partial native EPS security context is taken into use through a security mode control procedure, the MME and the UE shall delete the previously current EPS security context.

  -	When the MME and the UE create an EPS security context using null integrity and null ciphering algorithm during an attach procedure for emergency bearer services, or a tracking area updating procedure for a UE that has a PDN connection for emergency bearer services (see subclause 5.4.3.2), the MME and the UE shall delete the previous current EPS security context.

  -	When a new mapped EPS security context or EPS security context created using null integrity and null ciphering algorithm is taken into use during the inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the MME and the UE shall not delete the previously current native EPS security context, if any. Instead, the previously current native EPS security context shall become a non-current native EPS security context, and the MME and the UE shall delete any partial native EPS security context.

    	If no previously current native EPS security context exists, the MME and the UE shall not delete the partial native EPS security context, if any.

  -	When the MME and the UE derive a new mapped EPS security context during inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, the MME and the UE shall delete any existing current mapped EPS security context.

  -	When a non-current full native EPS security context is taken into use by a security mode control procedure, then the MME and the UE shall delete the previously current mapped EPS security context.

  -	When the UE or the MME moves from EMM-REGISTERED to EMM-DEREGISTERED state, if the current EPS security context is a mapped EPS security context and a non-current full native EPS security context exists, then the non-current EPS security context shall become the current EPS security context. Furthermore, the UE and the MME shall delete any mapped EPS security context or partial native EPS security context.

The UE shall mark the EPS security context on the USIM or in the non-volatile memory as invalid when the UE initiates an attach procedure as described in subclause 5.5.1 or when the UE leaves state EMM-DEREGISTERED for any other state except EMM-NULL.

The UE shall store the current native EPS security context as specified in annex C and mark it as valid only when the UE enters state EMM-DEREGISTERED from any other state except EMM-NULL or when the UE aborts the attach procedure without having left EMM-DEREGISTERED.


4.4.2.2	Establishment of a mapped EPS security context during intersystem handover

In order for the UE to derive a mapped EPS security context for an inter-system change from A/Gb mode or Iu mode to S1 mode in EMM-CONNECTED mode, the MME shall generate a KSISGSN, create a nonceMME and generate the K'ASME using the created nonceMME as indicated in 3GPP TS 33.401 [19]. The MME shall include the selected NAS algorithms, nonceMME and generated KSISGSN (associated with the K'ASME) in the NAS security transparent container for handover to E-UTRAN. The MME shall derive the EPS NAS keys from K'ASME.

When the UE receives the command to perform handover to E-UTRAN, the UE shall derive K'ASME, as indicated in 3GPP TS 33.401 [19], using the nonceMME received in the NAS security transparent container. Furthermore, the UE shall associate the derived K'ASME with the received KSISGSN and derive the EPS NAS keys from K'ASME.

When the UE has a PDN connection for emergency bearer services and has no current UMTS security context, the MME shall set EIA0 and EEA0 as the selected NAS security algorithms in the NAS security transparent container for handover to E-UTRAN. The MME shall create a locally generated K'ASME. The MME shall set the KSI value of the associated security context to "000" and the type of security context flag to "mapped security context" in the NAS security transparent container for handover to E-UTRAN.

When the UE receives the command to perform handover to E-UTRAN and has a PDN connection for emergency bearer services, if EIA0 and EEA0 as the selected NAS security algorithms are included in the NAS security transparent container for handover to E-UTRAN, the UE shall create a locally generated K'ASME. The UE shall set the KSI value of the associated security context to the KSI value received.

If the inter-system change from A/Gb mode or Iu mode to S1 mode in EMM-CONNECTED mode is not completed successfully, the MME and the UE shall delete the new mapped EPS security context.

The establishment of a mapped EPS security context during inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode is specified in 3GPP TS 24.501 [54] subclause 4.4.2.4.


4.4.2.3	Establishment of secure exchange of NAS messages

Secure exchange of NAS messages via a NAS signalling connection is usually established by the MME during the attach procedure by initiating a security mode control procedure. After successful completion of the security mode control procedure, all NAS messages exchanged between the UE and the MME are sent integrity protected using the current EPS security algorithms, and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered using the current EPS security algorithms.

During inter-system handover from A/Gb mode to S1 mode or Iu mode to S1 mode, secure exchange of NAS messages is established between the MME and the UE by:

  -	the transmission of NAS security related parameters encapsulated in the AS signalling from the MME to the UE triggering the inter-system handover (see 3GPP TS 33.401 [19]). The UE uses these parameters to generate the mapped EPS security context; and,

  -	after the handover, the transmission of a TRACKING AREA UPDATE REQUEST message from the UE to the MME. The UE shall send this message integrity protected using the mapped EPS security context, but unciphered. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected using the mapped EPS security context, and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered using the mapped EPS security context.

During inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode, secure exchange of NAS messages is established between the MME and the UE by:

  -	the transmission of NAS security related parameters encapsulated in the AS signalling from the AMF to the UE triggering the inter-system handover (see 3GPP TS 33.501 [56]). The UE uses these parameters to generate the mapped EPS security context (see subclause 8.6.1 of 3GPP TS 33.501 [56]); and

  -	after the handover, the transmission of a TRACKING AREA UPDATE REQUEST message from the UE to the MME. The UE shall send this message integrity protected using the mapped EPS security context, but unciphered. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected using the mapped EPS security context, and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered using the mapped EPS security context.

During inter-system change from N1 mode to S1 mode in EMM-IDLE mode, if the UE is operating in the single-registration mode and:

  1)	if the tracking area updating procedure is initiated as specified in 3GPP TS 24.501 [54], the UE shall transmit a TRACKING AREA UPDATE REQUEST message integrity protected with the current 5G NAS security context and the UE shall derive a mapped EPS security context (see subclause 8.6.1 of 3GPP TS 33.501 [56]). The UE shall include the eKSI indicating the 5G NAS security context value in the TRACKING AREA UPDATE REQUEST message.

    	After receiving the TRACKING AREA UPDATE REQUEST message including the eKSI, the MME forwards the TRACKING AREA UPDATE REQUEST message to the source AMF, if possible, to obtain the mapped EPS security context from the AMF as specified in 3GPP TS 33.501 [56]. The MME re-establishes the secure exchange of NAS messages by either:

    -	replying with a TRACKING AREA UPDATE ACCEPT message that is integrity protected and ciphered using the mapped EPS NAS security context. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered; or

    -	initiating a security mode control procedure. This can be used by the MME to take a non-current EPS security context into use or to modify the current EPS security context by selecting new NAS security algorithms; or

  2)	if the attach procedure is initiated as specified in 3GPP TS 24.501 [54] and:

    -	if the UE has a valid native EPS security context, the UE shall send an ATTACH REQUEST message integrity protected with the native EPS security context. The UE shall include the eKSI indicating the native EPS security context value in the ATTACH REQUEST message.

    -	if the UE has no valid native EPS security context, the UE shall send an ATTACH REQUEST message without integrity protection and encryption.

The secure exchange of NAS messages shall be continued after S1 mode to S1 mode handover. It is terminated after inter-system handover from S1 mode to A/Gb mode or Iu mode or when the NAS signalling connection is released.

When a UE in EMM-IDLE mode establishes a new NAS signalling connection and has a valid current EPS security context, secure exchange of NAS messages can be re-established in the following ways:

  1)	Except for the cases described in items 3 and 4 below, the UE shall transmit the initial NAS message integrity protected with the current EPS security context, but unciphered. The UE shall include the eKSI indicating the current EPS security context value in the initial NAS message. The MME shall check whether the eKSI included in the initial NAS message belongs to an EPS security context available in the MME, and shall verify the MAC of the NAS message. If the verification is successful, the MME may re-establish the secure exchange of NAS messages:

    -	by replying with a NAS message that is integrity protected and ciphered using the current EPS security context. From this time onward, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered; or

    -	by initiating a security mode control procedure. This can be used by the MME to take a non-current EPS security context into use or to modify the current EPS security context by selecting new NAS security algorithms; or

  2)	If the initial NAS message was a SERVICE REQUEST message or EXTENDED SERVICE REQUEST message, secure exchange of NAS messages is triggered by the indication from the lower layers that the user plane radio bearers are successfully set up. After successful completion of the procedure, all NAS messages exchanged between the UE and the MME are sent integrity protected and except for the messages specified in subclause 4.4.5, all NAS messages exchanged between the UE and the MME are sent ciphered.

  3)	If the UE has no current EPS security context and performs a tracking area updating procedure after an inter-system change in idle mode from A/Gb mode to S1 mode or Iu mode to S1 mode, the UE shall send the TRACKING AREA UPDATE REQUEST message without integrity protection and encryption. The UE shall include a nonce and a GPRS ciphering key sequence number for creation of a mapped EPS security context. The MME creates a fresh mapped EPS security context and takes this context into use by initiating a security mode control procedure and this context becomes the current EPS security context in both the UE and the MME. This re-establishes the secure exchange of NAS messages.

  4)	If the initial NAS message is a CONTROL PLANE SERVICE REQUEST message, the UE shall send the message integrity protected. If an ESM message container information element or a NAS message container information element is included the message shall be sent partially ciphered (see subclause 4.4.5) , otherwise the message shall be sent unciphered. Secure exchange of NAS messages is re-established in the UE:

    -	by the indication from the lower layers that the user plane radio bearers are successfully set up;

    -	upon receipt of a NAS message (e.g. a SERVICE ACCEPT message or ESM DATA TRANSPORT message) that is integrity protected and ciphered using the current EPS security context; or

    -	upon receipt of a SECURITY MODE COMMAND message that has successfully passed the integrity check.


4.4.2.4	Change of security keys

When the MME initiates a re-authentication to create a new EPS security context, the messages exchanged during the authentication procedure are integrity protected and ciphered using the current EPS security context, if any.

Both UE and MME shall continue to use the current EPS security context, until the MME initiates a security mode control procedure. The SECURITY MODE COMMAND message sent by the MME includes the eKSI of the new EPS security context to be used. The MME shall send the SECURITY MODE COMMAND message integrity protected with the new EPS security context, but unciphered. When the UE responds with a SECURITY MODE COMPLETE, it shall send the message integrity protected and ciphered with the new EPS security context.

The MME can also modify the current EPS security context or take the non-current native EPS security context, if any, into use, by sending a SECURITY MODE COMMAND message including the eKSI of the EPS security context to be modified and including a new set of selected NAS security algorithms. In this case the MME shall send the SECURITY MODE COMMAND message integrity protected with the modified EPS security context, but unciphered. When the UE replies with a SECURITY MODE COMPLETE message, it shall send the message integrity protected and ciphered with the modified EPS security context.


4.4.2.5	Derivation of keys at CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode

At change from A/Gb mode to S1 mode or from Iu mode to S1 mode due to CS to PS SRVCC handover (see 3GPP TS 23.216 [8]), the UE shall derive a mapped EPS security context for the PS domain from the UMTS security context for the CS domain.

At change from A/Gb mode to S1 mode due to CS to PS SRVCC handover, ciphering may be started and integrity protection shall be started (see 3GPP TS 36.331 [22]) without any new authentication procedure.

  NOTE 1:	CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode is not supported if the current CS security context is a GSM security context.

  NOTE 2:	For emergency calls, CS to PS SRVCC handover from A/Gb mode to S1 mode or from Iu mode to S1 mode is not supported.

In order to derive a mapped EPS security context for a CS to PS SRVCC handover from A/Gb mode or Iu mode to S1 mode, the MSC creates a NONCEMSC and generates the CK'PS and IK'PS using the CS UMTS integrity key, the CS UMTS ciphering key and the created NONCEMSC as specified in annex B.6 in 3GPP TS 33.102 [18]. The MSC associates the CK'PS and IK'PS with a KSI'PS. The KSI'PS is set to the value of the KSICS associated with the CS UMTS integrity key and the CS UMTS ciphering key. The MSC transfers the CK'PS, IK'PS and the KSI'PS to the MME. The MME shall create a mapped EPS security context by setting the K'ASME to the concatenation of the CK'PS and IK'PS received from the MSC (i.e. CK'PS || IK'PS). The MME shall associate the K'ASME with a KSISGSN. The MME shall set KSISGSN to the value of the KSI'PS received from the MSC. The MME shall include the selected NAS algorithms, NONCEMME and generated KSISGSN (associated with the K'ASME) in the NAS security transparent container for the handover to E-UTRAN. The MME shall derive the EPS NAS keys from K'ASME.

When the UE receives the command to perform CS to PS SRVCC handover to S1 mode, the ME shall generate the CK'PS and IK'PS using the CS UMTS integrity key, the CS UMTS ciphering key and the received NONCEMSC value in the transparent container in the CS to PS SRVCC handover command as specified in annex B.6 in 3GPP TS 33.102 [18]. The ME shall ignore the NONCEMME value received in the NAS Security Transparent Container in the CS to PS SRVCC handover command.

  NOTE 3:	The NONCEMME value received in the NAS Security Transparent Container for the handover to E-UTRAN is not used by the ME or MME in any key derivation in this handover.

The ME shall create the key K'ASME by concatenating the derived CK'PS and IK'PS (i.e. CK'PS || IK'PS.). The ME shall associate the derived key K'ASME with a KSISGSN.The ME shall set the KSISGSN associated to K'ASME to the KSISGSN value received in the NAS Security Transparent Container from the network.

  NOTE 4:	Although this case is related to the MSC server enhanced for SRVCC, the name KSISGSN is kept to avoid introducing a new name for the same domain.

The ME shall derive the EPS NAS keys (CK' and IK') from the K'ASME as specified in 3GPP TS 33.401 [19]. The ME shall apply these derived EPS NAS security keys (CK' and IK'), reset the uplink and downlink NAS COUNT values for the mapped EPS security context (i.e. to the value 0), and replace an already established mapped EPS security context for the PS domain, if any, in the ME, when the CS to PS SRVCC handover from A/Gb mode or Iu mode has been completed successfully. If the already established current EPS security context is of type native, then it shall become the non-current native EPS security context and overwrite any existing non-current native EPS security context in the ME.

The network shall replace an already established mapped EPS security context for the PS domain, if any, when the CS to PS SRVCC handover from A/Gb mode or Iu mode has been completed successfully. If the already established current EPS security context is of type native, then it shall become the non-current native EPS security context and overwrite any existing non-current native EPS security context in the MME.

If the CS to PS SRVCC handover from A/Gb mode or Iu mode has not been completed successfully, the UE and the network shall delete the new derived mapped EPS security context for the PS domain. Additionally, the network shall delete an already established mapped EPS security context for the PS domain, if any, if the eKSI of the already established EPS security context is equal to the KSISGSN of the new derived EPS security context for the PS domain.


4.4.3	Handling of NAS COUNT and NAS sequence number


4.4.3.1	General

Each EPS security context shall be associated with two separate counters NAS COUNT: one related to uplink NAS messages and one related to downlink NAS messages. The NAS COUNT counters use 24 bit internal representation and are independently maintained by UE and MME. The NAS COUNT shall be constructed as a NAS sequence number (8 least significant bits) concatenated with a NAS overflow counter (16 most significant bits).

When NAS COUNT is input to NAS ciphering or NAS integrity algorithms it shall be considered to be a 32-bit entity which shall be constructed by padding the 24-bit internal representation with 8 zeros in the most significant bits.

The value of the uplink NAS COUNT that is stored or read out of the USIM or non-volatile memory as described in annex C, is the value that shall be used in the next NAS message.

The value of the downlink NAS COUNT that is stored or read out of the USIM or non-volatile memory as described in annex C, is the largest downlink NAS COUNT used in a successfully integrity checked NAS message.

The NAS sequence number part of the NAS COUNT shall be exchanged between the UE and the MME as part of the NAS signalling. After each new or retransmitted outbound security protected NAS message, the sender shall increase the NAS COUNT number by one, except for the initial NAS messages if the lower layers indicated the failure to establish the RRC connection (see 3GPP TS 36.331 [22]). Specifically, on the sender side, the NAS sequence number shall be increased by one, and if the result is zero (due to wrap around), the NAS overflow counter shall also be incremented by one (see subclause 4.4.3.5). The receiving side shall estimate the NAS COUNT used by the sending side. Specifically, if the estimated NAS sequence number wraps around, the NAS overflow counter shall be incremented by one.

After the derivation of a NAS token due to an inter-system change from S1mode to A/Gb mode or Iu mode in idle mode as specified in 3GPP TS 24.008 [13], the UE shall increase the uplink NAS COUNT by one.

When the MME receives a NAS token via SGSN during an idle mode inter-system change from S1 mode to A/Gb mode or Iu mode, the MME shall check the NAS token as specified in 3GPP TS 33.401 [19], subclause 9.1.1, and update its uplink NAS COUNT with the uplink NAS COUNT value used for the successful check of the NAS token.

  NOTE 1:	The MME does not check the NAS token if it is received via SGSN during a connected mode inter-system change from S1 mode to A/Gb mode or Iu mode.

During the handover from UTRAN/GERAN to E-UTRAN, when a mapped EPS security context is derived and taken into use, the MME shall set both the uplink and downlink NAS COUNT counters of this EPS security context to zero. The UE shall set both the uplink and downlink NAS COUNT counters to zero.

When a mapped EPS security context is derived as specified in 3GPP TS 33.501 [56] and taken into use in the following cases:

  -	during the inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode; or

  -	during the inter-system change from N1 mode to S1 mode in EMM-IDLE mode for the UE operating in single-registration mode,

the MME shall store the mapped EPS NAS security context with the uplink and downlink NAS COUNT counters associated with the derived K'ASME key to the uplink and downlink NAS COUNT counters of the mapped EPS NAS security context respectively. The UE shall set the uplink and downlink NAS COUNT counters to the uplink and downlink NAS COUNT counters of the current 5G NAS security context respectively.

During the handover from E-UTRAN to UTRAN/GERAN the MME signals the current downlink NAS COUNT value in a NAS security transparent container (see subclause 9.9.2.6).

During handover to or from E-UTRAN, the MME shall increment downlink NAS COUNT by one after it has created a NAS security transparent container (see subclause 9.9.2.6 and 9.9.2.7).

  NOTE 2:	During the handover from UTRAN/GERAN to E-UTRAN, the NAS security transparent container (see subclause 9.9.2.7) is treated as an implicit SECURITY MODE COMMAND message for the UE and the MME, and therefore the MME regards the sending of the NAS security transparent container as the sending of an initial SECURITY MODE COMMAND message in order to derive and take into use a mapped EPS security context for the purpose of the NAS COUNT handling.

In some NAS messages only 5 of the 8 NAS sequence number bits are transmitted. When this is the case, the receiver shall estimate the remaining 3 most significant bits of the sequence number.


4.4.3.2	Replay protection

Replay protection shall be supported for received NAS messages both in the MME and the UE. However, since the realization of replay protection does not affect the interoperability between nodes, no specific mechanism is required for implementation.

Replay protection must assure that one and the same NAS message is not accepted twice by the receiver. Specifically, for a given EPS security context, a given NAS COUNT value shall be accepted at most one time and only if message integrity verifies correctly.

Replay protection is not applicable when EIA0 is used.


4.4.3.3	Integrity protection and verification

The sender shall use its locally stored NAS COUNT as input to the integrity protection algorithm.

The receiver shall use the NAS sequence number included in the received message (or estimated from the 5 bits of the NAS sequence number received in the message) and an estimate for the NAS overflow counter as defined in subclause 4.4.3.1 to form the NAS COUNT input to the integrity verification algorithm.

The algorithm to calculate the integrity protection information is specified in 3GPP TS 33.401 [19], and the integrity protection shall include octet 6 to n of the security protected NAS message, i.e. the sequence number IE and the NAS message IE. The integrity protection of the SERVICE REQUEST message is defined in subclause 9.9.3.28. In addition to the data that is to be integrity protected, the constant BEARER ID, DIRECTION bit, NAS COUNT and NAS integrity key are input to the integrity protection algorithm. These parameters are described in 3GPP TS 33.401 [19].

After successful integrity protection validation, the receiver shall update its corresponding locally stored NAS COUNT with the value of the estimated NAS COUNT for this NAS message.

Integrity verification is not applicable when EIA0 is used.


4.4.3.4	Ciphering and deciphering

The sender shall use its locally stored NAS COUNT as input to the ciphering algorithm.

The receiver shall use the NAS sequence number included in the received message (or estimated from the 5 bits of the NAS sequence number received in the message) and an estimate for the NAS overflow counter as defined in subclause 4.4.3.1 to form the NAS COUNT input to the deciphering algorithm.

The input parameters to the NAS ciphering algorithm are the constant BEARER ID, DIRECTION bit, NAS COUNT, NAS encryption key and the length of the key stream to be generated by the encryption algorithm. When an initial plain NAS message for transport of user data via control plane (i.e. CONTROL PLANE SERVICE REQUEST message) is to be partially ciphered, the length of the key stream is set to the length of the part of the initial plain NAS message (i.e. the value part of the ESM message container IE or the value part of the NAS message container) that is to be ciphered.


4.4.3.5	NAS COUNT wrap around

If, when increasing the NAS COUNT as specified above, the MME detects that either its downlink NAS COUNT or the UE's uplink NAS COUNT is "close" to wrap around, (close to 224), the MME shall take the following actions:

  -	If there is no non-current native EPS security context with sufficiently low NAS COUNT values, the MME shall initiate a new AKA procedure with the UE, leading to a new established EPS security context and the NAS COUNT being reset to 0 in both the UE and the MME when the new EPS security context is activated;

  -	Otherwise, the MME can activate a non-current native EPS security context with sufficiently low NAS COUNT values or initiate a new AKA procedure as specified above.

If for some reason a new KASME has not been established using AKA before the NAS COUNT wraps around, the node (MME or UE) in need of sending a NAS message shall instead release the NAS signalling connection. Prior to sending the next uplink NAS message, the UE shall delete the eKSI indicating the current EPS security context.

When the EIA0 is used as the NAS integrity algorithm, the UE and the MME shall allow NAS COUNT wrap around. If NAS COUNT wrap around occurs, the following requirements apply:

  -	the UE and the MME shall continue to use the current security context;

  -	the MME shall not initiate the EPS AKA procedure;

  -	the MME shall not release the NAS signalling connection; and

  -	the UE shall not perform a local release of the NAS signalling connection.


4.4.4	Integrity protection of NAS signalling messages


4.4.4.1	General

For the UE, integrity protected signalling is mandatory for the NAS messages once a valid EPS security context exists and has been taken into use. For the network, integrity protected signalling is mandatory for the NAS messages once a secure exchange of NAS messages has been established for the NAS signalling connection. Integrity protection of all NAS signalling messages is the responsibility of the NAS. It is the network which activates integrity protection.

The use of "null integrity protection algorithm" EIA0 (see subclause 9.9.3.23) in the current security context is only allowed for an unauthenticated UE for which establishment of emergency bearer services is allowed. For setting the security header type in outbound NAS messages, the UE and the MME shall apply the same rules irrespective of whether the "null integrity protection algorithm" or any other integrity protection algorithm is indicated in the security context.

If the "null integrity protection algorithm" EIA0 has been selected as a integrity protection algorithm, the receiver shall regard the NAS messages with the security header indicating integrity protection as integrity protected.

Details of the integrity protection and verification of NAS signalling messages are specified in 3GPP TS 33.401 [19].

When a NAS message needs to be sent both ciphered and integrity protected, the NAS message is first ciphered and then the ciphered NAS message and the NAS sequence number are integrity protected by calculating the MAC. The same applies when an initial NAS message needs to be sent partially ciphered and integrity protected.

  NOTE:	NAS messages that are ciphered or partially ciphered with the "null ciphering algorithm" EEA0 are regarded as ciphered or partially ciphered, respectively (see subclause 4.4.5).

When a NAS message needs to be sent only integrity protected and unciphered, the unciphered NAS message and the NAS sequence number are integrity protected by calculating the MAC.

When during the EPS attach procedure or service request procedure an ESM message is piggybacked in an EMM message, there is only one sequence number IE and one message authentication code IE, if any, for the combined NAS message.


4.4.4.2	Integrity checking of NAS signalling messages in the UE

Except the messages listed below, no NAS signalling messages shall be processed by the receiving EMM entity in the UE or forwarded to the ESM entity, unless the network has established secure exchange of NAS messages for the NAS signalling connection:

  -	EMM messages:

    -	IDENTITY REQUEST (if requested identification parameter is IMSI);

    -	AUTHENTICATION REQUEST;

    -	AUTHENTICATION REJECT;

    -	ATTACH REJECT (if the EMM cause is not #25);

    -	DETACH ACCEPT (for non switch off);

    -	TRACKING AREA UPDATE REJECT (if the EMM cause is not #25);

    -	SERVICE REJECT (if the EMM cause is not #25).

  NOTE:	These messages are accepted by the UE without integrity protection, as in certain situations they are sent by the network before security can be activated.

All ESM messages are integrity protected.

Once the secure exchange of NAS messages has been established, the receiving EMM or ESM entity in the UE shall not process any NAS signalling messages unless they have been successfully integrity checked by the NAS. If NAS signalling messages, having not successfully passed the integrity check, are received, then the NAS in the UE shall discard that message. The processing of the SECURITY MODE COMMAND message that has not successfully passed the integrity check is specified in subclause 5.4.3.5. If any NAS signalling message is received as not integrity protected even though the secure exchange of NAS messages has been established by the network, then the NAS shall discard this message.


4.4.4.3	Integrity checking of NAS signalling messages in the MME

Except the messages listed below, no NAS signalling messages shall be processed by the receiving EMM entity in the MME or forwarded to the ESM entity, unless the secure exchange of NAS messages has been established for the NAS signalling connection:

  -	EMM messages:

    -	ATTACH REQUEST;

    -	IDENTITY RESPONSE (if requested identification parameter is IMSI);

    -	AUTHENTICATION RESPONSE;

    -	AUTHENTICATION FAILURE;

    -	SECURITY MODE REJECT;

    -	DETACH REQUEST;

    -	DETACH ACCEPT;

    -	TRACKING AREA UPDATE REQUEST.

  NOTE 1:	The TRACKING AREA UPDATE REQUEST message is sent by the UE without integrity protection, if the tracking area updating procedure is initiated due to an inter-system change in idle mode and no current EPS security context is available in the UE. The other messages are accepted by the MME without integrity protection, as in certain situations they are sent by the UE before security can be activated.

  NOTE 2:	The DETACH REQUEST message can be sent by the UE without integrity protection, e.g. if the UE is attached for emergency bearer services and there is no shared EPS security context available, or if due to user interaction an attach procedure is cancelled before the secure exchange of NAS messages has been established. For these cases the network can attempt to use additional criteria (e.g. whether the UE is subsequently still performing periodic tracking area updating or still responding to paging) before marking the UE as EMM-DEREGISTERED.

All ESM messages are integrity protected except a PDN CONNECTIVITY REQUEST message if it is sent piggybacked in ATTACH REQUEST message and NAS security is not activated.

Once a current EPS security context exists, until the secure exchange of NAS messages has been established for the NAS signalling connection, the receiving EMM entity in the MME shall process the following NAS signalling messages, even if the MAC included in the message fails the integrity check or cannot be verified, as the EPS security context is not available in the network:

    -	ATTACH REQUEST;

    -	IDENTITY RESPONSE (if requested identification parameter is IMSI);

    -	AUTHENTICATION RESPONSE;

    -	AUTHENTICATION FAILURE;

    -	SECURITY MODE REJECT;

    -	DETACH REQUEST;

    -	DETACH ACCEPT;

    -	TRACKING AREA UPDATE REQUEST;

    -	SERVICE REQUEST;

    -	EXTENDED SERVICE REQUEST;

    -	CONTROL PLANE SERVICE REQUEST.

  NOTE 3:	These messages are processed by the MME even when the MAC that fails the integrity check or cannot be verified, as in certain situations they can be sent by the UE protected with an EPS security context that is no longer available in the network.

If an ATTACH REQUEST message is received without integrity protection or fails the integrity check and it is not an attach request for emergency bearer services, the MME shall authenticate the subscriber before processing the attach request any further. Additionally, if the MME initiates a security mode control procedure, the MME shall include a HASHMME IE in the SECURITY MODE COMMAND message as specified in subclause 5.4.3.2. For the case when the attach procedure is for emergency bearer services see subclause 5.5.1.2.3 and subclause 5.4.2.5.

If a DETACH REQUEST message fails the integrity check, the MME shall proceed as follows:

  -	If it is not a detach request due to switch off, and the MME can initiate an authentication procedure, the MME should authenticate the subscriber before processing the detach request any further.

  -	If it is a detach request due to switch off, or the MME does not initiate an authentication procedure for any other reason, the MME may ignore the detach request and remain in state EMM-REGISTERED.

  NOTE 4:	The network can attempt to use additional criteria (e.g. whether the UE is subsequently still performing periodic tracking area updating or still responding to paging) before marking the UE as EMM-DEREGISTERED.

If a TRACKING AREA UPDATE REQUEST message is received without integrity protection or fails the integrity check and the UE provided a nonceUE, GPRS ciphering key sequence number, P-TMSI and RAI in the TRACKING AREA UPDATE REQUEST message, the MME shall initiate a security mode control procedure to take a new mapped EPS security context into use; otherwise if the UE has only a PDN connection for non-emergency bearer services established, the MME shall initiate an authentication procedure. Additionally, if the MME initiates a security mode control procedure, the MME shall include a HASHMME IE in the SECURITY MODE COMMAND message as specified in subclause 5.4.3.2. For the case when the UE has a PDN connection for emergency bearer services see subclause 5.5.3.2.3 and subclause 5.4.2.5.

If a SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message fails the integrity check and the UE has only PDN connections for non-emergency bearer services established, the MME shall send the SERVICE REJECT message with EMM cause #9 "UE identity cannot be derived by the network" and keep the EMM-context and EPS security context unchanged. For the case when the UE has a PDN connection for emergency bearer services and integrity check fails, the MME may skip the authentication procedure even if no EPS security context is available and proceed directly to the execution of the security mode control procedure as specified in subclause 5.4.3. After successful completion of the service request procedure, the network shall deactivate all non-emergency EPS bearers locally. The emergency EPS bearers shall not be deactivated.

Once the secure exchange of NAS messages has been established for the NAS signalling connection, the receiving EMM or ESM entity in the MME shall not process any NAS signalling messages unless they have been successfully integrity checked by the NAS. If any NAS signalling message, having not successfully passed the integrity check, is received, then the NAS in the MME shall discard that message. If any NAS signalling message is received, as not integrity protected even though the secure exchange of NAS messages has been established, then the NAS shall discard this message.


4.4.5	Ciphering of NAS signalling messages

The use of ciphering in a network is an operator option subject to MME configuration. When operation of the network without ciphering is configured, the MME shall indicate the use of "null ciphering algorithm" EEA0 (see subclause 9.9.3.23) in the current security context for all UEs. For setting the security header type in outbound NAS messages, the UE and the MME shall apply the same rules irrespective of whether the "null ciphering algorithm" or any other ciphering algorithm is indicated in the security context.

When the UE establishes a new NAS signalling connection, it shall send the initial NAS message

  -	partially ciphered, if it is a CONTROL PLANE SERVICE REQUEST message including an ESM message container information element or a NAS message container information element; and

  -	unciphered, if it is any other initial NAS message.

The UE shall partially cipher the CONTROL PLANE SERVICE REQUEST message by ciphering the value part of the ESM message container IE or the value part of the NAS message container, using the ciphering algorithm of the current EPS security context.

The UE shall send the ATTACH REQUEST message always unciphered.

The UE shall send the TRACKING AREA UPDATE REQUEST message always unciphered.

Except for the CONTROL PLANE SERVICE REQUEST message including an ESM message container information element or a NAS message container information element, the UE shall start the ciphering and deciphering of NAS messages when the secure exchange of NAS messages has been established for a NAS signalling connection. From this time onward, unless explicitly defined, the UE shall send all NAS messages ciphered until the NAS signalling connection is released, or the UE performs intersystem handover to A/Gb mode or Iu mode.

The MME shall start ciphering and deciphering of NAS messages as described in subclause 4.4.2.3. From this time onward, except for the SECURITY MODE COMMAND message, the MME shall send all NAS messages ciphered until the NAS signalling connection is released, or the UE performs intersystem handover to A/Gb mode or Iu mode.

Once the encryption of NAS messages has been started between the MME and the UE, the receiver shall discard the unciphered NAS messages which shall have been ciphered according to the rules described in this specification. The MME shall discard any CONTROL PLANE SERVICE REQUEST message including an ESM message container information element or a NAS message container information element which has not been partially ciphered according to the rules described above.

If the "null ciphering algorithm" EEA0 has been selected as a ciphering algorithm, the NAS messages with the security header indicating ciphering are regarded as ciphered.

Details of ciphering and deciphering of NAS signalling messages are specified in 3GPP TS 33.401 [19].


4.5	Disabling and re-enabling of UE's E-UTRA capability

When the UE is disabling the E-UTRA capability, it should proceed as follows:

  a)	select another RAT (GERAN, UTRAN, or NG-RAN if the UE has not disabled its N1 mode capability for 3GPP access as specified in 3GPP TS 24.501 [54]) of the registered PLMN or a PLMN from the list of equivalent PLMNs;

  b)	if another RAT of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, or the UE does not have a registered PLMN, then perform PLMN selection as specified in 3GPP TS 23.122 [6]. As an implementation option, instead of performing PLMN selection, the UE may select another RAT of the chosen PLMN. If disabling of E-UTRA capability was not due to UE initiated detach procedure for EPS services only, the UE may re-enable the E-UTRA capability for this PLMN selection; or

  c)	if no other allowed PLMN and RAT combinations are available, then the UE may re-enable the E-UTRA capability and remain registered for EPS services in E-UTRAN of the registered PLMN. If the UE chooses this option, then it may periodically attempt to select another PLMN and RAT combination that can provide non-EPS services. How this periodic scanning is done, is UE implementation dependent.

The UE shall re-enable the E-UTRA capability when performing a PLMN selection unless:

  -	the disabling of E-UTRA capability was due to UE initiated detach procedure for EPS services only; or

  -	the UE has already re-enabled the E-UTRA capability when performing bullets b) or c) above.

If due to handover, the UE moves to a new PLMN in A/Gb or Iu mode which is not in the list of equivalent PLMNs and not a PLMN memorized by the UE for which E-UTRA capability was disabled, and the disabling of E-UTRA capability was not due to UE initiated detach procedure for EPS services only, the UE shall re-enable the E-UTRA capability after the RR/RRC connection is released.

If UE that has disabled its E-UTRA capability due to IMS voice not available and CS fallback not available re-enables it when PLMN selection is performed, then it should memorize the identity of the PLMNs where E-UTRA capability was disabled and use that stored information in subsequent PLMN selections as specified in 3GPP TS 23.122 [6].

The UE may support "E-UTRA Disabling for EMM cause #15" and implement the following behaviour:

  -	if the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled; and

  -	if the UE receives an ATTACH REJECT or TRACKING AREA UPDATE REJECT message including both EMM cause #15 "no suitable cells in tracking area" and an Extended EMM cause IE with value "E-UTRAN not allowed";

then the UE shall disable the E-UTRA capability, memorize the identity of the PLMN where the E-UTRA capability was disabled and use that stored information in subsequent PLMN selections as specified in 3GPP TS 23.122 [6].

When the UE supporting the A/Gb and/or Iu mode together with the S1 mode needs to stay in A/Gb or Iu mode, in order to prevent unwanted handover or cell reselection from UTRAN/GERAN to E-UTRAN, the UE shall disable the E-UTRA capability.

  -	The UE shall not set the E-UTRA support bits of the MS Radio Access capability IE (see 3GPP TS 24.008 [13], subclause 10.5.5.12a), the E-UTRA support bits of Mobile Station Classmark 3 IE (see 3GPP TS 24.008 [13], subclause 10.5.1.7), the PS inter-RAT HO from GERAN to E-UTRAN S1 mode capability bit and the ISR support bit of the MS network capability IE (see 3GPP TS 24.008 [13], subclause 10.5.5.12) in the ATTACH REQUEST message and the ROUTING AREA UPDATE REQUEST message after it selects GERAN or UTRAN;

  -	the UE shall use the same value of the EPC capability bit of the MS network capability IE (see 3GPP TS 24.008 [13], subclause 10.5.5.12) in the ATTACH REQUEST message and the ROUTING AREA UPDATE REQUEST message; and

  -	the UE NAS layer shall indicate the access stratum layer(s) of disabling of the E-UTRA capability.

When the UE supporting N1 mode together with S1 mode needs to stay in N1 mode, in order to prevent unwanted handover or cell reselection from NG-RAN to E-UTRAN, the UE shall disable the E-UTRA capability.

  -	the UE shall not set the S1 mode bit to "S1 mode supported" in the S1 UE network capability IE (see 3GPP TS 24.501 [54]) of the REGISTRATION REQUEST message; and

  -	the UE NAS layer shall indicate the access stratum layer(s) of disabling of the E-UTRA capability.

  NOTE 1:	The UE can only disable the E-UTRA capability when in EMM-IDLE mode.

  NOTE 2:	Disabling and re-enabling the UE's E-UTRA capability does not affect the UE's capability to access the 5GC via E-UTRA.

If the UE is disabling its E-UTRA capability before selecting to GERAN, UTRAN or NG-RAN radio access technology, the UE shall not perform the detach procedure of subclause 5.5.2.1.

If the UE is required to disable the E-UTRA capability and select GERAN, UTRAN or NG-RAN radio access technology, and the UE is in the EMM-CONNECTED mode, the UE shall locally release the established NAS signalling connection and enter the EMM-IDLE mode before selecting GERAN, UTRAN or NG-RAN radio access technology.

If the E-UTRA capability was disabled due to the attempt to select GERAN or UTRAN radio access technology progressing the CS emergency call establishment (see subclause 4.3.1), the criteria to enable the E-UTRA capability again is UE implementation specific.

If the E-UTRA capability was disabled due to the UE initiated detach procedure for EPS services only (see subclause 5.5.2.2.2), upon request of the upper layers to re-attach for EPS services the UE shall enable the E-UTRA capability again. If the E-UTRA capability was disabled due to receipt of EMM cause #14 "EPS services not allowed in this PLMN", then the UE shall enable the E-UTRA capability when the UE powers off and powers on again or the USIM is removed. If E-UTRA capability was disabled for any other reason, the UE shall enable the E-UTRA capability in the following cases:

  -	the UE mode of operation changes from CS/PS mode 1 of operation to CS/PS mode 2 of operation;

  -	the UE mode of operation changes from PS mode 1 of operation to PS mode 2 of operation; or

  -	the UE powers off and powers on again or the USIM is removed;

As an implementation option, the UE may start a timer for enabling E-UTRA when the UE's attach attempt counter or tracking area updating attempt counter reaches 5 and the UE disables E-UTRA capability for cases described in subclauses 5.5.1.2.6, 5.5.1.3.4.3, 5.5.1.3.6, 5.5.3.2.6, 5.5.3.3.4.3 and 5.5.3.3.6. The UE should memorize the identity of the PLMNs where E-UTRA capability were disabled. On expiry of this timer:

  -	if the UE is in Iu mode or A/Gb mode and is in idle mode as specified in 3GPP TS 24.008 [13] on expiry of the timer, the UE should enable the E-UTRA capability;

  -	if the UE is in Iu mode or A/Gb mode and an RR connection exists, the UE shall delay enabling E-UTRA capability until the RR connection is released;

  -	if the UE is in Iu mode and a PS signalling connection exists but no RR connection exists, the UE may abort the PS signalling connection before enabling E-UTRA capability;

  -	if the UE is in N1 mode and is in 5GMM-IDLE mode as specified in 3GPP TS 24.501 [54], on expiry of the timer, the UE should enable the E-UTRA capability; and

  -	if the UE is in N1 mode and is in 5GMM-CONNECTED mode as specified in 3GPP TS 24.501 [54], on expiry of the timer, the UE shall delay enabling the E-UTRA capability until the N1 NAS signalling connection is released.

If the UE attempts to establish an emergency bearer service in a PLMN where the E-UTRA capability was disabled due to the UE's attach attempt counter or tracking area updating attempt counter have reached 5, the UE may enable the E-UTRA capability for that PLMN memorized by the UE.

For other cases, it is up to the UE implementation when to enable the E-UTRA capability.

  NOTE 3:	If the UE is not operating in CS/PS mode 1 operation, the value of the timer for enabling E-UTRA capability is recommended to be not larger than the default value of T3402.


4.6	Applicability of procedures


4.6.1	Relay nodes

A relay node shall support all procedures that are mandatory for a UE supporting S1 mode only.

There is also functionality which is only applicable to a relay node, in which case the specification uses the term "relay node" instead of "UE".


4.7	EPS mobility management and EPS session management in NB-S1 mode

A UE in NB-S1 mode (see 3GPP TS 36.331 [22]) shall calculate the value of the applicable NAS timer:

  -	indicated in table 10.2.1 plus 240s; and

  -	indicated in table 10.3.1 plus 180s.

The timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not re-calculate the use of the NAS timer value until the NAS procedure is completed, restarted or aborted.

When an MME that supports NB-S1 mode performs NAS signaling with a UE, which is using NB-S1 mode, the MME shall calculate the value of the applicable NAS timer:

  -	indicated in table 10.2.2 plus 240s; and

  -	indicated in table 10.3.2 plus 180s.

The timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not re-calculate the use of the NAS timer value until the NAS procedure is completed, restarted or aborted.

  NOTE:	If the tracking area update procedure is initiated in EMM-CONNECTED mode, the MME can stop any running implementation specific supervision timer if it is started when sending an ESM DATA TRANSPORT message to the UE.


4.8	EPS mobility management and EPS session management in WB-S1 mode for IoT

In WB-S1 mode, a UE operating in category CE can operate in either CE mode A or CE mode B (see 3GPP TS 36.306 [44]). If a UE that supports CE mode B and operates in WB-S1 mode and the UE's usage setting is not set to "voice centric" (see 3GPP TS 23.401 [10]), the UE shall apply the value of the applicable NAS timer indicated in tables 10.2.1 and indicated in table 10.3.1 for WB-S1/CE mode.

The NAS timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure, and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.

The support of CE mode B by a UE is indicated to the MME by lower layers and shall be stored by the MME. When an MME that supports WB-S1 mode performs NAS signaling with a UE, which supports CE mode B and operates in WB-S1 mode and the MME determines that

  -	the use of enhanced coverge is not restricted for the UE; or

  -	CE mode B is not restricted for the UE (see 3GPP TS 23.401 [10])

the MME shall calculate the value of the applicable NAS timer indicated in tables 10.2.2 and indicated in table 10.3.2 for WB-S1/CE mode.

The NAS timer value obtained is used as described in the appropriate procedure subclause of this specification. The NAS timer value shall be calculated at start of a NAS procedure and shall not be re-calculated until the NAS procedure is completed, restarted or aborted.


4.9	Disabling and re-enabling of UE's NB-IoT capability

If the UE supports disabling and re-enabling of UE's NB-IoT capability and the UE in NB-S1 mode is disabling the NB-IoT capability, it should proceed as follows:

  a)	select E-UTRAN of the registered PLMN or a PLMN from the list of equivalent PLMNs;

  b)	if E-UTRAN of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, select another RAT (GERAN, UTRAN, or NG-RAN if the UE has not disabled its N1 mode capability for 3GPP access as specified in 3GPP TS 24.501 [54]) of the registered PLMN or a PLMN from the list of equivalent PLMNs;

  c)	if another RAT of the registered PLMN or a PLMN from the list of equivalent PLMNs cannot be found, or the UE does not have a registered PLMN, then perform PLMN selection as specified in 3GPP TS 23.122 [6]. As an implementation option, instead of performing PLMN selection, the UE may select another RAT of the chosen PLMN; or

  d)	if no other allowed PLMN and RAT combinations are available, then the UE may re-enable the NB-IoT capability and remain registered for EPS services in NB-IoT of the registered PLMN. If the UE chooses this option, then it may periodically attempt to select another PLMN and RAT combination that can provide non-EPS services. How this periodic scanning is done, is UE implementation dependent.

If the the NB-IoT capability is disabled, the UE shall re-enable the NB-IoT capability when:

  -	performing a PLMN selection unless the UE has already re-enabled the NB-IoT capability when performing bullets c) or d) above; or

  -	the UE powers off and powers on again or the USIM is removed.

If the UE in NB-S1 mode receives an ATTACH REJECT or TRACKING AREA UPDATE REJECT message including both EMM cause #15 "no suitable cells in tracking area" and an Extended EMM cause IE with value "NB-IoT not allowed" after the UE requests access to the NB-IoT, in order to prevent unwanted cell reselection from GERAN, UTRAN, E-UTRAN or NG-RAN to NB-IoT, the UE may:

  -	disable the NB-IoT capability:

  -	indicate the access stratum layer(s) of disabling of the NB-IoT capability; and

  -	memorize the identity of the PLMN where the NB-IoT capability was disabled and use that stored information in subsequent PLMN selections as specified in 3GPP TS 23.122 [6].

  NOTE:	The UE can only disable the NB-IoT capability when in EMM-IDLE mode.

If the UE in NB-S1 mode is required to disable the NB-IoT capability and select E-UTRAN radio access technology, and the UE is in the EMM-CONNECTED mode, the UE shall locally release the established NAS signalling connection and enter the EMM-IDLE mode before selecting E-UTRAN radio access technology.

As an implementation option, the UE may start a timer for enabling the NB-IoT capability. On expiry of this timer, the UE may enable the NB-IoT capability.


5	Elementary procedures for EPS mobility management


5.1	Overview


5.1.1	General

This clause describes the procedures used for mobility management for EPS services (EMM) at the radio interface (reference point "LTE-Uu").

The main function of the mobility management sublayer is to support the mobility of a user equipment, such as informing the network of its present location and providing user identity confidentiality.

A further function of the mobility management sublayer is to provide connection management services to the session management (SM) sublayer and the short message services (SMS) entity of the connection management (CM) sublayer.

All the EMM procedures described in this clause can only be performed if a NAS signalling connection has been established between the UE and the network. Else, the EMM sublayer has to initiate the establishment of a NAS signalling connection (see 3GPP TS 36.331 [22]).


5.1.2	Types of EMM procedures

Depending on how they can be initiated, three types of EMM procedures can be distinguished:

  1)	EMM common procedures:

    	An EMM common procedure can always be initiated whilst a NAS signalling connection exists. The procedures belonging to this type are:

       	Initiated by the network:

         -	GUTI reallocation;

         -	authentication;

         -	security mode control;

         -	identification;

         -	EMM information.

  2)	EMM specific procedures:

    	At any time only one UE initiated EMM specific procedure can be running. The procedures belonging to this type are:

       	Initiated by the UE and used to attach the IMSI in the network for EPS services and/or non-EPS services, and to establish an EMM context and if requested by the UE, a default bearer:

         -	attach and combined attach.

       	Initiated by the UE and used to attach the IMSI or IMEI for emergency bearer services, and to establish an EMM context and a default bearer to a PDN that provides emergency bearer services:

         -	attach.

       	Initiated by the UE or the network and used to detach the IMSI in the network for EPS services and/or non-EPS services and to release an EMM context and all bearers, if any:

         -	detach and combined detach.

       	Initiated by the UE and used to detach the IMSI in the network for EPS services or non-EPS services and to release an EMM context and all bearers, if any:

         -	eCall inactivity procedure.

       	Initiated by the UE when an EMM context has been established:

         -	normal tracking area updating and combined tracking area updating (S1 mode only);

         -	periodic tracking area updating (S1 mode only).

       	The tracking area updating procedure can be used to request also the resource reservation for sending data.

  3)	EMM connection management procedures (S1 mode only):

       	Initiated by the UE and used to establish a secure connection to the network or to request the resource reservation for sending data, or both:

         -	service request.

       	The service request procedure can only be initiated if no UE initiated EMM specific procedure is ongoing.

       	Initiated by the network and used to request the establishment of a NAS signalling connection or to prompt the UE to re-attach if necessary as a result of a network failure:

         -	paging procedure.

       	Initiated by the UE or the network and used to transport NAS messages:

         -	transport of NAS messages;

         -	generic transport of NAS messages.

       	The transport of NAS messages procedure and the generic transport of NAS messages procedure cannot be initiated while an EMM specific procedure or a service request procedure is ongoing.


5.1.3	EMM sublayer states


5.1.3.1	General

In the following subclauses, the EMM protocol of the UE and the network is described by means of two different state machines. In subclause 5.1.3.2, the states of the EMM entity in the UE are introduced. The behaviour of the UE depends on an EPS update status that is described in subclause 5.1.3.3. The states for the MME side are described in subclause 5.1.3.4.


5.1.3.2	EMM sublayer states in the UE


5.1.3.2.1	General

In the following subclauses, the possible EMM states of an EMM entity in the UE are described. Subclause 5.1.3.2.2 summarizes the main states of an EMM entity. The substates that have been defined are described in subclause 5.1.3.2.3 and subclause 5.1.3.2.4.

It should be noted, however, that this subclause does not include a description of the detailed behaviour of the UE in the single states and does not cover abnormal cases. A detailed description of the behaviour of the UE is given in subclause 5.2. For the behaviour of the UE in abnormal cases refer to the description of the elementary EMM procedures in subclauses 5.4, 5.5, 5.6 and 5.7.


5.1.3.2.2	Main states


5.1.3.2.2.1	EMM-NULL

EPS services are disabled in the UE. No EPS mobility management function shall be performed in this state.


5.1.3.2.2.2	EMM-DEREGISTERED

In the state EMM-DEREGISTERED, no EMM context has been established and the UE location is unknown to an MME and hence it is unreachable by an MME. In order to establish an EMM context, the UE shall start the attach or combined attach procedure (see subclause 5.5.1).


5.1.3.2.2.3	EMM-REGISTERED-INITIATED

A UE enters the state EMM-REGISTERED-INITIATED after it has started the attach or the combined attach procedure and is waiting for a response from the MME (see subclause 5.5.1).


5.1.3.2.2.4	EMM-REGISTERED

In the state EMM-REGISTERED an EMM context has been established. Additionally a default EPS bearer context has been activated in the UE:

  -	if EMM-REGISTERED without PDN connection is not supported by the UE or the MME; or

    -	if EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE has requested connectivity to a PDN and a default EPS bearer context is successfully established.

When the UE is in EMM-IDLE mode, the UE location is known to the MME with an accuracy of a list of tracking areas containing a certain number of tracking areas. When the UE is in EMM-CONNECTED mode, the UE location is known to the MME with an accuracy of a serving eNodeB. The UE may initiate sending and receiving user data and signalling information and reply to paging. Additionally, tracking area updating or combined tracking area updating procedure is performed (see subclause 5.5.3).


5.1.3.2.2.5	EMM-DEREGISTERED-INITIATED

A UE enters the state EMM-DEREGISTERED-INITIATED after it has requested release of the EMM context by starting the detach or combined detach procedure and is waiting for a response from the MME (see subclause 5.5.2).


5.1.3.2.2.6	EMM-TRACKING-AREA-UPDATING-INITIATED

A UE enters the state EMM-TRACKING-AREA-UPDATING-INITIATED after it has started the tracking area updating or combined tracking area updatingprocedure and is waiting for a response from the MME (see subclause 5.5.3).


5.1.3.2.2.7	EMM-SERVICE-REQUEST-INITIATED

A UE enters the state EMM-SERVICE-REQUEST-INITIATED after it has started the service request procedure and is waiting for a response from the MME (see subclause 5.6.1).

[pic]

  NOTE:	Not all possible transitions are shown in this figure.


Figure 5.1.3.2.2.7.1: EMM main states in the UE


5.1.3.2.3	Substates of state EMM-DEREGISTERED


5.1.3.2.3.1	General

The state EMM-DEREGISTERED is subdivided into a number of substates as described in this subclause. Valid subscriber data are available for the UE before it enters the substates, except for the substate EMM-DEREGISTERED.NO-IMSI.


5.1.3.2.3.2	EMM-DEREGISTERED.NORMAL-SERVICE

The substate EMM-DEREGISTERED.NORMAL-SERVICE is chosen in the UE when a suitable cell has been found and the PLMN or tracking area is not in the forbidden list.


5.1.3.2.3.3	EMM-DEREGISTERED.LIMITED-SERVICE

The substate EMM-DEREGISTERED.LIMITED-SERVICE is chosen in the UE, when it is known that a selected cell is unable to provide normal service (e.g. the selected cell is in a forbidden PLMN, is in a forbidden tracking area or the selected cell is a CSG cell whose CSG ID and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG List).


5.1.3.2.3.4	EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH

The substate EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH is chosen in the UE if the attach or combined attach procedure failed due to a missing response from the network or due to the circumstances described in subclauses 5.5.1.2.5, 5.5.1.2.6 and 5.5.1.3.5.


5.1.3.2.3.5	EMM-DEREGISTERED.PLMN-SEARCH

The substate EMM-DEREGISTERED.PLMN-SEARCH is chosen in the UE, if the UE is searching for PLMNs. This substate is left either when a cell has been selected (the new substate is NORMAL-SERVICE or LIMITED-SERVICE) or when it has been concluded that no cell is available at the moment (the new substate is NO-CELL-AVAILABLE).


5.1.3.2.3.6	EMM-DEREGISTERED.NO-IMSI

The substate EMM-DEREGISTERED.NO-IMSI is chosen in the UE, if the UE has no valid subscriber data available (SIM/USIM not available, or the SIM/USIM is considered invalid by the UE) and a cell has been selected.


5.1.3.2.3.7	EMM-DEREGISTERED.ATTACH-NEEDED

Valid subscriber data are available for the UE and for some reason an attach must be performed as soon as possible. This substate can be entered if the access class is blocked due to access class control, or if the network rejects the NAS signalling connection establishment.


5.1.3.2.3.8	EMM-DEREGISTERED.NO-CELL-AVAILABLE

No E-UTRAN cell can be selected. This substate is entered after a first intensive search failed when in substate EMM-DEREGISTERED.PLMN-SEARCH. Cells are searched for at a low rhythm. No EPS services are offered.


5.1.3.2.3.9	EMM-DEREGISTERED.eCALL-INACTIVE

The substate EMM-DEREGISTERED.eCALL-INACTIVE is chosen in the UE when:

  -	the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17];

  -	timer T3444 and timer T3445 have expired or are not running;

  -	a PLMN has been selected as specified in 3GPP TS 23.122 [6];

  -	the UE does not need to perform an eCall over IMS; and

  -	the UE does not need to perform a call to a non-emergency MSISDN or URI for test or terminal reconfiguration service.

In this substate, the UE shall not initiate any signalling towards the network, except to originate an eCall over IMS, or a call to a non-emergency MSISDN or URI for test or terminal reconfiguration service.


5.1.3.2.4	Substates of state EMM-REGISTERED


5.1.3.2.4.1	General

The state EMM-REGISTERED is subdivided into a number of substates as described in this subclause.


5.1.3.2.4.2	EMM-REGISTERED.NORMAL-SERVICE

The substate EMM-REGISTERED.NORMAL-SERVICE is chosen by the UE as the primary substate when the UE enters the state EMM-REGISTERED.


5.1.3.2.4.3	EMM-REGISTERED.ATTEMPTING-TO-UPDATE

The substate EMM-REGISTERED.ATTEMPTING-TO-UPDATE is chosen by the UE if the tracking area updating or combined tracking area updating procedure failed due to a missing response from the network or due to the circumstances described in subclauses 5.5.3.2.5, 5.5.3.2.6, 5.5.3.3.5, 5.6.1.5 and 5.6.1.6. No EMM procedure except the tracking area updating or combined tracking area updating procedure shall be initiated by the UE in this substate. No data shall be sent or received.


5.1.3.2.4.4	EMM-REGISTERED.LIMITED-SERVICE

The substate EMM-REGISTERED.LIMITED-SERVICE is chosen in the UE, if the cell the UE selected is known not to be able to provide normal service.


5.1.3.2.4.5	EMM-REGISTERED.PLMN-SEARCH

The substate EMM-REGISTERED.PLMN-SEARCH is chosen in the UE, while the UE is searching for PLMNs.


5.1.3.2.4.6	EMM-REGISTERED.UPDATE-NEEDED

The UE has to perform a tracking area updating or combined tracking area updating procedure, but access to the current cell is barred. This state can be entered if the access class is blocked due to access class control, or if the network rejects the NAS signalling connection establishment.

No EMM procedure except:

  -	tracking area updating;

  -	combined tracking area updating; or

  -	service request as a response to paging

shall be initiated by the UE in this substate.


5.1.3.2.4.7	EMM-REGISTERED.NO-CELL-AVAILABLE

E-UTRAN coverage has been lost or PSM is active in the UE. If PSM is active, the UE can deactivate PSM at any time by activating the AS layer when the UE needs to send mobile originated signalling or user data. Otherwise, the UE shall not initiate any EMM procedure except for cell and PLMN reselection.


5.1.3.2.4.8	EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM

A combined attach procedure or a combined tracking area updating procedure was successful for EPS services only. User data and signalling information may be sent and received.


5.1.3.2.4.9	EMM-REGISTERED.IMSI-DETACH-INITIATED

The UE performs a combined detach procedure for non-EPS services only (detach type "IMSI detach"). This substate is entered if the UE is attached for EPS and non-EPS services and wants to detach for non-EPS services only. User data and signalling information may be sent and received.


5.1.3.3	EPS update status

In order to describe the detailed UE behaviour, the EPS update (EU) status pertaining to a specific subscriber is defined.

The EPS update status is stored in a non-volatile memory in the USIM if the corresponding file is present in the USIM, else in the non-volatile memory in the ME, as described in annex C.

The EPS update status value is changed only after the execution of an attach or combined attach, network initiated detach, authentication, tracking area update or combined tracking area update, service request or paging for EPS services using IMSI procedure or due to change in TAI which is not part of TAI list while timer T3346 is running.

  EU1: UPDATED

    	The last attach or tracking area updating attempt was successful.

  EU2: NOT UPDATED

    	The last attach, service request or tracking area updating attempt failed procedurally, e.g. no response or reject message was received from the MME.

  EU3: ROAMING NOT ALLOWED

    	The last attach, service request or tracking area updating attempt was correctly performed, but the answer from the MME was negative (because of roaming or subscription restrictions).


5.1.3.4	EMM sublayer states in the MME


5.1.3.4.1	EMM-DEREGISTERED

In the state EMM-DEREGISTERED, the MME has no EMM context or the EMM Context is marked as detached. The UE is detached. The MME may answer to an attach or a combined attach procedure initiated by the UE (see subclause 5.5.1). The MME may also answer to a tracking area updating procedure or combined tracking area updating procedure initiated by a UE if the EMM context is marked as detached. The MME may also answer to a detach procedure initiated by the UE (see subclause 5.5.1.2.7).

If ISR is not activated or ISR is deactivated during a routing area updating or combined routing area updating procedure or an inter-system handover to A/Gb mode or Iu mode, the MME enters the state EMM-DEREGISTERED after the successful completion of the procedure.


5.1.3.4.2	EMM-COMMON-PROCEDURE-INITIATED

The MME enters the state EMM-COMMON-PROCEDURE-INITIATED, after it has started a common EMM procedure (see subclause 5.4) and is waiting for a response from the UE.


5.1.3.4.3	EMM-REGISTERED

In the state EMM-REGISTERED, an EMM context has been established. Additionally a default EPS bearer context has been activated in the MME:

  -	if EMM-REGISTERED without PDN connection is not supported by the UE or the MME; or

  -	if EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE has requested connectivity to a PDN and a default EPS bearer context is successfully established.


5.1.3.4.4	EMM-DEREGISTERED-INITIATED

The MME enters the state EMM-DEREGISTERED-INITIATED after it has started a detach procedure and is waiting for a response from the UE (see subclause 5.5.2).

[pic]

Figure 5.1.3.4.4.1: EMM main states in the MME


5.1.4	Coordination between EMM and GMM

If GMM and EMM are both enabled, a UE capable of S1 mode and A/Gb mode or Iu mode or both shall maintain one common registration for GMM and EMM indicating whether the UE is registered for packet services or not.

A UE that is not registered shall be in state GMM-DEREGISTERED and in state EMM-DEREGISTERED.

If the UE performs a successful attach or combined attach procedure in S1 mode, it shall enter substates GMM-REGISTERED.NO-CELL-AVAILABLE and EMM-REGISTERED.NORMAL-SERVICE. The UE resets the attach attempt counter and the GPRS attach attempt counter (see 3GPP TS 24.008 [13]).

If the UE performs a successful GPRS attach or combined GPRS attach procedure in A/Gb or Iu mode, it shall enter substates GMM-REGISTERED.NORMAL-SERVICE and EMM-REGISTERED.NO-CELL-AVAILABLE. The UE resets the attach attempt counter and the GPRS attach attempt counter (see 3GPP TS 24.008 [13]).

At intersystem change from A/Gb or Iu mode to S1 mode when no PDP context is active, if EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall move to state EMM-DEREGISTERED and state GMM-DEREGISTERED and then initiate an attach procedure. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall enter substates EMM-REGISTERED.NORMAL-SERVICE and GMM-REGISTERED.NO-CELL-AVAILABLE and initiate a tracking area updating procedure.

After successful completion of routing area updating or combined routing area updating and tracking area updating or combined tracking area updating procedures in both S1 mode and A/Gb or Iu mode, if the network has indicated that ISR is activated, the UE shall maintain registration and related periodic update timers in both GMM and EMM.

  NOTE:	As specified in subclause 5.5.3.2.4 of this document or subclause 4.7.5.1.3 of 3GPP TS 24.008 [13], the UE does not activate the ISR even if the network has indicated that the ISR is activated e.g. in the tracking area updating procedure triggered due to a change in UE network capability. In these scenarios, the UE only maintains one registration and related periodic update timer in GMM or EMM.


5.1.5	Coordination between EMM and MM

UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation shall use the combined EPS/IMSI attach procedure in order to attach to both EPS and non-EPS services.

UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation and are already attached to both EPS and non-EPS services shall use the combined tracking area updating and periodic tracking area updating procedures.

UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation and are already attached to both EPS and non-EPS services shall perform a combined detach procedure in order to detach for non-EPS services.

UEs that operate in CS/PS mode 1 or CS/PS mode 2 of operation should not use any MM timers related to MM specific procedures (e.g. T3210, T3211, T3212, T3213) while camped on E-UTRAN, unless the re-activation of these timers is explicitly described. If the MM timers are already running, the UE should not react on the expiration of the timers.

If the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17] and moves from GERAN/UTRAN to E-UTRAN, the UE shall:

  -	if timer T3242 is running, start timer T3444 with the time left on T3242 and stop timer T3242;

  -	if timer T3243 is running, start timer T3445 with the time left on T3243 and stop timer T3243;

  -	if the UE is attached for both EPS services and non-EPS services and timer T3242 or timer T3243 is running, perform a combined tracking area updating procedure; and

  NOTE 1:	A UE configured for eCall only mode as specified in 3GPP TS 31.102 [17] being attached for both EPS services and non-EPS services upon moving from GERAN/UTRAN to E-UTRAN is only possible in the case when the UE has performed a combined attach in E-UTRAN, subsequently moved to GERAN/UTRAN and returned to E-UTRAN before timer T3242 or timer T3243 expires.

  -	if the UE is attached for non-EPS services only and timer T3242 or timer T3243 is running, perform a combined attach procedure.

  NOTE 2:	Timers T3242 and T3243 are specified in 3GPP TS 24.008 [13].


5.2	Behaviour of the UE in state EMM-DEREGISTERED and state EMM-REGISTERED


5.2.1	General

In this subclause, the detailed behaviour of the UE in the states EMM-DEREGISTERED and EMM-REGISTERED is described.


5.2.2	UE behaviour in state EMM-DEREGISTERED


5.2.2.1	General

The state EMM-DEREGISTERED is entered in the UE, when:

  -	the detach or combined detach is performed either by the UE or by the MME (see subclause 5.5.2);

  -	the attach request is rejected by the MME (see subclause 5.5.1);

  -	the tracking area update request is rejected by the MME (see subclause 5.5.3);

  -	the service request procedure is rejected by the MME (see subclause 5.6.1);

  -	the UE deactivates all EPS bearer contexts locally (see subclause 6.4.4.6);

  -	the UE is switched on;

  -	an inter-system change from S1 mode to non-3GPP access is completed and the non-3GPP access network provides PDN connectivity to the same EPC; or

  -	the UE attached for emergency bearer services is in EMM-IDLE mode and its periodic tracking area update timer expires (see subclause 5.3.5).

In state EMM-DEREGISTERED, the UE shall behave according to the substate as explained in subclause 5.2.2.3.


5.2.2.2	Primary substate selection


5.2.2.2.1	Selection of the substate after power on

For a UE configured for eCall only mode as specified in 3GPP TS 31.102 [17], timers T3444 and T3445 are considered to have expired at power on. When the UE is switched on, the substate shall be PLMN-SEARCH if the USIM is available and valid. See 3GPP TS 23.122 [6] for further details.

The substate chosen after PLMN-SEARCH, following power on is:

  -	if no cell can be selected, the substate shall be NO-CELL-AVAILABLE;

  -	if no USIM is present, the substate shall be NO-IMSI;

  -	if a suitable cell has been found and the PLMN or tracking area is not in the forbidden list, then the substate shall be NORMAL-SERVICE;

  -	if the selected cell is known not to be able to provide normal service, then the UE shall enter the substate LIMITED-SERVICE;

  -	if the UE is in manual network selection mode and no cell of the selected PLMN has been found, the UE shall enter the substate NO-CELL-AVAILABLE;

  -	if the selected cell is a non-3GPP cell, the substate shall be NO-CELL-AVAILABLE; and

  -	if the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17], the substate shall be eCALL-INACTIVE.


5.2.2.3	Detailed description of UE behaviour in state EMM-DEREGISTERED


5.2.2.3.1	NORMAL-SERVICE

The UE shall initiate an attach or combined attach procedure.


5.2.2.3.2	LIMITED-SERVICE

The UE shall initiate an attach or combined attach procedure when entering a cell which provides normal service.

The UE may initiate attach for emergency bearer services.


5.2.2.3.3	ATTEMPTING-TO-ATTACH

The UE:

  -	shall initiate an attach or combined attach procedure on the expiry of timers T3411, T3402 or T3346 (see 3GPP TS 24.008 [13]);

  -	may initiate an attach for emergency bearer services even if timer T3346 is running;

  -	shall initiate an attach or combined attach procedure when entering a new PLMN, if timer T3346 is running and the new PLMN is not equivalent to the PLMN where the UE started timer T3346, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the tracking area is not in one of the lists of forbidden tracking areas;

  -	shall initiate an attach or combined attach procedure when the tracking area of the serving cell has changed, if timer T3346 is not running, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the tracking area of the new cell is not in one of the lists of forbidden tracking areas;

  -	shall use requests for non-EPS services for non-emergency call from CM layers to trigger a combined attach procedure, if timer T3346 is not running (see subclause 5.5.1.3), or to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures;

  -	shall use requests for non-EPS services for emergency call from CM layers to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures;

  -	may initiate an attach procedure upon receiving a request from upper layers to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A]) if timer T3346 is not already running for "MO exception data" and even if timer T3402 or timer T3411 is running; and

  -	may initiate an attach procedure upon request of the upper layers to establish a PDN connection for emergency bearer services, if timer T3346 is not running.


5.2.2.3.4	PLMN-SEARCH

The UE shall perform PLMN selection. If a new PLMN is selected, the UE shall reset the attach attempt counter and initiate the attach or combined attach procedure (see subclause 5.5.1).

If the selected cell is known not to be able to provide normal service, the UE may initiate attach for emergency bearer services.


5.2.2.3.5	NO-IMSI

The UE shall perform cell selection according to 3GPP TS 36.304 [21].

The UE may initiate attach for emergency bearer services.


5.2.2.3.6	ATTACH-NEEDED

The UE shall initiate the attach or combined attach procedure, if still needed, as soon as the access is allowed in the selected cell for one of the access classes of the UE.

The UE may initiate attach for emergency bearer services.


5.2.2.3.7	NO-CELL-AVAILABLE

The UE shall perform cell selection according to 3GPP TS 36.304 [21] and choose an appropriate substate when a cell is found. When the lower layers indicate to prepare for an S101 mode to S1 mode handover and the PLMN identity of the target cell provided with this indication is not in one of forbidden PLMN lists, the UE shall enter substate NORMAL-SERVICE.

  NOTE:	It is assumed that the UE can determine the PLMN identity of networks supporting cdma2000® HRPD access from the information broadcast over the radio interface. For the purpose of S101 mode to S1 mode handover, the UE can use the PLMN identity of the visited cdma2000® HRPD network also as PLMN identity of the target cell.


5.2.2.3.8	eCALL-INACTIVE

The UE camps on a suitable cell or an acceptable cell in a PLMN selected as specified in 3GPP TS 23.122 [6] but initiates no EMM signalling with the network and ignores any paging requests.

The UE shall leave substate EMM-DEREGISTERED.eCALL-INACTIVE state only when one of the following events occur:

  -	if the USIM is removed, the UE enters substate EMM-DEREGISTERED.NO-IMSI;

  -	if coverage is lost, the UE enters substate EMM-DEREGISTERED.PLMN-SEARCH;

  -	if the UE is deactivated (e.g. powered off) by the user, the UE enters state EMM-NULL;

  -	if the UE receives a request from upper layers to establish an eCall over IMS, the UE enters state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. The UE then uses the relevant EMM and ESM procedures to establish the eCall over IMS at the earliest opportunity; or

  -	if the UE receives a request from upper layers to establish a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service, the UE enters state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. Once the attach procedure is completed, the UE uses the relevant EMM and ESM procedures to establish the non-emergency call.


5.2.2.4	Substate when back to state EMM-DEREGISTERED from another EMM state

When returning to state EMM-DEREGISTERED, the UE shall select a cell as specified in 3GPP TS 36.304 [21].

The substate depends on the result of the cell selection procedure, the outcome of the previously performed EMM specific procedures, on the EPS update status of the UE, on the tracking area data stored in the UE, on the presence of the USIM, on the UE configuration and on the reason for moving to EMM-DEREGISTERED:

  -	If no cell has been found, the substate is NO-CELL-AVAILABLE, until a cell is found.

  -	If no USIM is present or if the inserted USIM is considered invalid by the UE, the substate shall be NO-IMSI.

  -	If a suitable cell has been found and the PLMN or tracking area is not in the forbidden list, the substate shall be NORMAL-SERVICE.

  -	If an attach shall be performed (e.g. network requested re-attach), the substate shall be ATTEMPTING-TO-ATTACH.

  -	If a PLMN reselection (according to 3GPP TS 23.122 [6]) is needed, the substate shall be PLMN-SEARCH.

  -	If the selected cell is known not to be able to provide normal service, the substate shall be LIMITED-SERVICE;

  -	If the selected cell is a non-3GPP cell, the substate shall be NO-CELL-AVAILABLE; and

  -	If the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17], T3444 and T3445 have expired or are not running, and substate PLMN-SEARCH is not required, the substate shall be eCALL-INACTIVE.


5.2.3	UE behaviour in state EMM-REGISTERED


5.2.3.1	General

The state EMM-REGISTERED is entered at the UE, when:

  -	the attach or combined attach procedure is performed by the UE (see subclause 5.5.1).

In state EMM-REGISTERED, the UE shall behave according to the substate as explained in subclause 5.2.3.2.


5.2.3.2	Detailed description of UE behaviour in state EMM-REGISTERED


5.2.3.2.1	NORMAL-SERVICE

The UE:

  -	shall initiate normal and combined tracking area updating (according to conditions given in subclause 5.5.3);

  -	shall perform periodic tracking area updating (see subclause 5.5.3) except when attached for emergency bearer services (see subclause 5.3.5);

  -	shall respond to paging; and

  -	if configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4).


5.2.3.2.2	ATTEMPTING-TO-UPDATE

The UE:

  -	shall not send any user data;

  -	shall initiate tracking area updating on the expiry of timers T3411, T3402 or T3346;

  -	shall initiate tracking area updating when entering a new PLMN, if timer T3346 is running and the new PLMN is not equivalent to the PLMN where the UE started timer T3346, the PLMN identity of the new cell is not in one of the forbidden PLMN lists, and the tracking area is not in one of the lists of forbidden tracking areas;

  -	shall initiate tracking area updating when the tracking area of the serving cell has changed, if timer T3346 is not running, the PLMN identity of the new cell is not in one of the forbidden PLMN lists and the tracking area is not in one of the lists of forbidden tracking areas;

  -	may initiate a tracking area updating procedure upon request of the upper layers to establish a PDN connection for emergency bearer services;

  -	shall initiate tracking area updating procedure upon request of the upper layers to establish a PDN connection without the NAS signalling low priority indication as specified in subclause 5.5.3.2.6, item l), if timer T3346 is running due to a NAS request message (TRACKING AREA UPDATE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority"and timer T3402 and timer T3411 are not running;

  -	may detach locally and initiate an attach for emergency bearer services even if timer T3346 is running;

  -	shall use requests for non-EPS services from CM layers to trigger a combined tracking area updating procedure, if timer T3346 is not running (see subclause 5.5.3.3), or to attempt to select GERAN, UTRAN or cdma2000® 1xRTT radio access technology and proceed with the appropriate MM and CC specific procedures;

  -	may use requests for an MMTEL voice call or MMTEL video call from the upper layers to initiate tracking area updating, if timer T3346 is not running;

  -	shall initiate tracking area updating in response to paging with S-TMSI or paging with IMSI and domain indicator set to ″CS″;

  -	shall initiate tracking area updating if the EPS update status is set to EU2 NOT UPDATED, and timers T3411, T3402 and T3346 are not running;

  -	if configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4); and

  -	may initiate tracking area updating upon receiving a request from upper layers to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A]) if timer T3346 is not already running for "MO exception data" and even if timer T3402 or timer T3411 is running.


5.2.3.2.3	LIMITED-SERVICE

The UE:

  -	shall perform cell selection/reselection according to 3GPP TS 36.304 [21];

  -	may respond to paging (with IMSI);

  -	may initiate attach for emergency bearer services; and

  -	if configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4).


5.2.3.2.4	PLMN-SEARCH

The UE may enter this substate when it is in automatic network selection mode and the maximum allowed number of subsequently unsuccessful tracking area updating have been performed. The UE may also enter this substate as a result of a tracking area update rejected by the network (see subclause 5.5.3) or as a result of a service request rejected by the network (see subclause 5.6.1). If a new PLMN is selected, the UE shall reset the tracking area updating attempt counter and initiate the tracking area updating or combined tracking area updating procedure (see subclause 5.5.3).

If the selected cell is known not to be able to provide normal service, the UE may initiate attach for emergency bearer services.


5.2.3.2.5	UPDATE-NEEDED

The UE:

  -	shall not send any user data;

  -	shall not send signalling information, unless it is a service request as a response to paging or a tracking area updating or combined tracking area updating procedure upon request by the upper layers to establish a PDN connection for emergency bearer services or upon a request from the upper layers for an MMTEL voice call, MMTEL video call, SMSoIP, SMS over NAS or SMS over S102;

  -	shall perform cell selection/reselection according to 3GPP TS 36.304 [21];

  -	shall enter the appropriate new substate depending on the EPS update status as soon as the access is allowed in the selected cell for one of the access classes of the UE; and

  -	if configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4).


5.2.3.2.6	NO-CELL-AVAILABLE

The UE shall perform cell selection/reselection according to 3GPP TS 36.304 [21].


5.2.3.2.7	ATTEMPTING-TO-UPDATE-MM

The UE:

  -	shall perform cell selection/reselection according to 3GPP TS 36.304 [21];

  -	shall be able to receive and transmit user data and signalling information;

  -	shall initiate combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" on the expiry of timers T3411 or T3402 or when the UE enters a tracking area not in the list of registered tracking areas;

  -	shall respond to paging with IMSI for the PS domain;

  -	shall use requests for non-EPS services from CM layers to attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM and CC specific procedures, unless T3402 is running due to receipt of an ATTACH ACCEPT or TRACKING AREA UPDATING ACCEPT message with EMM cause #22 "congestion"; and

  -	if configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4).


5.2.3.2.8	IMSI-DETACH-INITIATED

The UE:

  -	shall be able to receive and transmit user data and signalling information;

  -	shall initiate combined tracking area updating procedure (according to conditions given in subclause 5.5.3.3 or subclause 5.5.2.2.4); and

  -	if configured for eCall only mode as specified in 3GPP TS 31.102 [17], shall perform the eCall inactivity procedure at expiry of timer T3444 or T3445 (see subclause 5.5.4).


5.3	General on elementary EMM procedures


5.3.1	EMM modes and NAS signalling connection


5.3.1.1	Establishment of the NAS signalling connection

When the UE is in EMM-IDLE mode without suspend indication and needs to transmit an initial NAS message, the UE shall request the lower layer to establish a RRC connection. In this request to the lower layer the NAS shall provide to the lower layer the RRC establishment cause and the call type as specified in annex D of this specification and, for the case specified in subclause 5.6.1.2.2, shall also provide the initial NAS message, otherwise NAS may also provide the initial NAS message.

Initial NAS messages are:

  -	ATTACH REQUEST;

  -	DETACH REQUEST;

  -	TRACKING AREA UPDATE REQUEST;

  -	SERVICE REQUEST;

  -	EXTENDED SERVICE REQUEST; and

  -	CONTROL PLANE SERVICE REQUEST.

When the UE is in EMM-IDLE mode with suspend indication, the UE shall proceed the behaviour as specified in subclauses 5.3.1.3.

For the routing of the initial NAS message to the appropriate MME, the UE NAS provides the lower layers with either the S-TMSI or the registered globally unique MME identifier (GUMMEI) that consists of the PLMN ID, the MME group ID, and the MME code (see 3GPP TS 23.003 [2]) according to the following rules:

  -	If the TIN indicates "GUTI" or "RAT-related TMSI", or the TIN is not available, and the UE holds a valid GUTI:

    a)	When the UE in EMM-IDLE mode initiates a tracking area updating or combined tracking area updating procedure for load balancing purposes, the UE NAS shall provide the lower layers with neither S-TMSI nor registered MME identifier;

    b)	When the tracking area of the current cell is in the list of tracking areas that the UE previously registered in the MME during the NAS signalling connection establishment, the UE NAS shall provide the lower layers with the S-TMSI, but shall not provide the registered MME identifier to the lower layers; or

    c)	When the tracking area of the current cell is not in the list of tracking areas that the UE previously registered in the MME during the NAS signalling connection establishment, the UE NAS shall provide the lower layers with the MME identifier part of the valid GUTI with an indication that the identifier is a native GUMMEI.

  -	If the TIN indicates "P-TMSI" and the UE holds a valid P-TMSI and RAI, the UE NAS shall provide the lower layers with the MME identifier part of the mapped GUTI, which is generated from the P-TMSI and RAI with an indication that the identifier is a mapped GUMMEI.

If the UE operates in single-registration mode and was previously registered in 5GS, the UE NAS shall provide the lower layers with the MME identifier part of the mapped GUTI, which is generated from the 5G-GUTI as specified in 3GPP TS 23.003 [4], an indication that the identifier is a native GUMMEI and an indication that the identifier is mapped from 5GS.

The UE NAS also provides the lower layers with the identity of the selected PLMN (see 3GPP TS 36.331 [22]). In a shared network, the UE shall choose one of the PLMN identities as specified in 3GPP TS 23.122 [6].

When an ATTACH REQUEST message, or a TRACKING AREA UPDATE REQUEST message when the TAI of the current cell is not included in the TAI list, is sent to establish a signalling connection, the UE NAS also provides the lower layers with the DCN-ID according to the following rules:

  a)	if a DCN-ID for the PLMN code of the selected PLMN is available in the UE, the UE NAS shall provide this DCN-ID to the lower layers; or

  b)	if no DCN-ID for the PLMN code of the selected PLMN is available but a Default_DCN_ID value is avaialble in the UE, as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], the UE NAS shall provide this DCN-ID to the lower layers.

If a relay node is attaching for relay node operation (see 3GPP TS 23.401 [10]), the NAS in the relay node shall indicate to the lower layers that the establishment of the NAS signalling connection is for a relay node.

In S1 mode, when the RRC connection has been established successfully, the UE shall enter EMM-CONNECTED mode and consider the NAS signalling connection established.

In S101 mode, when the cdma2000® HRPD access network resources are available for tunnelled NAS signalling, the UE shall enter EMM-CONNECTED mode and consider the S101 mode NAS signalling connection established.


5.3.1.2	Release of the NAS signalling connection


5.3.1.2.1	General

The signalling procedure for the release of the NAS signalling connection is initiated by the network.

In S1 mode, when the RRC connection has been released, the UE shall enter EMM-IDLE mode and consider the NAS signalling connection released.

If the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17] then:

  -	if the NAS signalling connection that was released had been established for eCall over IMS, the UE shall start timer T3444; and

  -	if the NAS signalling connection that was released had been established for a call to an HPLMN designated non-emergency MSISDN or URI for test or terminal reconfiguration service, the UE shall start timer T3445.

The UE shall start the SGC timer T3447 with the service gap time value available in the UE when the NAS signalling connection is released if:

  -	the UE supports SGC feature, and the service gap timer value is available in the UE and does not indicate zero; and

  -	the NAS signalling connection that was released had been established for mobile originated request for transfer of uplink data.

If the UE receives the "Extended wait time" from the lower layers when no attach, tracking area updating or service request procedure is ongoing, the UE shall ignore the "Extended wait time".

To allow the network to release the NAS signalling connection, the UE:

  a)	shall start the timer T3440 if the UE receives any of the EMM cause values #11, #12, #13, #14 (not applicable to the service request procedure), #15, #25 or #35;

  b)	shall start the timer T3440 if:

    -	the UE receives a TRACKING AREA UPDATE ACCEPT message;

    -	the UE has not set the "active" flag in the TRACKING AREA UPDATE REQUEST message;

    -	the UE has not set the "signalling active" flag in the TRACKING AREA UPDATE REQUEST message;

    -	the tracking area updating or combined tracking area updating procedure has been initiated in EMM-IDLE mode; and

    -	the user plane radio bearers have not been set up;

  c)	shall start the timer T3440 if the UE receives a DETACH ACCEPT message and the UE has set the detach type to "IMSI detach" in the DETACH REQUEST message and user plane radio bearers have not been set up;

  d)	shall start the timer T3440 if the UE receives a TRACKING AREA UPDATE REJECT message indicating:

    -	any of the EMM cause values #9 or #10 and the UE has no CS fallback emergency call, CS fallback call, 1xCS fallback emergency call, or 1xCS fallback call pending; or

    -	the EMM cause values #40, the TRACKING AREA UPDATE message was not triggered due to receiving a paging for CS fallback or a paging for 1xCS fallback, and the UE has no CS fallback emergency call, CS fallback call, 1xCS fallback emergency call, or 1xCS fallback call pending;

  e)	shall start the timer T3440 if the UE receives a SERVICE REJECT message indicating any of the EMM cause values #9, #10 or #40 as a response to a SERVICE REQUEST message CONTROL PLANE SERVICE REQUEST message, or an EXTENDED SERVICE REQUEST message with service type set to "packet services via S1";

  f)	may start the timer T3440 if the UE receives any of the EMM cause values #7 or #8; or

  g)	shall start the timer T3440 if the UE receives a SERVICE REJECT message indicating the EMM cause value #39 and the UE has initiated EXTENDED SERVICE REQUEST in EMM-IDLE and the user plane radio bearers have not been set up.

  h)	shall start the timer T3440 if the UE receives a SERVICE REJECT, SERVICE ACCEPT, ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message with control plane data back-off timer.

Upon expiry of T3440,

  -	in cases a, b, c, f and h, the UE shall locally release the established NAS signalling connection; or

  -	in cases d and e, the UE shall locally release the established NAS signalling connection and the UE shall initiate the attach procedure as described in subclause 5.5.3.2.5, 5.5.3.3.5 or 5.6.1.5.

In cases b, c and g,

  -	upon an indication from the lower layers that the user plane radio bearers are set up, the UE shall stop timer T3440 and may send uplink signalling via the existing NAS signalling connection or user data via the user plane bearers. If the uplink signalling is for CS fallback for emergency call, or for establishing a PDN connection for emergency bearer services, the UE shall send the uplink signalling via the existing NAS signalling connection; or

  -	upon receipt of a DETACH REQUEST message, the UE shall stop timer T3440 and respond to the network initiated detach as specified in subclause 5.5.2.3.

In case b,

  -	upon receiving a request from upper layers to send NAS signalling not associated with establishing either a CS emergency call or a PDN connection for emergency bearer services, the UE shall wait for the the local release of the established NAS signalling connection upon expiry of timer T3440 or T3440 being stopped before proceeding;

  -	upon receiving a request from upper layers to establish either a CS emergency call or a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in subclause 5.6.1;

  -	upon receipt of ESM DATA TRANSPORT message, as an implementation option, the UE may reset and restart timer T3440;

  -	upon receipt of a DOWNLINK NAS TRANSPORT or DOWNLINK GENERIC NAS TRANSPORT message, the UE which is in EMM-REGISTERED without PDN connections shall stop timer T3440 and may send uplink signalling via the existing NAS signalling connection; or

  -	upon receipt of an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, MODIFY EPS BEARER CONTEXT REQUEST, DEACTIVATE EPS BEARER CONTEXT REQUEST, DOWNLINK NAS TRANSPORT or DOWNLINK GENERIC NAS TRANSPORT message, if the UE is using control plane CIoT EPS optimization, the UE shall stop timer T3440 and may send uplink signalling via the existing NAS signalling connection.

In case c,

  -	upon receiving a request from upper layers to send NAS signalling not associated with establishing a PDN connection for emergency bearer services, the UE shall wait for the the local release of the established NAS signalling connection upon expiry of timer T3440 or T3440 being stopped before proceeding; or

  -	upon receiving a request from upper layers to establish a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in subclause 5.6.1.

In cases d and e,

  -	upon an indication from the lower layers that the RRC connection has been released, the UE shall stop timer T3440 and perform a new attach procedure as specified in subclause 5.5.3.2.5, 5.5.3.3.5 or 5.6.1.5; or

  -	upon receiving a request from upper layers to establish a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in subclause 5.5.1.

In cases a and f,

  -	upon receiving a request from upper layers to establish a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in subclause 5.5.1.

In case g,

  -	upon receiving a request from upper layers to send NAS signalling not associated with establishing either a CS emergency call or a PDN connection for emergency bearer services, the UE shall wait for the the local release of the established NAS signalling connection upon expiry of timer T3440 or T3440 being stopped before proceeding; or

  -	upon receiving a request from upper layers to establish either a CS emergency call or a PDN connection for emergency bearer services, the UE shall stop timer T3440 and shall locally release the NAS signalling connection, before proceeding as specified in subclause 5.6.1.

In case h,

  -	upon an indication from the lower layers that the user plane radio bearers are set up or upon receiving a request from upper layers to send NAS signalling not associated with ESM DATA TRANSPORT, the UE shall stop timer T3440; or

  -	the UE shall not send ESM DATA TRANSPORT message until expiry of timer T3440 or times T3440 being stopped.

In EMM-CONNECTED mode, if the UE moves to EMM-SERVICE-REQUEST-INITIATED state upon receipt of a CS SERVICE NOTIFICATION message, the UE shall stop timer T3440.

In S101 mode, when the cdma2000® HRPD radio access connection has been released, the UE shall enter EMM-IDLE mode and consider the S101 mode NAS signalling connection released.


5.3.1.2.2	UE is using EPS services with control plane CIoT EPS optimization

Upon receipt of the indication from the ESM layer to release the NAS signalling connection (see subclause 6.6.4.2), unless the MME has additional downlink user data or signalling pending, the MME shall initiate release of the NAS signalling connection.


5.3.1.3	Suspend and resume of the NAS signalling connection

Suspend of the NAS signalling connection can be initiated by the network in EMM-CONNECTED mode when user plane CIoT EPS optimization is used. Resume of the suspended NAS signalling connection is initiated by the UE.

In the UE, when user plane CIoT EPS optimization is used:

  -	Upon indication from the lower layers that the RRC connection has been suspended, the UE shall enter EMM-IDLE mode with suspend indication, shall not consider the NAS signalling connection released and shall not consider the secure exchange of NAS messages terminated (see subclause 4.4.2.3 and 4.4.5). Based on further indications provided by the lower layers, the UE shall update the status of the suspend indication for the EMM-IDLE mode;

  -	Upon trigger of a procedure using an initial NAS message when in EMM-IDLE mode with suspend indication, the UE shall:

    i)	if the initial NAS message is a TRACKING AREA UPDATE REQUEST message which includes a UE radio capability information update needed IE, enter EMM-IDLE mode without suspend indication and proceed with the tracking area updating procedure; and

    ii)	otherwise, request the lower layer to resume the RRC connection. In this request to the lower layer the NAS shall provide to the lower layer the RRC establishment cause and the call type according to annex D of this document;

  NOTE 1:	In NB-S1 mode, in the request to the lower layer the data volume information of the initial NAS message is provided to the lower layers. Interactions between the NAS and the lower layers in order to obtain the data volume information of the initial NAS message (see 3GPP TS 36.321 [49], 3GPP TS 36.331 [22]) is left to implementations.

  -	Upon indication from the lower layers that the RRC connection has been resumed when in EMM-IDLE mode with suspend indication, the UE shall enter EMM-CONNECTED mode. If the pending NAS message is:

    i)	a SERVICE REQUEST message;

    ii)	a CONTROL PLANE SERVICE REQUEST message, and the UE did not include any ESM message container, NAS message container or EPS bearer context status information elements; or

    iii)	an EXTENDED SERVICE REQUEST message, and the Service type information element indicates "packet services via S1" and the UE did not include any EPS bearer context status information element,

    	the message shall not be sent. Otherwise the UE shall cipher the message as specified in subclause 4.4.5 and send the pending initial NAS message upon entering EMM-CONNECTED mode;

  NOTE 2:	If a NAS message is discarded and not sent to the network, the uplink NAS COUNT value corresponding to that message is reused for the next uplink NAS message to be sent.

  -	Upon fallback indication from the lower layers at RRC connection resume when in EMM-IDLE mode with suspend indication, the UE shall enter EMM-IDLE mode without suspend indication, send any pending initial NAS message and proceed as if RRC connection establishment had been requested;

  -	Upon indication from the lower layers that the RRC connection resume has failed and indication from the lower layers that the RRC connection is suspended, the UE shall enter EMM-IDLE mode with suspend indication and restart the ongoing NAS procedure if required; and

  -	Upon indication from the lower layers that the RRC connection resume has failed and indication from the lower layers that the RRC connection is not suspended, the UE shall enter EMM-IDLE mode without suspend indication and restart the ongoing NAS procedure if required.

In the network, when user plane CIoT EPS optimization is used:

  -	Upon indication from the lower layers that the RRC connection has been suspended, the network shall enter EMM-IDLE mode with suspend indication, shall not consider the NAS signalling connection released and shall not consider the secure exchange of NAS messages terminated; and

  -	Upon indication from the lower layers that the RRC connection has been resumed when in EMM-IDLE mode with suspend indication, the network shall enter EMM-CONNECTED mode.

  For the case that not all suspended bearers are resumed, see subclause 6.4.4.6.


5.3.2	Lists of forbidden tracking areas

The UE shall store a list of "forbidden tracking areas for roaming", as well as a list of "forbidden tracking areas for regional provision of service". These lists shall be erased when the UE is switched off or when the UICC containing the USIM is removed, and periodically (with a period in the range 12 to 24 hours). When the lists are erased, the UE performs cell selection according to 3GPP TS 36.304 [21]. One or more tracking areas is removed from the list of "forbidden tracking areas for roaming" in the UE, as well as the list of "forbidden tracking areas for regional provision of service" if, after a subsequent procedure e.g. attach procedure, tracking area updating procedure and GUTI reallocation procedure, one or more tracking areas in the lists is received from the network. If the UE has only one PDN connection established which is for emergency bearer services, the tracking areas shall not be removed from these lists if one or more tracking areas in the lists are received from the network.

In S1 mode, the UE shall update the suitable list whenever an ATTACH REJECT, TRACKING AREA UPDATE REJECT, SERVICE REJECT or DETACH REQUEST message is received with the EMM cause #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", or #15 "no suitable cells in tracking area".

Each list shall accommodate 40 or more TAIs. When the list is full and a new entry has to be inserted, the oldest entry shall be deleted.


5.3.3	List of forbidden PLMNs for attach in S101 mode

A UE supporting S101 mode shall store a list of "forbidden PLMNs for attach in S101 mode". The UE shall erase this list when the UE is switched off or when the USIM is removed.

In S101 mode, the UE shall add to the "forbidden PLMNs for attach in S101 mode" list the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover whenever an ATTACH REJECT message is received with the EMM cause #11 "PLMN not allowed", #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", #14 "EPS services not allowed in this PLMN", #15 "no suitable cells in tracking area", or #35 "Requested service option not authorized in this PLMN" as specified in subclause 5.5.1.2.5.

The maximum number of possible entries in the "forbidden PLMNs for attach in S101 mode" list is implementation dependent, but the list shall accommodate at least one PLMN identity. When the list is full and a new PLMN identity has to be inserted, the UE shall delete the oldest PLMN identity.


5.3.3a	Forbidden PLMNs for EPS services

The forbidden PLMNs for EPS services are contained in the "forbidden PLMNs for GPRS service" list, as defined in 3GPP TS 24.008 [13]. The UE updates this list as part of the attach procedure, tracking area updating procedure and network initiated detach procedure as described respectively in subclauses 5.5.1, 5.5.3 and 5.5.2.3.2.


5.3.4	Equivalent PLMNs list

The UE shall store a list of equivalent PLMNs. These PLMNs shall be regarded by the UE as equivalent to each other for PLMN selection and cell selection/re-selection. The same list is used by EMM, GMM and MM.

The UE shall update or delete this list at the end of each attach or combined attach or tracking area updating or combined tracking area updating procedure. The stored list consists of a list of equivalent PLMNs as downloaded by the network plus the PLMN code of the registered PLMN that downloaded the list. When the UE is switched off, it shall keep the stored list so that it can be used for PLMN selection after switch on. The UE shall delete the stored list if the USIM is removed or when the UE attached for emergency bearer services enters the state EMM-DEREGISTERED. The maximum number of possible entries in the stored list is 16.


5.3.5	Handling of the periodic tracking area update timer and mobile reachable timer (S1 mode only)

The periodic tracking area updating procedure is used to periodically notify the availability of the UE to the network. The procedure is controlled in the UE by timer T3412. The value of timer T3412 is sent by the network to the UE in the ATTACH ACCEPT message and can be sent in the TRACKING AREA UPDATE ACCEPT message. The UE shall apply this value in all tracking areas of the list of tracking areas assigned to the UE until a new value is received.

If timer T3412 received by the UE in an ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message contains an indication that the timer is deactivated or the timer value is zero, then timer T3412 is deactivated and the UE shall not perform the periodic tracking area updating procedure.

Timer T3412 is reset and started with its initial value, when the UE changes from EMM-CONNECTED to EMM-IDLE mode. Timer T3412 is stopped when the UE enters EMM-CONNECTED mode or the EMM-DEREGISTERED state.

If the UE is attached for emergency bearer services, and timer T3412 expires, the UE shall not initiate a periodic tracking area updating procedure, but shall locally detach from the network. When the UE is camping on a suitable cell, it may re-attach to regain normal service.

When a UE is not attached for emergency bearer services, and timer T3412 expires, the periodic tracking area updating procedure shall be started and the timer shall be set to its initial value for the next start.

If the UE is not attached for emergency bearer services, and is in a state other than EMM-REGISTERED.NORMAL-SERVICE when timer T3412 expires, the periodic tracking area updating procedure is delayed until the UE returns to EMM-REGISTERED.NORMAL-SERVICE.

If ISR is activated, the UE shall keep both timer T3412 and timer T3312. The two separate timers run in the UE for updating MME and SGSN independently. The UE shall start timer T3423, if timer T3412 expires, and timer T3346 is running or the UE is in one of the following states:

  -	EMM-REGISTERED.NO-CELL-AVAILABLE;

  -	EMM-REGISTERED.PLMN-SEARCH;

  -	EMM-REGISTERED.UPDATE-NEEDED; or

  -	EMM-REGISTERED.LIMITED-SERVICE.

The UE shall initiate the tracking area updating procedure and stop timer T3423 when it enters state EMM-REGISTERED.NORMAL-SERVICE before timer T3423 expires. After expiry of timer T3423 the UE shall set its TIN to "P-TMSI".

If timer T3423 expires the UE shall memorize that it has to initiate a tracking area updating procedure when it returns to state EMM-REGISTERED.NORMAL-SERVICE.

If the UE is attached to both EPS and non-EPS services, and if timer T3412 expires or timer T3423 expires when the UE is in EMM-REGISTERED.NO-CELL-AVAILABLE state, then the UE shall initiate the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" when the UE returns to EMM-REGISTERED.NORMAL-SERVICE state.

When the network includes T3412 extended value IE in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message, the network uses timer T3412 extended value IE as the value of timer T3412.

The network supervises the periodic tracking area updating procedure of the UE by means of the mobile reachable timer.

If the UE is not attached for emergency bearer services, the mobile reachable timer shall be longer than T3412. In this case, by default, the mobile reachable timer is 4 minutes greater than timer T3412.

If ISR is not activated, the network behaviour upon expiry of the mobile reachable timer is network dependent, but typically the network stops sending paging messages to the UE on the first expiry, and may take other appropriate actions.

If the UE is attached for emergency bearer services, the MME shall set the mobile reachable timer with a value equal to timer T3412. When the mobile reachable timer expires, the MME shall locally detach the UE.

The mobile reachable timer shall be reset and started with the value as indicated above, when the MME releases the NAS signalling connection for the UE. The mobile reachable timer shall be stopped when a NAS signalling connection is established for the UE.

Upon expiry of the mobile reachable timer the network shall start the implicit detach timer. The value of the implicit detach timer is network dependent. If ISR is activated, the default value of the implicit detach timer is 4 minutes greater than timer T3423. If the implicit detach timer expires before the UE contacts the network, the network shall implicitly detach the UE. If the MME includes timer T3346 in the TRACKING AREA UPDATE REJECT message or the SERVICE REJECT message and timer T3346 is greater than timer T3412, the MME sets the mobile reachable timer and the implicit detach timer such that the sum of the timer values is greater than timer T3346.

If the network includes the T3324 value IE in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message,and if the UE is not attached for emergency bearer services and has no PDN connection for emergency bearer services the MME shall set the active timer to a value equal to the value of timer T3324.

  NOTE 1:	Timer T3324 is specified in 3GPP TS 24.008 [13].

If the UE has established a PDN connection for emergency services after receiving the timer T3324 value IE in the ATTACH ACCEPT message or the last TRACKING AREA UPDATE ACCEPT message, the active timer shall not be started.

The active timer shall be reset and started with the value as indicated above, when the MME releases the NAS signalling connection for the UE. The active timer shall be stopped when an NAS signalling connection is established for the UE.

The network behaviour upon expiry of the active timer is network dependent, but typically the network stops sending paging messages to the UE on the first expiry, and may take other appropriate actions.

  NOTE 2:	ISR is not activated when the network includes the T3324 value IE in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message.

The implicit detach timer shall be stopped when a NAS signalling connection is established for the UE.


5.3.6	Handling of timer T3402

The value of timer T3402 can be sent by the network to the UE in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message. If the value is different from "deactivated", the UE shall apply this value in all tracking areas of the list of tracking areas assigned to the UE, until a new value is received.

The value of timer T3402 can be sent by the network to the UE in the ATTACH REJECT message. If an ATTACH REJECT message including timer T3402 value different from "deactivated", was received integrity protected, the UE shall apply this value until a new value is received with integrity protection or a new PLMN is selected. Otherwise, the default value of this timer is used.

The default value of this timer is also used by the UE in the following cases:

  -	ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message is received without a value specified;

  -	the UE does not have a stored value for this timer;

  -	a new PLMN which is not in the list of equivalent PLMNs has been entered, the tracking area updating fails and the tracking area updating attempt counter is equal to 5; or

  -	a new PLMN which is not in the list of equivalent PLMNs has been entered, the attach procedure fails, the attach attempt counter is equal to 5 and no ATTACH REJECT message was received from the new PLMN.


5.3.7	Handling of the Local Emergency Numbers List and the Extended Local Emergency Numbers List

The Local Emergency Numbers List and the Extended Local Emergency Numbers list contain additional local emergency numbers used by the serving network. These lists can be downloaded by the network to the UE at successful registration and subsequent registration updates. There is only one Local Emergency Numbers List and only one Extended Local Emergency Numbers list in the UE. The Local Emergency Numbers List can be updated with EMM procedures if the UE is in S1 mode, with GMM and MM procedures if the UE is in A/Gb or Iu mode, and with 5GMM procedures, as specified in 3GPP TS 24.501 [54], if UE is in N1 mode. The Extended Local Emergency Numbers List can be updated with EMM procedures if the UE is in S1 mode and with 5GMM procedures, as specified in 3GPP TS 24.501 [54], if UE is in N1 mode.

The UE shall use the stored Local Emergency Numbers List and the stored Extended Local Emergency Numbers List received from the network in addition to the emergency numbers stored on the USIM or user equipment to detect that the number dialled is an emergency number.

If the UE determines that the number dialled is an emergency number, the procedures specified in 3GPP TS 23.167 [45] and 3GPP TS 24.229 [13D] are utilised to select a domain for the emergency session attempt.

If the domain selected for the emergency session attempt is the PS domain, then the UE shall perform the session establishment procedures specified in 3GPP TS 24.229 [13D] to initiate an emergency session.

If the domain selected for the emergency session attempt is the CS domain, then the UE shall use the stored Local Emergency Numbers List, in addition to the emergency numbers stored on the USIM and the ME, to determine if the call control entity of the UE specified in 3GPP TS 24.008 [13] is to send an EMERGENCY SETUP message or a SETUP message to the network.

  NOTE 1:	The checking of whether the dialled number is an emergency number and the determination of whether an emergency call is to be initiated in the CS domain, can end once a match is found. The Extended Local Emergency Numbers List does not apply when the CS domain is selected.

  NOTE 2:	The user equipment can use the emergency numbers in each of the stored lists to assist the end user in determining whether the dialled number is intended for an emergency service or for another destination, e.g. a local directory service. The possible interactions with the end user are implementation specific.

  NOTE 3:	A UE that supports procedures specified in 3GPP TS 24.302 [48], can get additional local emergency numbers through those procedures, which can be used based on operator policy, see 3GPP TS 24.302 [48].

The network may send a Local Emergency Numbers List or an Extended Local Emergency Numbers List or both, in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT messages, by including the Emergency number list IE and the Extended emergency number list IE, respectively. The user equipment shall store the Local Emergency Numbers List and the Extended Local Emergency Numbers List, as provided by the network. The Local Emergency Numbers List stored in the user equipment shall be replaced on each receipt of the Emergency number list IE. The Extended Local Emergency Numbers List stored in the user equipment shall be replaced on each receipt of the Extended emergency number list IE. The received Local Emergency Numbers List or the received Extended Local Emergency Numbers list or both shall be provided to the upper layers.

The emergency number(s) received in the Emergency number list IE are valid only in networks in the same country as the PLMN from which this IE is received. If no Local Emergency Numbers List is contained in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT message, then the stored Local Emergency Numbers List in the user equipment shall be kept, except if the user equipment has successfully registered to a PLMN in a country different from that of the PLMN that sent the list.

The emergency number(s) received in the Extended emergency number list IE are valid only in:

  -	networks in the same country as the PLMN from which this IE is received, if the Extended Emergency Number List Validity (EENLV) field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid in the country of the PLMN from which this IE is received"; and

  -	 the PLMN from which this IE is received, if the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received".

If no Extended Local Emergency Numbers List is contained in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT message, and the registered PLMN has not changed, then the stored Extended Local Emergency Numbers List in the user equipment shall be kept. If no Extended Local Emergency Numbers List is contained in the ATTACH ACCEPT or in the TRACKING AREA UPDATE ACCEPT message, but the registered PLMN has changed, then:

  -	if the last received indication in the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is received", the stored Extended Local Emergency Numbers List in the user equipment shall be deleted; and

  -	if the last received indication in the EENLV field within the Extended emergency number list IE indicates "Extended Local Emergency Numbers List is valid in the country of the PLMN from which this IE is received" the list shall be kept except if the user equipment has successfully registered to a PLMN in a country different from that of the PLMN that sent the list.

  NOTE:	To prevent the misrouting of emergency calls, all operators within a country need to follow the regulation or agree on the setting of the Extended emergency number list IE in accordance to national agreement – either to indicate validity within a country or to indicate validity only within the PLMN.

The Local Emergency Numbers List and the Extended Local Emergency Numbers List shall be deleted at switch off and removal of the USIM. The user equipment shall be able to store up to ten entries in the Local Emergency Numbers List and up to twenty entries in the Extended Local Emergency Numbers List, received from the network.


5.3.7a	Specific requirements for UE configured to use timer T3245

The following requirement applies for an UE that is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]):

When the UE adds a PLMN identity to the "forbidden PLMN list", the "forbidden PLMNs for attach in S101 mode" list, or the "forbidden PLMNs for GPRS service" list or sets the USIM as invalid for non-EPS services or EPS services or both, and timer T3245 (see 3GPP TS 24.008 [13]) is not running, the UE shall start timer T3245 as specified in 3GPP TS 24.008 [13], subclause 4.1.1.6.

Upon expiry of the timer T3245, the UE shall erase the "forbidden PLMN list", the "forbidden PLMNs for GPRS service" list, and the "forbidden PLMNs for attach in S101 mode" list and set the USIM to valid for non-EPS and EPS services. When the lists are erased, the UE performs cell selection according to 3GPP TS 36.304 [21].

If the UE is switched off when the timer T3245 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:

  -	let t1 be the time remaining for T3245 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the UE will follow the behaviour as defined in the paragraph above upon expiry of the timer T3245. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.


5.3.7b	Specific requirements for UE when receiving non-integrity protected reject messages

This subclause specifies the requirements for a UE that is not configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) and receives an ATTACH REJECT, TRACKING AREA UPDATE REJECT or SERVICE REJECT message without integrity protection with specific EMM causes.

  NOTE 1:	Additional UE requirements for this case, requirements for other EMM causes, and requirements for the case when the UE receives an integrity protected reject message are specified in subclauses 5.5.1, 5.5.3 and 5.6.1.

The UE may maintain a list of PLMN-specific attempt counters and a list of PLMN-specific PS-attempt counters (see 3GPP TS 24.008 [13]). The maximum number of possible entries in each list is implementation dependent.

Additionally, the UE may maintain one counter for "SIM/USIM considered invalid for non-GPRS services" events and one counter for "SIM/USIM considered invalid for GPRS services" events (see 3GPP TS 24.008 [13]).

If the UE receives an ATTACH REJECT, TRACKING AREA UPDATE REJECT or SERVICE REJECT message without integrity protection with EMM cause value #3, #6, #7, #8, #11, #12, #13, #14, #15 or #35 before the network has established secure exchange of NAS messages for the NAS signalling connection, the UE shall start timer T3247 (see 3GPP TS 24.008 [13]) with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running, and take the following actions:

  1)	if the EMM cause value received is #3, #6, #7 or #8, and

    a)	if the UE maintains a counter for "SIM/USIM considered invalid for GPRS services" events and the counter has a value less than a UE implementation-specific maximum value, the UE shall:

       i)	set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI;

       -	delete the list of equivalent PLMNs;

       -	increment the counter for "SIM/USIM considered invalid for GPRS services" events;

       -	if the EMM cause value received is #3, #6 or #8, and if the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" and the counter has a value less than a UE implementation-specific maximum value, increment the counter;

       -	if an attach or tracking area updating procedure was performed, reset the attach attempt counter or the tracking area updating attempt counter, respectively;

       -	if A/Gb mode or Iu mode is supported by the UE, handle the GMM parameters GPRS attach attempt counter or routing area updating attempt counter, GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the GPRS attach or routing area updating procedure is rejected with the GMM cause of the same value in a NAS message without integrity protection;

       -	store the current TAI in the list of "forbidden tracking areas for roaming" and enter the state EMM-DEREGISTERED.LIMITED-SERVICE; and

       -	search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21]; or

       ii)	proceed as specified in subclauses 5.5.1, 5.5.3 and 5.6.1;

       -	increment the counter for "SIM/USIM considered invalid for GPRS services" events; and

       -	if the EMM cause value received is #3, #6 or #8, and if the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" and the counter has a value less than a UE implementation specific maximum value, increment the counter; and

    b)	else the UE shall proceed as specified in subclauses  5.5.1, 5.5.3 and 5.6.1;

  2)	if the EMM cause value received is #12, #13 or #15, the UE shall additionally proceed as specified in subclauses 5.5.1, 5.5.3 and 5.6.1;

  3)	if the EMM cause value received is #11, #14 or #35 and the UE is in its HPLMN or EHPLMN,

    -	the UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs. Additionally, if an attach or tracking area updating procedure was performed, the UE shall reset the attach attempt counter or the tracking area updating attempt counter, respectively.

    -	if A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter or routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the procedure is rejected with the GMM cause with the same value in a NAS message without integrity protection;

    -	the UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and enter the state EMM-DEREGISTERED.LIMITED-SERVICE; and

    -	the UE shall search for a suitable cell in another tracking area or in another location area in the same PLMN according to 3GPP TS 36.304 [21];

  4)	if the EMM cause value received is #11 or #35 and the UE is not in its HPLMN or EHPLMN, in addition to the UE requirements specified in subclause 5.5.1, 5.5.3 and 5.6.1,

       	if the UE maintains a list of PLMN-specific attempt counters and the PLMN-specific attempt counter for the PLMN sending the reject message has a value less than a UE implementation-specific maximum value, the UE shall increment the PLMN-specific attempt counter for the PLMN; and

  5)	if the EMM cause value received is #14 and the UE is not roaming in its HPLMN or EHPLMN, in addition to the UE requirements specified in subclause5.5.1, 5.5.3 and 5.6.1,

       	if the UE maintains a list of PLMN-specific PS-attempt counter and the PLMN-specific PS-attempt counter of the PLMN sending the reject message has a value less than a UE implementation-specific maximum value, the UE shall increment the PS-attempt counter of the PLMN.

Upon expiry of timer T3247, the UE shall

  -	erase the list of "forbidden tracking areas for regional provision of service" and the list of "forbidden tracking areas for roaming";

  -	set the USIM to valid for EPS services, if

    -	the UE does not maintain a counter for "SIM/USIM considered invalid for GPRS services" events; or

    -	the UE maintains a counter for "SIM/USIM considered invalid for GPRS services" events and this counter has a value less than a UE implementation-specific maximum value;

  -	set the USIM to valid for non-EPS services, if

    -	the UE does not maintain a counter for "SIM/USIM considered invalid for non-GPRS services" events; or

    -	the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events and this counter has a value less than a UE implementation-specific maximum value;

  -	if the UE maintains a list of PLMN-specific attempt counters, for each PLMN-specific attempt counter that has a value greater than zero and less than a UE implementation-specific maximum value, remove the respective PLMN from the forbidden PLMN list;

  -	if the UE maintains a list of PLMN-specific PS-attempt counters, for each PLMN-specific PS-attempt counter that has a value greater than zero and less than a UE implementation-specifc maximum value, remove the respective PLMN from the "forbidden PLMNs for GPRS service" list. If the resulting "forbidden PLMNs for GPRS service" list is empty, the UE shall re-enable the E-UTRA capability (see subclause 4.5);

  -	if the UE is supporting A/Gb mode or Iu mode, handle the list of "forbidden location areas for regional provision of service" and the list of "forbidden location areas for roaming" as specified in 3GPP TS 24.008 [13] for the case when timer T3247 expires;

  -	if the UE is supporting A/Gb mode or Iu mode and maintains a list of "forbidden location areas for non-GPRS services" and a list of "forbidden location areas for GPRS services", handle these lists as specified in 3GPP TS 24.008 [13] for the case when timer T3247 expires; and

  -	initiate an EPS attach procedure or tracking area updating procedure, if still needed, dependent on EMM state and EPS update status, or perform PLMN selection according to 3GPP TS 23.122 [6].

If the UE maintains a list of PLMN-specific attempt counters and PLMN-specific PS-attempt counters, when the UE is switched off, the UE shall, for each PLMN-specific attempt counter that has a value greater than zero and less than the UE implementation-specific maximum value, remove the respective PLMN from the forbidden PLMN list. When the USIM is removed, the UE should perform this action.

  NOTE 2:	If the respective PLMN was stored in the extension of the "forbidden PLMNs" list, then according to 3GPP TS 23.122 [6] the UE will delete the contents of this extension when the USIM is removed.


5.3.8	Abnormal cases in the UE

The following abnormal case can be identified:

  a)	EMM uplink message transmission failure indication by lower layers

    	When it is specified in the relevant procedure that it is up to the UE implementation to rerun the ongoing procedure that triggered that procedure, the procedure can typically be re-initiated using a retransmission mechanism of the uplink message (the one that has previously failed to be transmitted) with new sequence number and message authentication code information thus avoiding to restart the whole procedure.


5.3.9	Handling of NAS level mobility management congestion control

The network may detect EMM signalling congestion and perform NAS level mobility management congestion control. NAS level mobility management congestion control consists of general NAS level mobility management congestion control and subscribed APN based congestion control.

Under general overload conditions the network may reject mobility management signalling requests from UEs as specified in 3GPP TS 23.401 [10]. The network should not reject the following requests:

  -	requests for emergency bearer services;

  -	requests from UEs that were received via NAS signalling connections established with RRC establishment cause "High priority access AC 11 – 15"; and

  -	requests for CS fallback emergency call or 1xCS fallback emergency call.

When subscribed APN based mobility management congestion control is active for a particular APN, the network may reject attach requests from UEs with a subscription to this APN.

In mobility management the network may detect NAS signalling congestion and start or stop performing the subscribed APN based congestion control based on mobility management level criteria such as:

  -	rate of mobility management NAS messages from a group of UEs with a subscription to a particular APN exceeds or falls below certain thresholds; and/or

  -	setting in network management.

When the NAS level mobility management congestion control is active, the network may include a value for the mobility management back-off timer T3346 in the reject messages. The UE starts the timer T3346 with the value received in the mobility management reject messages. To avoid that large numbers of UEs simultaneously initiate deferred requests, the network should select the value for the timer T3346 for the rejected UEs so that timeouts are not synchronised.

For subscribed APN based congestion control the value of timer T3346 for a particular APN may be APN dependent.

If the timer T3346 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3346 is kept running until it expires or it is stopped.

If the UE is switched off when the timer T3346 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:

  -	let t1 be the time remaining for T3346 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1; and

  -	if prior to switch off, timer T3346 was started due to a NAS request message (ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority", then if timer T3346 is restarted at switch on, the UE configured for dual priority shall handle mobility management requests as indicated in subclauses 5.5.1.2.6, 5.5.3.2.6 and 5.6.1.6.

If the UE enters a new PLMN while timer T3346 is running, and the new PLMN is not equivalent to the PLMN where the UE started timer T3346, the UE shall stop timer T3346 when initiating mobility management procedures in the new PLMN.

After change in TAI which is not part of TAI list, if the timer T3346 is running and EMM update status is EU1 UPDATED then UE shall set the EMM update status to EU2 NOT UPDATED and enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.


5.3.9A	Handling of congestion control for transport of user data via the control plane

The network may activate congestion control for transport of user data via the control plane, as specified in 3GPP TS 23.401 [10].

If the congestion control for transport of user data via the control plane is active and if the UE has indicated support for the control plane data back-off timer, the network shall include a value for the control plane data back-off timer T3448 in ATTACH ACCEPT, TRACKING AREA UPDATE ACCEPT, SERVICE ACCEPT or SERVICE REJECT message, and shall store an control plane data back-off time on a per UE basis. The UE starts the timer T3448 with the value informed in the message. To avoid that large numbers of UEs simultaneously initiate deferred requests, the network should select the value for the timer T3448 for the informed UEs so that timeouts are not synchronised.

The network sends TRACKING AREA UPDATE ACCEPT message or SERVICE ACCEPT message without T3448 value IE to stop the timer T3448 running in the UE as specified in subclause 5.5.3.2.4 and subclause 5.6.1.4.2.

Based on the stored control plane data back-off time for the UE, the network may reject the transfer of user data via the control plane initiated by the UE.

While the timer T3448 is running, the UE in EMM-IDLE mode shall not initiate the transport of user data via the control plane procedure (see subclause 6.6.4), except if the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]) and the user data is related to an exceptional event.

Upon entering the state EMM-DEREGISTERED or a new PLMN which is not equivalent to the PLMN where the UE started the timer T3448, or upon being switched off while the timer T3448 is running, the UE shall stop the timer T3448. For further criteria to stop of timer T3448, refer to subclause 5.5.3.2.4 and subclause 5.6.1.4.2.


5.3.10	Access class control

The network can restrict the access for certain groups of UEs by means of barring their access class.

The UE shall evaluate the access control information as specified in 3GPP TS 36.331 [22] for:

  -	Access Class Barring;

  -	Access Control for CSFB and Extended Access Barring (EAB);

  -	Access Control for Application specific Congestion control for Data Communication (ACDC), if the UE supports ACDC; and

  -	Access Barring.


5.3.11	Power saving mode

The UE can request the use of power saving mode (PSM) during an attach or tracking area updating procedure (see 3GPP TS 23.682 [11A] and 3GPP TS 23.401 [10]). The UE shall not request the use of PSM during:

  -	an attach for emergency bearer services procedure;

  -	an attach procedure for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach";

  -	a tracking area updating procedure for initiating a PDN connection for emergency bearer services; or

  -	a tracking area updating procedure when the UE has a PDN connection established for emergency bearer services.

The network accepts the use of PSM by providing a specific value for timer T3324 when accepting the attach or tracking area updating procedure. The UE may use PSM only if the network has provided the T3324 value IE during the last attach or tracking area updating procedure with a value different from "deactivated".

  NOTE:	Timer T3324 is specified in 3GPP TS 24.008 [13].

Upon expiry of the timer T3324 or if the T3324 value provided by the network is zero, the UE may deactivate the AS layer and activate PSM by entering the state EMM-REGISTERED.NO-CELL-AVAILABLE if:

  a)	the UE is not attached for emergency bearer services;

  b)	the UE has no PDN connection for emergency bearer services;

  c)	the UE is in EMM-IDLE mode; and

  d)	in the EMM-REGISTERED.NORMAL-SERVICE state.

If conditions a, b and c are fulfilled, but the UE is in a state other than EMM-REGISTERED.NORMAL-SERVICE when timer T3324 expires, the UE may activate PSM when the MS returns to state EMM-REGISTERED.NORMAL-SERVICE.

A UE that has already been allocated timer T3324 with a value different from "deactivated" and the timer T3324 has expired, may activate PSM if it receives an "Extended wait time" from lower layers.

When PSM is activated all NAS timers are stopped and associated procedures aborted except for T3412, T3346, T3396, any backoff timers, and the timer T controlling the periodic search for HPLMN or EHPLMN or higher prioritized PLMNs (see 3GPP TS 23.122 [6]).

If the UE is attached for emergency bearer services or has a PDN connection for emergency bearer services, the UE shall not activate PSM.

The UE may deactivate PSM and activate the AS layerat any time. Upon deactivating PSM, the UE may initiate EMM procedures (e.g. for the transfer of mobile originated signalling or user data).


5.3.12	Extended idle-mode DRX cycle

The UE may request the use of extended idle-mode DRX cycle (eDRX) during an attach or tracking area updating procedure by including the extended DRX parameters IE (see 3GPP TS 23.682 [11A] and 3GPP TS 23.401 [10]). The UE shall not request the use of eDRX during:

  -	an attach for emergency bearer services procedure; or

  -	a tracking area updating procedure for the UE attached for emergency bearer services.

The UE and the network may negotiate eDRX parameters during a tracking area updating procedure when the UE has a PDN connection for emergency bearer services.

The network accepts the request to use the eDRX by providing the extended DRX parameters IE when accepting the attach or the tracking area updating procedure. The UE shall use eDRX only if it received the extended DRX parameters IE during the last attach or tracking area updating procedure and the UE does not have a PDN connection for emergency bearer services.

  NOTE:	If the UE wants to keep using eDRX, the UE includes the extended DRX parameters IE in each attach or tracking area updating procedure.

If the UE received the extended DRX parameters IE during the last attach or tracking area updating procedure, upon successful completion of the PDN disconnect procedure of the PDN connection for emergency bearer services or EPS bearer context deactivation procedure of the EPS bearer context for emergency, the UE shall resume eDRX.

If the network has provided the extended DRX parameters IE during the last attach or tracking area updating procedure, upon successful completion of the PDN disconnect procedure of the PDN connection for emergency bearer services or EPS bearer context deactivation procedure of the EPS bearer context for emergency, the network shall resume eDRX.

If the UE or the network locally releases the PDN connection for emergency bearer service, the UE or the network shall not use eDRX until the UE receives eDRX parameters during a tracking area updating procedure with EPS bearer context synchronization or upon successful completion of a service request procedure.

If the UE did not receive the extended eDRX parameters IE, or if the UE has a PDN connection for emergency bearer services, the UE shall use the stored UE specific DRX parameter, if available.

If the network did not accept the request to use eDRX, or if the UE has a PDN connection for emergency bearer services, the network shall use the stored UE specific DRX parameter, if available.

If the network provided the extended DRX parameters IE which was different from the one requested by the UE and also assigned a new GUTI for the UE as described in subclause 5.5.3.2.4 during the last tracking area updating procedure, the network shall use the stored UE specific DRX parameter, if available, with the old GUTI and use the eDRX provided by the network with the new GUTI until the old GUTI can be considered as invalid by the network (see subclause 5.4.1.4).


5.3.13	Interaction between power saving mode and extended idle mode DRX cycle

The UE can request the use of both PSM and eDRX during an attach or tracking area update procedure but it is up to the network to decide to enable none, one of them or both (see 3GPP TS 23.682 [11A] and 3GPP TS 23.401 [10]).

If the network accepts the use of both PSM (see subclause 5.3.11) and eDRX (see subclause 5.3.12), the extended DRX parameters IE provided to the UE should allow for multiple paging occasions before the active timer expires.


5.3.14	Dedicated core network

The network may reject mobility management signalling requests from UEs due to dedicated core network as specified in 3GPP TS 23.401 [10]. When the network rejects mobility management signalling requests due to dedicated core network, the mechanism for general NAS level mobility management congestion control as specified in subclause 5.3.9 shall be followed.


5.3.15	CIoT EPS optimizations

CIoT EPS optimizations provide improved support of small data and SMS transfer. A UE supporting CIoT EPS optimizations can indicate the CIoT network behaviour the UE can support and prefer to use during attach or tracking area updating procedure (see 3GPP TS 23.401 [10]). The UE may indicate the support for control plane CIoT EPS optimization, user plane CIoT EPS optimization, EMM-REGISTERED without PDN connection, S1-U data transfer and header compression (see subclause 9.9.3.34). The UE may also request to use SMS transfer without combined attach procedure during the attach procedure. Furthermore, the UE may, separately from the indication of support, indicate preference for control plane CIoT EPS optimization or user plane CIoT EPS optimization (see subclause 9.9.3.0B). The indication of preference is also considered as the request to use.

  NOTE 1:	The UE supporting control plane CIoT EPS optimization and S1-U data transfer but not user plane CIoT EPS optimization does not indicate preference for user plane CIoT EPS optimization.

The UE can be in NB-S1 mode or WB-S1 mode when requesting the use of CIoT EPS optimizations during an attach or tracking area updating procedure. A UE in NB-S1 mode always indicates support for control plane CIoT EPS optimization. A UE in NB-S1 mode can also request SMS transfer without combined procedure by using the normal attach or tracking area updating procedure (see subclause 5.5.1 and 5.5.3).

In NB-S1 mode, the UE, when requesting the use of CIoT EPS optimization, does not:

  -	request an attach for emergency bearer services procedure;

  -	request an attach procedure for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach"; or

  -	indicate voice domain preference and UE's usage setting.

The network does not indicate to the UE support of emergency bearer services when the UE is in NB-S1 mode (see subclause 5.5.1.2.4 and 5.5.3.2.4).

The control plane CIoT EPS optimization enables support of efficient transport of user data (IP, non-IP) or SMS messages over control plane via the MME without triggering data radio bearer establishment. The support of control plane CIoT EPS optimization is mandatory for the network in NB-S1 mode and optional in WB-S1 mode. Optional header compression of IP data can be applied to IP PDN type PDN connections that are configured to support header compression.

The user plane CIoT EPS optimization enables support for change from EMM-IDLE mode to EMM-CONNECTED mode without the need for using the service request procedure (see subclause 5.3.1.3).

If the UE indicates support of EMM-REGISTERED without PDN connection in the attach request, the UE may include an ESM DUMMY MESSAGE instead of a PDN CONNECTIVITY REQUEST message as part of the attach procedure. If the EMM-REGISTERED without PDN connection is supported by the network, the UE and the network can at any time release all the PDN connections and the UE still remains EPS attached.

  NOTE 2:	For both the UE and the network, the term "EMM-REGISTERED without PDN connection" is equivalent to the term "EPS attach without PDN connectivity" as specified in 3GPP TS 23.401 [10].

In NB-S1 mode, if the UE indicates "SMS only" during a normal attach or tracking area updating procedure, the MME supporting CIoT EPS optimisations provides SMS so that the UE is not required to perform a combined attach or tracking area updating procedure.

If the UE supports user plane CIoT EPS optimization, it shall also support S1-U data transfer.

If the UE indicates support of one or more CIoT EPS optimizations and the network supports one or more CIoT EPS optimizations and decides to accept the attach or tracking area update request, the network indicates the supported CIoT EPS optimizations to the UE per TAI list when accepting the UE request. Network indication of support is interpreted by the UE as the acceptance to use the respective feature. After completion of the attach or tracking area updating procedure, the UE and the network can then use the accepted CIoT EPS optimizations for the transfer of user data (IP, non-IP and SMS).

If the UE and the network support both the control plane CIoT EPS optimization and S1-U data transfer, then when receiving the UE's request for a PDN connection, the MME decides whether the PDN connection should be SCEF PDN connection or SGi PDN connection as specified in 3GPP TS 23.401 [10]:

  -	if SCEF PDN connection is to be established for non-IP data type, the MME shall include Control plane only indication for the requested PDN connection;

  -	if SGi PDN connection is to be established and existing SGi PDN connections for this UE were established with Control plane only indication, the MME shall include Control plane only indication for the newly requested SGi PDN connection;

  -	if SGi PDN connection is to be established and existing SGi PDN connections for this UE were established without Control plane only indication, the MME shall not include Control plane only indication for the newly requested SGi PDN connection; and

  -	if SGi PDN connection is to be established and no SGi PDN connection for this UE exists, the MME determine whether to include Control plane only indication for the requested SGi PDN connection based on local policies, the UE's preferred CIoT network behaviour and the supported CIoT network behaviour.

If the network supports user plane CIoT EPS optimization, it shall also support S1-U data transfer.

Broadcast system information may provide information about support of CIoT EPS optimizations (see 3GPP TS 36.331 [22]). At reception of new broadcast system information, the lower layers deliver it to the EMM layer in the UE. The information provided by lower layers is per PLMN and used by the UE to determine whether certain CIoT EPS optimizations are supported in the cell.

The UE shall not attempt to use CIoT EPS optimizations which are indicated as not supported.

In NB-S1 mode, when the UE requests the lower layer to establish a RRC connection and the UE requests the use of EMM-REGISTERED without PDN connection or user plane CIoT EPS optimization, the UE shall pass an indication of the requested CIoT EPS optimizations to the lower layers. If the UE requests the use of S1-U data transfer without user plane CIoT optimization, then the UE shall also pass an indication of user plane CIoT EPS optimization to lower layers.

In WB-S1 mode, when the UE requests the lower layer to establish a RRC connection and the UE requests the use of EMM-REGISTERED without PDN connection, control plane CIoT EPS optimization or user plane CIoT EPS optimization, the UE shall pass an indication of the requested CIoT EPS optimizations to the lower layers.


5.3.16	Restriction on use of enhanced coverage

In order to deal with use of extensive resources from the network, the operator may prevent specific subscribers from using enhanced coverage (see 3GPP TS 23.401 [10]). When in NB-S1 mode, the UE shall indicate support for restriction on use of enhanced coverage. When in WB-S1 mode, the UE supporting either CE mode A or CE mode B shall indicate support for restriction on use of enhanced coverage. The UE supporting restriction on use of enhanced coverage indicates its support for restriction on use of enhanced coverage in the ATTACH REQUEST and TRACKING AREA UPDATE REQUEST message. If the UE supports restriction on use of enhanced coverage, the MME indicates whether the use of enhanced coverage is restricted or not in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message (see subclause 5.5.1.2 and subclause 5.5.3.2). If the use of enhanced coverage is restricted, the UE shall not use enhanced coverage in the registered PLMN and in any PLMN which is in the list of equivalent PLMNs.

If the UE supports CE mode B and the network determines that

  -	the use of enhanced coverge is not restricted for the UE; or

  -	CE mode B is not restricted for the UE;

the applicable NAS timer values shall be calculated by the network as described in subclause 4.8.


5.3.17	Service Gap Control

The network may control the frequency UEs can transit from EMM-IDLE mode to EMM-CONNECTED mode via the service gap control (SGC) as specified in 3GPP TS 23.401 [10]. If the network supports service gap control (SGC) feature and the service gap time value is available in the EMM context of the UE, the MME shall consider SGC as active for the UE.

The UE and the network negotiate usage of the service gap control (SGC) feature during the attach and tracking area update procedures:

  -	the UE supporting service gap control indicates its support for service gap control in the ATTACH REQUEST and TRACKING AREA UPDATE REQUEST message. If the UE supports service gap control and the the SGC is active for the UE, the MME shall include service gap timer T3447 value in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message (see subclause 5.5.1.2 and subclause 5.5.3.2). The UE shall store the service gap time value; and

  -	for UEs that do not support the optional SGC feature when the network rejects mobility management signalling requests due to service gap control is active in the network, the mechanism for general NAS level mobility management congestion control as specified in subclause 5.3.9 applies.

The UE shall start the SGC timer T3447 when the NAS signalling connection is released and if:

  -	the UE supports SGC feature, and the service gap timer value is available in the UE and does not indicate zero; and

  -	the NAS signalling connection released was not established for:

    -	paging;

    -	attach requests without PDN connection request; or

    -	tracking area update requests without "active" or "signalling active" flag set.

If the SGC is active in the network, after the UE transitions from EMM-CONNECTED mode to EMM-IDLE mode except when the UE was in EMM-CONNECTED mode due to:

  -	paging;

  -	attach requests without PDN connection request; or

  -	tracking area update requests without "active" or "signalling active" flag set,

the network shall start the SGC timer T3447:

  -	with the service gap time value available in the EMM context minus 4 minutes, if the UE supports SGC feature and the service gap time value has been sent to the UE with a non-zero value; or

  -	with the service gap time value available in the EMM context if the UE does not support SGC feature.

When the SGC timer is running, the network allows:

  -	attach requests for emergency bearer services;

  -	attach requests without PDN connection request;

  -	tracking area update requests without "active" or "signalling active" flag set;

  -	requests from UEs that were received via NAS signalling connections established with RRC establishment cause "High priority access AC 11 – 15";

  -	mobile terminated service requests triggered by paging and subsequent MO signalling or MO data, if any, until the UE enters EMM-IDLE mode.

The UE or the network with a running service gap timer shall keep the timer running when the UE transits from EMM-IDLE mode to EMM-CONNECTED mode.

  NOTE:	If the UE transitions from EMM-IDLE mode to EMM-CONNECTED mode due to attach request without PDN connection request or tracking area update request without "active" or "signalling active" flag set, the UE initiates no further MO signalling except for tracking area update request without "active" or "signalling active" flag set until the UE receives network-initiated signalling (e.g. DOWNLINK NAS TRANSPORT message for MT SMS) or MT data over user plane, or after the UE has moved to EMM-IDLE state and the service gap timer is not running.

If the timer T3447 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3447 is kept running until it expires.

If the UE is switched off when the timer T3447 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:

  -	let t1 be the time remaining for T3447 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1.


5.4	EMM common procedures


5.4.1	GUTI reallocation procedure


5.4.1.1	General

The purpose of the GUTI reallocation procedure is to allocate a GUTI and optionally to provide a new TAI list or a new DCN-ID or both to a particular UE.

The reallocation of a GUTI is performed by the unique procedure defined in this subclause. This procedure can only be initiated by the MME in state EMM-REGISTERED.

The GUTI can also be implicitly reallocated at attach or tracking area updating procedures. The implicit reallocation of a GUTI is described in the subclauses which specify these procedures (see subclause 5.5.1 and 5.5.3).

The PLMN identity in the GUTI indicates the current registered PLMN.

  NOTE 1:	The GUTI reallocation procedure is usually performed in ciphered mode.

  NOTE 2:	Normally, the GUTI reallocation will take place in conjunction with another mobility management procedure, e.g. as part of tracking area updating.


5.4.1.2	GUTI reallocation initiation by the network

The MME shall initiate the GUTI reallocation procedure by sending a GUTI REALLOCATION COMMAND message to the UE and starting the timer T3450 (see example in figure 5.4.1.2.1).

The GUTI REALLOCATION COMMAND message shall include a GUTI and may include a TAI list or a DCN-ID or both.

[pic]

Figure 5.4.1.2.1: GUTI reallocation procedure


5.4.1.3	GUTI reallocation completion by the UE

Upon receipt of the GUTI REALLOCATION COMMAND message, the UE shall store the GUTI and the TAI list and the DCN-ID, if provided, and send a GUTI REALLOCATION COMPLETE message to the MME. The UE considers the new GUTI as valid and the old GUTI as invalid. If the UE receives a new TAI list in the GUTI REALLOCATION COMMAND message, the UE shall consider the new TAI list as valid and the old TAI list as invalid; otherwise, the UE shall consider the old TAI list as valid.

If the GUTI REALLOCATION COMMAND message contains the DCN-ID IE, then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex C.


5.4.1.4	GUTI reallocation completion by the network

Upon receipt of the GUTI REALLOCATION COMPLETE message, the MME shall stop the timer T3450 and consider the new GUTI as valid and the old GUTI as invalid. If a new TAI list is provided in the GUTI REALLOCATION COMMAND message, the MME shall consider the new TAI list as valid and the old TAI list as invalid.


5.4.1.5	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	Transmission failure of GUTI REALLOCATION COMPLETE message indication with TAI change from lower layers

    	If the current TAI is not in the TAI list, the GUTI reallocation procedure shall be aborted and a tracking area updating procedure shall be initiated.

    	If the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure that triggered the GUTI reallocation procedure.

  b)	Transmission failure of GUTI REALLOCATION COMPLETE message indication without TAI change from lower layers

    	It is up to the UE implementation how to re-run the ongoing procedure that triggered the GUTI reallocation procedure.


5.4.1.6	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	Lower layer failure

    	If a lower layer failure is detected before the GUTI REALLOCATION COMPLETE message is received, the old and the new GUTI shall be considered as valid until the old GUTI can be considered as invalid by the network. If a new TAI list was provided in the GUTI REALLOCATION COMMAND message, the old and new TAI list shall also be considered as valid until the old TAI list can be considered as invalid by the network.

    	During this period the network:

    -	may first use the old S-TMSI from the old GUTI for paging within the area defined by the old TAI list for an implementation dependent number of paging attempts for network originated transactions. If a new TAI list was provided with old GUTI in the GUTI REALLOCATION COMMAND message, the new TAI list should also be used for paging. Upon response from the UE, the network may re-initiate the GUTI reallocation. If the response is received from a tracking area within the old and new TAI list, the network shall re-initiate the GUTI reallocation. If no response is received to the paging attempts, the network may use the new S-TMSI from the new GUTI for paging for an implementation dependent number of paging attempts. In this case, if a new TAI list was provided with new GUTI in the GUTI REALLOCAITON COMMAND message, the new TAI list shall be used instead of the old TAI list. Upon response from the UE the network shall consider the new GUTI as valid and the old GUTI as invalid. If no response is received to the paging attempts, the network may use the IMSI for paging for an implementation dependent number of paging attempts;

  NOTE 1:	Paging with IMSI causes the UE to re-attach as described in subclause 5.6.2.2.2.

    -	shall consider the new GUTI as valid if it is used by the UE and, additionally, the new TAI list as valid if it was provided with this GUTI in the GUTI REALLOCATION COMMAND message;

    -	may use the identification procedure followed by a new GUTI reallocation if the UE uses the old GUTI; and

    -	if the network accepted to use eDRX for the UE, may determine the next paging window from both old GUTI and new GUTI, and may first use the S-TMSI from the GUTI which led the first eDRX for paging. If no response is received to the paging attempts for the first eDRX, the network may use the other S-TMSI from the other GUTI which led the second eDRX for paging. For this paging procedure, the network shall start timer T3415 long enough to care the paging attempts for both eDRXs.

  NOTE 2:	If the second eDRX comes during the first eDRX ongoing, the paging attempts for the second eDRX can be initiated with stopping further paging attempts for the first eDRX.

  b)	Expiry of timer T3450

    	The GUTI reallocation procedure is supervised by the timer T3450. The network shall, on the first expiry of timer T3450, reset and restart timer T3450 and shall retransmit the GUTI REALLOCATION COMMAND. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3450, the network shall abort the reallocation procedure and shall follow the rules described for case a above.

  c)	GUTI reallocation and attach procedure collision

    	If the network receives an ATTACH REQUEST message before the ongoing GUTI reallocation procedure has been completed the network shall proceed with the attach procedure after deletion of the EMM context.

  d)	GUTI reallocation and UE initiated detach procedure collision

    	If the network receives a DETACH REQUEST message before the ongoing GUTI reallocation procedure has been completed, the network shall abort the GUTI reallocation procedure and shall progress the detach procedure.

  e)	GUTI reallocation and tracking area updating procedure collision

    	If the network receives a TRACKING AREA UPDATE REQUEST message before the ongoing GUTI reallocation procedure has been completed, the network shall abort the GUTI reallocation procedure and shall progress the tracking area updating procedure. The network may then perform a new GUTI reallocation.

  f)	GUTI reallocation and service request procedure collision

    	If the network receives an EXTENDED SERVICE REQUEST message for CS fallback or 1xCS fallback before the ongoing GUTI reallocation procedure has been completed, the network shall progress both procedures.

  g)	Lower layer indication of non-delivered NAS PDU due to handover

    	If the GUTI REALLOCATION COMMAND message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the GUTI REALLOCATION COMMAND message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the GUTI REALLOCATION COMMAND message.

If there is a different new GUTI and optionally a new TAI list included in a subsequent GUTI REALLOCATION COMMAND message, the UE always regards the newest GUTI and the newest TAI list as valid for the recovery time.


5.4.2	Authentication procedure


5.4.2.1	General

The purpose of the EPS authentication and key agreement (AKA) procedure is to provide mutual authentication between the user and the network and to agree on a key KASME (see 3GPP TS 33.401 [19]). The cases when the EPS AKA procedure should be used are defined in 3GPP TS 33.401 [19].

The EPS AKA procedure is always initiated and controlled by the network. However, the UE can reject the EPS authentication challenge sent by the network.

The UE shall proceed with an EPS authentication challenge only if a USIM is present.

A partial native EPS security context is established in the UE and the network when an EPS authentication is successfully performed. During a successful EPS authentication procedure, the CK and IK are computed by the USIM. CK and IK are then used by the ME as key material to compute a new key, KASME. KASME is stored in the EPS security contexts (see 3GPP TS 33.401 [19]) of both the network and in the volatile memory of the ME while attached to the network, and is the root for the EPS integrity protection and ciphering key hierarchy.


5.4.2.2	Authentication initiation by the network

When a NAS signalling connection exists, the network can initiate an authentication procedure at any time. For restrictions applicable after handover or inter-system handover to S1 mode see subclause 5.5.3.2.3.

The network initiates the authentication procedure by sending an AUTHENTICATION REQUEST message to the UE and starting the timer T3460 (see example in figure 5.4.2.2.1). The AUTHENTICATION REQUEST message contains the parameters necessary to calculate the authentication response (see 3GPP TS 33.401 [19]).

If an eKSI is contained in an initial NAS message during an EMM procedure, the network shall include a different eKSI value in the AUTHENTICATION REQUEST message when it initiates an authentication procedure.

[pic]

Figure 5.4.2.2.1: Authentication procedure


5.4.2.3	Authentication response by the UE

The UE shall respond to an AUTHENTICATION REQUEST message. With the exception of the cases described in subclause 5.4.2.6, the UE shall process the authentication challenge data and respond with an AUTHENTICATION RESPONSE message to the network.

Upon a successful EPS authentication challenge, the UE shall determine the PLMN identity to be used for the calculation of the new KASME from the authentication challenge data according to the following rules:

  a)	When the UE moves from EMM-IDLE mode to EMM-CONNECTED mode, until the first handover, the UE shall use the PLMN identity of the selected PLMN; and

  b)	After handover or inter-system handover to S1 ,mode,

    -	if the target cell is not a shared network cell, the UE shall use the PLMN identity received as part of the broadcast system information;

    -	if the target cell is a shared network cell and the UE has a valid GUTI, the UE shall use the PLMN identity that is part of the GUTI; and

    -	if the target cell is a shared network cell, the UE does not have a valid GUTI and,

    -	the EPS authentication challenge is performed after inter-system handover from A/Gb mode to S1 mode or from Iu mode to S1 mode and the UE has a valid P-TMSI and RAI, the UE shall use the PLMN identity that is part of the RAI; or

       -	the EPS authentication challenge is performed after inter-system handover from N1 mode to S1 mode and the UE has a valid 5G-GUTI, the UE shall use the PLMN identity that is part of the 5G-GUTI.

Upon a successful EPS authentication challenge, the new KASME calculated from the authentication challenge data shall be stored in a new EPS security context in the volatile memory of the ME.

The USIM will compute the authentication response (RES) using the authentication challenge data received from the ME, and pass RES to the ME.

In order to avoid a synchronisation failure, when the UE receives an AUTHENTICATION REQUEST message, the UE shall store the received RAND together with the RES returned from the USIM in the volatile memory of the ME. When the UE receives a subsequent AUTHENTICATION REQUEST message, if the stored RAND value is equal to the new received value in the AUTHENTICATION REQUEST message, then the ME shall not pass the RAND to the USIM, but shall send the AUTHENTICATION RESPONSE message with the stored RES. If there is no valid stored RAND in the ME or the stored RAND is different from the new received value in the AUTHENTICATION REQUEST message, the ME shall pass the RAND to the USIM, shall override any previously stored RAND and RES with the new ones and start, or reset and restart timer T3416.

The RAND and RES values stored in the ME shall be deleted and timer T3416, if running, shall be stopped:

  -	upon receipt of a

    -	SECURITY MODE COMMAND,

    -	SERVICE REJECT,

    -	TRACKING AREA UPDATE REJECT,

    -	TRACKING AREA UPDATE ACCEPT, or

    -	AUTHENTICATION REJECT message;

  -	upon expiry of timer T3416;

  -	if the UE enters the EMM state EMM-DEREGISTERED or EMM-NULL; or

  -	if the UE enters EMM-IDLE mode.


5.4.2.4	Authentication completion by the network

Upon receipt of an AUTHENTICATION RESPONSE message, the network stops the timer T3460 and checks the correctness of RES (see 3GPP TS 33.401 [19]).

If the authentication procedure has been completed successfully and the related eKSI is stored in the EPS security context of the network, the network shall include a different eKSI value in the AUTHENTICATION REQUEST message when it initiates a new authentication procedure.

Upon receipt of an AUTHENTICATION FAILURE message, the network stops the timer T3460. In the case where the EMM cause #21 "synch failure" is received, the core network may renegotiate with the HSS/AuC and provide the UE with new authentication parameters.


5.4.2.5	Authentication not accepted by the network

If the authentication response (RES) returned by the UE is not valid, the network response depends upon the type of identity used by the UE in the initial NAS message, that is:

  -	if the GUTI was used; or

  -	if the IMSI was used.

If the GUTI was used, the network should initiate an identification procedure. If the IMSI given by the UE during the identification procedure differs from the IMSI the network had associated with the GUTI, the authentication should be restarted with the correct parameters. Otherwise, if the IMSI provided by the UE is the same as the IMSI stored in the network (i.e. authentication has really failed), the network should send an AUTHENTICATION REJECT message to the UE.

If the IMSI was used for identification in the initial NAS message, or the network decides not to initiate the identification procedure after an unsuccessful authentication procedure, the network should send an AUTHENTICATION REJECT message to the UE.

Upon receipt of an AUTHENTICATION REJECT message,

  a)	if the message has been successfully integrity checked by the NAS, the UE shall set the update status to EU3 ROAMING NOT ALLOWED, delete the stored GUTI, TAI list, last visited registered TAI and KSIASME. The USIM shall be considered invalid until switching off the UE or the UICC containing the USIM is removed. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	If A/Gb or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the authentication and ciphering procedure is not accepted by the network; and

  b)	if the message is received without integrity protection, the UE shall start timer T3247 (see 3GPP TS 24.008 [13]) with a random value uniformly drawn from the range between 30 minutes and 60 minutes, if the timer is not running (see subclause 5.3.7b). Additionally, the UE shall:

    -	if the UE maintains a counter for "SIM/USIM considered invalid for GPRS services" events and the counter has a value less than a UE implementation-specific maximum value, proceed as specified in subclause 5.3.7b, list item 1a for the case that the EMM cause value received is #3; and

    -	otherwise proceed as specified under list item a above for the case that the message has been successfully integrity checked.

If the AUTHENTICATION REJECT message is received by the UE, the UE shall abort any EMM signalling procedure, stop any of the timers T3410, T3416, T3417, T3430, T3418 or T3420 (if they were running) and enter state EMM-DEREGISTERED.

Depending on local requirements or operator preference for emergency bearer services, if the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services, the MME need not follow the procedures specified for the authentication failure in the present subclause. The MME may continue a current EMM specific procedure or PDN connectivity request procedure. Upon completion of the authentication procedure, if not initiated as part of another procedure, or upon completion of the EMM procedure or PDN connectivity request procedure, the MME shall deactivate all non-emergency EPS bearers, if any, by initiating an EPS bearer context deactivation procedure. The network shall consider the UE to be attached for emergency bearer services only.


5.4.2.6	Authentication not accepted by the UE

In an EPS authentication challenge, the UE shall check the authenticity of the core network by means of the AUTN parameter received in the AUTHENTICATION REQUEST message. This enables the UE to detect a false network.

During an EPS authentication procedure, the UE may reject the core network due to an incorrect AUTN parameter (see 3GPP TS 33.401 [19]). This parameter contains three possible causes for authentication failure:

  a)	MAC code failure:

       	If the UE finds the MAC code (supplied by the core network in the AUTN parameter) to be invalid, the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #20 "MAC failure". The UE shall then follow the procedure described in subclause 5.4.2.7, item c.

  b)	Non-EPS authentication unacceptable:

       	If the UE finds that the "separation bit" in the AMF field of AUTN supplied by the core network is 0, the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #26 "non-EPS authentication unacceptable" (see subclause 6.1.1 in 3GPP TS 33.401 [19]). The UE shall then follow the procedure described in subclause 5.4.2.7, item d.

  c)	SQN failure:

       	If the UE finds the SQN (supplied by the core network in the AUTN parameter) to be out of range, the UE shall send an AUTHENTICATION FAILURE message to the network, with the EMM cause #21 "synch failure" and a re-synchronization token AUTS provided by the USIM (see 3GPP TS 33.102 [18]). The UE shall then follow the procedure described in subclause 5.4.2.7, item e.

If the UE returns an AUTHENTICATION FAILURE message to the network, the UE shall delete any previously stored RAND and RES and shall stop timer T3416, if running.

If the UE has a PDN connection for emergency bearer services established or is establishing such a PDN connection, additional UE requirements are specified in subclause 5.4.2.7, under "for items c, d, e".


5.4.2.7	Abnormal cases

  a)	Lower layer failure:

    	Upon detection of lower layer failure before the AUTHENTICATION RESPONSE message is received, the network shall abort the procedure.

  b)	Expiry of timer T3460:

    	The network shall, on the first expiry of the timer T3460, retransmit the AUTHENTICATION REQUEST message and shall reset and start timer T3460. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3460, the network shall abort the authentication procedure and any ongoing EMM specific procedure and release the NAS signalling connection.

  c)	Authentication failure (EMM cause #20 "MAC failure"):

    	The UE shall send an AUTHENTICATION FAILURE message, with EMM cause #20 "MAC failure" according to subclause 5.4.2.6, to the network and start timer T3418 (see example in figure 5.4.2.7.1). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with EMM cause #20 "MAC failure", the network may initiate the identification procedure described in subclause 5.4.4. This is to allow the network to obtain the IMSI from the UE. The network may then check that the GUTI originally used in the authentication challenge corresponded to the correct IMSI. Upon receipt of the IDENTITY REQUEST message from the network, the UE shall send the IDENTITY RESPONSE message.

  NOTE 1:	Upon receipt of an AUTHENTICATION FAILURE message from the UE with EMM cause #20 "MAC failure", the network may also terminate the authentication procedure (see subclause 5.4.2.5).

    	If the GUTI/IMSI mapping in the network was incorrect, the network should respond by sending a new AUTHENTICATION REQUEST message to the UE. Upon receiving the new AUTHENTICATION REQUEST message from the network, the UE shall stop the timer T3418, if running, and then process the challenge information as normal. If the GUTI/IMSI mapping in the network was correct, the network should terminate the authentication procedure by sending an AUTHENTICATION REJECT message (see subclause 5.4.2.5).

    	If the network is validated successfully (an AUTHENTICATION REQUEST message that contains a valid SQN and MAC is received), the UE shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430) if they were running and stopped when the UE received the first failed AUTHENTICATION REQUEST message.

    	If the UE receives the second AUTHENTICATION REQUEST message while T3418 is running, and the MAC value cannot be resolved, the UE shall follow the procedure specified in this subclause, item c, starting again from the beginning, or if the message contains a UMTS authentication challenge, the UE shall follow the procedure specified in item d. If the SQN is invalid, the UE shall proceed as specified in item e.

    	It can be assumed that the source of the authentication challenge is not genuine (authentication not accepted by the UE) if any of the following occur:

    -	the timer T3418 expires;

    -	the UE detects any combination of the authentication failures: EMM causes #20 "MAC failure", #21 "synch failure" or #26 "non-EPS authentication unacceptable", during three consecutive authentication challenges. The authentication challenges shall be considered as consecutive only, if the authentication challenges causing the second and third authentication failure are received by the UE, while the timer T3418 or T3420 started after the previous authentication failure is running.

    	The UE shall stop timer T3418, if the timer is running and the UE enters EMM-IDLE mode, e.g. upon detection of a lower layer failure, release of the NAS signalling connection, or as the result of an inter-system handover to A/Gb mode or Iu mode.

    	When it has been deemed by the UE that the source of the authentication challenge is not genuine (i.e. authentication not accepted by the UE), the UE shall proceed as described in item f.

[pic]

Figure 5.4.2.7.1: Authentication failure procedure (EMM cause #20 "MAC failure" or
#26 "non-EPS authentication unacceptable")

  d)	Authentication failure (EMM cause #26 "non-EPS authentication unacceptable"):

    	The UE shall send an AUTHENTICATION FAILURE message, with EMM cause #26 "non-EPS authentication unacceptable", to the network and start the timer T3418 (see example in figure 5.4.2.7.1). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with EMM cause #26 "non-EPS authentication unacceptable", the network may initiate the identification procedure described in subclause 5.4.4. This is to allow the network to obtain the IMSI from the UE. The network may then check that the GUTI originally used in the authentication challenge corresponded to the correct IMSI. Upon receipt of the IDENTITY REQUEST message from the network, the UE shall send the IDENTITY RESPONSE message.

  NOTE 2:	Upon receipt of an AUTHENTICATION FAILURE message from the UE with EMM cause #26 "non-EPS authentication unacceptable", the network may also terminate the authentication procedure (see subclause 5.4.2.5).

    	If the GUTI/IMSI mapping in the network was incorrect, the network should respond by sending a new AUTHENTICATION REQUEST message to the UE. Upon receiving the new AUTHENTICATION REQUEST message from the network, the UE shall stop the timer T3418, if running, and then process the challenge information as normal. If the GUTI/IMSI mapping in the network was correct, the network should terminate the authentication procedure by sending an AUTHENTICATION REJECT message (see subclause 5.4.2.5).

    	It can be assumed that the source of the authentication challenge is not genuine (authentication not accepted by the UE) if any of the following occur:

    -	the timer T3418 expires;

    -	the UE detects any combination of the authentication failures: EMM causes #20 "MAC failure", #21 "synch failure" or #26 "non-EPS authentication unacceptable", during three consecutive authentication challenges. The authentication challenges shall be considered as consecutive only, if the authentication challenges causing the second and third authentication failure are received by the UE, while the timer T3418 or T3420 started after the previous authentication failure is running.

    	The UE shall stop timer T3420, if the timer is running and the UE enters EMM-IDLE mode, e.g. upon detection of a lower layer failure, release of the NAS signalling connection, or as the result of an inter-system handover to A/Gb mode or Iu mode.

    	When it has been deemed by the UE that the source of the authentication challenge is not genuine (i.e. authentication not accepted by the UE), the UE shall proceed as described in item f.

  e)	Authentication failure (EMM cause #21 "synch failure"):

    	The UE shall send an AUTHENTICATION FAILURE message, with EMM cause #21 "synch failure", to the network and start the timer T3420 (see example in figure 5.4.2.7.2). Furthermore, the UE shall stop any of the retransmission timers that are running (e.g. T3410, T3417, T3421 or T3430). Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with the EMM cause #21 "synch failure", the network shall use the returned AUTS parameter from the authentication failure parameter IE in the AUTHENTICATION FAILURE message, to re-synchronise. The re-synchronisation procedure requires the MME to delete all unused authentication vectors for that IMSI and obtain new vectors from the HSS. When re-synchronisation is complete, the network shall initiate the authentication procedure. Upon receipt of the AUTHENTICATION REQUEST message, the UE shall stop the timer T3420, if running.

  NOTE 3:	Upon receipt of two consecutive AUTHENTICATION FAILURE messages from the UE with EMM cause #21 "synch failure", the network may terminate the authentication procedure by sending an AUTHENTICATION REJECT message.

    	If the network is validated successfully (a new AUTHENTICATION REQUEST message is received which contains a valid SQN and MAC) while T3420 is running, the UE shall send the AUTHENTICATION RESPONSE message to the network and shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430), if they were running and stopped when the UE received the first failed AUTHENTICATION REQUEST message.

    	If the UE receives the second AUTHENTICATION REQUEST message while T3420 is running, and the MAC value cannot be resolved, the UE shall follow the procedure specified in item c or if the message contains a UMTS authentication challenge, the UE shall proceed as specified in item d; if the SQN is invalid, the UE shall follow the procedure specified in this subclause, item e, starting again from the beginning.

    	The UE shall deem that the network has failed the authentication check and proceed as described in item f if any of the following occurs:

    -	the timer T3420 expires;

    -	the UE detects any combination of the authentication failures: EMM cause #20 "MAC failure", #21 "synch failure", or #26 "non-EPS authentication unacceptable", during three consecutive authentication challenges. The authentication challenges shall be considered as consecutive only if the authentication challenges causing the second and third authentication failure are received by the UE while the timer T3418 or T3420 started after the previous authentication failure is running.

    	When it has been deemed by the UE that the source of the authentication challenge is not genuine (i.e. authentication not accepted by the UE), the UE shall proceed as described in item f.

[pic]

Figure 5.4.2.7.2: Authentication failure procedure (EMM cause #21 "synch failure")

    	Upon receipt of an AUTHENTICATION REJECT message, the UE shall perform the actions as specified in subclause 5.4.2.5.

  f)	Network failing the authentication check:

    	If the UE deems that the network has failed the authentication check, then it shall request RRC to locally release the RRC connection and treat the active cell as barred (see 3GPP TS 36.304 [21]). The UE shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430), if they were running and stopped when the UE received the first AUTHENTICATION REQUEST message containing an incorrect authentication challenge data causing the authentication failure.

  g)	Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication from lower layers (if the authentication procedure is triggered by a tracking area updating procedure)

    	The UE shall stop any of the timers T3418 and T3420, if running, and re-initiate the tracking area updating procedure.

  h)	Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication with TAI change from lower layers (if the authentication procedure is triggered by a service request procedure)

    	The UE shall stop any of the timers T3418 and T3420, if running.

    	If the current TAI is not in the TAI list, the authentication procedure shall be aborted and a tracking area updating procedure shall be initiated.

    	If the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure that triggered the authentication procedure.

  i)	Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION FAILURE message indication without TAI change from lower layers (if the authentication procedure is triggered by a service request procedure)

    	The UE shall stop any of the timers T3418 and T3420, if running. It is up to the UE implementation how to re-run the ongoing procedure that triggered the authentication procedure.

  j)	Lower layers indication of non-delivered NAS PDU due to handover

    	If the AUTHENTICATION REQUEST message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the AUTHENTICATION REQUEST message. If a failure of handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the AUTHENTICATION REQUEST message.

For items c, d, and e:

    	Depending on local requirements or operator preference for emergency bearer services, if the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services, the MME need not follow the procedures specified for the authentication failure specified in the present subclause. The MME may respond to the AUTHENTICATION FAILURE message by initiating the security mode control procedure selecting the "null integrity protection algorithm" EIA0, null ciphering algorithm or may abort the authentication procedure and continue using the current security context, if any. The MME shall deactivate all non-emergency EPS bearer contexts, if any, by initiating an EPS bearer context deactivation procedure. If there is an ongoing PDN connectivity procedure, the MME shall deactivate all non-emergency EPS bearer contexts upon completion of the PDN connectivity procedure. The network shall consider the UE to be attached for emergency bearer services only.

    	If a UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services and sends an AUTHENTICATION FAILURE message to the MME with the EMM cause appropriate for these cases (#20, #21, or #26, respectively) and receives the SECURITY MODE COMMAND message before the timeout of timer T3418 or T3420, the UE shall deem that the network has passed the authentication check successfully, stop timer T3418 or T3420, respectively, and execute the security mode control procedure.

    	If a UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services when timer T3418 or T3420 expires, the UE shall not deem that the network has failed the authentication check and not behave as described in item f. Instead the UE shall continue using the current security context, if any, deactivate all non-emergency EPS bearer contexts, if any, by initiating UE requested PDN disconnect procedure. If there is an ongoing PDN connectivity procedure, the UE shall deactivate all non-emergency EPS bearer contexts upon completion of the PDN connectivity procedure. The UE shall start any retransmission timers (e.g. T3410, T3417, T3421 or T3430) if:

    -	they were running and stopped when the UE received the AUTHENTICATION REQUEST message and detected an authentication failure;

    -	the procedures associated with these timers have not yet been completed.

  The UE shall consider itself to be attached for emergency bearer services only.


5.4.3	Security mode control procedure


5.4.3.1	General

The purpose of the NAS security mode control procedure is to take an EPS security context into use, and initialise and start NAS signalling security between the UE and the MME with the corresponding EPS NAS keys and EPS security algorithms.

Furthermore, the network may also initiate the security mode control procedure in the following cases:

  -	in order to change the NAS security algorithms for a current EPS security context already in use; and

  -	in order to change the value of uplink NAS COUNT used in the latest SECURITY MODE COMPLETE message as described in 3GPP TS 33.401 [19], subclause 7.2.9.2.

For restrictions concerning the concurrent running of a security mode control procedure with other security related procedures in the AS or inside the core network see 3GPP TS 33.401 [19], subclause 7.2.10.


5.4.3.2	NAS security mode control initiation by the network

The MME initiates the NAS security mode control procedure by sending a SECURITY MODE COMMAND message to the UE and starting timer T3460 (see example in figure 5.4.3.2.1).

The MME shall reset the downlink NAS COUNT counter and use it to integrity protect the initial SECURITY MODE COMMAND message if the security mode control procedure is initiated:

  -	to take into use the EPS security context created after a successful execution of the EPS authentication procedure;

  -	upon receipt of TRACKING AREA UPDATE REQUEST message including a GPRS ciphering key sequence number IE, if the MME wishes to create a mapped EPS security context (i.e. the type of security context flag is set to "mapped security context" in the NAS key set identifier IE included in the SECURITY MODE COMMAND message).

The MME shall send the SECURITY MODE COMMAND message unciphered, but shall integrity protect the message with the NAS integrity key based on KASME or mapped K'ASME indicated by the eKSI included in the message. The MME shall set the security header type of the message to "integrity protected with new EPS security context".

The MME shall create a locally generated KASME and send the SECURITY MODE COMMAND message including a KSI value in the NAS key set identifier IE set to "000" and EIA0 and EEA0 as the selected NAS security algorithms only when the security mode control procedure is initiated:

  -	during an attach procedure for emergency bearer services if no shared EPS security context is available;

  -	during a tracking area updating procedure for a UE that has a PDN connection for emergency bearer services if no shared EPS security context is available;

  -	during a service request procedure for a UE that has a PDN connection for emergency bearer services if no shared EPS security context is available; or

  -	after a failed authentication procedure for a UE that has a PDN connection for emergency bearer services or that is establishing a PDN connection for emergency bearer services, if continued usage of a shared security context is not possible.

The UE shall process a SECURITY MODE COMMAND message including a KSI value in the NAS key set identifier IE set to "000" and EIA0 and EEA0 as the selected NAS security algorithms and, if accepted, create a locally generated KASME when the security mode control procedure is initiated:

  -	during an attach procedure for emergency bearer services;

  -	during a tracking area updating procedure when the UE has a PDN connection for emergency bearer services;

  -	during a service request procedure when the UE has a PDN connection for emergency bearer services; or

  -	after an authentication procedure when the UE has a PDN connection for emergency bearer services or is establishing a PDN connection for emergency bearer services.

  NOTE 1:	The process for creation of the locally generated KASME by the MME and the UE is implementation dependent.

Upon receipt of a TRACKING AREA UPDATE REQUEST message including a GPRS ciphering key sequence number IE, if the MME does not have the valid current EPS security context indicated by the UE, the MME shall either:

  -	indicate the use of the new mapped EPS security context to the UE by setting the type of security context flag in the NAS key set identifier IE to "mapped security context" and the KSI value related to the security context of the source system; or

  -	set the KSI value "000" in the NAS key set identifier IE if the MME sets EIA0 and EEA0 as the selected NAS security algorithms for a UE that has a PDN connection for emergency bearer services.

While having a current mapped EPS security context with the UE, if the MME wants to take the native EPS security context into use, the MME shall include the eKSI that indicates the native EPS security context in the SECURITY MODE COMMAND message.

The MME shall include the replayed security capabilities of the UE (including the security capabilities with regard to NAS, RRC and UP (user plane) ciphering as well as NAS and RRC integrity, and other possible target network security capabilities, i.e. UTRAN/GERAN if the UE included them in the message to network), the replayed nonceUE when creating a mapped EPS security context and if the UE included it in the message to the network, the selected NAS ciphering and integrity algorithms and the Key Set Identifier (eKSI). If the MME supports handling of UE additional security capabilities and the UE included a UE additional security capability IE in the message to the network, the MME shall include the replayed additional security capabilities of the UE.

The MME shall include both the nonceMME and the nonceUE when creating a mapped EPS security context during inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode.

The MME may initiate a SECURITY MODE COMMAND in order to change the NAS security algorithms for a current EPS security context already in use. The MME re-derives the NAS keys from KASME with the new NAS algorithm identities as input and provides the new NAS algorithm identities within the SECURITY MODE COMMAND message. The MME shall set the security header type of the message to "integrity protected with new EPS security context".

If, during an ongoing attach or tracking area updating procedure, the MME is initiating a SECURITY MODE COMMAND (i.e. after receiving the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message, but before sending a response to that message) and the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message is received without integrity protection or does not successfully pass the integrity check at the MME, the MME shall calculate the HASHMME of the entire plain ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message as described in 3GPP TS 33.401 [19] and shall include the HASHMME in the SECURITY MODE COMMAND message.

Additionally, the MME may request the UE to include its IMEISV in the SECURITY MODE COMPLETE message.

  NOTE 2:	The AS and NAS security capabilities will be the same, i.e. if the UE supports one algorithm for NAS, the same algorithm is also supported for AS.

[pic]

Figure 5.4.3.2.1: Security mode control procedure


5.4.3.3	NAS security mode command accepted by the UE

Upon receipt of the SECURITY MODE COMMAND message, the UE shall check whether the security mode command can be accepted or not. This is done by performing the integrity check of the message and by checking that the received replayed UE security capabilities, the received replayed UE additional security capabilities, if included in the SECURITY MODE COMMAND message, and the received nonceUE have not been altered compared to the latest values that the UE sent to the network. However, the UE is not required to perform the checking of the received nonceUE if the UE does not want to re-generate the K'ASME (i.e. the SECURITY MODE COMMAND message is to derive and take into use a mapped EPS security context and the eKSI matches the current EPS security context, if it is a mapped EPS security context). When the UE has a PDN connection for emergency bearer services established or the UE is establishing a PDN connection for emergency bearer services, the UE is not required to locally re-generate the KASME (i.e. the SECURITY MODE COMMAND message is used to derive and take into use a native EPS security context where the KSI value "000" is included in the NAS key set identifier IE and the EIA0 and EEA0 are included as the selected NAS security algorithms).

The UE shall accept a SECURITY MODE COMMAND message indicating the "null integrity protection algorithm" EIA0 as the selected NAS integrity algorithm only if the message is received for a UE that has a PDN connection for emergency bearer services established or a UE that is establishing a PDN connection for emergency bearer services.

If the type of security context flag included in the SECURITY MODE COMMAND message is set to "native security context" and if the KSI matches a valid non-current native EPS security context held in the UE while the UE has a mapped EPS security context as the current EPS security context, the UE shall take the non-current native EPS security context into use which then becomes the current native EPS security context and delete the mapped EPS security context.

If the SECURITY MODE COMMAND message can be accepted, the UE shall take the EPS security context indicated in the message into use. The UE shall in addition reset the uplink NAS COUNT counter if:

  -	the SECURITY MODE COMMAND message is received in order to take an EPS security context into use created after a successful execution of the EPS authentication procedure;

  -	the SECURITY MODE COMMAND message received includes the type of security context flag set to "mapped security context" in the NAS key set identifier IE the eKSI does not match the current EPS security context, if it is a mapped EPS security context.

If the SECURITY MODE COMMAND message can be accepted and a new EPS security context is taken into use and SECURITY MODE COMMAND message does not indicate the "null integrity protection algorithm" EIA0 as the selected NAS integrity algorithm, the UE shall:

  -	if the SECURITY MODE COMMAND message has been successfully integrity checked using an estimated downlink NAS COUNT equal 0, then the UE shall set the downlink NAS COUNT of this new EPS security context to 0;

  -	otherwise the UE shall set the downlink NAS COUNT of this new EPS security context to the downlink NAS COUNT that has been used for the successful integrity checking of the SECURITY MODE COMMAND message.

If the SECURITY MODE COMMAND message can be accepted, the UE shall send a SECURITY MODE COMPLETE message integrity protected with the selected NAS integrity algorithm and the EPS NAS integrity key based on the KASME or mapped K'ASME if the type of security context flag is set to "mapped security context" indicated by the eKSI. When the SECURITY MODE COMMAND message includes the type of security context flag set to "mapped security context" in the NAS key set identifier IE, the nonceMME and the nonceUE, then the UE shall either:

  -	generate K'ASME from both the nonceMME and the nonceUE as indicated in 3GPP TS 33.401 [19];or

  -	check whether the SECURITY MODE COMMAND message indicates the eKSI of the current EPS security context, if it is a mapped EPS security context, in order not to re-generate the K'ASME.

Furthermore, if the SECURITY MODE COMMAND message can be accepted, the UE shall cipher the SECURITY MODE COMPLETE message with the selected NAS ciphering algorithm and the EPS NAS ciphering key based on the KASME or mapped K'ASME indicated by the eKSI. The UE shall set the security header type of the message to "integrity protected and ciphered with new EPS security context".

From this time onward the UE shall cipher and integrity protect all NAS signalling messages with the selected NAS ciphering and NAS integrity algorithms.

If the MME indicated in the SECURITY MODE COMMAND message that the IMEISV is requested, the UE shall include its IMEISV in the SECURITY MODE COMPLETE message.

If, during an ongoing attach or tracking area updating procedure, the SECURITY MODE COMMAND message includes a HASHMME, the UE shall compare HASHMME with a hash value locally calculated as described in 3GPP TS 33.401 [19] from the entire plain ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message that the UE had sent to initiate the procedure. If HASHMME and the locally calculated hash value are different, the UE shall include the complete ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message which the UE had previously sent in the Replayed NAS message container IE of the SECURITY MODE COMPLETE message.


5.4.3.4	NAS security mode control completion by the network

The MME shall, upon receipt of the SECURITY MODE COMPLETE message, stop timer T3460. From this time onward the MME shall integrity protect and encipher all signalling messages with the selected NAS integrity and ciphering algorithms.

If the SECURITY MODE COMPLETE message contains a Replayed NAS container message IE with an ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message, the MME shall complete the ongoing attach or tracking area updating procedure by considering the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message contained in the Replayed NAS message container IE as the message that triggered the procedure.


5.4.3.5	NAS security mode command not accepted by the UE

If the security mode command cannot be accepted, the UE shall send a SECURITY MODE REJECT message. The SECURITY MODE REJECT message contains an EMM cause that typically indicates one of the following cause values:

  #23:	UE security capabilities mismatch;

  #24:	security mode rejected, unspecified.

Upon receipt of the SECURITY MODE REJECT message, the MME shall stop timer T3460. The MME shall also abort the ongoing procedure that triggered the initiation of the NAS security mode control procedure.

Both the UE and the MME shall apply the EPS security context in use before the initiation of the security mode control procedure, if any, to protect the SECURITY MODE REJECT message and any other subsequent messages according to the rules in subclauses 4.4.4 and 4.4.5.


5.4.3.6	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication from lower layers (if the security mode control procedure is triggered by a tracking area updating procedure)

    	The UE shall abort the security mode control procedure and re-initiate the tracking area updating procedure.

  b)	Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication with TAI change from lower layers (if the security mode control procedure is triggered by a service request procedure)

    	If the current TAI is not in the TAI list, the security mode control procedure shall be aborted and a tracking area updating procedure shall be initiated.

    	If the current TAI is still part of the TAI list, the security mode control procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the security mode control procedure.

  c)	Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE REJECT message indication without TAI change from lower layers (if the security mode control procedure is triggered by a service request procedure)

    	The security mode control procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the security mode control procedure.


5.4.3.7	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	Lower layer failure before the SECURITY MODE COMPLETE or SECURITY MODE REJECT message is received

    	The network shall abort the security mode control procedure.

  b)	Expiry of timer T3460

    	The network shall, on the first expiry of the timer T3460, retransmit the SECURITY MODE COMMAND message and shall reset and start timer T3460. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3460, the procedure shall be aborted.

  NOTE:	If the SECURITY MODE COMMAND message was sent to create a mapped EPS security context during inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode, then the network does not generate new values for the nonceMME and the nonceUE, but includes the same values in the SECURITY MODE COMMAND message (see the subclause 7.2.4.4 in 3GPP TS 33.401 [19]).

  c)	Collision between security mode control procedure and attach, service request, tracking area updating procedure or detach procedure not indicating switch off

    	The network shall abort the security mode control procedure and proceed with the UE initiated procedure.

  d)	Collision between security mode control procedure and other EMM procedures than in item c

    	The network shall progress both procedures.

  e)	Lower layers indication of non-delivered NAS PDU due to handover

    	If the SECURITY MODE COMMAND message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the SECURITY MODE COMMAND message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the SECURITY MODE COMMAND message.


5.4.4	Identification procedure


5.4.4.1	General

The identification procedure is used by the network to request a particular UE to provide specific identification parameters, e.g. the International Mobile Subscriber Identity (IMSI) or the International Mobile Equipment Identity (IMEI). IMEI and IMSI definition and structure are specified in 3GPP TS 23.003 [2].

For mobile device supporting both 3GPP access and cdma2000® access a single IMEI is used to identify the device as specified in 3GPP TS 22.278 [1C].


5.4.4.2	Identification initiation by the network

The network initiates the identification procedure by sending an IDENTITY REQUEST message to the UE and starting the timer T3470 (see example in figure 5.4.4.2.1). The IDENTITY REQUEST message specifies the requested identification parameters in the Identity type information element.

[pic]

Figure 5.4.4.2.1: Identification procedure


5.4.4.3	Identification response by the UE

A UE shall be ready to respond to an IDENTITY REQUEST message at any time whilst in EMM-CONNECTED mode.

Upon receipt of the IDENTITY REQUEST message the UE shall send an IDENTITY RESPONSE message to the network. The IDENTITY RESPONSE message shall contain the identification parameters as requested by the network.


5.4.4.4	Identification completion by the network

Upon receipt of the IDENTITY RESPONSE the network shall stop the timer T3470.


5.4.4.5	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	Requested identity is not available

    	If the UE cannot encode the requested identity in the IDENTITY RESPONSE message, e.g. because no valid USIM is available, then it shall encode the identity type as "no identity".

  b)	Transmission failure of IDENTITY RESPONSE message indication from lower layers (if the identification procedure is triggered by a tracking area updating procedure)

    	The UE shall abort the identification procedure and re-initiate the tracking area updating procedure.

  c)	Transmission failure of IDENTITY RESPONSE message indication with TAI change from lower layers (if the identification procedure is triggered by a service request procedure)

    	If the current TAI is not in the TAI list, the identification procedure shall be aborted and a tracking area updating procedure shall be initiated.

    	If the current TAI is still part of the TAI list, the identification procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the identification procedure.

  d)	Transmission failure of IDENTITY RESPONSE message indication without TAI change from lower layers (if the identification procedure is triggered by a service request procedure)

    	The identification procedure shall be aborted and it is up to the UE implementation how to re-run the ongoing procedure that triggered the identification procedure.


5.4.4.6	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	Lower layer failure

    	Upon detection of a lower layer failure before the IDENTITY RESPONSE is received, the network shall abort any ongoing EMM procedure.

  b)	Expiry of timer T3470

    	The identification procedure is supervised by the network by the timer T3470. The network shall, on the first expiry of the timer T3470, retransmit the IDENTITY REQUEST message and reset and restart the timer T3470. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3470, the network shall abort the identification procedure and any ongoing EMM procedure.

  c)	Collision of an identification procedure with an attach procedure

    	If the network receives an ATTACH REQUEST message before the ongoing identification procedure has been completed and no attach procedure is pending on the network (i.e. no ATTACH ACCEPT/REJECT message has still to be sent as an answer to an ATTACH REQUEST message), the network shall proceed with the attach procedure.

  d)	Collision of an identification procedure with an attach procedure when the identification procedure has been caused by an attach procedure

    	If the network receives an ATTACH REQUEST message before the ongoing identification procedure has been completed and an attach procedure is pending (i.e. an ATTACH ACCEPT/REJECT message has to be sent as an answer to an earlier ATTACH REQUEST message), then:

    -	If one or more of the information elements in the ATTACH REQUEST message differ from the ones received within the previous ATTACH REQUEST message, the network shall proceed with the new attach procedure; or

    -	If the information elements do not differ, then the network shall not treat any further this new ATTACH REQUEST.

  e)	Collision of an identification procedure with a UE initiated detach procedure

    	Detach containing cause "switch off" within the Detach type IE:

       	If the network receives a DETACH REQUEST message before the ongoing identification procedure has been completed, the network shall abort the identification procedure and shall progress the detach procedure.

    	Detach containing other causes than "switch off" within the Detach type IE:

       	If the network receives a DETACH REQUEST message before the ongoing identification procedure has been completed, the network shall complete the identification procedure and shall respond to the detach procedure as described in subclause 5.5.2.

  f)	Collision of an identification procedure with a tracking area updating procedure

    	If the network receives a TRACKING AREA UPDATE REQUEST message before the ongoing identification procedure has been completed, the network shall progress both procedures.

  g)	Collision of an identification procedure with a service request procedure

    	If the network receives an EXTENDED SERVICE REQUEST message for CS fallback or 1xCS fallback before the ongoing identification procedure has been completed, the network shall progress both procedures.

  h)	Lower layers indication of non-delivered NAS PDU due to handover

    	If the IDENTITY REQUEST message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the IDENTITY REQUEST message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the IDENTITY REQUEST message.


5.4.5	EMM information procedure


5.4.5.1	General

The purpose of sending the EMM INFORMATION message is to allow the network to provide information to the UE. The message implementation is optional in the network. The UE may use the received information if the UE supports implementing this message.

The EMM information procedure may be invoked by the network at any time during an established EMM context.


5.4.5.2	EMM information procedure initiation by the network

The EMM information procedure consists only of the EMM INFORMATION message sent from the network to the UE (see example in figure 5.4.5.2.1). During an established EMM context, the network may send none, one, or more EMM INFORMATION messages to the UE. If more than one EMM INFORMATION message is sent, the messages need not have the same content.

[pic]

Figure 5.4.5.2.1: EMM information procedure


5.4.5.3	EMM information procedure in the UE

When the UE (supporting the EMM information message) receives an EMM INFORMATION message, it shall accept the message and optionally use the contents to update appropriate information stored within the UE.

If the UE does not support the EMM information message the UE shall ignore the contents of the message and return an EMM STATUS message with EMM cause #97 "message type non-existent or not implemented".


5.4.5.4	Abnormal cases on the network side

The following abnormal case can be identified:

  a)	Lower layers indication of non-delivered NAS PDU due to handover

    	If the EMM INFORMATION message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the EMM INFORMATION message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the EMM INFORMATION message.


5.5	EMM specific procedures


5.5.1	Attach procedure


5.5.1.1	General

The attach procedure is used to attach to an EPC for packet services in EPS.

The attach procedure is used for three purposes:

  -	by a UE in PS mode of operation to attach for EPS services only;

  -	by a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for both EPS and non-EPS services;

  -	by a UE supporting NB-S1 mode only in PS mode of operation to attach for EPS services and "SMS only"; or

  -	to attach for emergency bearer services.

The lower layers indicate to NAS that the network does not support emergency bearer services for the UE in limited service state (3GPP TS 36.331 [22]). This information is taken into account when deciding whether to initiate attach for emergency bearer services in WB-S1 mode.

If the MME does not support an attach for emergency bearer services, the MME shall reject any request to attach with an attach type set to "EPS emergency attach".

With a successful attach procedure, a context is established for the UE in the MME. Furthermore, if the UE requested PDN connectivity, a default bearer is established between the UE and the PDN GW, thus enabling always-on IP connectivity to the UE. In WB-S1 mode, the network may also initiate the activation of dedicated bearers as part of the attach procedure. In NB-S1 mode the network shall not initiate the activation of dedicated bearers.

With a successful attach procedure in NB-S1 mode, a context is established for the UE in the MME. If the attach request included information to request PDN connectivity, a default bearer is also established between the UE and the PDN.

If EMM-REGISTERED without PDN connection is supported by the UE and the MME, a default bearer need not be requested by the UE during the attach procedure. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, then the UE shall request establishment of a default bearer.

During the attach procedure with default bearer establishment, the UE may also obtain the home agent IPv4 or IPv6 address or both.

In a shared network, the UE shall choose one of the PLMN identities as specified in 3GPP TS 23.122 [6]. The UE shall construct the TAI of the cell from this chosen PLMN identity and the TAC received for this PLMN identity as part of the broadcast system information. The chosen PLMN identity shall be indicated to the E-UTRAN (see 3GPP TS 36.331 [22]). Whenever an ATTACH REJECT message with the EMM cause #11 "PLMN not allowed" is received by the UE, the chosen PLMN identity shall be stored in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. Whenever an ATTACH REJECT message with the EMM cause #14 "EPS services not allowed in this PLMN" is received by the UE, the chosen PLMN identity shall be stored in the "forbidden PLMNs for GPRS service" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. Whenever an ATTACH REJECT message is received by the UE with the EMM cause #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", or #15 "no suitable cells in tracking area", the constructed TAI shall be stored in the suitable list.

An attach attempt counter is used to limit the number of subsequently rejected attach attempts. The attach attempt counter shall be incremented as specified in subclause 5.5.1.2.6. Depending on the value of the attach attempt counter, specific actions shall be performed. The attach attempt counter shall be reset when:

  -	the UE is powered on;

  -	a USIM is inserted;

  -	an attach or combined attach procedure is successfully completed;

  NOTE:	The attach procedure can be initiated in S1 or S101 mode as described in subclause 5.5.1.

  -	a GPRS attach or combined GPRS attach procedure is successfully completed in A/Gb or Iu mode;

  -	a registration procedure for initial registration is successfully completed in N1 mode and the UE is operating in single-registration mode;

  -	a combined attach procedure is completed for EPS services only with cause #2, #16, #17, #18 or #22;

  -	an attach or combined attach procedure is rejected with cause #11, #12, #13, #14, #15, #25 or #35:

  -	a network initiated detach procedure is completed with cause #11, #12, #13, #14, #15 or #25; or

  -	a new PLMN is selected.

Additionally the attach attempt counter shall be reset when the UE is in substate EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH and:

  -	a new tracking area is entered;

  -	timer T3402 expires; or

  -	timer T3346 is started.


5.5.1.2	Attach procedure for EPS services


5.5.1.2.1	General

This procedure can be used by a UE to attach for:

  -	EPS services only; or

  -	EPS services and "SMS only" if the UE supports NB-S1 mode only.

When the UE initiates the attach procedure for normal service, the UE shall indicate "EPS attach" in the EPS attach type IE.

When the UE initiates the attach procedure for emergency bearer services, the UE shall indicate "EPS emergency attach" in the EPS attach type IE. The attach procedure for emergency bearer services is not applicable for NB-S1 mode (see 3GPP TS 23.401 [10]).


5.5.1.2.2	Attach procedure initiation

In state EMM-DEREGISTERED, the UE initiates the attach procedure by sending an ATTACH REQUEST message to the MME, starting timer T3410 and entering state EMM-REGISTERED-INITIATED (see example in figure 5.5.1.2.2.1). If timer T3402 is currently running, the UE shall stop timer T3402. If timer T3411 is currently running, the UE shall stop timer T3411.

The UE shall include the IMSI in the EPS mobile identity IE in the ATTACH REQUEST message if the selected PLMN is neither the registered PLMN nor in the list of equivalent PLMNs and:

  a)	the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]; or

  b)	the UE is in NB-S1 mode.

For all other cases, the UE shall handle the EPS mobile identity IE in the ATTACH REQUEST message as follows:

  a)	if the UE operating in the single-registration mode is performing an inter-system change from N1 mode to S1 mode or the UE was previously registered in N1 mode before entering state 5GMM-DEREGISTERED and:

    1)	the UE has received the interworking without N26 interface indicator set to "interworking without N26 interface supported" from the network and:

       i)	if the UE holds a valid GUTI, the UE shall include the valid GUTI into the EPS mobile identity IE, include Old GUTI type IE with GUTI type set to "native GUTI" and include the UE status IE with a 5GMM registration status set to:

         -	"UE is in 5GMM-REGISTERED state" if the UE is in 5GMM-REGISTERED state; or

         -	"UE is in 5GMM-DEREGISTERED state" if the UE is in 5GMM-DEREGISTERED state; or

       ii)	if the UE does not hold a valid GUTI, the UE shall include the IMSI in the EPS mobile identity IE; or

    2)	the UE has received the interworking without N26 interface indicator set to "interworking without N26 interface not supported" from the network and:

       i)	if the UE holds a valid 5G-GUTI, the UE shall include a GUTI, mapped from 5G-GUTI into the EPS mobile identity IE, include Old GUTI type IE with GUTI type set to "native GUTI" and include the UE status IE with a 5GMM registration status set to "UE is in 5GMM-DEREGISTERED state";

       ii)	if the UE holds a valid GUTI and does not hold a valid 5G-GUTI, the UE shall indicate the GUTI in the EPS mobile identity IE and include Old GUTI type IE with GUTI type set to "native GUTI"; or

       iii)	if the UE holds neither a valid GUTI nor a vaild 5G-GUTI, the UE shall include the IMSI in the EPS mobile identity IE; or

  b)	otherwise:

    1)	if the UE supports neither A/Gb mode nor Iu mode, the UE shall include in the ATTACH REQUEST message a valid GUTI together with the last visited registered TAI, if available. In addition, the UE shall include Old GUTI type IE with GUTI type set to "native GUTI". If there is no valid GUTI available, the UE shall include the IMSI in the ATTACH REQUEST message; or

    2)	If the UE supports A/Gb mode or Iu mode or both and:

       i)	if the TIN indicates "P-TMSI" and the UE holds a valid P-TMSI and RAI, the UE shall map the P-TMSI and RAI into the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to "mapped GUTI". If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE. Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE;

  NOTE 1:	The mapping of the P-TMSI and the RAI to the GUTI is specified in 3GPP TS 23.003 [2].

       ii)	if the TIN indicates "GUTI" or "RAT-related TMSI" and the UE holds a valid GUTI, the UE shall indicate the GUTI in the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to "native GUTI";

       iii)	if the TIN is deleted and:

         -	the UE holds a valid GUTI, the UE shall indicate the GUTI in the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to "native GUTI";

         -	the UE does not hold a valid GUTI but holds a valid P-TMSI and RAI, the UE shall map the P-TMSI and RAI into the EPS mobile identity IE, and include Old GUTI type IE with GUTI type set to "mapped GUTI". If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE; or

         -	the UE does not hold a valid GUTI, P-TMSI or RAI, the UE shall include the IMSI in the EPS mobile identity IE; or

       iv)	otherwise the UE shall include the IMSI in the EPS mobile identity IE.

If the UE is operating in the dual-registration mode and it is in 5GMM state 5GMM-REGISTERED, the UE shall include the UE status IE with the 5GMM registration status set to "UE is in 5GMM-REGISTERED state".

If the UE is attaching for emergency bearer services and does not hold a valid GUTI, P-TMSI or IMSI as described above, the IMEI shall be included in the EPS mobile identity IE.

If the UE supports A/Gb mode or Iu mode or if the UE needs to indicate its UE specific DRX parameter to the network, the UE shall include the UE specific DRX parameter in the DRX parameter IE in the ATTACH REQUEST message.

  NOTE 2:	The UE specific DRX parameter is not used by the E-UTRAN for paging from NB-IoT cells (see 3GPP TS 23.401 [10] and 3GPP TS 36.304 [21]).

If the UE supports eDRX and requests the use of eDRX, the UE shall include the extended DRX parameters IE in the ATTACH REQUEST message.

If the UE supports SRVCC to GERAN/UTRAN, the UE shall set the SRVCC to GERAN/UTRAN capability bit to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported".

If the UE supports vSRVCC from S1 mode to Iu mode, then the UE shall set the H.245 after handover capability bit to "H.245 after SRVCC handover capability supported" and additionally set the SRVCC to GERAN/UTRAN capability bit to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported" in the ATTACH REQUEST message.

If the UE supports PSM and requests the use of PSM, then the UE shall include the T3324 value IE with a requested timer value in the ATTACH REQUEST message. When the UE includes the T3324 value IE and the UE indicates support for extended periodic timer value in the MS network feature support IE, it may also include the T3412 extended value IE to request a particular T3412 value to be allocated.

If the UE supports ProSe direct discovery, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe direct discovery bit to "ProSe direct discovery supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports ProSe direct communication, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe direct communication bit to "ProSe direct communication supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports acting as a ProSe UE-to-network relay, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe UE-to-network relay bit to "acting as a ProSe UE-to-network relay supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports NB-S1 mode, Non-IP PDN type, or N1 mode, then the UE shall support the extended protocol configuration options IE.

If the UE supports the extended protocol configuration options IE, then the UE shall set the ePCO bit to "extended protocol configuration options supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports the restriction on use of enhanced coverage, then the UE shall set the RestrictEC bit to "Restriction on use of enhanced coverage supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports the control plane data back-off timer T3448, the UE shall set the CP backoff bit to "back-off timer for transport of user data via the control plane supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE is in NB-S1 mode, then the UE shall set the control plane CIoT EPS optimization bit to "control plane CIoT EPS optimization supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE is in NB-S1 mode, supports NB-S1 mode only, and requests to attach for EPS services and "SMS only", the UE shall indicate the SMS only requested bit to "SMS only" in the additional update type IE and shall set the EPS attach type IE to "EPS attach" in the ATTACH REQUEST message.

If the UE supports CIoT EPS optimizations, it shall indicate in the UE network capability IE of the ATTACH REQUEST message whether it supports EMM-REGISTERED without PDN connection.

If the UE supports S1-U data transfer and multiple user plane radio bearers (see 3GPP TS 36.306 [44], 3GPP TS 36.331 [22]) in NB-S1 mode, then the UE shall set the Multiple DRB support bit to "Multiple DRB supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports V2X communication over PC5, then the UE shall set the V2X PC5 bit to "V2X communication over PC5 supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports service gap control, then the UE shall set the SGC bit to "service gap control supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports dual connectivity with New Radio (NR), then the UE shall set the DCNR bit to "dual connectivity with NR supported" in the UE network capability IE of the ATTACH REQUEST message and shall include the UE additional security capability IE in the ATTACH REQUEST message.

If the UE supports N1 mode, the UE shall set the N1mode bit to "N1 mode supported" in the UE network capability IE of the ATTACH REQUEST message and shall include the UE additional security capability IE in the ATTACH REQUEST message.

If the UE supports signalling for a maximum number of 15 EPS bearer contexts, then the UE shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the UE network capability IE of the ATTACH REQUEST message.

If the UE supports ciphered broadcast assistance data and needs to obtain new ciphering keys, the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the ATTACH REQUEST message.

If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, or if the UE wants to request PDN connection with the attach procedure, the UE shall send the ATTACH REQUEST message together with a PDN CONNECTIVITY REQUEST message contained in the ESM message container IE.

If EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the UE does not want to request PDN connection with the attach procedure, the UE shall send the ATTACH REQUEST message together with an ESM DUMMY MESSAGE contained in the ESM message container information element.

If the attach procedure is initiated following an inter-system change from N1 mode to S1 mode in EMM-IDLE mode or the UE which was previously registered in N1 mode before entering state 5GMM-DEREGISTERED initiates the attach procedure:

  a)	if the UE has received an "interworking without N26 interface not supported" indication from the network and a valid 5G NAS security context exists in the UE, the UE shall integrity protect the ATTACH REQUEST message combined with the message included in the ESM message container IE using the 5G NAS security context;

  b)	otherwise:

    1)	if a valid EPS security context exists, the UE shall integrity protect the ATTACH REQUEST message combined with the message included in the ESM message container IE using the EPS security context; or

    2)	if the UE does not have a valid EPS security context, the ATTACH REQUEST message combined with the message included in the ESM message container IE is not integrity protected.

[pic]

Figure 5.5.1.2.2.1: Attach procedure and combined attach procedure


5.5.1.2.3	EMM common procedure initiation

The network may initiate EMM common procedures, e.g. the identification, authentication and security mode control procedures during the attach procedure, depending on the information received in the ATTACH REQUEST message (e.g. IMSI, GUTI and KSI).

If the network receives an ATTACH REQUEST message containing the Old GUTI type IE and the EPS mobile identity IE with type of identity indicating "GUTI", and the network does not follow the use of the most significant bit of the <MME group id> as specified in 3GPP TS 23.003 [2], subclause 2.8.2.2.2, the network shall use the Old GUTI type IE to determine whether the mobile identity included in the EPS mobile identity IE is a native GUTI or a mapped GUTI.

During an attach for emergency bearer services, the MME may choose to skip the authentication procedure even if no EPS security context is available and proceed directly to the execution of the security mode control procedure as specified in subclause 5.4.3.


5.5.1.2.4	Attach accepted by the network

During an attach for emergency bearer services, if not restricted by local regulations, the MME shall not check for mobility and access restrictions, regional restrictions, subscription restrictions, or perform CSG access control when processing the ATTACH REQUEST message. The network shall not apply subscribed APN based congestion control during an attach procedure for emergency bearer services.

If the attach request is accepted by the network, the MME shall send an ATTACH ACCEPT message to the UE and start timer T3450.

If the attach request included the PDN CONNECTIVITY REQUEST message in the ESM message container information element to request PDN connectivity, the MME when accepting the attach request shall:

  -	send the ATTACH ACCEPT message together with an ESM DUMMY MESSAGE contained in the ESM message container information element and discard the ESM message container information element included in the attach request if:

    -	the UE indicated support of EMM-REGISTERED without PDN connection in the UE network capability IE of the ATTACH REQUEST message;

    -	the MME supports EMM-REGISTERED without PDN connection and PDN connection is restricted according to the user's subscription data;

    -	the attach type is not set to "EPS emergency attach"; and

    -	the request type of the UE requested PDN connection is not set to "emergency";

  -	otherwise, send the ATTACH ACCEPT message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message contained in the ESM message container information element to activate the default bearer (see subclause 6.4.1). In WB-S1 mode, the network may also initiate the activation of dedicated bearers towards the UE by invoking the dedicated EPS bearer context activation procedure (see subclause 6.4.2). In NB-S1 mode the network shall not initiate the activation of dedicated bearers.

If EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the UE included an ESM DUMMY MESSAGE in the ESM message container information element of the ATTACH REQUEST message, the MME shall send the ATTACH ACCEPT message together with an ESM DUMMY MESSAGE contained in the ESM message container information element.

If the attach request is accepted by the network, the MME shall delete the stored UE radio capability information, if any.

In NB-S1 mode, if the attach request is accepted by the network, the MME shall set the EMC BS bit to zero in the EPS network feature support IE included in the ATTACH ACCEPT message to indicate that support of emergency bearer services in NB-S1 mode is not available.

If the UE has included the UE network capability IE or the MS network capability IE or both in the ATTACH REQUEST message, the MME shall store all octets received from the UE, up to the maximum length defined for the respective information element.

  NOTE 1:	This information is forwarded to the new MME during inter-MME handover or to the new SGSN during inter-system handover to A/Gb mode or Iu mode.

  NOTE 2:	For further details concerning the handling of the MS network capability and UE network capability in the MME see also 3GPP TS 23.401 [10].

If the UE specific DRX parameter was included in the DRX Parameter IE in the ATTACH REQUEST message, the MME shall replace any stored UE specific DRX parameter with the received parameter and use it for the downlink transfer of signalling and user data.

In NB-S1 mode, if the UE requested "SMS only" in the Additional update type IE, supports NB-S1 mode only and the MME decides to accept the attach request for EPS services and "SMS only", the MME shall indicate "SMS only" in the Additional update result IE and shall set the EPS attach result IE to "EPS only" in the ATTACH ACCEPT message.

The MME shall include the extended DRX parameters IE in the ATTACH ACCEPT message only if the extended DRX parameters IE was included in the ATTACH REQUEST message, and the MME supports and accepts the use of eDRX.

The MME shall assign and include the TAI list the UE is registered to in the ATTACH ACCEPT message. The MME shall not assign a TAI list containing both tracking areas in NB-S1 mode and tracking areas in WB-S1 mode. The UE, upon receiving an ATTACH ACCEPT message, shall delete its old TAI list and store the received TAI list.

  NOTE 3:	When assigning the TAI list, the MME can take into account the eNodeB's capability of support of CIoT EPS optimization.

The MME may include T3412 extended value IE in the ATTACH ACCEPT message only if the UE indicates support of the extended periodic timer T3412 in the MS network feature support IE in the ATTACH REQUEST message.

The MME shall include the T3324 value IE in the ATTACH ACCEPT message only if the T3324 value IE was included in the ATTACH REQUEST message, and the MME supports and accepts the use of PSM.

If the MME supports and accepts the use of PSM, and the UE included the T3412 extended value IE in the ATTACH REQUEST message, then the MME shall take into account the T3412 value requested when providing the T3412 value IE and the T3412 extended value IE in the ATTACH ACCEPT message.

  NOTE 4:	Besides the value requested by the UE, the MME can take local configuration or subscription data provided by the HSS into account when selecting a value for T3412 (3GPP TS 23.401 [10] subclause 4.3.17.3).

If the UE indicates support for EMM-REGISTERED without PDN connection in the ATTACH REQUEST message and the MME supports EMM-REGISTERED without PDN connection, the MME shall indicate support for EMM-REGISTERED without PDN connection in the EPS network feature support IE of the ATTACH ACCEPT message. The UE and the MME shall use the information whether the peer entity supports EMM-REGISTERED without PDN connection as specified in the present clause 5 and in clause 6.

If the UE requests "control plane CIoT EPS optimization" in the Additional update type IE, indicates support of control plane CIoT EPS optimization in the UE network capability IE and the MME decides to accept the requested CIoT EPS optimization and the attach request, the MME shall indicate "control plane CIoT EPS optimization supported" in the EPS network feature support IE.

If the MME supports NB-S1 mode, Non-IP PDN type, or inter-system change with 5GS, then the MME shall support the extended protocol configuration options IE.

If the MME supports the extended protocol configuration options IE and the UE indicated support of the extended protocol configuration options IE, then the MME shall set the ePCO bit to "extended protocol configuration options supported" in the EPS network feature support IE of the ATTACH ACCEPT message.

If the UE indicates support for restriction on use of enhanced coverage in the ATTACH REQUEST message, and the network decides to restrict the use of enhanced coverage for the UE, then the MME shall set the RestrictEC bit to "Use of enhanced coverage is restricted" in the EPS network feature support IE of the ATTACH ACCEPT message.

If the UE has indicated support for the control plane data back-off timer, and the MME decides to activate the congestion control for transport of user data via the control plane, then the MME shall include the T3448 value IE in the ATTACH ACCEPT message.

If the UE indicates support for dual connectivity with NR in the ATTACH REQUEST message, and the MME decides to restrict the use of dual connectivity with NR for the UE, then the MME shall set the RestrictDCNR bit to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the ATTACH ACCEPT message.

If the UE indicates support for N1 mode in the ATTACH REQUEST message and the MME supports inter-system interworking with 5GS, the MME may set the IWK N26 bit to either:

  -	"interworking without N26 interface not supported" if the MME supports N26 interface; or

  -	"interworking without N26 interface supported" if the MME does not support N26 interface

in the EPS network feature support IE in the ATTACH ACCEPT message.

If the UE requests ciphering keys for ciphered broadcast assistance data in the ATTACH REQUEST message and the MME has valid ciphering key data applicable to the UE's subscription, then the MME shall include the ciphering key data in the Ciphering key data IE of the ATTACH ACCEPT message.

If due to operator policies unsecured redirection to a GERAN cell is not allowed in the current PLMN, the MME shall set the redir-policy bit to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the ATTACH ACCEPT message.

The MME may include the T3447 value IE set to the service gap time value in the ATTACH ACCEPT message if:

  -	the UE has indicated support for service gap control; and

  -	a service gap time value is available in the EMM context.

If the network supports signalling for a maximum number of 15 EPS bearer contexts and the UE indicated support of signalling for a maximum number of 15 EPS bearer contexts in the ATTACH REQUEST message, then the MME shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the EPS network feature support IE of the ATTACH ACCEPT message.

Upon receiving the ATTACH ACCEPT message, the UE shall stop timer T3410.

The GUTI reallocation may be part of the attach procedure. When the ATTACH REQUEST message includes the IMSI or IMEI, or the MME considers the GUTI provided by the UE is invalid, or the GUTI provided by the UE was assigned by another MME, the MME shall allocate a new GUTI to the UE. The MME shall include in the ATTACH ACCEPT message the new assigned GUTI together with the assigned TAI list. In this case the MME shall enter state EMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.4.1.

For a shared network, the TAIs included in the TAI list can contain different PLMN identities. The MME indicates the selected core network operator PLMN identity to the UE in the GUTI (see 3GPP TS 23.251 [8B]).

If the ATTACH ACCEPT message contains a GUTI, the UE shall use this GUTI as the new temporary identity. The UE shall delete its old GUTI and store the new assigned GUTI. If no GUTI has been included by the MME in the ATTACH ACCEPT message, the old GUTI, if any available, shall be kept.

If A/Gb mode or Iu mode is supported in the UE, the UE shall set its TIN to "GUTI" when receiving the ATTACH ACCEPT message.

If the ATTACH ACCEPT message contains the T3412 extended value IE, then the UE shall use the value in T3412 extended value IE as periodic tracking area update timer (T3412). If the ATTACH ACCEPT message does not contain T3412 extended value IE, then the UE shall use the value in T3412 value IE as periodic tracking area update timer (T3412).

If the ATTACH ACCEPT message contains the T3324 value IE, then the UE shall use the included timer value for T3324 as specified in 3GPP TS 24.008 [13], subclause 4.7.2.8.

If the ATTACH ACCEPT message contains the DCN-ID IE, then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex C.

The MME may also include a list of equivalent PLMNs in the ATTACH ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if the attach procedure is not for emergency bearer services, the UE shall remove from the list any PLMN code that is already in the list of "forbidden PLMNs" or in the list of "forbidden PLMNs for GPRS service". In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the ATTACH ACCEPT message. If the ATTACH ACCEPT message does not contain a list, then the UE shall delete the stored list.

If the attach procedure is not for emergency bearer services, and if the PLMN identity of the registered PLMN is a member of the list of "forbidden PLMNs" or the list of "forbidden PLMNs for GPRS service", any such PLMN identity shall be deleted from the corresponding list(s).

The network informs the UE about the support of specific features, such as IMS voice over PS session, location services (EPC-LCS, CS-LCS), emergency bearer services, or CIoT EPS optimizations, in the EPS network feature support information element. In a UE with IMS voice over PS capability, the IMS voice over PS session indicator and the emergency bearer services indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account as specified in 3GPP TS 23.221 [8A], subclause 7.2a and subclause 7.2b, when selecting the access domain for voice sessions or calls. When initiating an emergency call, the upper layers also take both the IMS voice over PS session indicator and the emergency bearer services indicator into account for the access domain selection. In a UE with LCS capability, location services indicators (EPC-LCS, CS-LCS) shall be provided to the upper layers. When MO-LR procedure is triggered by the UE's application, those indicators are taken into account as specified in 3GPP TS 24.171 [13C].

If the RestrictDCNR bit is set to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the ATTACH ACCEPT message, the UE shall provide the indication that dual connectivity with NR is restricted to the upper layers.

The UE supporting N1 mode shall operate in the mode for inter-system interworking with 5GS as follows:

  -	if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface not supported", the UE shall operate in single-registration mode;

  -	if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" and the UE supports dual-registration mode, the UE may operate in dual-registration mode; or

  NOTE:	The registration mode used by the UE is implementation dependent.

  -	if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" and the UE only supports single-registration mode, the UE shall operate in single-registration mode.

The UE shall treat the interworking without N26 interface indicator as valid in the entire PLMN and equivalent PLMNs. The interworking procedures required for coordination between 5GMM and EMM without N26 interface are specified in 3GPP TS 24.501 [54].

If the redir-policy bit is set to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the ATTACH ACCEPT message, the UE shall set the network policy on unsecured redirection to GERAN for the current PLMN to "Unsecured redirection to GERAN not allowed" and indicate to the lower layers that unsecured redirection to a GERAN cell is not allowed. If the redir-policy bit is set to "Unsecured redirection to GERAN allowed" or if the Network policy IE is not included in the ATTACH ACCEPT message, the UE shall set the network policy for the current PLMN to "Unsecured redirection to GERAN allowed" and indicate to the lower layers that unsecured redirection to a GERAN cell is allowed. The UE shall set the network policy on unsecured redirection to GERAN to "Unsecured redirection to GERAN not allowed" and indicate this to the lower layers when any of the following events occurs:

  -	the UE initiates an EPS attach or tracking area updating procedure in a PLMN different from the PLMN where the UE performed the last successful EPS attach or tracking area updating procedure;

  -	the UE is switched on; or

  -	the UICC containing the USIM is removed.

If the UE has initiated the attach procedure due to manual CSG selection and receives an ATTACH ACCEPT message; and the UE sent the ATTACH REQUEST message in a CSG cell, the UE shall check if the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list. If not, the UE shall add that CSG ID and associated PLMN identity to the Allowed CSG list and the UE may add the HNB Name (if provided by lower layers) to the Allowed CSG list if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list.

When the UE receives the ATTACH ACCEPT message combined with the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, and if the UE has requested PDN connectivity the UE shall forward the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message to the ESM sublayer. Upon receipt of an indication from the ESM sublayer that the default EPS bearer context has been activated, the UE shall send an ATTACH COMPLETE message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message contained in the ESM message container information element to the network.

Additionally, the UE shall reset the attach attempt counter, enter state EMM-REGISTERED, and set the EPS update status to EU1 UPDATED.

If EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the UE receives the ATTACH ACCEPT message combined with an ESM DUMMY MESSAGE, the UE shall send an ATTACH COMPLETE message together with an ESM DUMMY MESSAGE contained in the ESM message container information element to the network.

If the UE receives the ATTACH ACCEPT message from a PLMN for which a PLMN-specific attempt counter or PLMN-specific PS-attempt counter is maintained (see subclause 5.3.7b), then the UE shall reset these counters. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall reset this counter.

When the UE receives any ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST messages during the attach procedure, and if the UE has requested PDN connectivity the UE shall forward the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message(s) to the ESM sublayer. The UE shall send a response to the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message(s) after successful completion of the attach procedure.

If the attach procedure was initiated in S101 mode, the lower layers are informed about the successful completion of the procedure.

Upon receiving an ATTACH COMPLETE message, the MME shall stop timer T3450, enter state EMM-REGISTERED and consider the GUTI sent in the ATTACH ACCEPT message as valid.

If the T3448 value IE is present in the received ATTACH ACCEPT message, the UE shall:

  -	stop timer T3448 if it is running; and

  -	start timer T3448 with the value provided in the T3448 value IE.

If the UE is using EPS services with control plane CIoT EPS optimization, the T3448 value IE is present in the ATTACH ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present.

If the UE has indicated "service gap control supported" in the ATTACH REQUEST message and:

  -	the ATTACH ACCEPT message contains the T3447 value IE, then the UE shall store the new T3447 value, erase any previous stored T3447 value if exists and use the new T3447 value with the T3447 timer next time it is started; or

  -	the ATTACH ACCEPT message does not contain the T3447 value IE, then the UE shall erase any previous stored T3447 value if exists and stop the T3447 timer if running.


5.5.1.2.4A	Attach successful for EPS services and not accepted for SMS services

Apart from the actions on the tracking area updating attempt counter, the description for attach for EPS services as specified in subclause 5.5.1.2.4 shall be followed. In addition, the following description for attach for SMS services applies.

In NB-S1 mode, if the UE requested "SMS only" in the Additional update type IE and supports NB-S1 mode only, the MME decides to accept the attach request for EPS services only and:

  -	the location update for non-EPS services is not accepted by the VLR as specified in 3GPP TS 29.118 [16A]; or

  -	the MME decides to not accept the attach request for "SMS only",

the MME shall set the EPS attach result IE to "EPS only", shall not indicate "SMS only" in the Additional update result IE in the ATTACH ACCEPT message and shall include an appropriate SMS services status value.

The UE receiving the ATTACH ACCEPT message takes one of the following actions depending on the value included in the SMS services status IE:

  "SMS services not available"

       	The UE shall stop timer T3410 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. The USIM shall be considered as invalid for SMS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a.

  "SMS services not available in this PLMN"

       	The UE shall stop timer T3410 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.

       	The UE may provide a notification to the user or the upper layers that the SMS services are not available.

       	The UE shall not attempt normal attach or tracking area update procedure indicating "SMS only" with current PLMN until switching off the UE or the UICC containing the USIM is removed. Additionally, the UE may perform a PLMN selection according to 3GPP TS 23.122 [6].

  "Network failure"

       	The UE shall stop timer T3410 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.

       	If the tracking area updating attempt counter is less than 5:

       -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.

       	If the tracking area updating attempt counter is equal to 5:

       -	the UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.

  "Congestion"

       	The UE shall stop the timer T3410 if still running. The tracking area updating attempt counter shall be set to 5. The UE shall start the timer T3402, shall set the EPS update status to EU1 UPDATED, and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.

Other values and the case that no SMS services status IE was received are considered as abnormal cases. The attach procedure shall be considered as failed for SMS services. The behaviour of the UE in those cases is specified in subclause 5.5.1.2.6A.


5.5.1.2.5	Attach not accepted by the network

If the attach request cannot be accepted by the network, the MME shall send an ATTACH REJECT message to the UE including an appropriate EMM cause value.

If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the attach request included a PDN CONNECTIVITY REQUEST message, the attach procedure fails due to:

  -	a default EPS bearer setup failure;

  -	an ESM procedure failure; or

  -	operator determined barring is applied on default EPS bearer context activation during attach procedure,

the MME shall:

  -	combine the ATTACH REJECT message with a PDN CONNECTIVITY REJECT message contained in the ESM message container information element. In this case the EMM cause value in the ATTACH REJECT message shall be set to #19 "ESM failure"; or

  -	send the ATTACH REJECT message with the EMM cause set to #15 "No suitable cells in tracking area", if the PDN connectivity reject is due to ESM cause #29 subject to operator policies (see 3GPP TS 29.274 [16D] for further details). In this case, the network may additionally include the Extended EMM cause IE with value "E-UTRAN not allowed".

If the attach request is rejected due to NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a back-off timer T3346.

If the attach request is rejected due to service gap control as specified in subclause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.

If the attach request is rejected due to incompatibility between the CIoT EPS optimizations supported by the UE and what the network supports and the network sets the EMM cause value to #15 "no suitable cells in tracking area", the network may additionally include the Extended EMM cause IE with value "requested EPS optimization not supported".

  NOTE 1:	How the UE uses the Extended EMM cause IE with value "requested EPS optimization not supported" is implementation specific. The UE still behaves according to the EMM cause value #15.

Upon receiving the ATTACH REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3410.

If the ATTACH REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.

The UE shall take the following actions depending on the EMM cause value received in the ATTACH REJECT message.

  #3	(Illegal UE);

  #6	(Illegal ME); or

  #8	(EPS services and non-EPS services not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services and non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and enter state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure is rejected with the 5GMM cause with the same value.

  NOTE 2:	The possibility to configure a UE so that the radio transceiver for a specific RAT is not active, although it is implemented in the UE, is out of scope of the present specification.

  #7	(EPS services not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and enter state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure is rejected with the 5GMM cause with the same value.

  #11	(PLMN not allowed); or

  #35	(Requested service option not authorized in this PLMN);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.

    	In S1 mode, the UE shall store the PLMN identity in the "forbidden PLMN list" and enter state EMM-DEREGISTERED.PLMN-SEARCH and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6]. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

    	In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value and no RR connection exists.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure is rejected with the 5GMM cause with the same value.

  #12	(Tracking area not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.

    	In S1 mode, the UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service" and enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

    	In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure is rejected with the 5GMM cause with the same value.

  #13	(Roaming not allowed in this tracking area);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.

    	In S1 mode, the UE shall store the current TAI in the list of "forbidden tracking areas for roaming". Additionally, the UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE or optionally EMM-DEREGISTERED.PLMN-SEARCH. The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].

    	In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure is rejected with the 5GMM cause with the same value.

  #14	(EPS services not allowed in this PLMN);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall delete the list of equivalent PLMNs and reset the attach attempt counter.

    	In S1 mode, the UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list. Additionally, the UE shall enter state EMM-DEREGISTERED.PLMN-SEARCH and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6]. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

    	In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

  #15	(No suitable cells in tracking area);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally, the UE shall reset the attach attempt counter.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and enter the state EMM-DEREGISTERED.LIMITED-SERVICE and:

    -	if the UE is in WB-S1 mode and the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the ATTACH REJECT message, the UE supports "E-UTRA Disabling for EMM cause #15", and the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in subclause 4.5 and search for a suitable cell in GERAN, UTRAN or NG-RAN radio access technology;

    -	if the UE is in NB-S1 mode and the Extended EMM cause IE with value "NB-IoT not allowed" is included in the ATTACH REJECT message, then the UE may disable the NB-IoT capability as specified in subclause 4.9 and search for a suitable cell in E-UTRAN radio access technology;

    -	otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].

    	In S101 mode, the UE shall store the PLMN identity provided with the indication from the lower layers to prepare for an S101 mode to S1 mode handover in the list of "forbidden PLMNs for attach in S101 mode" and enter the state EMM-DEREGISTERED.NO-CELL-AVAILABLE and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure is rejected with the 5GMM cause with the same value.

  #22	(Congestion);

    	If the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below; otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.1.2.6.

    	The UE shall abort the attach procedure, reset the attach attempt counter, set the EPS update status to EU2 NOT UPDATED and enter state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.

    	The UE shall stop timer T3346 if it is running.

    	If the ATTACH REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.

    	If the ATTACH REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].

    	The UE stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started if still needed when timer T3346 expires or is stopped.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure is rejected with the 5GMM cause with the same value.

  #25	(Not authorized for this CSG);

    	EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.2.6.

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause 5.1.3.3). Additionally, the UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

    	If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.

    	If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] subclause 3.1A.

    	The UE shall search for a suitable cell according to 3GPP TS 36.304 [21].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal attach procedure is rejected with the GMM cause with the same value.

  #42	(Severe network failure);

    	The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the attach attempt counter to 5. The UE shall start an implementation specific timer setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.

Other values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause 5.5.1.2.6.


5.5.1.2.5A	Attach for emergency bearer services not accepted by the network

If the attach request for emergency bearer services cannot be accepted by the network, the MME shall send an ATTACH REJECT message to the UE including EMM cause #5 "IMEI not accepted" or one of the EMM cause values as described in subclause 5.5.1.2.5.

  NOTE 1:	If EMM cause #11 is sent to a UE of a roaming subscriber attaching for emergency bearer services and the UE is in automatic network selection mode, it cannot obtain normal service provided by this PLMN.

Upon receiving the ATTACH REJECT message including EMM cause #5, the UE shall enter the state EMM-DEREGISTERED.NO-IMSI.

Upon receiving the ATTACH REJECT message including one of the other EMM cause values, the UE shall perform the actions as described in subclause 5.5.1.2.5 with the following addition: the UE shall inform the upper layers of the failure of the procedure.

  NOTE 2:	This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.

If the attach request for emergency bearer services fails due to abnormal case a) in subclause 5.5.1.2.6, the UE shall perform the actions as described in subclause 5.5.1.2.6 and inform the upper layers of the failure to access the network.

  NOTE 3:	This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN .

If the attach request for emergency bearer services fails due to abnormal cases b), c) or d) in subclause 5.5.1.2.6, the UE shall perform the actions as described in subclause 5.5.1.2.6 with the following addition: the UE shall inform the upper layers of the failure of the procedure.

  NOTE 4:	This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN .

In a shared network, upon receiving the ATTACH REJECT message, the UE shall perform the actions as described in subclause 5.5.1.2.5, and shall:

  a)	inform the upper layers of the failure of the procedure; or

  NOTE 5:	This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN .

  b)	attempt the attach for emergency bearer services to another PLMN in the shared network.

In a shared network, if the attach request for emergency bearer services fails due to abnormal case a) in subclause 5.5.1.2.6, the UE shall perform the actions as described in subclause 5.5.1.2.6 and shall:

  a)	inform the upper layers of the failure to access the network; or

  NOTE 6:	This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN .

  b)	attempt the attach for emergency bearer services to another PLMN in the shared network.

In a shared network, if the attach request for emergency bearer services fails due to abnormal cases b), c) or d) in subclause 5.5.1.2.6, the UE shall perform the actions as described in subclause 5.5.1.2.6, and shall:

  a)	inform the upper layers of the failure of the procedure; or

  NOTE 7:	This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN .

  b)	attempt the attach for emergency bearer services to another PLMN in the shared network.


5.5.1.2.5B	Attach for initiating a PDN connection for emergency bearer services not accepted by the network

If the network cannot accept attach request for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach", the UE shall perform the procedures as described in subclause 5.5.1.2.5. Then if the UE is in the same selected PLMN where the last attach request was attempted, the UE shall:

  a)	inform the upper layers of the failure of the procedure; or

  NOTE 1:	This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.

  b)	attempt EPS attach for emergency bearer services.

If the attach request for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach" fails due to abnormal case a) in subclause 5.5.1.2.6, the UE shall perform the actions as described in subclause 5.5.1.2.6 and inform the upper layers of the failure to access the network.

  NOTE 2:	This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.

If the attach request for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach" fails due to abnormal cases b), c) or d) in subclause 5.5.1.2.6, the UE shall perform the procedures as described in subclause 5.5.1.2.6. Then if the UE is in the same selected PLMN where the last attach request was attempted, the UE shall:

  a)	inform the upper layers of the failure of the procedure; or

  NOTE 3:	This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.

  b)	attempt EPS attach for emergency bearer services.


5.5.1.2.6	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	Access barred because of access class barring, EAB, ACDC or NAS signalling connection establishment rejected by the network without "Extended wait time" received from lower layers

    	In WB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), the attach procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started as soon as possible, i.e. when access for "originating signalling" is granted on the current cell or when the UE moves to a cell where access for "originating signalling" is granted.

    	In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), the attach procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. Further UE behaviour is implementation specific, e.g. the attach procedure is started again after an implementation dependent time.

    	In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), a request for an exceptional event is received from the upper layers, then the attach procedure shall be started.

  NOTE 1:	In NB-S1 mode, the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP TS 36.331 [22]).

    	If access is barred because of access class barring for "originating signalling" (see 3GPP TS 36.331 [22]), ACDC is applicable to the request from the upper layers and the UE supports ACDC, then the attach procedure shall be started.

    	If access is barred for a certain ACDC category (see 3GPP TS 36.331 [22]), a request with a higher ACDC category is received from the upper layers and the UE supports ACDC, then the attach procedure shall be started.

    	If an access request for an uncategorized application is barred due to ACDC (see 3GPP TS 36.331 [22]), a request with a certain ACDC category is received from the upper layers and the UE supports ACDC, then the attach procedure shall be started.

  b)	Lower layer failure or release of the NAS signalling connection without "Extended wait time" and without "Extended wait time CP data" received from lower layers before the ATTACH ACCEPT or ATTACH REJECT message is received

    	The attach procedure shall be aborted, and the UE shall proceed as described below.

  c)	T3410 timeout

    	The UE shall abort the attach procedure and proceed as described below. The NAS signalling connection, if any, shall be released locally.

  NOTE 2:	The NAS signalling connection can also be released if the UE deems that the network has failed the authentication check as specified in subclause 5.4.2.7.

  d)	ATTACH REJECT, other EMM cause values than those treated in subclause 5.5.1.2.5, and cases of EMM cause values  #22 and #25, if considered as abnormal cases according to subclause 5.5.1.2.5

    	Upon reception of the EMM cause #19 "ESM failure", if the UE is not configured for NAS signalling low priority and the ESM cause value received in the PDN CONNECTIVITY REJECT message is not #54 "PDN connection does not exist", the UE may set the attach attempt counter to 5. Subsequently, if the UE needs to retransmit the ATTACH REQUEST message to request PDN connectivity towards a different APN, the UE may stop T3411 or T3402, if running, and send the ATTACH REQUEST message.

  NOTE 3:	When receiving EMM cause #19 "ESM failure", coordination is required between the EMM and ESM sublayers in the UE to determine whether to set the attach attempt counter to 5.

    	If the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach", upon reception of the EMM causes #95, #96, #97, #99 and #111 the UE should set the attach attempt counter to 5.

    	The UE shall proceed as described below.

  e)	Change of cell into a new tracking area

    	If a cell change into a new tracking area occurs before the attach procedure is completed, the attach procedure shall be aborted and re-initiated immediately. If a tracking area border is crossed when the ATTACH ACCEPT message has been received but before an ATTACH COMPLETE message is sent, the attach procedure shall be re-initiated. If a GUTI was allocated during the attach procedure, this GUTI shall be used in the attach procedure.

  f)	Mobile originated detach required

    	The attach procedure shall be aborted, and the UE initiated detach procedure shall be performed.

  g)	Detach procedure collision

    	If the UE receives a DETACH REQUEST message from the network in state EMM-REGISTERED-INITIATED and the detach type indicates "re-attach not required" and no EMM cause IE, or "re-attach not required" and the EMM cause value is not #2 "IMSI unknown in HSS", the detach procedure shall be progressed and the attach procedure shall be aborted. If the UE receives a DETACH REQUEST message from the network in state EMM-REGISTERED-INITIATED and the detach type indicates "re-attach required", the detach procedure shall be progressed and the UE shall locally release the NAS signalling connection, before re-initiating the attach procedure. Otherwise the attach procedure shall be progressed and the DETACH REQUEST message shall be ignored.

  h)	Transmission failure of ATTACH REQUEST message indication from lower layers

    	The UE shall restart the attach procedure immediately.

  i)	Transmission failure of ATTACH COMPLETE message indication from lower layers

    	If the current TAI is not in the TAI list, the UE shall restart the attach procedure.

    	If the current TAI is still in the TAI list, it is up to the UE implementation how to re-run the ongoing procedure. The EMM sublayer notifies the ESM sublayer that the ESM message in the ESM message container IE of the ATTACH COMPLETE has failed to be transmitted.

  j)	If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, and the ACTIVATE DEFAULT BEARER CONTEXT REQUEST message combined with the ATTACH ACCEPT is not accepted by the UE due to failure in the UE ESM sublayer, then the UE shall initiate the detach procedure by sending a DETACH REQUEST message to the network. Further UE behaviour is implementation specific.

    	If EMM-REGISTERED without PDN connection is supported by the UE and the MME, and the ACTIVATE DEFAULT BEARER CONTEXT REQUEST message combined with the ATTACH ACCEPT is not accepted by the UE due to failure in the UE ESM sublayer, then the UE shall either send an ATTACH COMPLETE message together with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT contained in the ESM message container information element to the network or initiate the detach procedure by sending a DETACH REQUEST message. Further UE behaviour is implementation specific.

  k)	Indication from the lower layers that an S101 mode to S1 mode handover has been cancelled (S101 mode only)

    	The UE shall abort the attach procedure and enter state EMM-DEREGISTERED.NO-CELL-AVAILABLE.

  l)	"Extended wait time" from the lower layers

    	If the ATTACH REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", the UE shall start timer T3346 with the "Extended wait time" value and reset the attach attempt counter.

    	If the ATTACH REQUEST message did not contain the low priority indicator set to "MS is configured for NAS signalling low priority", the UE is operating in NB-S1 mode and the UE is not a UE configured to use AC11 – 15 in selected PLMN, then the UE shall start timer T3346 with the "Extended wait time" value and reset the attach attempt counter.

    	In other cases the UE shall ignore the "Extended wait time".

    	The UE shall abort the attach procedure, stay in the current serving cell, change the state to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH and apply the normal cell reselection process.

    	The UE shall proceed as described below.

  la)	"Extended wait time CP data" from the lower layers

    	If the UE is operating in NB-S1 mode, the UE shall start the timer T3346 with the "Extended wait time CP data" value and reset the attach attempt counter.

    	In other cases the UE shall ignore the "Extended wait time CP data".

    	The UE shall abort the attach procedure, stay in the current serving cell, change the state to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH and apply the normal cell reselection process.

    	The UE shall proceed as described below.

  m)	Timer T3346 is running

    	The UE shall not start the attach procedure unless:

    -	the UE is a UE configured to use AC11 – 15 in selected PLMN;

    -	the UE needs to attach for emergency bearer services;

    -	the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and

       i)	the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in  3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]); and

       ii)	timer T3346 was not started when NAS signaling connection was established with RRC establishment cause set to "MO exception data"; or

    -	the UE needs to attach without the NAS signalling low priority indication and if the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority".

    	The UE stays in the current serving cell and applies the normal cell reselection process.

  NOTE 4:	It is considered an abnormal case if the UE needs to initiate an attach procedure while timer T3346 is running independent on whether timer T3346 was started due to an abnormal case or a non successful case.

    	The UE shall proceed as described below.

  n)	If EMM-REGISTERED without PDN connection is supported by the UE and the MME, an ESM DUMMY MESSAGE is included in the ESM message container information element of the ATTACH REQUEST message and the UE receives the ATTACH ACCEPT message combined with a PDN CONNECTIVITY REJECT message, the UE shall send an ATTACH COMPLETE message together with an ESM DUMMY MESSAGE contained in the ESM message container information element to the network. Further UE behaviour is implementation specific.

  o)	Timer T3447 is running

    	The UE shall not start the attach procedure unless:

    -	the UE is a UE configured to use AC11 – 15 in selected PLMN;

    -	the UE attempts to attach for emergency bearer services; or

    -	the UE attempts to attach without PDN connection request.

    	The UE stays in the current serving cell and applies the normal cell reselection process. The attach request procedure is started, if still necessary, when timer T3447 expires.

For the cases b, c, d, l, la and m:

  -	Timer T3410 shall be stopped if still running.

  -	For the cases b, c, d, l when the "Extended wait time" is ignored, and la when the "Extended wait time CP data" is ignore, if the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach", the attach attempt counter shall be incremented, unless it was already set to 5.

  -	If the attach attempt counter is less than 5:

    -	for the cases l, la and m, the attach procedure is started, if still necessary, when timer T3346 expires or is stopped;

    -	for the cases b, c, d, l when the "Extended wait time" is ignored, and la when the "Extended wait time CP data" is ignore, if the attach request is neither for emergency bearer services nor for initiating a PDN connection for emergency bearer services with attach type not set to "EPS emergency attach", timer T3411 is started and the state is changed to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH. When timer T3411 expires the attach procedure shall be restarted, if still required by ESM sublayer.

  -	If the attach attempt counter is equal to 5:

    -	the UE shall delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs and KSI, shall set the update status to EU2 NOT UPDATED, and shall start timer T3402. The state is changed to EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH or optionally to EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6]; and

    -	if A/Gb mode, Iu mode or N1 mode is supported by the UE:

       -	if A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the abnormal case when a normal attach procedure fails and the attach attempt counter is equal to 5;

       -	if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the abnormal case when an initial registration procedure fails and the registration attempt counter is equal to 5; and

       -	the UE shall attempt to select GERAN, UTRAN or NG-RAN radio access technology and proceed with appropriate GMM or 5GMM specific procedures. Additionally, the UE may disable the E-UTRA capability as specified in subclause 4.5.


5.5.1.2.6A	Abnormal cases in the UE, SMS services not accepted

The UE shall proceed as follows:

  1)	if the attach was successful for EPS services only and the ATTACH ACCEPT message contained a value included in the SMS services status IE not treated in subclause 5.5.1.2.4A or the SMS services status IE is not included in the message, the UE shall proceed as follows:

    a)	The UE shall stop timer T3410 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;

    b)	If the tracking area updating attempt counter is less than 5:

       -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered;

    c)	If the tracking area updating attempt counter is equal to 5:

       -	the UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered; and

  2)	otherwise, the abnormal cases specified in subclause 5.5.1.2.6 apply.


5.5.1.2.7	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	Lower layer failure

    	If a lower layer failure occurs before the message ATTACH COMPLETE has been received from the UE, the network shall locally abort the attach procedure, enter state EMM-DEREGISTERED and shall not resend the message ATTACH ACCEPT. If a new GUTI was assigned to the UE in the attach procedure, the MME shall consider both the old and the new GUTI as valid until the old GUTI can be considered as invalid by the network or the EMM context which has been marked as detached in the network is released.

    	If the old GUTI was allocated by an MME other than the current MME, the current MME does not need to retain the old GUTI. If the old GUTI is used by the UE in a subsequent attach message, the network may use the identification procedure to request the UE's IMSI.

  b)	Protocol error

    	If the ATTACH REQUEST message is received with a protocol error, the network shall return an ATTACH REJECT message with one of the following EMM cause values:

    	#96:	invalid mandatory information;

    	#99:	information element non-existent or not implemented;

    	#100:	conditional IE error; or

    	#111:	protocol error, unspecified.

  c)	T3450 time-out

    	On the first expiry of the timer, the network shall retransmit the ATTACH ACCEPT message and shall reset and restart timer T3450.

    	This retransmission is repeated four times, i.e. on the fifth expiry of timer T3450, the attach procedure shall be aborted and the MME enters state EMM-DEREGISTERED. If a new GUTI was allocated in the ATTACH ACCEPT message, the network shall consider both the old and the new GUTI as valid until the old GUTI can be considered as invalid by the network or the EMM context which has been marked as detached in the network is released. If the old GUTI was allocated by an MME other than the current MME, the current MME does not need to retain the old GUTI.

    	If the old GUTI is used by the UE in a subsequent attach message, the network acts as specified for case a above.

  d)	ATTACH REQUEST received after the ATTACH ACCEPT message has been sent and before the ATTACH COMPLETE message is received

    -	If one or more of the information elements in the ATTACH REQUEST message differ from the ones received within the previous ATTACH REQUEST message, the previously initiated attach procedure shall be aborted if the ATTACH COMPLETE message has not been received and the new attach procedure shall be progressed; or

    -	if the information elements do not differ, then the ATTACH ACCEPT message shall be resent and the timer T3450 shall be restarted if an ATTACH COMPLETE message is expected. In that case, the retransmission counter related to T3450 is not incremented.

  e)	More than one ATTACH REQUEST received and no ATTACH ACCEPT or ATTACH REJECT message has been sent

    -	If one or more of the information elements in the ATTACH REQUEST message differs from the ones received within the previous ATTACH REQUEST message, the previously initiated attach procedure shall be aborted and the new attach procedure shall be executed;

    -	if the information elements do not differ, then the network shall continue with the previous attach procedure and shall ignore the second ATTACH REQUEST message.

  f)	ATTACH REQUEST received in state EMM-REGISTERED

    	If an ATTACH REQUEST message is received in state EMM-REGISTERED the network may initiate the EMM common procedures; if it turned out that the ATTACH REQUEST message was sent by a UE that has already been attached, the EMM context, EPS bearer contexts, if any, are deleted and the new ATTACH REQUEST is progressed.

  g)	TRACKING AREA UPDATE REQUEST message received before ATTACH COMPLETE message.

    	Timer T3450 shall be stopped. The allocated GUTI in the attach procedure shall be considered as valid and the tracking area updating procedure shall be rejected with the EMM cause #10 "implicitly detached" as described in subclause 5.5.3.2.5.

  h)	DETACH REQUEST message received before ATTACH COMPLETE message.

    	The network shall abort the attach procedure and shall progress the detach procedure as described in subclause 5.5.2.2.

  i)	If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME receives an ATTACH REQUEST message with an ESM message included in the ESM message container information element, and the ESM sublayer in the MME detects a message error according to clause 7, the MME may decide to proceed with the attach procedure or to reject it. When sending the ATTACH ACCEPT or ATTACH REJECT message to the UE, the MME shall include the ESM message provide by the ESM layer in the ESM message container information element.

  j)	UE security capabilities invalid or unacceptable

    	If the ATTACH REQUEST message is received with invalid or unacceptable UE security capabilities (e.g. no EPS encryption algorithms (all bits zero), no EPS integrity algorithms (all bits zero), mandatory EPS encryption algorithms not supported or mandatory EPS integrity algorithms not supported, etc.), the MME shall return an ATTACH REJECT message.

  NOTE:	EMM cause value to be used in ATTACH REJECT message is up to the network implementation.


5.5.1.3	Combined attach procedure for EPS services and non-EPS services (S1 mode only)


5.5.1.3.1	General

The combined attach procedure is used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for both EPS and non-EPS services, or both EPS services and "SMS only".

The combined attach procedure is also used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation to attach for EPS services if it is already IMSI attached for non-EPS services.

When the UE initiates a combined attach procedure, the UE shall indicate "combined EPS/IMSI attach" in the EPS attach type IE.

The combined attach procedure follows the attach procedure for EPS described in subclause 5.5.1.2 with exception of subclause 5.5.1.2.4A and subclause 5.5.1.2.6A.


5.5.1.3.2	Combined attach procedure initiation

If the UE is in EMM state EMM-DEREGISTERED, the UE initiates the combined attach procedure by sending an ATTACH REQUEST message to the network, starting timer T3410 and entering state EMM-REGISTERED-INITIATED (see example in figure 5.5.1.2.2.1).

The UE shall include the TMSI status IE if no valid TMSI is available. Furthermore, if the UE has stored a valid location area identification, the UE shall include it in the Old location area identification IE in the ATTACH REQUEST message.

If the UE has stored a valid TMSI, the UE shall include the TMSI based NRI container IE in the ATTACH REQUEST message.

If the UE initiates a combined attach procedure for EPS services and "SMS only", the UE shall indicate "SMS only" in the Additional update type IE.


5.5.1.3.3	EMM common procedure initiation

The network may initiate EMM common procedures, e.g. the identification, authentication and security mode control procedures, depending on the received information such as IMSI, GUTI and KSI.


5.5.1.3.4	Combined attach accepted by the network


5.5.1.3.4.1	General

Depending on the value of the EPS attach result IE received in the ATTACH ACCEPT message, the following different cases can be distinguished:

  1)	The EPS attach result IE value indicates "combined EPS/IMSI attach": attach for EPS and non-EPS services, or for EPS services and "SMS only" have been successful.

  2)	The EPS attach result IE value indicates "EPS only": attach for EPS services has been successful but attach for non-EPS services or "SMS only" has failed.


5.5.1.3.4.2	Combined attach successful

The description for attach for EPS services as specified in subclause 5.5.1.2.4 shall be followed. In addition, the following description for attach for non-EPS services or "SMS only" applies.

The TMSI reallocation may be part of the combined attach procedure. The TMSI allocated is then included in the ATTACH ACCEPT message, together with the location area identification (LAI). In this case the MME shall start timer T3450 as described in subclause 5.4.1.4, and enter state EMM-COMMON-PROCEDURE-INITIATED. If the MME does not indicate "SMS only" in the ATTACH ACCEPT message, subject to operator policies the MME should allocate a TAI list that does not span more than one location area.

For a shared network in CS domain, the MME indicates the selected PLMN for CS domain in the LAI to the UE as specified in 3GPP TS 23.272 [9].

The UE, receiving an ATTACH ACCEPT message, stores the received location area identification, stops timer T3410, resets the location update attempt counter and sets the update status to U1 UPDATED. If the message contains an IMSI, the UE is not allocated any TMSI, and shall delete any TMSI accordingly. If the message contains a TMSI, the UE shall use this TMSI as the new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. If neither a TMSI nor an IMSI has been included by the network in the ATTACH ACCEPT message, the old TMSI, if any available, shall be kept.

If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events (see subclause 5.3.7b), then the UE shall reset this counter.

If the UE requested "SMS only" in the Additional update type IE, or if the UE requested a combined attach for EPS and non-EPS services, but the network decides to accept the attach request for EPS services and "SMS only", the network shall indicate "SMS only" in the Additional update result IE. In addition, if the SMS services are provided via SMS in MME, the network shall provide a non-broadcast LAI in the ATTACH ACCEPT message. If a TMSI has to be allocated, then the network shall also provide a TMSI value which cannot cause any ambiguity with assigned TMSI values.

If the ATTACH ACCEPT message includes the Additional update result IE with value "SMS only", a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with "IMS voice available" shall not attempt to use CS fallback for mobile originating services.

As an implementation option, if the ATTACH ACCEPT message does not include the Additional update result IE with value "SMS only" and the UE is not configured for NAS signaling low priority then the UE may stop timer T3246 if running.

If the ATTACH ACCEPT message includes the Additional update result IE with value "CS Fallback not preferred", this indicates to a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with "IMS voice available" that it is attached for EPS and non-EPS services and that it can use CS fallback.

If the LAI contained in the ATTACH ACCEPT message is a member of the list of "forbidden location areas for regional provision of service" or the list of "forbidden location areas for roaming" then such entry shall be deleted.

If the PLMN identity for the CS domain which is provided as part of the LAI contained in the ATTACH ACCEPT message differs from the PLMN identity provided as part of the GUTI, the MME shall include the PLMN identity for the CS domain in the list of equivalent PLMNs in the ATTACH ACCEPT message.

The UE, when having requested PDN connectivity as contained in the ATTACH REQUEST and on receiving the ATTACH ACCEPT message combined with the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, shall send an ATTACH COMPLETE message combined with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message to the network.

Upon transmission of the ATTACH COMPLETE message the UE shall enter state EMM-REGISTERED and MM state MM-IDLE and set the EPS update status to EU1 UPDATED.

If the ATTACH ACCEPT message includes the Additional update result IE with value "SMS only" or "CS Fallback not preferred", a UE operating in CS/PS mode 1 with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see subclause 4.5).

Upon receiving an ATTACH COMPLETE message, the MME shall stop timer T3450, enter state EMM-REGISTERED.

  NOTE:	Upon receiving an ATTACH COMPLETE message, the MME sends an SGsAP-TMSI-REALLOCATION-COMPLETE message as specified in 3GPP TS 29.118 [16A].


5.5.1.3.4.3	Combined attach successful for EPS services only

Apart from the actions on the tracking area updating attempt counter, the description for attach for EPS services as specified in subclause 5.5.1.2.4 shall be followed. In addition, the following description for attach for non-EPS services applies.

The UE receiving the ATTACH ACCEPT message takes one of the following actions depending on the EMM cause value:

  #2	(IMSI unknown in HSS)

       	The UE shall stop T3410 if still running and shall reset the tracking area updating attempt counter. The UE shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The UE shall enter state EMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE. The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed.or the timer T3245 expires as described in subclause 5.3.7a. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  #16	(MSC temporarily not reachable); or

  #17	(Network failure)

       	The UE shall stop timer T3410 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.

       	If the tracking area updating attempt counter is less than 5:

       -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered.

       	If the tracking area updating attempt counter is equal to 5:

       -	a UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered;

       -	a UE operating in CS/PS mode 1 of operation with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see subclause 4.5).

  #18	(CS domain not available)

       	The UE shall stop timer T3410 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.

       	The UE shall enter state MM IDLE and shall set the update status to U2 NOT UPDATED.

       	A UE in CS/PS mode 1 of operation with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology  and disable the E-UTRA capability (see subclause 4.5).

       	A UE in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" may provide a notification to the user or the upper layers that the CS domain is not available.

       	The UE shall not attempt combined attach or combined tracking area update procedure with current PLMN until switching off the UE or the UICC containing the USIM is removed.

  #22	(Congestion)

       	The UE shall stop the timer T3410 if still running. The tracking area updating attempt counter shall be set to 5. The UE shall start the timer T3402, shall set the EPS update status to EU1 UPDATED, shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, and shall enter state MM IDLE.

Other EMM cause values and the case that no EMM cause IE was received are considered as abnormal cases. The combined attach procedure shall be considered as failed for non-EPS services. The behaviour of the UE in those cases is specified in subclause 5.5.1.3.6.


5.5.1.3.5	Combined attach not accepted by the network

If the attach request can neither be accepted by the network for EPS nor for non-EPS services, the MME shall send an ATTACH REJECT message to the UE including an appropriate EMM cause value. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the attach request included a PDN CONNECTIVITY REQUEST message, and the attach procedure fails due to a default EPS bearer setup failure, an ESM procedure failure or operator determined barring, the MME shall:

  -	combine the ATTACH REJECT message with a PDN CONNECTIVITY REJECT message contained in the ESM message container information element. In this case the EMM cause value in the ATTACH REJECT message shall be set to #19, "ESM failure"; or

  -	send the ATTACH REJECT message with the EMM cause set to #15 "No suitable cells in tracking area" ,if the PDN connectivity reject is due to ESM cause #29 subject to operator policies (see 3GPP TS 29.274 [16D] for further details). In this case, the network may additionally include the Extended EMM cause IE with value "E-UTRAN not allowed".

If the attach request is rejected due to NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a back-off timer T3346.

If the attach request is rejected due to service gap control as specified in subclause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.

Upon receiving the ATTACH REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3410 and enter MM state MM IDLE.

If the ATTACH REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.

The UE shall take the following actions depending on the EMM cause value received in the ATTACH REJECT message.

  #3	(Illegal UE);

  #6	(Illegal ME); or

  #8	(EPS services and non-EPS services not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI.

    	The UE shall consider the USIM as invalid for EPS and non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure is rejected with the 5GMM cause with the same value.

  #7	(EPS services not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	A UE which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.

    	The UE shall attempt to select GERAN or UTRAN radio access technology and shall proceed with the appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure is rejected with the 5GMM cause with the same value.

  #11	(PLMN not allowed); or

  #35	(Requested service option not authorized in this PLMN);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI, and reset the attach attempt counter. The UE shall delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.

    	The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

    	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value and no RR connection exists.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure is rejected with the 5GMM cause with the same value.

  #12	(Tracking area not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service".

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure is rejected with the 5GMM cause with the same value.

  #13	(Roaming not allowed in this tracking area);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall delete the list of equivalent PLMNs and reset the attach attempt counter. Additionally the UE enter the state EMM-DEREGISTERED.LIMITED-SERVICE or optionally EMM-DEREGISTERED.PLMN-SEARCH.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming".

    	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure is rejected with the 5GMM cause with the same value.

  #14	(EPS services not allowed in this PLMN);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally the UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.PLMN-SEARCH.

    	The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

    	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.

    	A UE operating in CS/PS mode 1 of operation and supporting A/Gb or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see subclause 4.5).

    	A UE operating in CS/PS mode 1 of operation and supporting A/Gb or Iu mode may perform a PLMN selection according to 3GPP TS 23.122 [6].

    	A UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

  #15	(No suitable cells in tracking area);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. Additionally the UE shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and:

    -	if the UE is in WB-S1 mode and the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the ATTACH REJECT message, the UE supports "E-UTRA Disabling for EMM cause #15", and the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled, then the UE shall disable the E-UTRA capability as specified in subclause 4.5 and search for a suitable cell in another location area or 5GS tracking area;

    -	if the UE is in NB-S1 mode and the Extended EMM cause IE with value "NB-IoT not allowed" is included in the ATTACH REJECT message, then the UE may disable the NB-IoT capability as specified in subclause 4.9 and search for a suitable cell in E-UTRAN radio access technology;

    -	otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure is rejected with the 5GMM cause with the same value.

  #22	(Congestion);

    	If the T3346 value IE is present in the ATTACH REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below; otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.1.3.6.

    	The UE shall abort the attach procedure, reset the attach attempt counter, set the EPS update status to EU2 NOT UPDATED and enter state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.

    	The UE shall stop timer T3346 if it is running.

    	If the ATTACH REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.

    	If the ATTACH REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].

    	The UE stays in the current serving cell and applies the normal cell reselection process. The attach procedure is started if still needed when timer T3346 expires or is stopped.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the initial registration procedure is rejected with the 5GMM cause with the same value.

  #25	(Not authorized for this CSG);

    	EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.1.3.6.

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause 5.1.3.3). Additionally, the UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

    	If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.

    	If the CSG ID and associated PLMN identity of the cell where the UE has sent the ATTACH REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] subclause 3.1A.

    	The UE shall search for a suitable cell according to 3GPP TS 36.304 [21].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the MM parameters update status and location update attempt counter, and GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined attach procedure is rejected with the GMM cause with the same value.

  #42	(Severe network failure);

    	The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, TAI list, eKSI, and list of equivalent PLMNs, and set the attach attempt counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.

Other values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause 5.5.1.3.6.


5.5.1.3.6	Abnormal cases in the UE

The UE shall proceed as follows:

  1)	if the UE requested the combined attach for EPS services and "SMS only" and the ATTACH ACCEPT message indicates a combined attach successful for EPS and non-EPS services, the UE shall behave as if the combined attach was successful for EPS services and "SMS only";

  NOTE:	In this case the UE can ignore the CS SERVICE NOTIFICATION message or the Paging with CN domain indicator set to "CS", as specified in subclause 5.6.2.3.2.

  2)	if the combined attach was successful for EPS services only and the ATTACH ACCEPT message contained an EMM cause value not treated in subclause 5.5.1.3.4.3 or the EMM cause IE is not included in the message, the UE shall proceed as follows:

    a)	The UE shall stop timer T3410 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;

    b)	If the tracking area updating attempt counter is less than 5:

       -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered;

    c)	If the tracking area updating attempt counter is equal to 5:

       -	a UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered; and

       -	a UE operating in CS/PS mode 1 of operation with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see subclause 4.5); and

    d)	If there is a CS fallback emergency call pending or CS fallback call pending, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer; and

  3)	otherwise, the abnormal cases specified in subclause 5.5.1.2.6 apply with the following modification.

    	If the attach attempt counter is incremented according to subclause 5.5.1.2.6 the next actions depend on the value of the attach attempt counter:

    -	if the attach attempt counter is less than 5, the UE shall set the update status to U2 NOT UPDATED but shall not delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs; or

    -	if the attach attempt counter is equal to 5, then the UE shall delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs and set the update status to U2 NOT UPDATED. The UE shall attempt to select GERAN, UTRAN or NG-RAN radio access technology and proceed with appropriate MM, GMM or 5GMM specific procedures. Additionally, the UE may disable the E-UTRA capability as specified in subclause 4.5.

    	If there is a CS fallback emergency call pending or CS fallback call pending, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.


5.5.1.3.7	Abnormal cases on the network side

The abnormal cases specified in subclause 5.5.1.2.7 apply.


5.5.2	Detach procedure


5.5.2.1	General

The detach procedure is used:

  -	by the UE to detach for EPS services only;

  -	by the UE to disconnect from the last remaining PDN it is connected to if EMM-REGISTERED without PDN connection is not supported by the UE or the MME;

  -	by the UE in CS/PS mode 1 or CS/PS mode 2 of operation to detach for both EPS services and non-EPS services or for non-EPS services only via a combined detach procedure;

  -	by the network to inform the UE that it is detached for EPS services or non-EPS services or both;

  -	by the network to disconnect the UE from the last remaining PDN to which it is connected if EMM-REGISTERED without PDN connection is not supported by the UE or the MME; and

  -	by the network to inform the UE to re-attach to the network and re-establish all PDN connections.

  NOTE 1:	After a successful completion of an inter-system change of the UE from S1 mode to non-3GPP access, if the non-3GPP network provides PDN connectivity to the same EPC and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the MME performs a local detach of the UE.

  NOTE 2:	If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the detach procedure is not triggered when disconnecting the UE from the last remaining PDN to which it is connected.

The detach procedure also applies to the UE which is IMSI attached for "SMS only".

The detach procedure with appropriate detach type shall be invoked by the UE if the UE is switched off, the USIM card is removed from the UE, the UE wishes to detach for EPS services, the UE wishes to detach for non-EPS services or as part of the eCall inactivity procedure defined in subclause 5.5.4.

If the detach procedure is triggered due to USIM removal, the UE shall indicate "switch off" in the detach type IE.

When upper layers indicates that emergency bearer services are no longer required, the UE if still attached for emergency bearer services, may perform a detach followed by a re-attach to regain normal services, if the UE is in or moves to a suitable cell.

If a detach is requested by the HSS for a UE that has bearers for emergency services, the MME shall not send a DETACH REQUEST message to the UE, and shall follow the procedures in subclause 6.4.4.1 for a UE that has bearers for emergency services.

If the detach procedure for EPS services is performed, the EPS bearer context(s), if any, for this particular UE are deactivated locally without peer-to-peer signalling between the UE and the MME.

If the UE supports A/Gb mode or Iu mode or both, the UE shall store the TIN in the non-volatile memory in the ME, as described in annex C, for a subsequent attach procedure.

The UE is allowed to initiate the detach procedure even if the timer T3346 is running.

The network proceeds with the detach procedure even if NAS level mobility management congestion control is active.


5.5.2.2	UE initiated detach procedure


5.5.2.2.1	UE initiated detach procedure initiation

The detach procedure is initiated by the UE by sending a DETACH REQUEST message (see example in figure 5.5.2.2.1.1). The Detach type IE included in the message indicates whether detach is due to a "switch off" or not. The Detach type IE also indicates whether the detach is for EPS services only, for non-EPS services only, or for both. If the UE has a mapped EPS security context as the current EPS security context, the UE shall set the type of security context flag to "mapped security context". Otherwise, the UE shall set the type of security context flag to "native security context".

If the UE has a valid GUTI, the UE shall populate the EPS mobile identity IE with the valid GUTI. If the UE does not have a valid GUTI, the UE shall populate the EPS mobile identity IE with its IMSI.

If the UE does not have a valid GUTI and it does not have a valid IMSI, then the UE shall populate the EPS mobile identity IE with its IMEI.

  NOTE:	During the attach for emergency service when the UE (with no USIM or invalid USIM) is in EMM-REGISTERED-INITIATED STATE, the UE has neither a valid GUTI nor a valid IMSI.

If the detach is not due to switch off and the UE is in the state EMM-REGISTERED or EMM-REGISTERED-INITIATED, timer T3421 shall be started in the UE after the DETACH REQUEST message has been sent. If the detach type indicates that the detach is for non-EPS services only the UE shall enter the state EMM-REGISTERED.IMSI-DETACH-INITIATED, otherwise the UE shall enter the state EMM-DEREGISTERED-INITIATED. If the detach type indicates that the detach is for non-EPS services or both EPS and non-EPS services, the UE shall enter the state MM IMSI DETACH PENDING.

If the UE to be switched off is not operating in NB-S1 mode and not operating in WB-S1 mode in any enhanced coverage CE mode, the UE shall try for a period of 5 seconds to send the DETACH REQUEST message. If the UE to be switched off:-

  -	is operating in NB-S1 mode, then the UE should try for at least a period of 85 seconds to send the DETACH REQUEST; or

  -	is operating in WB-S1 mode in any enhanced coverage CE mode, then the UE should try for at least a period of 14 seconds to send the DETACH REQUEST.

During this period, the UE may be switched off as soon as the DETACH REQUEST message has been sent.

After the last DETACH REQUEST message is sent, the UE shall proceed as follows:

  -	if the current EPS security context is a native EPS security context, then the UE shall store the current EPS security context as specified in annex C and mark it as valid;

  -	else if the current EPS security context is a mapped EPS security context and a non-current full native EPS security context exists, then the UE shall store the non-current EPS security context as specified in annex C and mark it as valid, and finally the UE shall delete any mapped EPS security context or partial native EPS security context.

[pic]

Figure 5.5.2.2.1.1: UE initiated detach procedure


5.5.2.2.2	UE initiated detach procedure completion for EPS services only

When the DETACH REQUEST message is received by the network, the network shall send a DETACH ACCEPT message to the UE, if the Detach type IE does not indicate "switch off". Otherwise, the procedure is completed when the network receives the DETACH REQUEST message.

The network and the UE shall deactivate the EPS bearer context(s), if any, for this UE locally without peer-to-peer signalling between the UE and the MME.

The UE is marked as inactive in the network for EPS services. The network shall enter the state EMM-DEREGISTERED.

The UE, when receiving the DETACH ACCEPT message, shall stop timer T3421. Furthermore, if the UE is operating in PS mode of operation, or is operating in CS/PS mode of operation and supports S1 mode only then:

  -	If the detach procedure was performed due to disabling of EPS services, then the UE shall enter the EMM-NULL state.

  -	Otherwise, the UE shall enter the EMM-DEREGISTERED state.

The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, and supporting A/Gb mode or Iu mode, shall further set the update status to U2 NOT UPDATED, disable the E-UTRA capability (see subclause 4.5) and attempt to select GERAN or UTRAN access technology.


5.5.2.2.3	UE initiated combined detach procedure completion

When the DETACH REQUEST message is received by the network, a DETACH ACCEPT message shall be sent to the UE, if the Detach type IE does not indicate "switch off". Otherwise, the procedure is completed when the network receives the DETACH REQUEST message.

Depending on the value of the Detach type IE the following applies:

  -	combined EPS/IMSI detach:

    	The network and the UE shall deactivate the EPS bearer context(s) for this UE locally without peer-to-peer signalling between the UE and the MME. The UE is marked as inactive in the network for EPS and for non-EPS services. The states EMM-DEREGISTERED and MM-NULL are entered in both the UE and the network.

  -	IMSI detach:

    	The UE is marked as inactive in the network for non-EPS services. The states MM-NULL and EMM-REGISTERED are entered in both the UE and the network.

The UE, when receiving the DETACH ACCEPT message, shall stop timer T3421.


5.5.2.2.4	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	Access barred because of access class barring, EAB or NAS signalling connection establishment rejected by the network

    	In WB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), the detach signalling procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. The detach signalling procedure is started as soon as possible and if still necessary, i.e. when access for "originating signalling" is granted on the current cell or when the UE moves to a cell where access for "originating signalling" is granted. The UE may perform a local detach either immediately or after an implementation dependent time.

    	In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), the detach signalling procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. Further UE behaviour is implementation specific, e.g. the detach signalling procedure is started again after an implementation dependent time.

  NOTE 1:	In NB-S1 mode, the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP TS 36.331 [22]).

  b)	Lower layer failure or release of the NAS signalling connection before reception of DETACH ACCEPT message

    	The detach procedure shall be aborted and the UE proceeds as follows:

    -	if the detach procedure was performed due to disabling of EPS services, the UE shall enter the EMM-NULL state;

    -	if "EPS detach" was requested for reasons other than disabling of EPS services, the UE shall enter the EMM-DEREGISTERED state;

    -	if "IMSI detach" was requested, the UE shall enter the EMM-REGISTERED.NORMAL-SERVICE state and the MM-NULL state; or

    -	if "combined EPS/IMSI detach" was requested, the UE shall enter the EMM-DEREGISTERED state and the MM-NULL state.

  c)	T3421 timeout

    	On the first four expiries of the timer, the UE shall retransmit the DETACH REQUEST message and shall reset and restart timer T3421. On the fifth expiry of timer T3421, the detach procedure shall be aborted and the UE proceeds as follows:

    -	if the detach procedure was performed due to disabling of EPS services, the UE shall enter the EMM-NULL state;

    -	if "EPS detach" was requested for reasons other than disabling of EPS services, the UE shall enter the EMM-DEREGISTERED state;

    -	if "IMSI detach" was requested, the UE shall enter the EMM-REGISTERED.NORMAL-SERVICE state and the MM-NULL state; or

    -	if "combined EPS/IMSI detach" was requested, the UE shall enter the EMM-DEREGISTERED state and the MM-NULL state.

  d)	Detach procedure collision

    	Detach containing cause "switch off" within the Detach type IE:

    -	If the UE receives a DETACH REQUEST message before the UE initiated detach procedure has been completed, this message shall be ignored and the UE initiated detach procedure shall continue.

    	Detach containing other causes than "switch off" within the Detach type IE:

    -	If the UE receives a DETACH REQUEST message before the UE initiated detach procedure has been completed, it shall treat the message as specified in subclause 5.5.2.3.2 with the following modifications:

       -	If the DETACH REQUEST message received by the UE contains detach type "re-attach required", and the UE initiated detach procedure is with detach type "EPS detach" or "combined EPS/IMSI detach", the UE need not initiate the attach or combined attach procedure.

       -	If the DETACH REQUEST message received by the UE contains detach type "IMSI detach", and the UE initiated detach procedure is with detach type "IMSI detach", the UE need not re-attach to non-EPS services.

       -	If the DETACH REQUEST message received by the UE contains detach type "IMSI detach", and the UE initiated detach procedure is with detach type "EPS detach" or "combined EPS/IMSI detach", the UE shall progress both procedures. The UE need not re-attach to non-EPS services.

  e)	Detach and EMM common procedure collision

    	Detach containing cause "switch off":

    -	If the UE receives a message used in an EMM common procedure before the detach procedure has been completed, this message shall be ignored and the detach procedure shall continue.

    	Detach containing other causes than "switch off" and containing detach type "IMSI detach":

    -	If the UE receives a message used in an EMM common procedure before the detach procedure has been completed, both the EMM common procedure and the detach procedure shall continue.

    	Detach containing other causes than "switch off" and containing other detach types than "IMSI detach":

    -	If the UE receives a GUTI REALLOCATION COMMAND, an EMM STATUS or an EMM INFORMATION message before the detach procedure is completed, this message shall be ignored and the detach procedure shall continue.

    -	If the UE receives an AUTHENTICATION REQUEST, SECURITY MODE COMMAND or IDENTITY REQUEST message before the detach procedure has been completed, the UE shall respond to it as described in subclause 5.4.2, 5.4.3 and 5.4.4 respectively and the detach procedure shall continue.

  f)	Change of cell into a new tracking area

    	If a cell change into a new tracking area that is not in the stored TAI list occurs before the UE initiated detach procedure is completed, the detach procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure. If the detach procedure was initiated due to removal of the USIM or the UE is to be switched off, the UE shall abort the detach procedure and enter the state EMM-DEREGISTERED.

  g)	Transmission failure of DETACH REQUEST message indication with TAI change from lower layers

    	If the current TAI is not in the TAI list, the detach procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure. If the detach procedure was initiated due to removal of the USIM or the UE is to be switched off, the UE shall abort the detach procedure and enter the state EMM-DEREGISTERED.

    	If the current TAI is still part of the TAI list, the UE shall restart the detach procedure.

  h)	Transmission failure of DETACH REQUEST message indication without TAI change from lower layers

    	The UE shall restart the detach procedure.

  i)	Detach and paging procedure collision

    	If the UE receives a CS SERVICE NOTIFICATION message before the UE initiated combined detach procedure with detach type "IMSI detach" or "combined EPS/IMSI detach" has been completed, then this message shall be ignored and the UE initiated combined detach procedure shall continue.


5.5.2.2.5	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	Detach request received in a CSG cell for which the UE has no valid CSG subscription

    	If the UE initiates a detach procedure in a CSG cell the CSG ID of which is not valid for the UE, and the detach procedure is not due to "switch off", the network shall proceed as follows:

    -	if the detach type is "IMSI detach" and the UE has a PDN connection for emergency bearer services active, the MME shall send a DETACH ACCEPT message and deactivate all non-emergency EPS bearers, if any, by initiating an EPS bearer context deactivation procedure;

    -	otherwise, the network shall initiate the detach procedure. The MME shall send a DETACH REQUEST message including the EMM cause #25,"not authorized for this CSG".

  b)	Lower layers indication of non-delivered NAS PDU due to handover

    	If the DETACH ACCEPT message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the DETACH ACCEPT message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the DETACH ACCEPT message.


5.5.2.3	Network initiated detach procedure


5.5.2.3.1	Network initiated detach procedure initiation

The network initiates the detach procedure by sending a DETACH REQUEST message to the UE (see example in figure 5.5.2.3.1).

  NOTE:	If the MME performs a local detach, it will inform the UE with an EMM messages (e.g. SERVICE REJECT or TRACKING AREA UPDATE reject) with EMM cause #10 "implicitly detached" only when the UE initiates an EMM procedure.

The network may include an EMM cause IE to specify the reason for the detach request. The network shall start timer T3422. If the Detach type IE indicates "re-attach required" or "re-attach not required" and the EMM cause value is not #2 "IMSI unknown in HSS", or if the MME performs a local detach, the MME shall either store the current EPS security context if it is a native EPS security context, or the MME shall delete the current EPS security context if it is a mapped EPS security context. If the detach type IE indicates "re-attach required" or "re-attach not required" and the EMM cause value is not #2 "IMSI unknown in HSS", the network shall deactivate the EPS bearer context(s), if any, for the UE locally and enter state EMM-DEREGISTERED-INITIATED.

[pic]

Figure 5.5.2.3.1: Network initiated detach procedure


5.5.2.3.2	Network initiated detach procedure completion by the UE

When receiving the DETACH REQUEST message and the detach type indicates "re-attach required", the UE shall deactivate the EPS bearer context(s), if any, including the default EPS bearer context locally without peer-to-peer signalling between the UE and the MME. The UE shall stop the timer T3346, if it is running. The UE shall also stop timer(s) T3396, if it is running. The UE shall send a DETACH ACCEPT message to the network and enter the state EMM-DEREGISTERED. Furthermore, the UE shall, after the completion of the detach procedure, and the release of the existing NAS signalling connection, initiate an attach or combined attach procedure. The UE should also re-establish any previously established PDN connection(s).

  NOTE 1:	When the detach type indicates "re-attach required", user interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s), if any, automatically.

A UE which receives a DETACH REQUEST message with detach type indicating "re-attach required" or "re-attach not required" and no EMM cause IE, is detached only for EPS services.

When receiving the DETACH REQUEST message and the detach type indicates "IMSI detach", the UE shall not deactivate the EPS bearer context(s) including the default EPS bearer context. The UE shall set the MM update status to U2 NOT UPDATED. A UE may send a DETACH ACCEPT message to the network, and shall re-attach to non-EPS services by performing the combined tracking area updating procedure according to subclause 5.5.3.3, sending a TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating "combined TA/LA updating with IMSI attach".

If the UE is attached for EPS and non-EPS services, then the UE shall set the update status to U2 NOT UPDATED if:

  -	the Detach type IE indicates "re-attach required"; or

  -	the Detach type IE indicates "re-attach not required" and no EMM cause IE is included.

When receiving the DETACH REQUEST message and the detach type indicates "re-attach not required" and no EMM cause IE, or "re-attach not required" and the EMM cause value is not #2 "IMSI unknown in HSS", the UE shall deactivate the EPS bearer context(s), if any, including the default EPS bearer context locally without peer-to-peer signalling between the UE and the MME. The UE shall then send a DETACH ACCEPT message to the network and enter state EMM-DEREGISTERED.

If the detach type indicates "IMSI detach" or "re-attach required", then the UE shall ignore the EMM cause IE if received.

If the detach type indicates "re-attach not required", the UE shall take the following actions depending on the received EMM cause value:

  #2	(IMSI unknown in HSS);

    	The UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	The UE is still attached for EPS services in the network.

  #3	(Illegal UE);

  #6	(Illegal ME); or

  #8	(EPS services and non-EPS services not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number and the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". The USIM shall also be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a.

    	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received with the 5GMM cause with the same value and with de-registration type set to "re-registration not required".

  NOTE 2:	The possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.

  #7	(EPS services not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".

    	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is IMSI attached for non-EPS services is still IMSI attached for non-EPS services in the network. The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN access technology and shall proceed with the appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.

    	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received with the 5GMM cause with the same value and with de-registration type set to "re-registration not required".

  #11	(PLMN not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall delete the list of equivalent PLMNs, shall reset the attach attempt counter and enter the state EMM-DEREGISTERED.PLMN-SEARCH.

    	The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

    	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number and the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".

    	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received with the 5GMM cause with the same value and with de-registration type set to "re-registration not required".

  #12	(Tracking area not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service".

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".

    	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received with the 5GMM cause with the same value and with de-registration type set to "re-registration not required".

  #13	(Roaming not allowed in this tracking area);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall delete the list of equivalent PLMNs, reset the attach attempt counter and shall change to state EMM-DEREGISTERED.PLMN-SEARCH.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming".

    	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6]

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter and as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".

    	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received with the 5GMM cause with the same value and with de-registration type set to "re-registration not required".

  #14	(EPS services not allowed in this PLMN);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). Furthermore, the UE shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.

    	The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

    	A UE in PS mode 1 or PS mode 2 of operation shall delete the list of equivalent PLMNs and perform a PLMN selection according to 3GPP TS 23.122 [6].

    	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.

    	A UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see subclause 4.5).

    	A UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP TS 23.122 [6].

    	A UE operating in CS/PS mode 1 of operation and supporting S1 mode only or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".

  #15	(No suitable cells in tracking area);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and KSI. The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming".

    	The UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, RAI, P-TMSI, P-TMSI signature, GPRS ciphering key sequence number, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".

    	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when a DEREGISTRATION REQUEST is received with the 5GMM cause with the same value and with de-registration type set to "re-registration not required".

  #25	(Not authorized for this CSG);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). The UE shall reset the attach attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

    	If the cell where the UE has received the DETACH REQUEST message is a CSG cell and the CSG ID and associated PLMN identity of the cell are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.

    	If the cell where the UE has received the DETACH REQUEST message is a CSG cell and the CSG ID and associated PLMN identity of the cell are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] subclause 3.1A.

    	The UE shall search for a suitable cell according to 3GPP TS 36.304 [21].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and GPRS attach attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with GMM cause with the same value and with detach type set to "re-attach not required". If the UE is IMSI attached for non-EPS services, the UE shall in addition handle the MM parameters update status and location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when a DETACH REQUEST is received with the GMM cause with the same value and with detach type set to "re-attach not required".

Other EMM cause values or if no EMM cause IE is included is considered as abnormal cases. The behaviour of the UE in those cases is described in subclause 5.5.2.3.4.


5.5.2.3.3	Network initiated detach procedure completion by the network

The network shall stop timer T3422 upon receipt of the DETACH ACCEPT message. If the Detach type IE indicates "IMSI detach", or "re-attach not required" and the EMM cause value is #2 "IMSI unknown in HSS", the network shall not change the current EMM state; otherwise the network shall enter state EMM-DEREGISTERED.


5.5.2.3.4	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	Transmission failure of DETACH ACCEPT message indication from lower layers

    	The detach procedure shall be progressed and the UE shall send the DETACH ACCEPT message.

  b)	DETACH REQUEST, other EMM cause values than those treated in subclause 5.5.2.3.2 or no EMM cause IE is included, and the Detach type IE indicates "re-attach not required"

    	The UE shall delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs, KSI, shall set the update status to EU2 NOT UPDATED and shall start timer T3402.

    	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is IMSI attached for non-EPS services is still IMSI attached for non-EPS services and shall set the update status to U2 NOT UPDATED.

  -	A UE not supporting A/Gb mode or Iu mode, or operating in PS mode of operation may enter the state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6]; otherwise the UE shall enter the state EMM-DEREGISTERED.ATTEMPTING-TO-ATTACH.

    	A UE supporting A/Gb mode or Iu mode and operating in CS/PS mode 1 of operation or CS/PS mode 2 of operation shall

    -	enter the state EMM-DEREGISTERED and attempt to select GERAN or UTRAN radio access technology and proceed with the appropriate MM or GMM specific procedures. In this case, the UE may disable the E-UTRA capability (see subclause 4.5); or

    -	enter the state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall set the GPRS update status to GU2 NOT UPDATED and shall delete the GMM parameters P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and shall enter the state GMM-DEREGISTERED.


5.5.2.3.5	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	T3422 time-out

    	On the first expiry of the timer, the network shall retransmit the DETACH REQUEST message and shall start timer T3422. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3422, the detach procedure shall be aborted. If the detach type is "IMSI detach", or "re-attach not required" and the EMM cause value is #2 "IMSI unknown in HSS", the network shall not change the current EMM state; otherwise the network shall change to state EMM-DEREGISTERED.

  b)	Lower layer failure

    	The detach procedure is aborted. If the detach type indicates "IMSI detach", or "re-attach not required" and the EMM cause value is #2 "IMSI unknown in HSS",  the network shall not change the current EMM state; otherwise the network shall change to state EMM-DEREGISTERED.

  c)	Detach procedure collision

    	If the network receives a DETACH REQUEST message with "switch off" indication, before the network initiated detach procedure has been completed, both procedures shall be considered completed.

    	If the network receives a DETACH REQUEST message without "switch off" indication, before the network initiated detach procedure has been completed, the network shall send a DETACH ACCEPT message to the UE.

  d)	Detach and attach procedure collision

    	If the network receives an ATTACH REQUEST message before the network initiated detach procedure with detach type "re-attach not required" and the EMM cause value not #2 "IMSI unknown in HSS", has been completed, the network shall ignore the ATTACH REQUEST message. If the Detach type IE, sent in the DETACH REQUEST message, indicates "re-attach required" the detach procedure is aborted and the attach procedure shall be progressed after the EPS bearer context(s) have been deleted. If the Detach type IE, sent in DETACH REQUEST message, indicates "IMSI detach", or "re-attach not required" and the EMM cause value is #2 "IMSI unknown in HSS", the detach procedure is aborted and the attach procedure shall be progressed.

  e)	Detach and tracking area updating procedure collision

    	If the Detach type IE, sent in DETACH REQUEST message, indicates "re-attach not required" with EMM cause other than #2 "IMSI unknown in HSS" or indicates "re-attach required", and the network receives a TRACKING AREA UPDATE REQUEST message before the network initiated detach procedure has been completed, the detach procedure shall be progressed, i.e. the TRACKING AREA UPDATE REQUEST message shall be ignored.

    	If the Detach type IE, sent in DETACH REQUEST message, indicates "re-attach not required" with EMM cause #2 "IMSI unknown in HSS" or indicates "IMSI detach" and the network receives a TRACKING AREA UPDATE REQUEST message before the network initiated detach procedure has been completed, the network shall abort the detach procedure, shall stop T3422 and shall progress the tracking area updating procedure.

  f)	Detach and service request procedure collision

    	If the network receives a SERVICE REQUEST message or an EXTENDED SERVICE REQUEST message for packet services before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) and the DETACH REQUEST contains detach type "re-attach not required" with EMM cause #2 "IMSI unknown in HSS" or detach type "IMSI detach", the network shall progress both procedures. If the DETACH REQUEST message contains detach type "re-attach not required" with EMM cause other than #2 "IMSI unknown in HSS" or detach type "re-attach required", the network shall progress the detach procedure.

    	If the network receives an EXTENDED SERVICE REQUEST message for CS fallback, but not for CS fallback for emergency call, before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) and the DETACH REQUEST contains detach type "re-attach not required" with EMM cause #2 "IMSI unknown in HSS" or detach type "IMSI detach", the network shall ignore the EXTENDED SERVICE REQUEST message and progress the detach procedure.

    	If the network receives an EXTENDED SERVICE REQUEST message for CS fallback for emergency call before the network initiated detach procedure has been completed (e.g. the DETACH REQUEST message is pending to be sent to the UE) and the DETACH REQUEST contains detach type "re-attach not required" with EMM cause #2 "IMSI unknown in HSS" or detach type "IMSI detach", the network shall progress both procedures.

  g)	Lower layers indication of non-delivered NAS PDU due to handover

    	If the DETACH REQUEST message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the DETACH REQUEST message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the DETACH REQUEST message.


5.5.3	Tracking area updating procedure (S1 mode only)


5.5.3.1	General

The tracking area updating procedure is always initiated by the UE and is used for the following purposes:

  -	normal tracking area updating to update the registration of the actual tracking area of a UE in the network;

  -	combined tracking area updating to update the registration of the actual tracking area for a UE in CS/PS mode 1 or CS/PS mode 2 of operation;

  -	periodic tracking area updating to periodically notify the availability of the UE to the network;

  -	IMSI attach for non-EPS services when the UE is attached for EPS services. This procedure is used by a UE in CS/PS mode 1 or CS/PS mode 2 of operation;

  -	in various cases of inter-system change from Iu mode to S1 mode or from A/Gb mode to S1 mode;

  -	in various cases of inter-system change from N1 mode to S1 mode if the UE operates in single-registration mode and as described in 3GPP TS 24.501 [54];

  -	S101 mode to S1 mode inter-system change;

  -	MME load balancing;

  -	to update certain UE specific parameters in the network;

  -	recovery from certain error cases;

  -	to indicate that the UE enters S1 mode after CS fallback or 1xCS fallback;

  -	to indicate to the network that the UE has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG list;

  -	to indicate the current radio access technology to the network for the support of terminating access domain selection for voice calls or voice sessions; and

  -	to indicate to the network that the UE has locally released EPS bearer context(s).

Details on the conditions for the UE to initiate the tracking area updating procedure are specified in subclause 5.5.3.2.2 and subclause 5.5.3.3.2.

While a UE has a PDN connection for emergency bearer services, the UE shall not perform manual CSG selection.

If control plane CIoT EPS optimization is not used by the UE, a UE initiating the tracking area updating procedure in EMM-IDLE mode may request the network to re-establish the radio and S1 bearers for all active EPS bearer contexts during the procedure. If control plane CIoT EPS optimization is used by the UE, a UE initiating the tracking area updating procedure in EMM-IDLE mode may request the network to re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without control plane only indication during the procedure.

In a shared network, the UE shall choose one of the PLMN identities as specified in 3GPP TS 23.122 [6]. The UE shall construct the TAI of the cell from this chosen PLMN identity and the TAC received for this PLMN identity on the broadcast system information. The chosen PLMN identity shall be indicated to the E-UTRAN (see 3GPP TS 36.331 [22]). Whenever a TRACKING AREA UPDATE REJECT message with the EMM cause #11 "PLMN not allowed" is received by the UE, the chosen PLMN identity shall be stored in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. Whenever a TRACKING AREA UPDATE REJECT message with the EMM cause #14 "EPS services not allowed in this PLMN" is received by the UE, the chosen PLMN identity shall be stored in the "forbidden PLMNs for GPRS service". Whenever a TRACKING AREA UPDATE REJECT message is received by the UE with the EMM cause #12 "tracking area not allowed", #13 "roaming not allowed in this tracking area", or #15 "no suitable cells in tracking Area", the constructed TAI shall be stored in the suitable list.

In a shared network, if TRACKING AREA UPDATE REJECT is received as a response to a tracking area update procedure initiated in EMM-CONNECTED mode, the UE need not update forbidden lists.

A tracking area updating attempt counter is used to limit the number of subsequently rejected tracking area update attempts. The tracking area updating attempt counter shall be incremented as specified in subclause 5.5.3.2.6. Depending on the value of the tracking area updating attempt counter, specific actions shall be performed. The tracking area updating attempt counter shall be reset when:

  -	a normal or periodic tracking area updating or a combined tracking area updating procedure is successfully completed;

  -	a normal or periodic tracking area updating or a combined tracking area updating procedure is rejected with EMM cause #11, #12, #13, #14, #15, #25 or #35:

  -	a combined attach procedure or a combined tracking area updating procedure is completed for EPS services only with cause #2 or #18;or

  -	a new PLMN is selected.

Additionally the tracking area updating attempt counter shall be reset when the UE is in substate EMM-REGISTERED.ATTEMPTING-TO-UPDATE or EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, and:

  -	a new tracking area is entered;

  -	timer T3402 expires; or

  -	timer T3346 is started.


5.5.3.2	Normal and periodic tracking area updating procedure


5.5.3.2.1	General

The periodic tracking area updating procedure is controlled in the UE by timer T3412. When timer T3412 expires, the periodic tracking area updating procedure is started. Start and reset of timer T3412 is described in subclause 5.3.5.


5.5.3.2.2	Normal and periodic tracking area updating procedure initiation

The UE in state EMM-REGISTERED shall initiate the tracking area updating procedure by sending a TRACKING AREA UPDATE REQUEST message to the MME,

  a)	when the UE detects entering a tracking area that is not in the list of tracking areas that the UE previously registered in the MME, unless the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] and is entering a tracking area in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs;

  b)	when the periodic tracking area updating timer T3412 expires;

  c)	when the UE enters EMM-REGISTERED.NORMAL-SERVICE and the UE's TIN indicates "P-TMSI";

  d)	when the UE performs an inter-system change from S101 mode to S1 mode and has no user data pending;

  e)	when the UE receives an indication from the lower layers that the RRC connection was released with cause "load balancing TAU required";

  f)	when the UE deactivated EPS bearer context(s) locally while in EMM-REGISTERED, because it could not establish a NAS signalling connection, and then returns to EMM-REGISTERED.NORMAL-SERVICE and no EXTENDED SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST message or DETACH REQUEST message with detach type is "EPS detach" or "combined EPS/IMSI detach" is pending to be sent by the UE;

  g)	when the UE changes the UE network capability information or the MS network capability information or both;

  h)	when the UE changes the UE specific DRX parameter;

  i)	when the UE receives an indication of "RRC Connection failure" from the lower layers and has no signalling or user uplink data pending (i.e when the lower layer requests NAS signalling connection recovery);

  j)	when the UE enters S1 mode after 1xCS fallback or 1xSRVCC;

  k)	when due to manual CSG selection the UE has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG list;

  l)	when the UE reselects an E-UTRAN cell while it was in GPRS READY state or PMM-CONNECTED mode;

  m)	when the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN and changes the mobile station classmark 2 or the supported codecs, or the UE supports SRVCC to GERAN and changes the mobile station classmark 3;

  n)	when the UE changes the radio capability for GERAN, or cdma2000® or both;

  o)	when the UE's usage setting or the voice domain preference for E-UTRAN change in the UE;

  p)	when the UE activates mobility management for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.2, and the TIN indicates "RAT-related TMSI";

  q)	when the UE performs an inter-system change from A/Gb mode to S1 mode and the TIN indicates "RAT-related TMSI", but the UE is required to perform tracking area updating for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.4;

  r)	upon reception of a paging indication using S-TMSI and the UE is in state EMM-REGISTERED.ATTEMPTING-TO-UPDATE;

  s)	when the UE needs to update the network with EPS bearer context status due to local de-activation of EPS bearer context(s) as specified in subclause 6.5.1.4A;

  t)	when the UE needs to request the use of PSM or needs to stop the use of PSM;

  u)	when the UE needs to request the use of eDRX or needs to stop the use of eDRX;

  v)	when a change in the eDRX usage conditions at the UE requires different extended DRX parameters;

  w)	when a change in the PSM usage conditions at the UE requires a different timer T3412 value or different timer T3324 value;

  NOTE 2:	A change in the PSM or eDRX usage conditions at the UE can include e.g. a change in the UE configuration, a change in requirements from upper layers or the battery running low at the UE.

  x)	when the CIoT EPS optimizations the UE needs to use, change in the UE;

  y)	when the Default_DCN_ID value changes, as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17];

  NOTE 3:	The tracking area updating procedure is initiated after deleting the DCN-ID list as specified in annex C.

  z)	when the UE performs inter-system change from N1 mode to S1 mode in EMM-IDLE mode, the UE operates in single-registration mode, and conditions specified in 3GPP TS 24.501 [54] apply;

  za)	when the UE in EMM-IDLE mode changes the radio capability for E-UTRAN;

  zb)	when the UE needs to request new ciphering keys for ciphered broadcast assistance data;

  zc)	when the UE in EMM-IDLE mode changes the radio capability for NG-RAN; or

  zd)	when the UE performs inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode.

For all cases except case b, the UE shall set the EPS update type IE in the TRACKING AREA UPDATE REQUEST message to "TA updating". For case b, the UE shall set the EPS update type IE to "periodic updating".

For cases n, za and zc, the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.

For case l, if the TIN indicates "RAT-related TMSI", the UE shall set the TIN to "P-TMSI" before initiating the tracking area updating procedure.

For case r, the "active" flag in the EPS update type IE shall be set to 1. If a UE is only using EPS services with control plane CIoT EPS optimization, the "signalling active" flag in the Additional update type IE shall be set to 1.

If the UE is using only control plane CIoT EPS optimization, the case i only applies to the case that the UE has indicated to the network that subsequent to the uplink data transmission a downlink data transmission is expected during the transport of uplink user data via the control plane procedure (see subclause 6.6.4).

If the UE has to request resources for ProSe direct discovery or Prose direct communication (see 3GPP TS 36.331 [22]), then the UE shall set the "active" flag to 1 in the TRACKING AREA UPDATE REQUEST message.

If the UE does not have any established PDN connection, the "active" flag in the EPS update type IE shall be set to 0.

When the UE has user data pending and performs an inter-system change from S101 mode to S1 mode to a tracking area included in the TAI list stored in the UE, the UE shall perform a service request procedure instead of a tracking area updating procedure.

When initiating a tracking area updating procedure while in S1 mode, the UE shall use the current EPS NAS integrity key to integrity protect the TRACKING AREA UPDATE REQUEST message, unless the UE is performing inter-system change from N1 mode to S1 mode.

In order to indicate its UE specific DRX parameter while in E-UTRAN coverage, the UE shall send the TRACKING AREA UPDATE REQUEST message containing the UE specific DRX parameter in the DRX parameter IE to the network, with the exception of the case if the UE had indicated its DRX parameter (3GPP TS 24.008 [13]) to the network while in GERAN or UTRAN coverage. In this case, when the UE enters E-UTRAN coverage and initiates a tracking area updating procedure, the UE shall not include the UE specific DRX parameter in the DRX parameter IE in the TRACKING AREA UPDATE REQUEST message.

  NOTE 4:	The UE specific DRX parameter is not used by the E-UTRAN for paging from NB-IoT cells (see 3GPP TS 23.401 [10] and 3GPP TS 36.304 [21]).

If the UE supports eDRX and requests the use of eDRX, the UE shall include the extended DRX parameters IE in the TRACKING AREA UPDATE REQUEST message.

If the UE supports PSM and requests the use of PSM, the UE shall include the T3324 value IE with a requested timer value in the TRACKING AREA UPDATE REQUEST message. When the UE includes the T3324 value IE and the UE indicates support for extended periodic timer value in the MS network feature support IE, it may also include the T3412 extended value IE to request a particular T3412 value to be allocated.

If a UE supporting CIoT EPS optimizations in NB-S1 mode initiates the tracking area updating procedure for EPS services and "SMS only", the UE shall indicate "SMS only" in the Additional update type IE and shall set the EPS update type IE to "TA updating".

If the UE supports S1-U data transfer and multiple user plane radio bearers (see 3GPP TS 36.306 [44], 3GPP TS 36.331 [22]) in NB-S1 mode, then the UE shall set the Multiple DRB support bit to "Multiple DRB supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

If the UE has to request resources for V2X communication over PC5 (see 3GPP TS 23.285 [47]), then the UE shall set the "active" flag to 1 in the TRACKING AREA UPDATE REQUEST message.

After sending the TRACKING AREA UPDATE REQUEST message to the MME, the UE shall start timer T3430 and enter state EMM-TRACKING-AREA-UPDATING-INITIATED (see example in figure 5.5.3.2.2.1). If timer T3402 is currently running, the UE shall stop timer T3402. If timer T3411 is currently running, the UE shall stop timer T3411. If timer T3442 is currently running, the UE shall stop timer T3442.

For all cases except cases z and zd:

  1)	if the UE supports neither A/Gb mode nor Iu mode, the UE shall include a valid GUTI in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. In addition, the UE shall include Old GUTI type IE with GUTI type set to "native GUTI"; or

  2)	if the UE supports A/Gb mode or Iu mode or both, the UE shall handle the Old GUTI IE as follows:

    -	If the TIN indicates "P-TMSI" and the UE holds a valid P-TMSI and RAI, the UE shall map the P-TMSI and RAI into the Old GUTI IE, and include Old GUTI type IE with GUTI type set to "mapped GUTI". If a P-TMSI signature is associated with the P-TMSI, the UE shall include it in the Old P-TMSI signature IE. Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE.

  NOTE 5:	The mapping of the P-TMSI and RAI to the GUTI is specified in 3GPP TS 23.003 [2].

    -	If the TIN indicates "GUTI" or "RAT-related TMSI" and the UE holds a valid GUTI, the UE shall indicate the GUTI in the Old GUTI IE, and include Old GUTI type IE with GUTI type set to "native GUTI".

If a UE has established PDN connection(s) and uplink user data pending to be sent via user plane when it initiates the tracking area updating procedure, or uplink signalling not related to the tracking area updating procedure when the UE does not support control plane CIoT EPS optimization, it may also set an "active" flag in the TRACKING AREA UPDATE REQUEST message to indicate the request to establish the user plane to the network and to keep the NAS signalling connection after the completion of the tracking area updating procedure.

If a UE is using EPS services with control plane CIoT EPS optimization and has user data pending to be sent via control plane over MME but no user data pending to be sent via user plane, or uplink signalling not related to the tracking area updating procedure, the UE may set a "signalling active" flag in the TRACKING AREA UPDATE REQUEST message to indicate the request to keep the NAS signalling connection after the completion of the tracking area updating procedure.

For all cases except cases z and zd, if the UE has a current EPS security context, the UE shall include the eKSI (either KSIASME or KSISGSN) in the NAS Key Set Identifier IE in the TRACKING AREA UPDATE REQUEST message. Otherwise, the UE shall set the NAS Key Set Identifier IE to the value "no key is available". If the UE has a current EPS security context, the UE shall integrity protect the TRACKING AREA UPDATE REQUEST message with the current EPS security context. Otherwise the UE shall not integrity protect the TRACKING AREA UPDATE REQUEST message.

When the tracking area updating procedure is initiated in EMM-IDLE mode to perform an inter-system change from A/Gb mode or Iu mode to S1 mode and the TIN is set to "P-TMSI", the UE shall include the GPRS ciphering key sequence number applicable for A/Gb mode or Iu mode and a nonceUE in the TRACKING AREA UPDATE REQUEST message.

When the tracking area updating procedure is initiated in EMM-CONNECTED mode to perform an inter-system change from A/Gb mode or Iu mode to S1 mode, the UE shall derive the EPS NAS keys from the mapped K'ASME using the selected NAS algorithms, nonceMME and KSISGSN (to be associated with the mapped K'ASME) provided by lower layers as indicated in 3GPP TS 33.401 [19]. The UE shall reset both the uplink and downlink NAS COUNT counters of the mapped EPS security context which shall be taken into use. If the UE has a non-current native EPS security context, the UE shall include the KSIASME in the Non-current native NAS key set identifier IE and its associated GUTI, as specified above, either in the Old GUTI IE or in the Additional GUTI IE of the TRACKING AREA UPDATE REQUEST message. The UE shall set the TSC flag in the Non-current native NAS key set identifier IE to "native security context".

For the case z, the TRACKING AREA UPDATE REQUEST message shall be integrity protected using the 5G NAS security context available in the UE. The UE shall include a GUTI, mapped from 5G-GUTI (see 3GPP TS 23.501 [54] and 3GPP TS 23.003 [2]), in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. In addition, the UE shall include Old GUTI type IE with GUTI set to "Native GUTI", and the UE shall include a UE status IE with a 5GMM registration status set to "UE is in 5GMM-REGISTERED state". Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE.

For the case zd, the TRACKING AREA UPDATE REQUEST message shall be integrity protected using the mapped EPS security context as derived when triggering the handover to E-UTRAN (see subclause 4.4.2.2). The UE shall include a GUTI, mapped from 5G-GUTI (see 3GPP TS 23.501 [54] and 3GPP TS 23.003 [2]), in the Old GUTI IE in the TRACKING AREA UPDATE REQUEST message. In addition, the UE shall include Old GUTI type IE with GUTI set to "Native GUTI", and the UE shall include a UE status IE with a 5GMM registration status set to "UE is in 5GMM-REGISTERED state". Additionally, if the UE holds a valid GUTI, the UE shall indicate the GUTI in the Additional GUTI IE. If the UE has a non-current native EPS security context, the UE shall include the KSIASME in the Non-current native NAS key set identifier IE of the TRACKING AREA UPDATE REQUEST message. The UE shall set the TSC flag in the Non-current native NAS key set identifier IE to "native security context".

When the tracking area updating procedure is initiated in EMM-IDLE mode, the UE may also include an EPS bearer context status IE in the TRACKING AREA UPDATE REQUEST message, indicating which EPS bearer contexts are active in the UE. The UE shall include the EPS bearer context status IE in TRACKING AREA UPDATE REQUEST message:

  -	for the case f;

  -	for the case s;

  -	for the case z; and

  -	if the UE has established PDN connection(s) of "non IP" PDN type.

If the UE initiates the first tracking area updating procedure following an attach in A/Gb mode or Iu mode, the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.

If the UE initiates the first tracking area updating procedure following an initial registration in N1 mode and the UE is operating in the single-registration mode, the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports SRVCC to GERAN/UTRAN, the UE shall set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported".

For all cases except case b, if the UE supports vSRVCC from S1 mode to Iu mode, then the UE shall set the H.245 after handover capability bit in the UE network capability IE to "H.245 after SRVCC handover capability supported" and additionally set the SRVCC to GERAN/UTRAN capability bit in the MS network capability IE to "SRVCC from UTRAN HSPA or E-UTRAN to GERAN/UTRAN supported" in the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports ProSe direct discovery, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe direct discovery bit to "ProSe direct discovery supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports ProSe direct communication, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe direct communication bit to "ProSe direct communication supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports acting as a ProSe UE-to-network relay, then the UE shall set the ProSe bit to "ProSe supported" and set the ProSe UE-to-network relay bit to "acting as a ProSe UE-to-network relay supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

If the UE supports NB-S1 mode, Non-IP PDN type, or N1 mode, then the UE shall support the extended protocol configuration options IE.

For all cases except case b, if the UE supports the extended protocol configuration options IE, then the UE shall set the ePCO bit to "extended protocol configuration options supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports V2X communication over PC5, then the UE shall set the V2X PC5 bit to "V2X communication over PC5 supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports the restriction on use of enhanced coverage, then the UE shall set the RestrictEC bit to "Restriction on use of enhanced coverage supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports the control plane data back-off timer T3448, the UE shall set the CP backoff bit to "backoff timer for transport of user data via the control plane supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports dual connectivity with NR, then the UE shall set the DCNR bit to "dual connectivity with NR supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message and shall include the UE additional security capability IE in the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports SGC, then the UE shall set the SGC bit to "service gap control supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports signalling for a maximum number of 15 EPS bearer contexts, then the UE shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message.

For all cases except cases b and zb, if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys, the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message.

For case ee, the UE shall include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message.

For case a, if the UE supports ciphered broadcast assistance data and the UE detects entering a tracking area for which one or more ciphering keys stored at the UE is not applicable, the UE should include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message.

For case b, if the UE supports ciphered broadcast assistance data and the remaining validity time for one or more ciphering keys stored at the UE is less than timer T3412, the UE should include the Additional information requested IE with the CipherKey bit set to "ciphering keys for ciphered broadcast assistance data requested" in the TRACKING AREA UPDATE REQUEST message.

For all cases except case b, if the UE supports N1 mode, the UE shall set the N1mode bit to "N1 mode supported" in the UE network capability IE of the TRACKING AREA UPDATE REQUEST message and shall include the UE additional security capability IE in the TRACKING AREA UPDATE REQUEST message.

[pic]

Figure 5.5.3.2.2.1: Tracking area updating procedure


5.5.3.2.3	EMM common procedure initiation

If the network receives a TRACKING AREA UPDATE REQUEST message containing the Old GUTI type IE, and the network does not follow the use of the most significant bit of the <MME group id> to distinguish the node type as specified in 3GPP TS 23.003 [2], subclause 2.8.2.2.2, the network shall use the Old GUTI type IE to determine whether the mobile identity included in the Old GUTI IE is a native GUTI or a mapped GUTI.

During the tracking area updating procedure, the MME may initiate EMM common procedures, e.g. the EMM authentication and security mode control procedures.

The MME may be configured to skip the authentication procedure even if no EPS security context is available and proceed directly to the execution of the security mode control procedure as specified in subclause 5.4.3, during a tracking area updating procedure for a UE that has only a PDN connection for emergency bearer services.

The MME shall not initiate an EMM authentication procedure before completion of the tracking area updating procedure, if the following conditions apply:

  a)	the UE initiated the tracking area updating procedure after handover or inter-system handover to S1 mode;

  b)	the target cell is a shared network cell; and

    -	the UE has provided its GUTI in the Old GUTI IE or the Additional GUTI IE in the TRACKING AREA UPDATE REQUEST message, and the PLMN identity included in the GUTI is different from the selected PLMN identity of the target cell; or

    -	the UE has mapped the P-TMSI and RAI into the Old GUTI IE and not included an Additional GUTI IE in the TRACKING AREA UPDATE REQUEST message, and the PLMN identity included in the RAI is different from the selected PLMN identity of the target cell.


5.5.3.2.4	Normal and periodic tracking area updating procedure accepted by the network

If the tracking area update request has been accepted by the network, the MME shall send a TRACKING AREA UPDATE ACCEPT message to the UE. If the MME assigns a new GUTI for the UE, a GUTI shall be included in the TRACKING AREA UPDATE ACCEPT message. In this case, the MME shall start timer T3450 and enter state EMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.4.1. The MME may include a new TAI list for the UE in the TRACKING AREA UPDATE ACCEPT message. The MME shall not assign a TAI list containing both tracking areas in NB-S1 mode and tracking areas in WB-S1 mode.

  NOTE 1:	When assigning the TAI list, the MME can take into account the eNodeB's capability of support of CIoT EPS optimization.

If the UE has included the UE network capability IE or the MS network capability IE or both in the TRACKING AREA UPDATE REQUEST message, the MME shall store all octets received from the UE, up to the maximum length defined for the respective information element.

  NOTE 2:	This information is forwarded to the new MME during inter-MME handover or to the new SGSN during inter-system handover to A/Gb mode or Iu mode.

  NOTE 3:	For further details concerning the handling of the MS network capability and UE network capability in the MME see also 3GPP TS 23.401 [10].

In NB-S1 mode, if the tracking area update request is accepted by the network, the MME shall set the EMC BS bit to zero in the EPS network feature support IE included in the TRACKING AREA UPDATE ACCEPT message to indicate that support of emergency bearer services in NB-S1 mode is not available.

If a UE radio capability information update needed IE is included in the TRACKING AREA UPDATE REQUEST message, the MME shall delete the stored UE radio capability information, if any.

If the UE specific DRX parameter was included in the DRX Parameter IE in the TRACKING AREA UPDATE REQUEST message, the network shall replace any stored UE specific DRX parameter with the received parameter and use it for the downlink transfer of signalling and user data.

If the UE requests "control plane CIoT EPS optimization" in the Additional update type IE, indicates support of control plane CIoT EPS optimization in the UE network capability IE and the MME decides to accept the requested CIoT EPS optimization and the tracking area update request, the MME shall indicate "control plane CIoT EPS optimization supported" in the EPS network feature support IE.

In NB-S1 mode, if the UE requested "SMS only" in the Additional update type IE, supports NB-S1 mode only and the MME decides to accept the tracking area update request for EPS services and "SMS only", the MME shall indicate "SMS only" in the Additional update result IE and shall set the EPS update type IE to "TA updating" in the TRACKING AREA UPDATE ACCEPT message.

The MME shall include the extended DRX parameters IE in the TRACKING AREA UPDATE ACCEPT message only if the extended DRX parameters IE was included in the TRACKING AREA UPDATE REQUEST message, and the MME supports and accepts the use of eDRX.

If the UE indicates support for EMM-REGISTERED without PDN connection in the TRACKING AREA UPDATE REQUEST message and the MME supports EMM-REGISTERED without PDN connection, the MME shall indicate this in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message. The UE and the MME shall use the information whether the peer entity supports EMM-REGISTERED without PDN connection as specified in the present clause 5 and in clause 6.

If an EPS bearer context status IE is included in the TRACKING AREA UPDATE REQUEST message, the MME shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the MME and the UE) which are in ESM state BEARER CONTEXT ACTIVE or BEARER CONTEXT MODIFY PENDING on the network side, but are indicated by the UE as being in ESM state BEARER CONTEXT INACTIVE. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the TRACKING AREA UPDATE REQUEST message, and this default bearer is not associated with the last remaining PDN connection of the UE in the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.

If the EPS bearer context status IE is included in the TRACKING AREA UPDATE REQUEST, the MME shall include an EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message, indicating which EPS bearer contexts are active in the MME except for the case no EPS bearer context exists on the network side.

If the EPS update type IE included in the TRACKING AREA UPDATE REQUEST message indicates "periodic updating", and the UE was previously successfully attached for EPS and non-EPS services, subject to operator policies the MME should allocate a TAI list that does not span more than one location area.

The MME shall indicate "combined TA/LA updated" or "combined TA/LA updated and ISR activated" in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message, if the following conditions apply:

  -	the EPS update type IE included in the TRACKING AREA UPDATE REQUEST message indicates "periodic updating" and the UE was previously successfully attached for EPS and non-EPS services; and

  -	location area updating for non-EPS services as specified in 3GPP TS 29.118 [16A] is successful.

The MME may include T3412 extended value IE in the TRACKING AREA UPDATE ACCEPT message only if the UE indicates support of the extended periodic timer T3412 in the MS network feature support IE in the TRACKING AREA UPDATE REQUEST message.

The MME shall include the T3324 value IE in the TRACKING AREA UPDATE ACCEPT message only if the T3324 value IE was included in the TRACKING AREA UPDATE REQUEST message, and the MME supports and accepts the use of PSM.

If the MME supports and accepts the use of PSM, and the UE included the T3412extended value IE in the TRACKING AREA UPDATE REQUEST message, then the MME shall take into account the T3412 value requested when providing the T3412 value IE and the T3412 extended value IE in the TRACKING AREA UPDATE ACCEPT message.

  NOTE 4:	Besides the value requested by the MS, the MME can take local configuration or subscription data provided by the HSS into account when selecting a value for T3412 (see 3GPP TS 23.401 [10] subclause 4.3.17.3).

If the MME includes the T3324 value IE indicating a value other than deactivated in the TRACKING AREA UPDATE ACCEPT message, then the MME shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated.

Also during the tracking area updating procedure without "active" flag, if the MME has deactivated EPS bearer context(s) locally for any reason, the MME shall inform the UE of the deactivated EPS bearer context(s) by including the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message.

Also during the tracking area updating procedure with "active" flag, if the MME has deactivated EPS bearer context(s) associated with control plane only indication locally for any reason, the MME shall inform the UE of the deactivated EPS bearer context(s) by including the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message.

If the TRACKING AREA UPDATE ACCEPT message contains the DCN-ID IE, then the UE shall store the included DCN-ID value together with the PLMN code of the registered PLMN in a DCN-ID list in a non-volatile memory in the ME as specified in annex C.

If due to regional subscription restrictions or access restrictions the UE is not allowed to access the TA, but it has a PDN connection for emergency bearer services established, the MME may accept the TRACKING AREA UPDATE REQUEST message and deactivate all non-emergency EPS bearer contexts by initiating an EPS bearer context deactivation procedure when the tracking area updating procedure is initiated in EMM-CONNECTED mode. When the tracking area updating procedure is initiated in EMM-IDLE mode, the MME locally deactivates all non-emergency EPS bearer contexts and informs the UE via the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message. The MME shall not deactivate the emergency EPS bearer contexts. The network shall consider the UE to be attached for emergency bearer services only and shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated.

If a TRACKING AREA UPDATE REQUEST message is received from a UE with a LIPA PDN connection, and if:

  -	a GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the P-GW address included in the EPS bearer context of the LIPA PDN Connection is different from the provided GW Transport Layer Address IE value (see 3GPP TS 36.413 [23]); or

  -	no GW Transport Layer Address is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,

then the MME locally deactivates all EPS bearer contexts associated with the LIPA PDN connection. Furthermore, the MME takes one of the following actions:

  -	if no active EPS bearer contexts remain for the UE, the MME shall not accept the tracking area update request as specified in subclause 5.5.3.2.5;

  -	if active EPS bearer contexts remain for the UE and the TRACKING AREA UPDATE REQUEST message is accepted, the MME informs the UE via the EPS bearer context status IE in the TRACKING AREA UPDATE ACCEPT message that EPS bearer contexts were locally deactivated.

If a TRACKING AREA UPDATE REQUEST message is received from a UE with a SIPTO at the local network PDN connection, is accepted by the network, the following different cases can be distinguished:

  1)	If the PDN connection is a SIPTO at the local network PDN connection with collocated L-GW and if:

    -	a SIPTO L-GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the P-GW address included in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided SIPTO L-GW Transport Layer Address IE value (see 3GPP TS 36.413 [23]); or

    -	no SIPTO L-GW Transport Layer Address is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,

  2)	If the PDN connection is a SIPTO at the local network PDN connection with stand-alone GW and if:

    -	a LHN-ID value is provided by the lower layer together with the TRACKING AREA UPDATE REQUEST message, and the LHN-ID stored in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided LHN-ID value (see 3GPP TS 36.413 [23]); or

    -	no LHN-ID value  is provided together with the TRACKING AREA UPDATE REQUEST message by the lower layer,

then the MME takes one of the following actions:

  -	if the SIPTO at the local network PDN connection is the last remaining PDN connection for the UE, and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, then the MME shall upon completion of the tracking area updating procedure detach the UE by using detach type "re-attach required" (see subclause 5.5.2.3.1);

  -	if the SIPTO at the local network PDN connection is the last remaining PDN connection for the UE, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, then the MME shall upon completion of the tracking area updating procedure initiate an EPS bearer context deactivation procedure with ESM cause #39 "reactivation requested"for the default EPS bearer context of the SIPTO at the local network PDN connection (see subclause 6.4.4.2); and

  -	if a PDN connection remains that is not SIPTO at the local network PDN connection, the MME shall upon completion of the tracking area updating procedure initiate an EPS bearer context deactivation procedure with ESM cause #39 "reactivation requested"for the default EPS bearer context of each SIPTO at the local network PDN connection (see subclause 6.4.4.2);

For a SIPTO at the local network PDN connection with stand-alone GW, the conditions to deactivate ISR are specified in 3GPP TS 23.401 [10], subclause 4.3.5.6.

For a shared network, the TAIs included in the TAI list can contain different PLMN identities. The MME indicates the selected core network operator PLMN identity to the UE in the GUTI (see 3GPP TS 23.251 [8B]).

If the "active" flag is included in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is not used by the MME, the MME shall re-establish the radio and S1 bearers for all active EPS bearer contexts. If the "active" flag is included in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME shall re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without Control plane only indication.

If the "signalling active" flag is included in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME shall not immediately release the NAS signalling connection after the completion of the tracking area updating procedure.

If the "active" flag is not included in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is not used by the MME, the MME may also re-establish the radio and S1 bearers for all active EPS bearer contexts due to downlink pending data or downlink pending signalling. If the "active" flag is not included in the TRACKING AREA UPDATE REQUEST message and control plane CIoT EPS optimization is used by the MME, the MME may also re-establish the radio and S1 bearers for all active EPS bearer contexts associated with PDN connections established without Control plane only indication due to downlink pending data or downlink pending signalling.

If the MME supports NB-S1 mode, Non-IP PDN type, or inter-system change with 5GS, then the MME shall support the extended protocol configuration options IE.

If the MME supports the extended protocol configuration options IE and the UE indicated support of the extended protocol configuration options IE, then the MME shall set the ePCO bit to "extended protocol configuration options supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.

If the UE indicates support for restriction on use of enhanced coverage in the TRACKING AREA UPDATE REQUEST message, and the network decides to restrict the use of enhanced coverage for the UE, then the MME shall set the RestrictEC bit to "Use of enhanced coverage is restricted" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.

The MME may indicate the header compression configuration status IE in the TRACKING AREA UPDATE ACCEPT message for each established EPS bearer context using control plane CIoT EPS optimisation.

If the UE has indicated support for the control plane data back-off timer, and the MME decides to activate the congestion control for transport of user data via the control plane, then the MME shall include the T3448 value IE in the TRACKING AREA UPDATE ACCEPT message.

If the UE indicates support for dual connectivity with NR in the TRACKING AREA UPDATE REQUEST message, and the MME decides to restrict the use of dual connectivity with NR for the UE, then the MME shall set the RestrictDCNR bit to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.

If the UE indicates support for N1 mode in the TRACKING AREA UPDATE REQUEST message and the MME supports inter-system interworking with 5GS, the MME may set the IWK N26 bit to either:

  -	"interworking without N26 not supported" if the MME supports N26 interface; or

  -	"interworking without N26 supported" if the MME does not support N26 interface

in the EPS network feature support IE in the TRACKING AREA UPDATE ACCEPT message.

If due to operator policies unsecured redirection to a GERAN cell is not allowed in the current PLMN, the MME shall set the redir-policy bit to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the TRACKING AREA UPDATE ACCEPT message.

If the UE has indicated support for service gap control, a service gap time value is available in the EMM context, the MME may include the T3447 value IE set to the service gap time value in the TRACKING AREA UPDATE ACCEPT message.

If the network supports signalling for a maximum number of 15 EPS bearer contexts and the UE indicated support of signalling for a maximum number of 15 EPS bearer contexts in the TRACKING AREA UPDATE REQUEST message, then the MME shall set the 15 bearers bit to "Signalling for a maximum number of 15 EPS bearer contexts supported" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message.

If the UE requests ciphering keys for ciphered broadcast assistance data in the TRACKING AREA UPDATE REQUEST message and the MME has valid ciphering key data applicable to the UE's subscription, then the MME shall include the ciphering key data in the Ciphering key data IE of the TRACKING AREA UPDATE ACCEPT message.

Upon receiving a TRACKING AREA UPDATE ACCEPT message, the UE shall stop timer T3430, reset the service request attempt counter, tracking area updating attempt counter, enter state EMM-REGISTERED and set the EPS update status to EU1 UPDATED. If the message contains a GUTI, the UE shall use this GUTI as new temporary identity for EPS services and shall store the new GUTI. If no GUTI was included by the MME in the TRACKING AREA UPDATE ACCEPT message, the old GUTI shall be used. If the UE receives a new TAI list in the TRACKING AREA UPDATE ACCEPT message, the UE shall consider the new TAI list as valid and the old TAI list as invalid; otherwise, the UE shall consider the old TAI list as valid.

If the UE receives the TRACKING AREA UPDATE ACCEPT message from a PLMN for which a PLMN-specific attempt counter or PLMN-specific PS-attempt counter is maintained (see subclause 5.3.7b), then the UE shall reset these counters. If the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall reset this counter.

If the TRACKING AREA UPDATE ACCEPT message contains the T3412 extended value IE, then the UE shall use the T3412 extended value IE as periodic tracking area update timer (T3412). If the TRACKING AREA UPDATE ACCEPT contains T3412 value IE, but not T3412 extended value IE, then the UE shall use value in T3412 value IE as periodic tracking area update timer (T3412). If neither T3412 value IE nor T3412 extended value IE is included, the UE shall use the value currently stored, e.g. from a prior ATTACH ACCEPT or TRACKING AREA UPDATE ACCEPT message.

If the TRACKING AREA UPDATE ACCEPT message contains the T3324 value IE, then the UE shall use the timer value for T3324 as specified in 3GPP TS 24.008 [13], subclause 4.7.2.8.

If the UE had initiated the tracking area updating procedure in EMM-IDLE mode to perform an inter-system change from A/Gb mode or Iu mode to S1 mode and the nonceUE was included in the TRACKING AREA UPDATE REQUEST message, the UE shall delete the nonceUE upon receipt of the TRACKING AREA UPDATE ACCEPT message.

If an EPS bearer context status IE is included in the TRACKING AREA UPDATE ACCEPT message, the UE shall deactivate all those EPS bearers contexts locally (without peer-to-peer signalling between the UE and the MME) which are active in the UE, but are indicated by the MME as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the TRACKING AREA UPDATE ACCEPT message, and this default bearer is not associated with the last remaining PDN connection in the UE, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME. If only the PDN connection for emergency bearer services remains established, the UE shall consider itself attached for emergency bearer services only. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.

If an EPS bearer context status IE is included in the TRACKING AREA UPDATE ACCEPT message, the UE may choose to ignore all those EPS bearers which are indicated by the MME as being active but are inactive at the UE.

The MME may also include a list of equivalent PLMNs in the TRACKING AREA UPDATE ACCEPT message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall store the list as provided by the network, and if there is no PDN connection for emergency bearer services established, the UE shall remove from the list any PLMN code that is already in the list of "forbidden PLMNs" or in the list of "forbidden PLMNs for GPRS service". If the UE is not attached for emergency bearer services and there is a PDN connection for emergency bearer services established, the UE shall remove from the list of equivalent PLMNs any PLMN code present in the list of forbidden PLMNs or in the list of "forbidden PLMNs for GPRS service" when the PDN connection for emergency bearer services is released. In addition, the UE shall add to the stored list the PLMN code of the registered PLMN that sent the list. The UE shall replace the stored list on each receipt of the TRACKING AREA UPDATE ACCEPT message. If the TRACKING AREA UPDATE ACCEPT message does not contain a list, then the UE shall delete the stored list.

If the UE is not attached for emergency bearer services and if the PLMN identity of the registered PLMN is a member of the list of "forbidden PLMNs" or the list of "forbidden PLMNs for GPRS service", any such PLMN identity shall be deleted from the corresponding list(s).

The network may also indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is active. If the UE is attached for emergency bearer services, the network shall indicate in the EPS update result IE in the TRACKING AREA UPDATE ACCEPT message that ISR is not activated. If the TRACKING AREA UPDATE ACCEPT message contains:

  i)	no indication that ISR is activated, the UE shall set the TIN to "GUTI" and shall stop the periodic routing area update timer T3312 or T3323, if running;

  ii)	an indication that ISR is activated, then:

    -	if the UE is required to perform routing area updating for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.5, the UE shall set the TIN to "GUTI" and shall stop the periodic routing area update timer T3312 or T3323, if running;

    -	if the UE had initiated the tracking area updating procedure due to a change in UE network capability or change in DRX parameters, the UE shall set the TIN to "GUTI" and shall stop the periodic routing area update timer T3312 or T3323, if running;

    -	if the UE had initiated the tracking area updating procedure due to a change in the UE's usage setting or the voice domain preference for E-UTRAN, the UE shall set the TIN to "GUTI" and shall stop the periodic routing area update timer T3312 or T3323, if running; or

    -	the UE shall regard a previously assigned P-TMSI and RAI as valid and registered with the network. If the TIN currently indicates "P-TMSI" and the periodic routing area update timer T3312 is running or is deactivated, the UE shall set the TIN to "RAT-related TMSI". If the TIN currently indicates "P-TMSI" and the periodic routing area update timer T3312 has already expired, the UE shall set the TIN to "GUTI".

The network informs the UE about the support of specific features, such as IMS voice over PS session, location services (EPC-LCS, CS-LCS), emergency bearer services, or CIoT EPS optimizations, in the EPS network feature support information element. In a UE with IMS voice over PS capability, the IMS voice over PS session indicator and the emergency bearer services indicator shall be provided to the upper layers. The upper layers take the IMS voice over PS session indicator into account as specified in 3GPP TS 23.221 [8A], subclause 7.2a and subclause 7.2b, when selecting the access domain for voice sessions or calls. When initiating an emergency call, the upper layers also take both the IMS voice over PS session indicator and the emergency bearer services indicator into account for the access domain selection. When the UE determines via the IMS voice over PS session indicator that the network does not support IMS voice over PS sessions in S1 mode, then the UE shall not locally release any persistent EPS bearer context. When the UE determines via the emergency bearer services indicator that the network does not support emergency bearer services in S1 mode, then the UE shall not locally release any emergency EPS bearer context if there is a radio bearer associated with that context. In a UE with LCS capability, location services indicators (EPC-LCS, CS-LCS) shall be provided to the upper layers. When MO-LR procedure is triggered by the UE's application, those indicators are taken into account as specified in 3GPP TS 24.171 [13C].

If the RestrictDCNR bit is set to "Use of dual connectivity with NR is restricted" in the EPS network feature support IE of the TRACKING AREA UPDATE ACCEPT message, the UE shall provide the indication that dual connectivity with NR is restricted to the upper layers.

The UE supporting N1 mode shall operate in the mode for inter-system interworking with 5GS as follows:

  -	if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface not supported", the UE shall operate in single-registration mode;

  -	if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" and the UE supports dual-registration mode, the UE may operate in dual-registration mode; or

  NOTE:	The registration mode used by the UE is implementation dependent.

  -	if the IWK N26 bit in the EPS network feature support IE is set to "interworking without N26 interface supported" and the UE only supports single-registration mode, the UE shall operate in single-registration mode.

The UE shall treat the interworking without N26 interface indicator as valid in the entire PLMN and equivalent PLMNs. The interworking procedures required for coordination between 5GMM and EMM without N26 interface are specified in 3GPP TS 24.501 [54].

If the redir-policy bit is set to "Unsecured redirection to GERAN not allowed" in the Network policy IE of the TRACKING AREA UPDATE ACCEPT message, the UE shall set the network policy on unsecured redirection to GERAN for the current PLMN to "Unsecured redirection to GERAN not allowed" and indicate to the lower layers that unsecured redirection to a GERAN cell is not allowed. If the redir-policy bit is set to "Unsecured redirection to GERAN allowed" or if the Network policy IE is not included in the TRACKING AREA UPDATE ACCEPT message, the UE shall set the network policy on unsecured redirection to GERAN for the current PLMN to "Unsecured redirection to GERAN allowed" and indicate to the lower layers that unsecured redirection to a GERAN cell is allowed. The UE shall set the network policy on unsecured redirection to GERAN to "Unsecured redirection to GERAN not allowed" and indicate this to the lower layers when any of the following events occurs:

  -	the UE initiates an EPS attach or tracking area updating procedure in a PLMN different from the PLMN where the UE performed the last successful EPS attach or tracking area updating procedure;

  -	the UE is switched on; or

  -	the UICC containing the USIM is removed.

If the UE has initiated the tracking area updating procedure due to manual CSG selection and receives a TRACKING AREA UPDATE ACCEPT message, and the UE sent the TRACKING AREA UPDATE REQUEST message in a CSG cell, the UE shall check if the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list. If not, the UE shall add that CSG ID and associated PLMN identity to the Allowed CSG list and the UE may add the HNB Name (if provided by lower layers) to the Allowed CSG list if the HNB Name is present in neither the Operator CSG list nor the Allowed CSG list.

If the TRACKING AREA UPDATE ACCEPT message contained a GUTI, the UE shall return a TRACKING AREA UPDATE COMPLETE message to the MME to acknowledge the received GUTI.

If the UE which was previously successfully attached for EPS and non-EPS services receives the TRACKING AREA UPDATE ACCEPT message with EPS update result IE indicating "combined TA/LA updated" or "combined TA/LA updated and ISR activated" as the response of the TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating "periodic updating", the UE shall behave as follows:

  -	If the TRACKING AREA UPDATE ACCEPT message contains an IMSI, the UE is not allocated any TMSI, and shall delete any old TMSI accordingly.

  -	If the TRACKING AREA UPDATE ACCEPT message contains a TMSI, the UE shall use this TMSI as new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. In this case, a TRACKING AREA UPDATE COMPLETE message is returned to the network to confirm the received TMSI.

  -	If neither a TMSI nor an IMSI has been included by the network in the TRACKING AREA UPDATE ACCEPT message, the old TMSI, if any is available, shall be kept.

If the header compression configuration status is included in the TRACKING AREA UPDATE ACCEPT message, the UE shall stop using header compression and decompression for those EPS bearers using Control plane CIoT EPS optimisation for which the MME indicated that the header compression configuration is not used.

If the T3448 value IE is present in the received TRACKING AREA UPDATE ACCEPT message, the UE shall:

  -	stop timer T3448 if it is running; and

  -	start timer T3448 with the value provided in the T3448 value IE.

If the UE is using EPS services with control plane CIoT EPS optimization, the T3448 value IE is present in the TRACKING AREA UPDATE ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present.

  If the UE in EMM-IDLE mode initiated the tracking area update procedure and the TRACKING AREA UPDATE ACCEPT message does not include the T3448 value IE and if timer T3448 is running, then the UE shall stop timer T3448.

If the UE has indicated "service gap control supported" in the TRACKING AREA UPDATE REQUEST message and:

  -	the TRACKING AREA UPDATE ACCEPT message contains the T3447 value IE, then the UE shall store the new T3447 value, erase any previous stored T3447 value if exists and use the the new T3447 value with the T3447 timer next time it is started; or

  -	the TRACKING AREA UPDATE ACCEPT message does not contain the T3447 value IE, then the UE shall erase any previous stored T3447 value if exists and stop the T3447 timer if running.

Upon receiving a TRACKING AREA UPDATE COMPLETE message, the MME shall stop timer T3450 and change to state EMM-REGISTERED. The GUTI, if sent in the TRACKING AREA UPDATE ACCEPT message, shall be considered as valid.

  NOTE 5:	Upon receiving a TRACKING AREA UPDATE COMPLETE message, if a new TMSI was included in the TRACKING AREA UPDATE ACCEPT message, the MME sends an SGsAP-TMSI-REALLOCATION-COMPLETE message as specified in 3GPP TS 29.118 [16A].

For inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode, if the UE has included an eKSI in the NAS Key Set Identifier IE indicating a current EPS security context in the TRACKING AREA UPDATE REQUEST message by which the TRACKING AREA UPDATE REQUEST message is integrity protected, the MME shall take one of the following actions:

  -	if the MME retrieves the current EPS security context as indicated by the eKSI and GUTI sent by the UE, the MME shall integrity check the TRACKING AREA UPDATE REQUEST message using the current EPS security context and integrity protect the TRACKING AREA UPDATE ACCEPT message using the current EPS security context;

  -	if the MME cannot retrieve the current EPS security context as indicated by the eKSI and GUTI sent by the UE, and if the UE has included a valid GPRS ciphering key sequence number, the MME shall create a new mapped EPS security context as specified in 3GPP TS 33.401 [19], and then perform a security mode control procedure to indicate the use of the new mapped EPS security context to the UE (see subclause 5.4.3.2); or

  -	if the UE has not included an Additional GUTI IE, the MME may treat the TRACKING AREA UPDATE REQUEST message as in the previous item, i.e. as if it cannot retrieve the current EPS security context.

  NOTE 6:	The handling described above at failure to retrieve the current EPS security context or if no Additional GUTI IE was provided does not preclude the option for the MME to perform an EPS authentication procedure and create a new native EPS security context.

For inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-IDLE mode, if the UE has not included a valid eKSI in the NAS Key Set Identifier IE and has included a valid GPRS ciphering key sequence number in the TRACKING AREA UPDATE REQUEST message, the MME shall create a new mapped EPS security context as specified in 3GPP TS 33.401 [19], and then perform a security mode control procedure to indicate the use of the new mapped EPS security context to the UE (see subclause 5.4.3.2).

  NOTE 7:	This does not preclude the option for the MME to perform an EPS authentication procedure and create a new native EPS security context.

For inter-system change from N1 mode to S1 mode in EMM-IDLE mode, if the UE has included an eKSI in the NAS Key Set Identifier IE indicating a 5G NAS security context in the TRACKING AREA UPDATE REQUEST message by which the TRACKING AREA UPDATE REQUEST message is integrity protected, the MME shall take actions as specified in subclause 4.4.2.3.

For inter-system change from N1 mode to S1 mode in EMM-IDLE mode, if the UE has not included a valid eKSI in the NAS Key Set Identifier IE and the MME can retrieve a valid native EPS security context as indicated by GUTI included in the Additional GUTI IE sent by the UE, the MME shall perform a security mode control procedure to indicate the use of the native EPS security context to the UE.

  NOTE 8:	This does not preclude the option for the MME to perform an EPS authentication procedure and create a new native EPS security context.

For inter-system change from A/Gb mode to S1 mode or Iu mode to S1 mode in EMM-CONNECTED mode, the MME shall integrity check TRACKING AREA UPDATE REQUEST message using the current K'ASME as derived when triggering the handover to E-UTRAN (see subclause 4.4.2.2). The MME shall verify the received UE security capabilities in the TRACKING AREA UPDATE REQUEST message. The MME shall then take one of the following actions:

  -	if the TRACKING AREA UPDATE REQUEST does not contain a valid KSIASME in the Non-current native NAS key set identifier IE, the MME shall remove the non-current native EPS security context, if any, for any GUTI for this UE. The MME shall then integrity protect and cipher the TRACKING AREA UPDATE ACCEPT message using the security context based on K'ASME and take the mapped EPS security context into use; or

  -	if the TRACKING AREA UPDATE REQUEST contains a valid KSIASME in the Non-current native NAS key set identifier IE, the MME may initiate a security mode control procedure to take the corresponding native EPS security context into use.

For inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode, the MME shall integrity check TRACKING AREA UPDATE REQUEST message using the current K'ASME as derived when triggering the handover to E-UTRAN (see subclause 4.4.2.2). The MME shall verify the received UE security capabilities in the TRACKING AREA UPDATE REQUEST message. The MME shall then take one of the following actions:

  -	if the TRACKING AREA UPDATE REQUEST does not contain a valid KSIASME in the Non-current native NAS key set identifier IE, the MME shall remove the non-current native EPS security context, if any, for any GUTI for this UE. The MME shall then integrity protect and cipher the TRACKING AREA UPDATE ACCEPT message using the security context based on K'ASME and take the mapped EPS security context into use; or

  -	if the TRACKING AREA UPDATE REQUEST contains a valid KSIASME in the Non-current native NAS key set identifier IE, the MME may initiate a security mode control procedure to take the corresponding native EPS security context into use.


5.5.3.2.4A	Tracking area updating successful for EPS services and not accepted for SMS services

Apart from the actions on the tracking area updating attempt counter, the description for tracking area update for EPS services as specified in subclause 5.5.3.2.4 shall be followed. In addition, the following description for tracking area updating for SMS services applies.

In NB-S1 mode, if the UE requested "SMS only" in the Additional update type IE and supports NB-S1 mode only, the MME decides to accept the tracking area update request for EPS services only and:

  -	the location update for non-EPS services is not accepted by the VLR as specified in 3GPP TS 29.118 [16A]; or

  -	the MME decides to not accept the tracking area update request for "SMS only",

the MME shall set the EPS update result IE to "EPS only", shall not indicate "SMS only" in the Additional update result IE in the TRACKING AREA UPDATE ACCEPT message and shall include an appropriate SMS services status value.

The UE receiving the TRACKING AREA UPDATE ACCEPT message takes one of the following actions depending on the value included in the SMS services status IE:

  "SMS services not available"

       	The UE shall stop timer T3430 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. The USIM shall be considered as invalid for SMS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a.

  "SMS services not available in this PLMN"

       	The UE shall stop timer T3430 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.

       	The UE may provide a notification to the user or the upper layers that the SMS services are not available.

       	The UE shall not attempt normal attach or tracking area update procedure indicating "SMS only" with current PLMN until switching off the UE or the UICC containing the USIM is removed. Additionally, the UE may perform a PLMN selection according to 3GPP TS 23.122 [6].

  "Network failure"

       	The UE shall stop timer T3430 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.

       	If the tracking area updating attempt counter is less than 5:

       -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.

       	If the tracking area updating attempt counter is equal to 5:

       -	the UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.

  "Congestion"

       	The UE shall stop the timer T3430 if still running. The tracking area updating attempt counter shall be set to 5. The UE shall start the timer T3402, shall set the EPS update status to EU1 UPDATED, and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered.

Other values and the case that no SMS services status IE was received are considered as abnormal cases. The tracking area update procedure shall be considered as failed for SMS services. The behaviour of the UE in those cases is specified in subclause 5.5.3.2.6A.


5.5.3.2.5	Normal and periodic tracking area updating procedure not accepted by the network

If the tracking area updating cannot be accepted by the network, the MME sends a TRACKING AREA UPDATE REJECT message to the UE including an appropriate EMM cause value.

If a tracking area update request from a UE with a LIPA PDN connection is not accepted due to the reasons specified in subclause 5.5.3.2.4, the MME shall send the TRACKING AREA UPDATE REJECT message with EMM cause value #10 "Implicitly detached".

If the tracking area update request is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a back-off timer T3346.

If the tracking area request is rejected due to service gap control as specified in subclause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.

If the tracking area update request is rejected due to incompatibility between the CIoT EPS optimizations supported by the UE and what the network supports and the network sets the EMM cause value to #15 "no suitable cells in tracking area", the network may additionally include the Extended EMM cause IE with value "requested EPS optimization not supported".

  NOTE:	How the UE uses the Extended EMM cause IE with value "requested EPS optimization not supported" is implementation specific. The UE still behaves according to the EMM cause value #15.

If the UE initiated the tracking area updating procedure due to inter-system change from N1 mode to S1 mode, and the MME does not support N26 interface, the MME shall send a TRACKING AREA UPDATE REJECT message with EMM cause value #9 "UE identity cannot be derived by the network".

Upon receiving the TRACKING AREA UPDATE REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3430 and stop any transmission of user data.

If the TRACKING AREA UPDATE REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.

The UE shall take the following actions depending on the EMM cause value received in the TRACKING AREA UPDATE REJECT message.

  #3	(Illegal UE);

  #6	(Illegal ME); or

  #8	(EPS services and non-EPS services not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  NOTE 3:	The possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.

  #7	(EPS services not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	If the EPS update type is "periodic updating", a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, which is IMSI attached for non-EPS services, is still IMSI attached for non-EPS services. The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and shall proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #9	(UE identity cannot be derived by the network);

    	The UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.

    	If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall subsequently, automatically initiate the attach procedure.

  NOTE 4:	User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in the single-registration mode, the UE shall handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #10	(Implicitly detached);

    	If the EPS update type is "periodic updating", a UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.

    	The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall then perform a new attach procedure.

  NOTE 5:	User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #11	(PLMN not allowed); or

  #35	(Requested service option not authorized in this PLMN);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter, delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.

    	The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

    	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value and no RR connection exists.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #12	(Tracking area not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service".

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #13	(Roaming not allowed in this tracking area);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete the list of equivalent PLMNs. The UE shall reset the tracking area updating attempt counter and shall change to state EMM-REGISTERED.PLMN-SEARCH.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and shall remove the current TAI from the stored TAI list if present.

    	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #14	(EPS services not allowed in this PLMN);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). Furthermore, the UE shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.

    	The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

    	If the EPS update type is "TA updating", or the EPS update type is "periodic updating" and the UE is in PS mode 1 or PS mode 2 of operation, the UE shall perform a PLMN selection according to 3GPP TS 23.122 [6]. In this case, the UE supporting S1 mode only shall delete the list of equivalent PLMNs before performing the procedure.

    	If the EPS update type is "periodic updating", a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation, which is IMSI attached for non-EPS services, is still IMSI attached for non-EPS services and shall proceed as follows:

    -	a UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED;

    -	a UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see subclause 4.5);

    -	a UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP TS 23.122 [6];

    -	a UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

  #15	(No suitable cells in tracking area);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and shall remove the current TAI from the stored TAI list if present and:

    -	if the UE is in WB-S1 mode and the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the TRACKING AREA UPDATE REJECT message, the UE supports "E-UTRA Disabling for EMM cause #15", and the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in subclause 4.5 and search for a suitable cell in another location area or 5GS tracking area;

    -	if the UE is in NB-S1 mode and the Extended EMM cause IE with value "NB-IoT not allowed" is included in the TRACKING AREA UPDATE REJECT message, then the UE may disable the NB-IoT capability as specified in subclause 4.9 and search for a suitable cell in E-UTRAN radio access technology;

    -	otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #22	(Congestion);

    	If the T3346 value IE is present in the TRACKING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.3.2.6.

    	The UE shall abort the tracking area updating procedure, reset the tracking area updating attempt counter and set the EPS update status to EU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

    	The UE shall stop timer T3346 if it is running.

    	If the TRACKING AREA UPDATE REJECT message is integrity protected, the UE shall start timer with the value provided in the T3346 value IE.

    	If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].

    	The UE stays in the current serving cell and applies the normal cell reselection process. The tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #25	(Not authorized for this CSG);

    	EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.3.2.6.

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

    	If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.

    	If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] subclause 3.1A.

    	The UE shall search for a suitable cell according to 3GPP TS 36.304 [21].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause with the same value.

  #40	(No EPS bearer context activated);

    	The UE shall deactivate all the EPS bearer contexts locally, if any, and shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall perform a new attach procedure.

  NOTE 6:	User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the normal routing area updating procedure is rejected with the GMM cause value #10 "Implicitly detached".

  #42	(Severe network failure);

    	The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, eKSI, and list of equivalent PLMNs, and set the tracking area update counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.

Other values are considered as abnormal cases. The specification of the UE behaviour in those cases is described in subclause 5.5.3.2.6.


5.5.3.2.5A	Tracking area updating procedure for initiating a PDN connection for emergency bearer services not accepted by the network

If the tracking area updating request for initiating a PDN connection for emergency bearer services cannot be accepted by the network, the UE shall perform the procedures as described in subclause 5.5.3.2.5. Then if the UE is in the same selected PLMN where the last tracking area updating request was attempted, the UE shall:

  a)	inform the upper layers of the failure of the procedure; or

  NOTE 1:	This can result in the upper layers establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.

  b)	detach locally, if not detached already, attempt EPS attach for emergency bearer services.

If the tracking area updating request for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in subclause 5.5.3.2.6, the UE shall perform the actions as described in subclause 5.5.3.2.6 and inform the upper layers of the failure to access the network.

  NOTE 2:	This can result in the upper layers establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.

If the tracking area updating request for initiating a PDN connection for emergency bearer services fails due to abnormal cases b), c) or d) in subclause 5.5.3.2.6, the UE shall perform the procedures as described in subclause 5.5.3.2.6. Then if the UE is in the same selected PLMN where the last tracking area updating request was attempted, the UE shall:

  a)	inform the upper layers of the failure of the procedure; or

  NOTE 3:	This can result in the upper layers establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.

  b)	detach locally, if not detached already, attempt EPS attach for emergency bearer services.


5.5.3.2.6	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	Access barred because of access class barring, EAB, ACDC or NAS signalling connection establishment rejected by the network without "Extended wait time" received from lower layers

    	In WB-S1 mode, if the tracking area updating procedure is started in response to a paging request from the network, access class barring, EAB or ACDC is not applicable.

    	In NB-S1 mode, if the tracking area updating procedure is started in response to a paging request from the network, access barring is not applicable.

    	In WB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), the tracking area updating procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. The tracking area updating procedure is started as soon as possible and if still necessary, e.g. when access for "originating signalling" is granted on the current cell or when the UE moves to a cell where access for "originating signalling" is granted.

    	In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), the tracking area updating procedure shall not be started. The UE stays in the current serving cell and applies the normal cell reselection process. Further UE behaviour is implementation specific, e.g. the tracking area updating procedure is started again after an implementation dependent time.

    	In NB-S1 mode, if access is barred for "originating signalling" (see 3GPP TS 36.331 [22]), a request for an exceptional event is received from the upper layers, then the tracking area updating procedure shall be started.

  NOTE 1:	In NB-S1 mode, the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP TS 36.331 [22]).

    	If access is barred because of access class barring for "originating signalling" (see 3GPP TS 36.331 [22]) and if:

    -	one of the MO MMTEL voice call is started, MO MMTEL video call is started or MO SMSoIP is started conditions is satisfied;

    -	the upper layers request to send a mobile originated SMS over NAS or SMS over S102; or

    -	the upper layers request user plane radio resources, ACDC is applicable to the request and the UE supports ACDC.

    	then the tracking area updating procedure shall be started according to subclause 5.5.3.2.2. The call type used shall be per annex D of this document.

  NOTE 2:	If more than one of MO MMTEL voice call is started, MO MMTEL video call is started or MO SMSoIP is started conditions are satisfied, it is left to UE implementation to determine the call type based on Annex D of this document.

    	If access is barred for a certain ACDC category (see 3GPP TS 36.331 [22]), and if the upper layers request user plane radio resources for a higher ACDC category and the UE supports ACDC, then the tracking area updating procedure shall be started according to subclause 5.5.3.2.2.

    	If an access request for an uncategorized application is barred due to ACDC (see 3GPP TS 36.331 [22]), and if the upper layers request user plane radio resources for a certain ACDC category and the UE supports ACDC, then the tracking area updating procedure shall be started according to subclause 5.5.3.2.2.

    	If the trigger for the tracking area update procedure is the response to a paging request from the network and the NAS signalling connection establishment is rejected by the network, the tracking area update procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. The tracking area update procedure may be started if it is still necessary when access for "terminating calls" is granted or because of a cell change.

  b)	Lower layer failure or release of the NAS signalling connection without "Extended wait time" and without "Extended wait time CP data" received from lower layers before the TRACKING AREA UPDATE ACCEPT or TRACKING AREA UPDATE REJECT message is received

    	The tracking area updating procedure shall be aborted, and the UE shall proceed as described below.

  c)	T3430 timeout

    	The UE shall abort the procedure and proceed as described below. The NAS signalling connection, if any, shall be released locally.

  NOTE 3:	The NAS signalling connection can also be released if the UE deems that the network has failed the authentication check as specified in subclause 5.4.2.7.

  d)	TRACKING AREA UPDATE REJECT, other causes than those treated in subclause 5.5.3.2.5, and cases of EMM cause values  #22 and #25, if considered as abnormal cases according to subclause 5.5.3.2.5

    	If the tracking area updating request is not for initiating a PDN connection for emergency bearer services, upon reception of the EMM causes #95, #96, #97, #99 and #111 the UE should set the tracking area updating attempt counter to 5.

    	The UE shall proceed as described below.

  e)	Change of cell into a new tracking area

    	If a cell change into a new tracking area occurs before the tracking area updating procedure is completed, the tracking area updating procedure shall be aborted and re-initiated immediately. The UE shall set the EPS update status to EU2 NOT UPDATED.

    	The UE shall proceed as described below.

  f)	Tracking area updating and detach procedure collision

    	EPS detach containing detach type "re-attach required" or "re-attach not required":

       	If the UE receives a DETACH REQUEST message before the tracking area updating procedure has been completed, the tracking area updating procedure shall be aborted and the detach procedure shall be progressed. If the DETACH REQUEST message contains detach type "re-attach not required" and EMM cause #2 "IMSI unknown in HSS", the UE will follow the procedure as described below for the detach type "IMSI detach".

    	EPS detach containing detach type "IMSI detach":

       	If the UE receives a DETACH REQUEST message before the tracking area updating procedure has been completed, the DETACH REQUEST message shall be ignored and tracking area updating procedure shall be progressed.

    	The UE shall proceed as described below.

  g)	Tracking area updating and GUTI reallocation procedure collision

    	If the UE receives a GUTI REALLOCATION COMMAND message before the tracking area updating procedure has been completed, this message shall be ignored and the tracking area updating procedure shall be progressed.

  h)	Transmission failure of TRACKING AREA UPDATE REQUEST message indication from lower layers

    	The tracking area updating procedure shall be aborted and re-initiated immediately. The UE shall set the EPS update status to EU2 NOT UPDATED.

  i)	Transmission failure of TRACKING AREA UPDATE COMPLETE message indication with TAI change from lower layers

    	If the current TAI is not in the TAI list, the tracking area updating procedure shall be aborted and re-initiated immediately. The UE shall set the EPS update status to EU2 NOT UPDATED.

    	If the current TAI is still part of the TAI list, it is up to the UE implementation how to re-run the ongoing procedure.

  j)	Transmission failure of TRACKING AREA UPDATE COMPLETE message indication without TAI change from lower layers

    	It is up to the UE implementation how to re-run the ongoing procedure.

  k)	"Extended wait time" from the lower layers

    	If the TRACKING AREA UPDATE REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", the UE shall start timer T3346 with the "Extended wait time" value and reset the tracking area updating attempt counter.

    	If the TRACKING AREA UPDATE REQUEST message did not contain the low priority indicator set to "MS is configured for NAS signalling low priority", the UE is operating in NB-S1 mode and the UE is not a UE configured to use AC11 – 15 in selected PLMN, then the UE shall start timer T3346 with the "Extended wait time" value and reset the tracking area updating attempt counter.

    	In other cases the UE shall ignore the "Extended wait time".

    	The UE shall abort the tracking area updating procedure, stay in the current serving cell, set the EPS update status to EU2 NOT UPDATED, change the state to EMM-REGISTERED.ATTEMPTING-TO-UPDATE and apply the normal cell reselection process.

    	If the UE had used eDRX before initiating tracking area updating procedure, then the UE shall continue to use the eDRX with the extended DRX parameters IE received during the last attach or tracking area updating procedure.

    	The UE shall proceed as described below.

  ka)	"Extended wait time CP data" from the lower layers

    	If the UE is operating in NB-S1 mode and supports the timer T3448, the UE shall start the timer T3448 with the "Extended wait time CP data" value. If the UE is operating in NB-S1 mode and does not support the timer T3448, the UE shall start the timer T3346 with the "Extended wait time CP data" value and reset the tracking area updating attempt counter.

    	In other cases the UE shall ignore the "Extended wait time CP data".

    	The UE shall abort the tracking area updating procedure, stay in the current serving cell, set the EPS update status to EU2 NOT UPDATED, change the state to EMM-REGISTERED.ATTEMPTING-TO-UPDATE and apply the normal cell reselection process.

    	If the UE had used eDRX before initiating tracking area updating procedure, then the UE shall continue to use the eDRX with the extended DRX parameters IE received during the last attach or tracking area updating procedure.

    	The UE shall proceed as described below.

  l)	Timer T3346 is running

    	The UE shall not start the tracking area updating procedure unless:

    -	the UE is in EMM-CONNECTED mode;

    -	the UE received a paging;

    -	the UE is a UE configured to use AC11 – 15 in selected PLMN;

    -	the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services;

    -	the UE is requested by the upper layer for a CS fallback for emergency call or a 1xCS fallback for emergency call;

    -	the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and

       i)	the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]); and

       ii)	timer T3346 was not started when NAS signaling connection was established with RRC establishment cause set to "MO exception data"; or

    -	the UE has a PDN connection established without the NAS signalling low priority indication or is establishing a PDN connection without the NAS signalling low priority indication, the timer T3402 and the timer T3411 are not running and the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST or EXTENDED SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority".

    	The UE stays in the current serving cell and applies the normal cell reselection process.

  NOTE 4:	It is considered an abnormal case if the UE needs to initiate a tracking area updating procedure while timer T3346 is running independent on whether timer T3346 was started due to an abnormal case or a non successful case.

    	If the TAI of the current serving cell is not included in the TAI list or the TIN indicates "P-TMSI", the UE shall set the EPS update status to EU2 NOT UPDATED and change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

    	The UE shall proceed as described below.

  la)	Timer T3448 is running

    	The UE shall not start the tracking area updating procedure with the "signalling active" flag unless:

    -	the UE is a UE configured to use AC11 – 15 in selected PLMN;

    -	the UE which is only using EPS services with control plane CIoT EPS optimization received a paging; or

    -	the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]).

    	The UE stays in the current serving cell and applies the normal cell reselection process.

    	The UE shall proceed as described below.

  m)	Mobile originated detach required

    	Detach due to removal of USIM or due to switch off:

       	The tracking area updating procedure shall be aborted, and the UE initiated detach procedure shall be performed.

    	Detach not due to removal of USIM and not due to switch off:

       	The UE initiated detach procedure shall be initiated after successful completion of the tracking area updating procedure.

  o)	Timer T3447 is running

    	The UE shall not start the tracking area updating procedure with the "signalling active" or "active" flag unless:

    -	the UE received a paging;

    -	the UE is a UE configured to use AC11 – 15 in selected PLMN;

    -	the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services;

    	The UE stays in the current serving cell and applies the normal cell reselection process. The tracking area update request procedure is started, if still necessary, when timer T3447 expires.

  p)	Tracking area updating and paging procedure collision

    	If the UE receives a CS SERVICE NOTIFICATION message before the tracking area updating procedure has been completed, the UE shall progress the tracking area updating procedure and respond to the CS SERVICE NOTIFICATION upon successful completion of the tracking area updating procedure.

For the cases b, c, d, e, f with detach type "re-attach required" or "re-attach not required" with EMM cause other than #2 "IMSI unknown in HSS", k and ka, the UE shall stop any ongoing transmission of user data.

For the cases b, c, d, k, ka, l and la, the UE shall proceed as follows:

    	Timer T3430 shall be stopped if still running.

    	For the cases b, c, d, la k when the "Extended wait time" is ignored, and ka when the "Extended wait time CP data" is ignored, if the tracking area updating request is not for initiating a PDN connection for emergency bearer services, the tracking area updating attempt counter shall be incremented, unless it was already set to 5.

    	If the tracking area updating attempt counter is less than 5, and the TAI of the current serving cell is included in the TAI list, and the EPS update status is equal to EU1 UPDATED and the TIN does not indicate "P-TMSI":

       	the UE shall keep the EPS update status to EU1 UPDATED and enter state EMM-REGISTERED.NORMAL-SERVICE. The UE shall start timer T3411.

       	If in addition the TRACKING AREA UPDATE REQUEST indicated "periodic updating" or if tracking area updating procedure was initiated to recover NAS signalling connection due to "RRC Connection failure" from the lower layers, none of the other reasons for initiating the tracking area updating procedure listed in subclause 5.5.3.2.2 was applicable, and the TRACKING AREA UPDATE REQUEST message did not include T3324 value IE, T3412 extended value IE or Extended DRX parameters IE, the timer T3411 may be stopped when the UE enters EMM-CONNECTED mode.

       	If timer T3411 expires the tracking area updating procedure is triggered again.

    	If the tracking area updating attempt counter is less than 5, and the TAI of the current serving cell is not included in the TAI list or the EPS update status is different to EU1 UPDATED or the TIN indicates "P-TMSI" or the tracking area updating procedure is performed due to an inter-system change from N1 mode to S1 mode:

    -	for the cases k and l, the tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.

    -	for the case ka, if timer T3346 is started, the tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.

    -	for the case ka, if timer T3448 is started and the "signalling active" flag is set in the TRACKING AREA UPDATE REQUEST message, the tracking area updating procedure is started, if still necessary, when timer T3448 expires or is stopped.

    -	for the case la, if the "signalling active" flag is set in the TRACKING AREA UPDATE REQUEST message, the tracking area updating procedure is started, if still necessary, when timer T3448 expires or is stopped.

    -	for the cases b, c, d, k when the "Extended wait time" is ignored, and ka when the "Extended wait time CP data" is ignored, if the tracking area updating request is not for initiating a PDN connection for emergency bearer services, the UE shall start timer T3411, shall set the EPS update status to EU2 NOT UPDATED and change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE. When timer T3411 expires the tracking area updating procedure is triggered again.

       	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GPRS update status as specified in 3GPP TS 24.008 [13] for the abnormal case when a normal or periodic routing area updating procedure fails and the routing area updating attempt counter is less than 5 and the GPRS update status is different from GU1 UPDATED.

       	If the UE is operating in single registration mode, the UE shall in addition handle the 5GS update status as specified in 3GPP TS 24.501 [54] for the abnormal cases when a registration procedure for mobility and periodic registration fails and the registration attempt counter is less than 5 and the 5GS update status is different from 5U1 UPDATED.

    	If the tracking area updating attempt counter is equal to 5:

    -	the UE shall start timer T3402, shall set the EPS update status to EU2 NOT UPDATED;

    -	the UE shall delete the list of equivalent PLMNs and shall change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE or optionally to EMM-REGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6]; and

    -	if A/Gb mode, Iu mode or N1 mode is supported by the UE:

       -	if A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GPRS update status as specified in 3GPP TS 24.008 [13] for the abnormal case when a normal or periodic routing area updating procedure fails and the routing area updating attempt counter is equal to 5;

       -	if the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the abnormal case when a registration procedure for mobility or periodic registration update fails and the registration attempt counter is equal to 5; and

       -	if the UE does not change to state EMM-REGISTERED.PLMN-SEARCH, the UE shall attempt to select GERAN. UTRAN or NG-RAN radio access technology.

         	If a GERAN or UTRAN cell is selected:

         -	a UE in PS mode 1 or PS mode 2 of operation shall proceed with appropriate GMM specific procedures;

         -	a UE in CS/PS mode 1 or CS/PS mode 2 of operation shall proceed with appropriate MM or GMM specific procedures.

         	If an NG-RAN cell is selected, the UE shall proceed with appropriate 5GMM specific procedures.

         	Additionally, the UE may disable the E-UTRA capability as specified in subclause 4.5.


5.5.3.2.6A	Abnormal cases in the UE, SMS services not accepted

The UE shall proceed as follows:

  1)	if the tracking area update was successful for EPS services only and the TRACKING AREA UPDATE ACCEPT message contained a value included in the SMS services status IE not treated in subclause 5.5.3.2.4A or the SMS services status IE is not included in the message, the UE shall proceed as follows:

    a)	The UE shall stop timer T3430 if still running. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;

    b)	If the tracking area updating attempt counter is less than 5:

       -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3411 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered;

    c)	If the tracking area updating attempt counter is equal to 5:

       -	the UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE. When timer T3402 expires the normal tracking area updating procedure for EPS services and "SMS only" or the combined tracking area updating procedure for EPS services and "SMS only" is triggered; and

  2)	otherwise, the abnormal cases specified in subclause 5.5.3.2.6 apply.


5.5.3.2.7	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	If a lower layer failure occurs before the message TRACKING AREA UPDATE COMPLETE has been received from the UE and a GUTI has been assigned, the network shall abort the procedure, enter EMM-IDLE mode and shall consider both, the old and new GUTI as valid until the old GUTI can be considered as invalid by the network (see subclause 5.4.1.4). During this period the network may use the identification procedure followed by a GUTI reallocation procedure if the old GUTI is used by the UE in a subsequent message.

    	The network may page with IMSI if paging with old and new S-TMSI fails. Paging with IMSI causes the UE to re-attach as described in subclause 5.6.2.2.2.

  b)	Protocol error

    	If the TRACKING AREA UPDATE REQUEST message has been received with a protocol error, the network shall return a TRACKING AREA UPDATE REJECT message with one of the following EMM cause values:

    	#96:	invalid mandatory information element error;

    	#99:	information element non-existent or not implemented;

    	#100:	conditional IE error; or

    	#111:	protocol error, unspecified.

  c)	T3450 time-out

    	On the first expiry of the timer, the network shall retransmit the TRACKING AREA UPDATE ACCEPT message and shall reset and restart timer T3450. The retransmission is performed four times, i.e. on the fifth expiry of timer T3450, the tracking area updating procedure is aborted. Both, the old and the new GUTI shall be considered as valid until the old GUTI can be considered as invalid by the network (see subclause 5.4.1.4). During this period the network acts as described for case a above.

  d)	TRACKING AREA UPDATE REQUEST received after the TRACKING AREA UPDATE ACCEPT message has been sent and before the TRACKING AREA UPDATE COMPLETE message is received

    -	If one or more of the information elements in the TRACKING AREA UPDATE REQUEST message differ from the ones received within the previous TRACKING AREA UPDATE REQUEST message, the previously initiated tracking area updating procedure shall be aborted if the TRACKING AREA UPDATE COMPLETE message has not been received and the new tracking area updating procedure shall be progressed; or

    -	if the information elements do not differ, then the TRACKING AREA UPDATE ACCEPT message shall be resent and the timer T3450 shall be restarted if an TRACKING AREA UPDATE COMPLETE message is expected. In that case, the retransmission counter related to T3450 is not incremented.

  e)	More than one TRACKING AREA UPDATE REQUEST received and no TRACKING AREA UPDATE ACCEPT or TRACKING AREA UPDATE REJECT message has been sent

    -	If one or more of the information elements in the TRACKING AREA UPDATE REQUEST message differs from the ones received within the previous TRACKING AREA UPDATE REQUEST message, the previously initiated tracking area updating procedure shall be aborted and the new tracking area updating procedure shall be progressed;

    -	if the information elements do not differ, then the network shall continue with the previous tracking area updating procedure and shall not treat any further this TRACKING AREA UPDATE REQUEST message.

  f)	Lower layers indication of non-delivered NAS PDU due to handover

       	If the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message could not be delivered due to an intra MME handover and the TAI of the target cell and the TAI of the source cell are the same, then upon successful completion of the intra MME handover the MME shall retransmit the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the TRACKING AREA UPDATE ACCEPT message or TRACKING AREA UPDATE REJECT message.

  g)	DETACH REQUEST message received before the TRACKING AREA UPDATE ACCEPT message is sent or before the TRACKING AREA UPDATE COMPLETE message (in case of GUTI and/or TMSI was allocated) is received.

    	Detach containing cause "switch off":

       	The network shall abort the signalling for the tracking area updating procedure towards the UE and shall progress the detach procedure as described in subclause 5.5.2.2.

  NOTE:	Internally in the network, before processing the detach request, the MME can perform the necessary signalling procedures for the tracking area updating procedure before progressing the detach procedure.

    	Detach containing other causes than "switch off":

       	The network shall proceed with the tracking area updating procedure and shall progress the detach procedure after successful completion of the tracking area updating procedure.

  h)	If the TRACKING AREA UPDATE REQUEST message with EPS update type IE indicating "periodic updating" is received by the new MME which does not have the EMM context data related to the subscription, the new MME may send the TRACKING AREA UPDATE REJECT message with EMM cause value #10 "Implicitly detached"


5.5.3.3	Combined tracking area updating procedure


5.5.3.3.1	General

Within a combined tracking area updating procedure the messages TRACKING AREA UPDATE ACCEPT and TRACKING AREA UPDATE COMPLETE carry information for the tracking area updating and the location area updating.

The combined tracking area updating procedure follows the normal tracking area updating procedure described in subclause 5.5.3.2 with exception of subclause 5.5.3.2.4A and subclause 5.5.3.2.6A.


5.5.3.3.2	Combined tracking area updating procedure initiation

The UE operating in CS/PS mode 1 or CS/PS mode 2, in state EMM-REGISTERED, shall initiate the combined tracking area updating procedure:

  a)	when the UE that is attached for both EPS and non-EPS services detects entering a tracking area that is not in the list of tracking areas that the UE previously registered in the MME, unless the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] and is entering a tracking area in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs;

  b)	when the UE that is attached for EPS services wants to perform an attach for non-EPS services. In this case the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach";

  c)	when the UE performs an intersystem change from A/Gb mode to S1 mode and the EPS services were previously suspended in A/Gb mode;

  d)	when the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, and the UE previously either performed a combined GPRS attach procedure, an IMSI attach procedure, a location area updating procedure or a combined routing area updating procedure, in A/Gb or Iu mode, or moved to A/Gb or Iu mode from S1 mode through an SRVCC handover or moved to Iu mode from S1 mode through an vSRVCC handover. In this case the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach";

  e)	when the UE enters EMM-REGISTERED.NORMAL-SERVICE and the UE's TIN indicates "P-TMSI";

  f)	when the UE receives an indication from the lower layers that the RRC connection was released with cause "load balancing TAU required";

  g)	when the UE deactivated EPS bearer context(s) locally while in EMM-REGISTERED, because it was not able or not allowed to establish a NAS signalling connection, and then returns to EMM-REGISTERED.NORMAL-SERVICE and no EXTENDED SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST message or DETACH REQUEST message is pending to be sent by the UE;

  h)	when the UE changes the UE network capability information or the MS network capability information or both;

  i)	when the UE changes the UE specific DRX parameter;

  j)	when the UE receives an indication of "RRC Connection failure" from the lower layers and has no signalling or user uplink data pending (i.e when the lower layer requests NAS signalling connection recovery);

  k)	when due to manual CSG selection the UE has selected a CSG cell whose CSG identity and associated PLMN identity are not included in the UE's Allowed CSG list or in the UE's Operator CSG list;

  l)	when the UE reselects an E-UTRAN cell while it was in GPRS READY state or PMM-CONNECTED mode;

  m)	when the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN, and changes the mobile station classmark 2 or the supported codecs, or the UE supports SRVCC to GERAN and changes the mobile station classmark 3;

  n)	when the UE changes the radio capability for GERAN or cdma2000® or both;

  o)	when the UE's usage setting or the voice domain preference for E-UTRAN change in the UE;

  p)	when the UE activates mobility management for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.2, and the TIN indicates "RAT-related TMSI";

  q)	when the UE performs an intersystem change from A/Gb mode to S1 mode and the TIN indicates "RAT-related TMSI", but the UE is required to perform tracking area updating for IMS voice termination as specified in 3GPP TS 24.008 [13], annex P.4;

  r)	upon reception of a paging indication, if the UE is in state EMM-REGISTERED.ATTEMPTING-TO-UPDATE and the paging indication uses S-TMSI or it uses IMSI with domain indicator set to ″CS″;

  s)	when the UE needs to update the network with EPS bearer context status due to local de-activation of EPS bearer context(s) as specified in subclause 6.5.1.4A;

  t)	when the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, and the UE has previously performed the MM connection establishment for CS fallback emergency calls (see 3GPP TS 24.008 [13], subclause 4.5.1.5a) without performing a location area updating procedure or combined routing area updating procedure while camping on a location area which is different from the stored location area. In this case, the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach";

  u)	when the UE performs an intersystem change from A/Gb or Iu mode to S1 mode, and the MM update status is U2 NOT UPDATED. In this case the EPS update type IE shall be set to "combined TA/LA updating with IMSI attach";

  v)	when the UE needs to request the use of PSM or needs to stop the use of PSM;

  w)	when the UE needs to request the use of eDRX or needs to stop the use of eDRX;

  x)	when a change in the eDRX usage conditions at the UE requires different extended DRX parameters;

  y)	when a change in the PSM usage conditions at the UE requires a different timer T3412 value or different timer T3324 value;

  NOTE 1:	A change in the PSM or eDRX usage conditions at the UE can include e.g. a change in the UE configuration, a change in requirements from upper layers or the battery running low at the UE.

  z)	when the CIoT EPS optimizations the UE needs to use, change in the UE;

  za)	when the Default_DCN_ID value changes, as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17];

  NOTE 2:	The tracking area updating procedure is initiated after deleting the DCN-ID list as specified in annex C.

  zb)	when the UE performs inter-system change from N1 mode to S1 mode in EMM-IDLE mode, the UE operates in single-registration mode, and conditions specified in 3GPP TS 24.501 [54] apply;

  zc)	when the UE in EMM-IDLE mode changes the radio capability for E-UTRAN; or

  zd)	when the UE performs inter-system change from N1 mode to S1 mode in EMM-CONNECTED mode.

For case c, if the TIN indicates "RAT-related TMSI" and the EPS services were not resumed before returning to S1 mode, the UE shall set the TIN to "P-TMSI" before initiating the combined tracking area updating procedure.

For cases n and zc, the UE shall include a UE radio capability information update needed IE in the TRACKING AREA UPDATE REQUEST message.

For case l, if the TIN indicates "RAT-related TMSI", the UE shall set the TIN to "P-TMSI" before initiating the combined tracking area updating procedure.

For case r, the "active" flag in the EPS update type IE shall be set to 1. If the paging is received for CS fallback, the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection after the completion of the tracking area updating procedure.

To initiate a combined tracking area updating procedure the UE sends the message TRACKING AREA UPDATE REQUEST to the network, starts timer T3430 and changes to state EMM-TRACKING-AREA-UPDATING-INITIATED. The value of the EPS update type IE in the message shall indicate "combined TA/LA updating" unless explicitly specified otherwise.

If the UE initiates the combined tracking area updating procedure for EPS services and "SMS only", the UE shall indicate "SMS only" in the additional update type IE.

The UE shall include the TMSI status IE if no valid TMSI is available. Furthermore, if the UE has stored a valid location area identification, the UE shall include it in the Old location area identification IE in the TRACKING AREA UPDATE REQUEST message.

If the UE has stored a valid TMSI, the UE shall include the TMSI based NRI container IE in the TRACKING AREA UPDATE REQUEST message.

For cases g, s and zb, the UE shall include EPS bearer context status IE in TRACKING AREA UPDATE REQUEST message.


5.5.3.3.3	EMM common procedure initiation

During the combined tracking area updating procedure, the MME may initiate EMM common procedures, e.g. the EMM authentication and security mode control procedures. For restrictions applicable after handover or inter-system handover to S1 mode see subclause 5.5.3.2.3.


5.5.3.3.4	Combined tracking area updating procedure accepted by the network


5.5.3.3.4.1	General

Depending on the value of the EPS update result IE received in the TRACKING AREA UPDATE ACCEPT message, the following different cases can be distinguished:

  1)	The EPS update result IE value indicates "combined TA/LA updated": Tracking and location area updating is successful for EPS and non-EPS services, or for EPS services and "SMS only";

  2)	The EPS update result IE value indicates "TA updated": Tracking area updating is successful, but location area updating for non-EPS services or "SMS only" is not successful.

A TRACKING AREA UPDATE COMPLETE message shall be returned to the network if the TRACKING AREA UPDATE ACCEPT message contains a GUTI or a TMSI or both.


5.5.3.3.4.2	Combined tracking area updating successful

The description for normal tracking area update as specified in subclause 5.5.3.2.4 shall be followed. In addition, the following description for location area updating applies.

The TMSI reallocation may be part of the combined tracking area updating procedure. The TMSI allocated is then included in the TRACKING AREA UPDATE ACCEPT message together with the location area identification (LAI). In this case the MME shall change to state EMM-COMMON-PROCEDURE-INITIATED and shall start the timer T3450 as described in subclause 5.4.1. The LAI may be included in the TRACKING AREA UPDATE ACCEPT message without TMSI. If the MME does not indicate "SMS only" in the TRACKING AREA UPDATE ACCEPT message, subject to operator policies the MME should allocate a TAI list that does not span more than one location area.

For a shared network in CS domain, the MME indicates the selected PLMN for CS domain in the LAI to the UE as specified in 3GPP TS 23.272 [9].

The UE, receiving a TRACKING AREA UPDATE ACCEPT message, stores the received location area identification, resets the location update attempt counter, sets the update status to U1 UPDATED and enters MM state MM IDLE.

If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services" events (see subclause 5.3.7b), then the UE shall reset this counter.

If the LAI contained in the TRACKING AREA UPDATE ACCEPT message is a member of the list of "forbidden location areas for regional provision of service" or the list of "forbidden location areas for roaming" then such entry shall be deleted.

If the PLMN identity for the CS domain which is provided as part of the LAI contained in the TRACKING AREA UPDATE ACCEPT message differs from the PLMN identity provided as part of the GUTI, the MME shall include the PLMN identity for the CS domain in the list of equivalent PLMNs in the TRACKING AREA UPDATE ACCEPT message.

If the UE requested "SMS only" in the Additional update type IE, or if the UE requested a combined tracking area updating for EPS and non-EPS services, but the network decides to accept the tracking area update request for EPS services and "SMS only", the network shall indicate "SMS only" in the Additional update result IE. In addition, if the SMS services are provided via SMS in MME, the network shall, in the TRACKING AREA UPDATE ACCEPT message, provide a non-broadcast LAI and may indicate in the EPS update result IE that ISR is activated. If a TMSI has to be allocated, then the network shall also provide a TMSI which cannot cause any ambiguity with assigned TMSI values.

If the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value "SMS only", a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with "IMS voice available" shall not attempt to use CS fallback for mobile originating services.

As an implementation option, if the TRACKING AREA UPDATE ACCEPT message does not include the Additional update result IE with value "SMS only" and the UE is not configured for NAS signaling low priority then the UE may stop timer T3246 if running.

If the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value "CS Fallback not preferred", this indicates to a UE operating in CS/PS mode 2 and a UE operating in CS/PS mode 1 with "IMS voice available" that it is attached for EPS and non-EPS services and that it can use CS fallback.

How to handle the old TMSI stored in the UE depends on the mobile identity included in the TRACKING AREA UPDATE ACCEPT message.

  -	If the TRACKING AREA UPDATE ACCEPT message contains an IMSI, the UE is not allocated any TMSI, and shall delete any old TMSI accordingly.

  -	If the TRACKING AREA UPDATE ACCEPT message contains a TMSI, the UE shall use this TMSI as new temporary identity. The UE shall delete its old TMSI and shall store the new TMSI. In this case, a TRACKING AREA UPDATE COMPLETE message is returned to the network to confirm the received TMSI.

  -	If neither a TMSI nor an IMSI has been included by the network in the TRACKING AREA UPDATE ACCEPT message, the old TMSI, if any is available, shall be kept.

  NOTE 1:	It is possible for UEs compliant with earlier versions of this specification to send a TRACKING AREA UPDATE COMPLETE message even if TMSI reallocation is not part of the combined tracking area update procedure.

If the TRACKING AREA UPDATE ACCEPT message includes the Additional update result IE with value "SMS only" or "CS Fallback not preferred", a UE operating in CS/PS mode 1 with "IMS voice not available" shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see subclause 4.5).

The network receiving a TRACKING AREA UPDATE COMPLETE message stops timer T3450, changes to state EMM-REGISTERED.

  NOTE 2:	Upon receiving a TRACKING AREA UPDATE COMPLETE message, if a new TMSI was included in the TRACKING AREA UPDATE ACCEPT message, the MME sends an SGsAP-TMSI-REALLOCATION-COMPLETE message as specified in 3GPP TS 29.118 [16A].


5.5.3.3.4.3	Combined tracking area updating successful for EPS services only

Apart from the actions on the tracking area updating attempt counter, the description for tracking area for EPS services as specified in subclause 5.5.3.2.4 shall be followed. In addition, the following description for location updating for non-EPS services applies.

The UE receiving the TRACKING AREA UPDATE ACCEPT message takes one of the following actions depending on the EMM cause value:

  #2	(IMSI unknown in HSS)

       	The UE shall stop T3430 if still running and shall reset the tracking area updating attempt counter. The UE shall set the update status to U3 ROAMING NOT ALLOWED and shall delete any TMSI, LAI and ciphering key sequence number. The UE shall enter state EMM-REGISTERED.NORMAL-SERVICE. The new MM state is MM IDLE. The USIM shall be considered as invalid for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described subclause 5.3.7a. If the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  #16	(MSC temporarily not reachable); or

  #17	(Network failure)

       	The UE shall stop timer T3430 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5.

       	If the tracking area updating attempt counter is less than 5:

       -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again.

       	If the tracking area updating attempt counter is equal to 5:

       -	a UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again;

       -	a UE operating in CS/PS mode 1 of operation with "IMS voice not available" without a persistent EPS bearer context shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see subclause 4.5);

       -	a UE operating in CS/PS mode 1 of operation with "IMS voice not available" and with a persistent EPS bearer context shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again. When the radio bearer associated with the persistent EPS bearer context has been released and the UE is registered for EPS services only, operating in CS/PS mode 1 of operation with "IMS voice not available", then the UE shall stop timer T3402, if already running, attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM or GMM specific procedures and disable the E-UTRA capability (see subclause 4.5).

  #18	(CS domain not available)

       	The UE shall stop timer T3430 if still running, shall reset the tracking area updating attempt counter, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.NORMAL-SERVICE.

       	The UE shall enter state MM IDLE and shall set the update status to U2 NOT UPDATED.

       	A UE in CS/PS mode 1 of operation with "IMS voice not available" without a persistent EPS bearer context shall attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the registered PLMN or equivalent PLMN and disable the E-UTRA capability (see subclause 4.5).

       	A UE in CS/PS mode 1 of operation with "IMS voice not available" and with a persistent EPS bearer context shall, after the radio bearer associated with the persistent EPS bearer context has been released, attempt to select GERAN or UTRAN radio access technology rather than E-UTRAN for the registered PLMN or equivalent PLMN and disable the E-UTRA capability (see subclause 4.5).

       	A UE in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" may provide a notification to the user or the upper layers that the CS domain is not available.

       	The UE shall not attempt combined attach or combined tracking area updating procedure with current PLMN until switching off the UE or the UICC containing the USIM is removed.

  #22	(Congestion)

       	The UE shall stop timer T3430 if still running. The tracking area updating attempt counter shall be set to 5. The UE shall start timer T3402, shall set the EPS update status to EU1 UPDATED, shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM, shall enter state MM IDLE.

Other EMM cause values and the case that no EMM cause IE was received are considered as abnormal cases. The combined tracking area updating procedure shall be considered as failed for non-EPS services. The behaviour of the UE in those cases is specified in subclause 5.5.3.3.6.


5.5.3.3.5	Combined tracking area updating procedure not accepted by the network

If the combined tracking area updating cannot be accepted by the network, the MME shall send a TRACKING AREA UPDATE REJECT message to the UE including an appropriate EMM cause value.

If the MME locally deactivates EPS bearer contexts for the UE (see subclause 5.5.3.2.4) and no active EPS bearer contexts remain for the UE, the MME shall send the TRACKING AREA UPDATE REJECT message including the EMM cause value #10 "implicitly detached".

If the tracking area update request is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a back-off timer T3346.

If the UE initiated the tracking area updating procedure due to inter-system change from N1 mode to S1 mode, and the MME does not support N26 interface, the MME shall send a TRACKING AREA UPDATE REJECT message with EMM cause value #9 "UE identity cannot be derived by the network".

If the tracking area request is rejected due to service gap control as specified in subclause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.

Upon receiving the TRACKING AREA UPDATE REJECT message, if the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall stop timer T3430, stop any transmission of user data and enter state MM IDLE.

If the TRACKING AREA UPDATE REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.

The UE shall take the following actions depending on the EMM cause value received in the TRACKING AREA UPDATE REJECT message.

  #3	(Illegal UE);

  #6	(Illegal ME); or

  #8	(EPS services and non-EPS services not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI.

    	The UE shall consider the USIM as invalid for EPS and non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. Additionally, the UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI and ciphering key sequence number, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #7	(EPS services not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall consider then USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. The UE shall delete the list of equivalent PLMNs and shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	A UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.

    	A UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #9	(UE identity cannot be derived by the network);

    	The UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall enter the state EMM-DEREGISTERED.

    	If there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.

    	If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.

    	If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.

    	If there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback and the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall subsequently, automatically initiate the attach procedure.

  NOTE 1:	User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

    	A UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.

    	A UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.

    	If the UE is operating in the single-registration mode, the UE shall handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #10	(Implicitly detached);

    	A UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.

    	The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.

    	If there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.

    	If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.

    	If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.

    	If there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback and the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall then perform a new attach procedure.

  NOTE 2:	User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

    	A UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #11	(PLMN not allowed); or

  #35	(Requested service option not authorized in this PLMN);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI, and reset the tracking area updating attempt counter. The UE shall delete the list of equivalent PLMNs and enter the state EMM-DEREGISTERED.PLMN-SEARCH.

    	The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

    	The UE shall then perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value and no RR connection exists.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #12	(Tracking area not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service".

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter, and the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #13	(Roaming not allowed in this tracking area);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete the list of equivalent PLMNs. The UE shall reset the tracking area updating attempt counter and shall change to state EMM-REGISTERED.PLMN-SEARCH.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and shall remove the current TAI from the stored TAI list if present.

    	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].

    	The UE shall indicate the Update type IE "combined TA/LA updating with IMSI attach" when performing the tracking area updating procedure following the PLMN selection.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #14	(EPS services not allowed in this PLMN);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). Furthermore, the UE shall delete any GUTI, last visited registered TAI, TAI List and eKSI. The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.

    	The UE shall store the PLMN identity in the "forbidden PLMNs for GPRS service" list and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific PS-attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

    	The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.

    	The UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.

    	A UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may select GERAN or UTRAN radio access technology and proceed with the appropriate MM specific procedure according to the MM service state. In this case, the UE shall disable the E-UTRA capability (see subclause 4.5).

    	A UE operating in CS/PS mode 1 of operation and supporting A/Gb mode or Iu mode may perform a PLMN selection according to 3GPP TS 23.122 [6].

    	A UE operating in CS/PS mode 1 of operation and supporting S1 mode only, or operating in CS/PS mode 2 of operation shall delete the list of equivalent PLMNs and shall perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, GPRS ciphering key sequence number and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

  #15	(No suitable cells in tracking area);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and shall remove the current TAI from the stored TAI list if present and:

    -	if the UE is in WB-S1 mode and the Extended EMM cause IE with value "E-UTRAN not allowed" is included in the TRACKING AREA UPDATE REJECT message, the UE supports "E-UTRA Disabling for EMM cause #15", and the "E-UTRA Disabling Allowed for EMM cause #15" parameter as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] is present and set to enabled; then the UE shall disable the E-UTRA capability as specified in subclause 4.5 and search for a suitable cell in another location area or 5GS tracking area;

    -	if the UE is in NB-S1 mode and the Extended EMM cause IE with value "NB-IoT not allowed" is included in the TRACKING AREA UPDATE REJECT message, then the UE may disable the NB-IoT capability as specified in subclause 4.9 and search for a suitable cell in E-UTRAN radio access technology;

    -	otherwise, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].

    	The UE shall indicate the Update type IE "combined TA/LA updating with IMSI attach" when performing the tracking area updating procedure.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #22	(Congestion);

    	If the T3346 value IE is present in the TRACKING AREA UPDATE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.5.3.3.6.

    	The UE shall abort the tracking area updating procedure, reset the tracking area updating attempt counter and set the EPS update status to EU2 NOT UPDATED. If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall change to state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

    	The UE shall stop timer T3346 if it is running.

    	If the TRACKING AREA UPDATE REJECT message is integrity protected, the UE shall start timer with the value provided in the T3346 value IE.

    	If the TRACKING AREA UPDATE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].

    	The UE stays in the current serving cell and applies the normal cell reselection process. The tracking area updating procedure is started, if still necessary, when timer T3346 expires or is stopped.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the registration procedure for mobility and periodic registration update indicating "mobility registration updating" in the 5GS registration type IE of the REGISTRATION REQUEST message is rejected with the 5GMM cause with the same value.

  #25	(Not authorized for this CSG);

    	EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.5.3.3.6.

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause 5.1.3.3). The UE shall reset the tracking area updating attempt counter and shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

    	If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.

    	If the CSG ID and associated PLMN identity of the cell where the UE has sent the TRACKING AREA UPDATE REQUEST message are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] subclause 3.1A.

    	The UE shall search for a suitable cell according to 3GPP TS 36.304 [21].

    	The UE shall indicate the Update type IE "combined TA/LA updating with IMSI attach" when performing the tracking area updating procedure.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the MM parameters update status and the location update attempt counter, and the GMM parameters GMM state, GPRS update status and routing area updating attempt counter as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause with the same value.

  #40	(No EPS bearer context activated);

    	The UE shall deactivate all the EPS bearer contexts locally, if any, and shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE.

    	If there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.

    	If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.

    	If there is a 1xCS fallback emergency call pending or 1xCS fallback call pending, or a paging for 1xCS fallback, and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.

    	If there is no CS fallback emergency call pending, CS fallback call pending, 1xCS fallback emergency call pending, 1xCS fallback call pending, paging for CS fallback, or paging for 1xCS fallback, the UE shall perform a new attach procedure.

  NOTE 3:	User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the combined routing area updating procedure is rejected with the GMM cause value #10 "Implicitly detached".

    	A UE in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.

    	A UE in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.

  #42	(Severe network failure);

    	The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, eKSI, and list of equivalent PLMNs, and set the tracking area updating attempt counter to 5. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.

Other values are considered as abnormal cases. The behaviour of the UE in those cases is specified in subclause 5.5.3.3.6.


5.5.3.3.6	Abnormal cases in the UE

The UE shall proceed as follows:

  1)	if the UE requested the combined tracking area update for EPS services and "SMS only" and the TRACKING AREA UPDATE ACCEPT message indicates a combined tracking area updating procedure successful for EPS and non-EPS services, the UE shall behave as if the combined tracking area updating procedure was successful for EPS services and "SMS only";

  NOTE:	In this case the UE can ignore the CS SERVICE NOTIFICATION message or the Paging with CN domain indicator set to "CS", as specified in subclause 5.6.2.3.2.

  2)	if the combined tracking area update was successful for EPS services only and the TRACKING AREA UPDATE ACCEPT message contained an EMM cause value not treated in subclause 5.5.3.3.4.3 or the EMM Cause IE is not included in the message, the UE shall proceed as follows:

    a)	The UE shall stop timer T3430 if still running, and shall enter state MM IDLE. The tracking area updating attempt counter shall be incremented, unless it was already set to 5;

    b)	If the tracking area updating attempt counter is less than 5:

       -	the UE shall start timer T3411, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3411 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again;

    c)	If the tracking area updating attempt counter is equal to 5:

       -	a UE operating in CS/PS mode 2 of operation and a UE operating in CS/PS mode 1 of operation with "IMS voice available" shall start timer T3402, shall set the EPS update status to EU1 UPDATED and shall enter state EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM. When timer T3402 expires the combined tracking area updating procedure indicating "combined TA/LA updating with IMSI attach" is triggered again; and

       -	a UE operating in CS/PS mode 1 of operation with "IMS voice not available" shall attempt to select GERAN, UTRAN or NG-RAN radio access technology, proceed with appropriate MM, GMM or 5GMM specific procedures and disable the E-UTRA capability (see subclause 4.5); and

    d)	If there is a CS fallback emergency call or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise, if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer; and

  3)	otherwise, the abnormal cases specified in subclause 5.5.3.2.6 apply with the following modification.

    	If the tracking area updating attempt counter is incremented according to subclause 5.5.3.2.6 the next actions depend on the value of the tracking area updating attempt counter.

    -	If the tracking area updating attempt counter is less than 5, the UE shall set the update status to U2 NOT UPDATED, but shall not delete any LAI, TMSI, ciphering key sequence number and list of equivalent PLMNs; or

    -	if the tracking area updating attempt counter is equal to 5, the UE shall delete any LAI, TMSI and ciphering key sequence number and set the update status to U2 NOT UPDATED.

    	If there is a CS fallback emergency call pending or CS fallback call pending, or a paging for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures; otherwise if there is a CS fallback emergency call or CS fallback call pending, the EMM sublayer shall indicate the abort of the EMM procedure to the MM sublayer.


5.5.3.3.7	Abnormal cases on the network side

The abnormal cases specified in subclause 5.5.3.2.7 apply.


5.5.4	eCall inactivity procedure

The eCall inactivity procedure is applicable only to a UE configured for eCall only mode as specified in 3GPP TS 31.102 [17]. The procedure shall be started when:

    -	the UE is in any EMM-REGISTERED substate except substates EMM-REGISTERED.PLMN-SEARCH or EMM-REGISTERED.NO-CELL-AVAILABLE;

    -	the UE is in EMM-IDLE mode, and

    -	one of the following conditions applies:

       1)	timer T3444 expires or is found to have already expired and timer T3445 is not running;

       2)	timer T3445 expires or is found to have already expired and timer T3444 is not running; or

       3)	timers T3444 and T3445 expire or are found to have already expired.

The UE shall then perform the following actions:

  -	stop other running timers (e.g. T3411, T3412);

  -	if the UE is currently registered to EPS services only, perform a detach procedure for EPS services only;

  -	if the UE is currently registered for both EPS services and non-EPS services, perform a combined detach procedure for EPS services and non-EPS services;

  -	delete any GUTI, TAI list, last visited registered TAI, list of equivalent PLMNs, and KSI; and

  -	enter EMM-DEREGISTERED.eCALL-INACTIVE state.


5.5.5	Tracking area update request message (for N1 mode only)

The tracking area updating procedure is used to construct a TRACKING AREA UPDATE REQUEST message for the inter-system change from S1 mode to N1 mode for further security verification by the MME.

The TRACKING AREA UPDATE REQUEST message is created by EMM by request of 5GMM which further includes the message in the REGISTRATION REQUEST message as described in 3GPP TS 24.501 [54].

The TRACKING AREA UPDATE REQUEST message shall contain only mandatory information elements.

The UE shall set the EPS update type IE in the TRACKING AREA UPDATE REQUEST message to "TA updating".

If the UE has a current EPS security context, the UE shall include the eKSI (either KSIASME or KSISGSN) in the NAS Key Set Identifier IE in the TRACKING AREA UPDATE REQUEST message. Otherwise, the UE shall set the NAS Key Set Identifier IE to the value "no key is available". If the UE has a current EPS security context, the UE shall integrity protect the TRACKING AREA UPDATE REQUEST message with the current EPS security context and increase the uplink NAS COUNT by one. Otherwise the UE shall not integrity protect the TRACKING AREA UPDATE REQUEST message. The UE shall set associated GUTI in the Old GUTI IE.

When the UE is in EMM-REGISTERED.NO-CELL-AVAILABLE substate and needs to construct the TRACKING AREA UPDATE REQUEST message for inter-system change from S1 mode to N1 mode, the UE shall consider that the tracking area updating procedure is not initiated and the UE shall remain in EMM-REGISTERED.NO-CELL-AVAILABLE state.


5.6	EMM connection management procedures (S1 mode only)


5.6.1	Service request procedure


5.6.1.1	General

The purpose of the service request procedure is to transfer the EMM mode from EMM-IDLE to EMM-CONNECTED mode. If the UE is not using EPS services with control plane CIoT EPS optimization, this procedure is used to establish the radio and S1 bearers when user data or signalling is to be sent. If the UE is using EPS services with control plane CIoT EPS optimization, this procedure can be used for UE initiated transfer of user data via the control plane. Another purpose of this procedure is to invoke MO/MT CS fallback or 1xCS fallback procedures.

This procedure is used when:

  -	the network has downlink signalling pending;

  -	the UE has uplink signalling pending;

  -	the UE or the network has user data pending and the UE is in EMM-IDLE mode;

  -	the UE is in EMM-CONNECTED mode and has a NAS signalling connection only; the UE is using EPS services with control plane CIoT EPS optimization, and it has user data pending which is to be transferred via user plane radio bearers;

  -	the UE in EMM-IDLE or EMM-CONNECTED mode has requested to perform mobile originating/terminating CS fallback or 1xCS fallback;

  -	the network has downlink cdma2000® signalling pending;

  -	the UE has uplink cdma2000® signalling pending;

  -	the UE has to request resources for ProSe direct discovery or Prose direct communication; or

  -	the UE has to request resources for V2X communication over PC5.

The service request procedure is initiated by the UE, however, for the downlink transfer of signalling, cdma2000® signalling or user data in EMM-IDLE mode, the trigger is given by the network by means of the paging procedure (see subclause 5.6.2).

The UE shall invoke the service request procedure when:

  a)	the UE in EMM-IDLE mode receives a paging request using S-TMSI with CN domain indicator set to "PS" from the network;

  b)	the UE, in EMM-IDLE mode, has pending user data to be sent;

  c)	the UE, in EMM-IDLE mode, has uplink signalling pending;

  d)	the UE in EMM-IDLE or EMM-CONNECTED mode is configured to use CS fallback and has a mobile originating CS fallback request from the upper layer;

  e)	the UE in EMM-IDLE mode is configured to use CS fallback and receives a paging request with CN domain indicator set to "CS", or the UE in EMM-CONNECTED mode is configured to use CS fallback and receives a CS SERVICE NOTIFICATION message;

  f)	the UE in EMM-IDLE or EMM-CONNECTED mode is configured to use 1xCS fallback and has a mobile originating 1xCS fallback request from the upper layer;

  g)	the UE in EMM-CONNECTED mode is configured to use 1xCS fallback and accepts cdma2000® signalling messages containing a 1xCS paging request received over E-UTRAN;

  h)	the UE, in EMM-IDLE mode, has uplink cdma2000® signalling pending to be transmitted over E-UTRAN;

  i)	the UE, in EMM-IDLE or EMM-CONNECTED mode, is configured to use 1xCS fallback, accepts cdma2000® signalling messages containing a 1xCS paging request received over cdma2000® 1xRTT, and the network supports dual Rx CSFB or provide CS fallback registration parameters (see 3GPP TS 36.331 [22]);

  j)	the UE, in EMM-IDLE or EMM-CONNECTED mode, has uplink cdma2000® signalling pending to be transmitted over cdma2000® 1xRTT, and the network supports dual Rx CSFB or provide CS fallback registration parameters (see 3GPP TS 36.331 [22]);

  k)	the UE performs an inter-system change from S101 mode to S1 mode and has user data pending;

  l)	the UE in EMM-IDLE mode has to request resources for ProSe direct discovery or Prose direct communication (see 3GPP TS 36.331 [22]); or

  m)	the UE, in EMM-CONNECTED mode and has a NAS signalling connection only, is using EPS services with control plane CIoT EPS optimization and has pending user data to be sent via user plane radio bearers; or

  n)	the UE in EMM-IDLE mode has to request resources for V2X communication over PC5 (see 3GPP TS 23.285 [47]).

If one of the above criteria to invoke the service request procedure is fulfilled, then the service request procedure may only be initiated by the UE when the following conditions are fulfilled:

  -	its EPS update status is EU1 UPDATED, and the TAI of the current serving cell is included in the TAI list; and

  -	no EMM specific procedure is ongoing.

[pic]

  NOTE 1:	AS indications (indications from lower layers) are results of procedures triggered by MME in service request procedure. Triggered procedures could be e.g. RRC connection reconfiguration procedure (see 3GPP TS 36.331 [22]) and inter system PS handover to GERAN or UTRAN procedure as a result of CSFB procedure (see 3GPP TS 23.272 [9]).
  NOTE 2:	For 1xCS fallback, the UE sends the EXTENDED SERVICE REQUEST message and starts timer T3417. The procedure is considered completed upon receiving indication of system change from AS.


Figure 5.6.1.1.1: Service request procedure (part 1)

[pic]

  NOTE 1:	Security protected NAS message: this could be e.g. a SECURITY MODE COMMAND, SERVICE ACCEPT, or ESM DATA TRANSPORT message.
  NOTE 2:	AS indications (indications from lower layers) are results of procedures triggered by MME in service request procedure. Triggered procedures could be e.g. an RRC connection release procedure or RRC connection reconfiguration procedure (see 3GPP TS 36.331 [22]).


Figure 5.6.1.1.2: Service request procedure (part 2)

A service request attempt counter is used to limit the number of service request attempts and no response from the network. The service request attempt counter shall be incremented as specified in subclause 5.6.1.6.

The service request attempt counter shall be reset when:

  -	a normal or periodic tracking area updating or a combined tracking area updating procedure is successfully completed; or

  -	a service request procedure in order to obtain packet services is successfully completed.


5.6.1.2	Service request procedure initiation


5.6.1.2.1	UE is not using EPS services with control plane CIoT EPS optimization

For cases a, b, c, h, k and l in subclause 5.6.1.1:

  -	if the UE is not configured for NAS signalling low priority, the UE initiates the service request procedure by sending a SERVICE REQUEST message to the MME;

  -	if the UE is configured for NAS signalling low priority, and the last received ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message from the network indicated that the network supports use of EXTENDED SERVICE REQUEST for packet services, the UE shall send an EXTENDED SERVICE REQUEST message with service type set to "packet services via S1"; or

  NOTE:	A UE configured for dual priority is configured for NAS signalling low priority indicator.

  -	if the UE is configured for NAS signalling low priority and the last received ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message from the network did not indicate that the network supports use of EXTENDED SERVICE REQUEST for packet services, the UE shall instead send a SERVICE REQUEST message.

For cases a, b, c, h, k and l in subclause 5.6.1.1, after sending the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message with service type set to "packet services via S1", the UE shall start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED.

For case d in subclause 5.6.1.1, the UE shall send an EXTENDED SERVICE REQUEST message, start T3417ext and enter the state EMM-SERVICE-REQUEST-INITIATED.

For case e in subclause 5.6.1.1:

  -	if the UE is in EMM-IDLE mode, the UE shall send an EXTENDED SERVICE REQUEST message, start T3417ext-mt and enter the state EMM-SERVICE-REQUEST-INITIATED;

  -	if the UE is in EMM-CONNECTED mode and if the UE accepts the paging, the UE shall send an EXTENDED SERVICE REQUEST message with the CSFB response IE indicating "CS fallback accepted by the UE", start T3417ext-mt and enter the state EMM-SERVICE-REQUEST-INITIATED; or

  -	if the UE is in EMM-CONNECTED mode and if the UE rejects the paging, the UE shall send an EXTENDED SERVICE REQUEST message with the CSFB response IE indicating "CS fallback rejected by the UE" and enter the state EMM-REGISTERED.NORMAL-SERVICE. The network shall not initiate CS fallback procedures.

For cases f, g, i and j in subclause 5.6.1.1, the UE shall send an EXTENDED SERVICE REQUEST message, start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED.


5.6.1.2.2	UE is using EPS services with control plane CIoT EPS optimization

The UE shall send a CONTROL PLANE SERVICE REQUEST message, start T3417 and enter the state EMM-SERVICE-REQUEST-INITIATED.

For case a in subclause 5.6.1.1, the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate "mobile terminating request". The UE may include the ESM DATA TRANSPORT message. The UE shall not include any ESM message other than ESM DATA TRANSPORT message.

For case b in subclause 5.6.1.1,

  -	if the UE has pending IP or non-IP user data that is to be sent via the control plane radio bearers, the Control plane service type of the CONTROL PLANE SERVICE REQUEST message shall indicate "mobile originating request". The UE shall include an ESM DATA TRANSPORT message in the ESM message container IE. If the UE supports the CP-EDT (see 3GPP TS 36.300 [20]), the UE shall provide the CONTROL PLANE SERVICE REQUEST message in the NAS request to the lower layer to establish a RRC connection as specified in subclause 5.3.1.1.

For cases b and m in subclause 5.6.1.1,

  -	if the UE has pending IP or non-IP user data that is to be sent via the user plane radio bearers, the UE shall set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to "mobile originating request" and the "active" flag in the Control plane service type IE to 1. The UE shall not include any ESM message container or NAS message container IE in the CONTROL PLANE SERVICE REQUEST message.

For case c in subclause 5.6.1.1, the UE shall set the Control plane service type of the CONTROL PLANE SERVICE REQUEST message to "mobile originating request". If the CONTROL PLANE SERVICE REQUEST message is:

  -	for sending SMS , the UE shall include the SMS message in the NAS message container IE and shall not include any ESM message container IE in the CONTROL PLANE SERVICE REQUEST message ; and

  -	for sending signalling different from SMS, the UE shall not include any ESM message container or NAS message container IE in the CONTROL PLANE SERVICE REQUEST message.


5.6.1.3	EMM common procedure initiation

Upon receipt of the SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message, the MME may initiate the EMM common procedures, e.g. the authentication procedure and security mode control procedure.


5.6.1.4	Service request procedure accepted by the network


5.6.1.4.1	UE is not using EPS services with control plane CIoT EPS optimization

If EMM-REGISTERED without PDN connection is supported by the UE and the MME and the MME has no active EPS bearer contexts for the UE, for cases a, b and c in subclause 5.6.1.1, upon receipt of the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services, after completion of the EMM common procedures according to subclause 5.6.1.3, if any, the MME shall send a SERVICE ACCEPT message.

If EMM-REGISTERED without PDN connection is supported by the UE and the MME and the UE has no active EPS bearer contexts, for cases a, b and c in subclause 5.6.1.1, the UE shall treat the receipt of a SERVICE ACCEPT message as successful completion of the procedure. Otherwise, for cases a, b, c, h, k and l in subclause 5.6.1.1, the UE shall treat the indication from the lower layers that the user plane radio bearer is set up as successful completion of the procedure. The UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.

If the service type information element in the EXTENDED SERVICE REQUEST message indicates "mobile terminating CS fallback or 1xCS fallback" and the CSFB response IE, if included, indicates "CS fallback accepted by the UE", or if the service type information element in the EXTENDED SERVICE REQUEST message indicates "mobile originating CS fallback or 1xCS fallback" or "mobile originating CS fallback emergency call or 1xCS fallback emergency call", the network initiates CS fallback or 1xCS fallback procedures.

If the EPS bearer context status IE is included in the EXTENDED SERVICE REQUEST message, the network shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the network and the UE) which are active on the network side but are indicated by the UE as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the EXTENDED SERVICE REQUEST message, and this default bearer is not associated with the last remaining PDN connection of the UE in the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.

If the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services, was sent in a CSG cell and the CSG subscription has expired or was removed for a UE, but the UE has a PDN connection for emergency bearer services established, the network shall accept the SERVICE REQUEST message or the EXTENDED SERVICE REQUEST message for packet services and deactivate all non-emergency EPS bearers locally. The emergency EPS bearers shall not be deactivated.

For cases d in subclause 5.6.1.1, and for case e in subclause 5.6.1.1 when the CSFB response was set to "CS fallback accepted by the UE", the UE shall treat the indication from the lower layers that the inter-system change from S1 mode to A/Gb or Iu mode is completed as successful completion of the procedure. The EMM sublayer in the UE shall indicate to the MM sublayer that the CS fallback procedure has succeeded. The UE shall stop the timer T3417ext or T3417ext-mt, respectively, and enter the state EMM-REGISTERED.NO-CELL-AVAILABLE.

If the service request procedure was initiated in EMM-IDLE mode and an EXTENDED SERVICE REQUEST message was sent in a CSG cell and the CSG subscription has expired or was removed for the UE, the network need not perform CSG access control if the service type information element indicates "mobile originating CS fallback emergency call or 1xCS fallback emergency call".

For cases f and g in subclause 5.6.1.1:

  -	if the UE receives the indication from the lower layers that the signalling connection is released with the redirection indication to cdma2000® 1x access network or the indication from the lower layers that a change to cdma2000® 1x access network for 1xCS fallback has started (see 3GPP TS 36.331 [22]), the UE shall consider the service request procedure successfully completed, stop timer T3417 and enter the state EMM-REGISTERED.NO-CELL-AVAILABLE;

  -	if the UE receives the dual Rx/Tx redirection indication from the lower layers (see 3GPP TS 36.331 [22]), the UE shall select cdma2000® 1x access network for 1xCS fallback, consider the service request procedure successfully completed, stop timer T3417 and enter the state EMM-REGISTERED.NORMAL-SERVICE; and

  -	if the UE receives a cdma2000® signalling message indicating 1xCS fallback rejection by cdma2000® 1x access network, the UE shall abort the service request procedure, stop timer T3417 and enter the state EMM-REGISTERED.NORMAL-SERVICE.

For cases i and j in subclause 5.6.1.1, if the UE receives the indication from the lower layers that the signalling connection is released, the UE shall consider the service request procedure successfully completed, stop timer T3417 and enter the state EMM-REGISTERED.NO-CELL-AVAILABLE.

If the SERVICE REQUEST message or an EXTENDED SERVICE REQUEST message for packet services was used, the UE shall locally deactivate the EPS bearer contexts that do not have a user plane radio bearer established upon successful completion of the service request procedure.

If the EXTENDED SERVICE REQUEST message is for CS fallback or 1xCS fallback and radio bearer establishment takes place during the procedure, the UE shall locally deactivate the EPS bearer contexts that do not have a user plane radio bearer established upon receiving a lower layer indication of radio bearer establishment. The UE does not perform local deactivation of EPS bearer contexts upon receiving an indication of inter-system change from lower layers.

If the EXTENDED SERVICE REQUEST message is for CS fallback or 1xCS fallback and radio bearer establishment does not take place during the procedure, the UE does not perform local deactivation of the EPS bearer context. The UE does not perform local deactivation of EPS bearer contexts upon receiving an indication of inter-system change from lower layers.

If a service request is received from a UE with a LIPA PDN connection, and if:

  -	a GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the service request, and the P-GW address included in the EPS bearer context of the LIPA PDN connection is different from the provided GW Transport Layer Address IE value (see 3GPP TS 36.413 [23]); or

  -	no GW Transport Layer Address is provided together with the service request by the lower layer;

then the MME shall locally deactivate all EPS bearer contexts associated with any LIPA PDN connection. Furthermore, if no active EPS bearer contexts remain for the UE, the MME shall not accept the service request as specified in subclause 5.6.1.5.

If a service request is received from a UE with a SIPTO at the local network PDN connection, and if the PDN connection is a:

    1)	SIPTO at the local network PDN connection with stand-alone GW, and if:

    -	a LHN-ID value is provided by the lower layer together with the service request, and the LHN-ID value stored in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided LHN-ID value (see 3GPP TS 36.413 [23]); or

    -	no LHN-ID value is provided together with the service request by the lower layer; or

    2)	SIPTO at the local network PDN connection with collocated L-GW, and if:

    -	a SIPTO L-GW Transport Layer Address IE value identifying a L-GW is provided by the lower layer together with the service request, and the P-GW address included in the EPS bearer context of the SIPTO at the local network PDN connection is different from the provided SIPTO L-GW Transport Layer Address IE value (see 3GPP TS 36.413 [23]); or

    -	no SIPTO L-GW Transport Layer Address is provided together with the service request by the lower layer;

then, the MME takes one of the following actions:

    -	if all the remaining PDN connections are SIPTO at the local network PDN connections, the MME shall not accept the service request as specified in subclause 5.6.1.5; and

    -	if a PDN connection remains that is not SIPTO at the local network PDN connection and the network decides to set up the S1 and radio bearers, the MME shall upon completion of the setup of the S1 bearers initiate an EPS bearer context deactivation procedure with ESM cause #39 "reactivation requested" for the default EPS bearer context of each SIPTO at the local network PDN connection (see subclause 6.4.4.2).

  NOTE:	For some cases of CS fallback or 1x CS fallback the network can decide not to set up any S1 and radio bearers.

When the E-UTRAN fails to establish radio bearers for one or more EPS bearer contexts, then the MME shall locally deactivate the EPS bearer contexts corresponding to the failed radio bearers based on the lower layer indication from the E-UTRAN, without notifying the UE.

If the UE is not using EPS services with control plane CIoT EPS optimization, the network shall consider the service request procedure successfully completed in the following cases:

  -	when it receives an indication from the lower layer that the user plane is setup, if radio bearer establishment is required;

  -	otherwise when it receives an indication from the lower layer that the UE has been redirected to the other RAT (GERAN or UTRAN in CS fallback, or cdma2000® 1x access network for 1xCS fallback).


5.6.1.4.2	UE is using EPS services with control plane CIoT EPS optimization

For case a in subclause 5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating "mobile terminating request", after completion of the EMM common procedures according to subclause 5.6.1.3:

  1)	if the MME needs to perform an EPS bearer context status synchronization

    -	for an EPS bearer context associated with Control plane only indication; or

    -	for an EPS bearer context not associated with Control plane only indication, there is no downlink user data pending to be delivered via the user plane, and the UE did not set the "active" flag in the Control plane service type IE to 1; or

  2)	if the control plane data back-off time for the UE is stored in MME and the MME decides to deactivate congestion control for transport of user data via the control plane,

then the MME shall send a SERVICE ACCEPT message.

Furthermore the MME may:

  1)	initiate the transport of user data via the control plane procedure or any other NAS signalling procedure;

  2)	if supported by the UE and required by the network, initiate the setup of the user plane radio bearer(s); or

  3)	send a NAS signalling message not related to an EMM common procedure to the UE if downlink signalling is pending.

For case b in subclause 5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating "mobile originating request", after completion of the EMM common procedures according to subclause 5.6.1.3, if any, if the MME needs to perform an EPS bearer context status synchronization

  -	for an EPS bearer context associated with Control plane only indication; or

  -	for an EPS bearer context not associated with Control plane only indication, there is no downlink user data pending to be delivered via the user plane, and the UE did not set the "active" flag in the Control plane service type IE to 1,

then the MME shall send a SERVICE ACCEPT message.

Furthermore, the MME may:

  1)	initiate release of the NAS signalling connection upon receipt of an indication from the ESM layer (see subclause 6.6.4.2), unless the MME has additional downlink user data or signalling pending;

  2)	initiate the setup of the user plane radio bearer(s), if downlink user data is pending to be delivered via the user plane or the UE has set the "active" flag in the Control plane service type IE to 1;

  3)	send an ESM DATA TRANSPORT message to the UE, if downlink user data is pending to be delivered via the control plane;

  4)	send a NAS signalling message not related to an EMM common procedure to the UE if downlink signalling is pending; or

  5)	send a SERVICE ACCEPT message to complete the service request procedure, if no NAS security mode control procedure was initiated, the MME did not send a SERVICE ACCEPT message as specified above to perform an EPS bearer context status synchronization, and the MME did not initiate any of the procedures specified in item 1 to 4 above.

  NOTE 1:	The MME can initiate the setup of the user plane radio bearer(s) if the MME decides to activate the congestion control for transport of user data via the control plane.

For case m in subclause 5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating "mobile originating request" and the "active" flag in the Control plane service type IE set to 1:

  1)	if the MME accepts the request, the MME shall initiate the setup of the user plane radio bearer(s) for all active EPS bearer contexts of SGi PDN connections that are established without control plane only indication.

  2)	if the MME does not accept the request, the MME shall send a SERVICE ACCEPT message to complete the service request procedure.

  NOTE 2:	The MME takes into account the maximum number of user plane radio bearers supported by the UE, in addition to local policies and the UE's preferred CIoT network behaviour when deciding whether to accept the request to establish user plane bearer(s) as described in subclause 5.3.15. If the MME accepts the request, all SGi PDN connections are considered as established without Control plane only indication.

  NOTE 3:	In this release of the specification, a UE in NB-S1 mode can support a maximum of 2 user plane radio bearers (see subclause 6.5.0).

For case c in subclause 5.6.1.1, upon receipt of the CONTROL PLANE SERVICE REQUEST message with Control plane service type indicating "mobile originating request" and without an ESM message container IE, after completion of the EMM common procedures according to subclause 5.6.1.3, if any, the MME proceeds as follows:

If the MME needs to perform an EPS bearer context status synchronization

  -	for an EPS bearer context associated with Control plane only indication; or

  -	for an EPS bearer context not associated with Control plane only indication, and there is no downlink user data pending to be delivered via the user plane,

then the MME shall send a SERVICE ACCEPT message.

Furthermore, the MME may:

  1)	initiate the setup of the user plane radio bearer(s), if downlink user data is pending to be delivered via the user plane;

  2)	send an ESM DATA TRANSPORT message to the UE, if downlink user data is pending to be delivered via the control plane;

  3)	send a NAS signalling message not related to an EMM common procedure to the UE, if downlink signalling is pending; or

  4)	send a SERVICE ACCEPT message to complete the service request procedure, if no NAS security mode control procedure was initiated, the MME did not send a SERVICE ACCEPT message as specified above to perform an EPS bearer context status synchronization, and the MME did not initiate any of the procedures specified in item 1 to 3 above.

In NB-S1 mode, for cases a, b, c and m in subclause 5.6.1.1, if the MME needs to initiate the setup of user plane radio bearer(s), the MME shall check if the UE can support the establishment of additional user plane radio bearer based on the multiple DRB support indicated by UE in the UE network capability IE.

For cases a, b and c in subclause 5.6.1.1, if the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST message, the network shall deactivate all those EPS bearer contexts locally (without peer-to-peer signalling between the network and the UE) which are active on the network side but are indicated by the UE as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the CONTROL PLANE SERVICE REQUEST message, and this default bearer is not associated with the last PDN connection of the UE in the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.

If the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST and the MME decides to respond with a SERVICE ACCEPT message, the MME shall include an EPS bearer context status IE, indicating which EPS bearer contexts are active in the MME, except for the case when no EPS bearer context exists on the network side.

If the MME needs to initiate an EPS bearer context status synchronization, the MME may include an EPS bearer context status IE in the SERVICE ACCEPT message also if no EPS bearer context status IE was included in the CONTROL PLANE SERVICE REQUEST message.

If the MME sends a SERVICE ACCEPT message upon receipt of the CONTROL PLANE SERVICE REQUEST message piggybacked with the ESM DATA TRANSPORT message:

  -	if the Release assistance indication IE is set to "No further uplink or downlink data transmission subsequent to the uplink data transmission is expected" in the message;

  -	if the UE has indicated support for the control plane data back-off timer; and

  -	if the MME decides to activate the congestion control for transport of user data via the control plane,

then the MME shall include the T3448 value IE in the SERVICE ACCEPT message.

If the MME sends a SERVICE ACCEPT message and decides to deactivate congestion control for transport of user data via the control plane then the MME shall delete the stored control plane data back-off time for the UE and the MME shall not include timer T3448 value IE in SERVICE ACCEPT message.

For cases a, b, c and m in subclause 5.6.1.1, if the EPS bearer context status IE is included in the CONTROL PLANE SERVICE REQUEST message or the MME needs to initiate an EPS bearer context status synchronization, the MME shall consider the service request procedure successfully completed when it sends the SERVICE ACCEPT message. If the EPS bearer context status IE is not included in the CONTROL PLANE SERVICE REQUEST message and the MME does not need to initiate an EPS bearer context status synchronization, the MME shall consider the service request procedure successfully completed in the following cases:

  -	when it successfully completes a NAS security mode control procedure;

  -	when it receives an indication from the lower layer that the user plane is setup, if radio bearer establishment is required;

  -	upon receipt of the CONTROL PLANE SERVICE REQUEST message and completion of the EMM common procedures, if any, if the CONTROL PLANE SERVICE REQUEST message was successfully integrity checked and the ESM message container or NAS message container in the CONTROL PLANE SERVICE REQUEST message, if applicable, was successfully deciphered, radio bearer establishment is not required, and the MME has downlink user data or signalling not related to an EMM common procedure pending; and

  -	with the transmission of a SERVICE ACCEPT message or with the decision to initiate release of the NAS signalling connection, if the CONTROL PLANE SERVICE REQUEST message was successfully integrity checked and the ESM message container or NAS message container in the CONTROL PLANE SERVICE REQUEST message, if applicable, was successfully deciphered, radio bearer establishment is not required, and the MME does not have any downlink user data or signalling pending.

If the MME considers the service request procedure successfully completed the MME shall:

  1)	forward the contents of the ESM message container IE, if any, to the ESM layer; and

  2)	forward the contents of the NAS message container IE, if any.

For cases a, b and c in subclause 5.6.1.1, the UE shall treat the receipt of any of the following as successful completion of the procedure:

  -	a SECURITY MODE COMMAND message;

  -	a security protected EMM message different from a SERVICE REJECT message and not related to an EMM common procedure;

  -	a security protected ESM message; and

  -	receipt of the indication from the lower layers that the user plane radio bearers are set up.

Upon successful completion of the procedure, the UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.

  NOTE 4:	The security protected EMM message can be e.g. a SERVICE ACCEPT message and the ESM message an ESM DATA TRANSPORT message.

For case m in subclause 5.6.1.1, the UE shall treat the indication from the lower layers that the user plane radio bearers are set up as successful completion of the procedure. The UE shall treat the receipt of a SERVICE ACCEPT message as completion of the procedure without the establishment of the user plane radio bearers. For both cases, the UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.

For case b in subclause 5.6.1.1, the UE shall also treat the indication from the lower layers that the RRC connection has been released as successful completion of the procedure. The UE shall reset the service request attempt counter, stop the timer T3417 and enter the state EMM-REGISTERED.

For cases a, c and m in subclause 5.6.1.1, the UE shall treat the indication from the lower layers that the RRC connection has been released as an abnormal case and shall follow the procedure described in subclause 5.6.1.6, item b.

For cases a, b and c in subclause 5.6.1.1,

  -	if the MME needs to initiate an EPS bearer context status synchronization, the UE can receive a SERVICE ACCEPT message even after it received a SECURITY MODE COMMAND message or an indication from the lower layers that the user plane radio bearers are set up and determined successful completion of the service request procedure. Upon receipt of the SECURITY MODE COMMAND message or an indication from the lower layers that the user plane radio bearers are set up, the UE shall start timer T3449. If the UE receives a security protected ESM message or a security protected EMM message not related to an EMM common procedure, the UE shall stop the timer T3449. If the UE receives a SERVICE ACCEPT message while the timer T3449 is running, the UE shall treat the SERVICE ACCEPT message and stop the timer T3449. If the UE is not in state EMM-SERVICE-REQUEST-INITIATED and timer T3449 is not running, the receipt of the SERVICE ACCEPT message is considered as protocol error and the UE shall return EMM STATUS message as specified in subclause 7.4; otherwise the UE shall treat the SERVICE ACCEPT message; and

  -	if the UE treats the SERVICE ACCEPT message and an EPS bearer context status IE is included in the message, the UE shall deactivate all those EPS bearers contexts locally (without peer-to-peer signalling between the UE and the MME) which are active in the UE, but are indicated by the MME as being inactive. If a default EPS bearer context is marked as inactive in the EPS bearer context status IE included in the SERVICE ACCEPT message, and this default bearer is not associated with the last remaining PDN connection in the UE, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME. If the default bearer is associated with the last remaining PDN connection of the UE in the MME, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the MME.

If the T3448 value IE is present in the received SERVICE ACCEPT message, the UE shall:

  -	stop timer T3448 if it is running;

  -	consider the transport of user data via the control plane as successful; and

  -	start timer T3448 with the value provided in the T3448 value IE.

If the UE is using EPS services with control plane CIoT EPS optimization, the T3448 value IE is present in the SERVICE ACCEPT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and proceed as if the T3448 value IE is not present.

  If the UE in EMM-IDLE mode initiated the service request procedure by sending a CONTROL PLANE SERVICE REQUEST message and the SERVICE ACCEPT message does not include the T3448 value IE and if timer T3448 is running, then the UE shall stop timer T3448.


5.6.1.5	Service request procedure not accepted by the network

If the service request cannot be accepted, the network shall return a SERVICE REJECT message to the UE including an appropriate EMM cause value.

  NOTE 1:	A service request can only be rejected before the network has initiated any procedure which will be interpreted by the UE as successful completion of the service request procedure (see subclauses 5.6.1.4.1 and 5.6.1.4.2) and which will trigger a transition from state EMM-SERVICE-REQUEST-INITIATED to EMM-REGISTERED on the UE side.

Based on local policies or configurations in the MME, if the MME determines to change the periodic tracking area update timer (T3412), or if the MME determines to change the PSM usage or the value of timer T3324 in the UE for which PSM is allowed by the MME, the MME may return a SERVICE REJECT with the cause #10 "implicitly detached" to the UE.

The MME may be configured to perform MME-based access control for mobile originating CS fallback calls for a certain area A by rejecting related service request with EMM cause #39 "CS service temporarily not available".

  NOTE 2:	Dependent on implementation and operator configuration the area A can be configured with the granularity of an MME area, tracking area or eNodeB service area.

The MME may further be configured for a certain area A' to exempt service requests for mobile originating CS fallback calls from this MME-based access control, if:

  -	the service request is initiated in EMM-IDLE mode; and

  -	the UE indicated support of eNodeB-based access control for mobile originating CS fallback calls during an attach or tracking area updating procedure.

  NOTE 3:	The operator can use this second option when the eNodeBs in area A' are supporting the eNodeB-based access control for CS fallback calls. The area A' can be part of area A or the whole area A. It is the responsibility of the operator to coordinate the activation of MME-based access control and eNodeB-based access control for mobile originating CS fallback calls.

When the EMM cause value is #39 "CS service temporarily not available", the MME shall include a value for timer T3442 in the SERVICE REJECT message. If a mobile terminating CS fallback call is aborted by the network during call establishment as specified in 3GPP TS 29.118 [16A], the MME shall include the EMM cause value #39 "CS service temporarily not available" and set the value of timer T3442 to zero.

If a service request from a UE with only LIPA PDN connections is not accepted due to the reasons specified in subclause 5.6.1.4, depending on the service request received, the MME shall include the following EMM cause value in the SERVICE REJECT message:

  -	if the service request received is not due to CS fallback or 1xCS fallback, EMM cause value #10 "implicitly detached"; or

  -	if the service request received is due to CS fallback or 1xCS fallback, EMM cause value #40 "no EPS bearer context activated".

If a service request from a UE with only remaining SIPTO at the local network PDN connections is not accepted due to the reasons specified in subclause 5.6.1.4, depending on the service request received, the MME shall:

  -	if the service request received is due to CS fallback or 1xCS fallback, include the EMM cause value #40 "no EPS bearer context activated" in the SERVICE REJECT message; or

  -	if the service request received is not due to CS fallback or 1xCS fallback, abort the service request procedure and send a DETACH REQUEST message to the UE with detach type "re-attach required" (see subclause 5.5.2.3.1).

If the service request for mobile originated services is rejected due to general NAS level mobility management congestion control, the network shall set the EMM cause value to #22 "congestion" and assign a value for back-off timer T3346.

If the service request for mobile originated services is rejected due to service gap control as specified in subclause 5.3.17 i.e. the T3447 timer is running, the network shall set the EMM cause value to #22 "congestion" and may assign a back-off timer T3346 with the remaining time of the running T3447 timer.

If the MME sends a SERVICE REJECT message upon receipt of the CONTROL PLANE SERVICE REQUEST message piggybacked with the ESM DATA TRANSPORT message:

  -	if the Release assistance indication IE is not set to "No further uplink or downlink data transmission subsequent to the uplink data transmission is expected" in the message;

  -	if the UE has indicated a support for the control plane data back-off timer; and

  -	if the MME decides to activate the congestion control for transport of user data via the control plane,

then the MME shall set the EMM cause value to #22 "congestion" and assign a value for control plane data back-off timer T3448.

On receipt of the SERVICE REJECT message, if the UE is in state EMM-SERVICE-REQUEST-INITIATED and the message is integrity protected or contains a reject cause other than EMM cause value #25, the UE shall reset the service request attempt counter, stop timer T3417, T3417ext or T3417ext-mt, if running.

If the SERVICE REJECT message with EMM cause #25 was received without integrity protection, then the UE shall discard the message.

The UE shall take the following actions depending on the received EMM cause value in the SERVICE REJECT message.

  #3	(Illegal UE);

  #6	(Illegal ME); or

  #8	(EPS services and non-EPS services not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. The UE shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI and ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value. The USIM shall be considered as invalid also for non-EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for non-GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

  NOTE 4:	The possibility to configure a UE so that the radio transceiver for a specific radio access technology is not active, although it is implemented in the UE, is out of scope of the present specification.

    	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the service request procedure is rejected with the 5GMM cause with the same value.

  #7	(EPS services not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall consider the USIM as invalid for EPS services until switching off or the UICC containing the USIM is removed or the timer T3245 expires as described in subclause 5.3.7a. The UE shall enter the state EMM-DEREGISTERED. If the message has been successfully integrity checked by the NAS and the UE maintains a counter for "SIM/USIM considered invalid for GPRS services", then the UE shall set this counter to UE implementation-specific maximum value.

    	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.

    	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED, shall attempt to select GERAN or UTRAN radio access technology and proceed with appropriate MM specific procedure according to the MM service state. The UE shall not reselect E-UTRAN radio access technology until switching off or the UICC containing the USIM is removed.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the service request procedure is rejected with the 5GMM cause with the same value.

  #9	(UE identity cannot be derived by the network);

    	The UE shall set the EPS update status to EU2 NOT UPDATED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.

    	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

    	If the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.

    	If the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.

    	If the service request was initiated for any reason other than CS fallback, 1x CS fallback or initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.

  NOTE 5:	User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

    	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services.

    	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.

    	If the UE is operating in single-registration mode, the UE shall handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the service request procedure is rejected with the 5GMM cause with the same value.

  #10	(Implicitly detached);

    	A UE in CS/PS mode 1 or CS/PS mode 2 of operation is IMSI detached for both EPS services and non-EPS services.

    	The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.

    	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

    	If the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.

    	If the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.

    	If the service request was initiated for any reason other than CS fallback, 1x CS fallback or initiating a PDN connection for emergency bearer services, the UE shall perform a new attach procedure.

  NOTE 6:	User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

    	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the service request procedure is rejected with the 5GMM cause with the same value.

  #11	(PLMN not allowed); or

  #35	(Requested service option not authorized in this PLMN);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.PLMN-SEARCH.

    	The UE shall store the PLMN identity in the "forbidden PLMN list" and if the UE is configured to use timer T3245 (see 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) then the UE shall start timer T3245 and proceed as described in subclause 5.3.7a. If the message has been successfully integrity checked by the NAS and the UE maintains a PLMN-specific attempt counter for that PLMN, then the UE shall set this counter to the UE implementation-specific maximum value.

    	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number and the MM parameters update status, TMSI, LAI, ciphering key sequence number and the location update attempt counter as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the service request procedure is rejected with the 5GMM cause with the same value.

  #12	(Tracking area not allowed);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3) and shall delete any GUTI, last visited registered TAI, TAI list and eKSI. The UE shall enter the state EMM-DEREGISTERED.LIMITED-SERVICE.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for regional provision of service".

    	If the UE initiated service request for mobile originated CS fallback and a CS fallback cancellation request was not received, then the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure is rejected with the 5GMM cause with the same value.

  #13	(Roaming not allowed in this tracking area);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). The UE shall enter the state EMM-REGISTERED.PLMN-SEARCH.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and remove the current TAI from the stored TAI list if present.

    	The UE shall perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure is rejected with the 5GMM cause with the same value.

  #15	(No suitable cells in tracking area);

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.3). The UE shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

    	The UE shall store the current TAI in the list of "forbidden tracking areas for roaming" and remove the current TAI from the stored TAI list if present.

    	If the UE initiated service request for mobile originated CS fallback and a CS fallback cancellation request was not received, then the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

    	If the service request was not initiated for mobile originated CS fallback, the UE shall search for a suitable cell in another tracking area or in another location area according to 3GPP TS 36.304 [21].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters except the current TAI as specified in 3GPP TS 24.501 [54] for the case when the service request procedure is rejected with the 5GMM cause with the same value.

  #18	(CS domain not available);

    	If the request was related to CS fallback, the UE shall send an indication to the MM sublayer and shall not attempt CS fallback until combined tracking area updating procedure has been successfully completed. The UE shall enter the state EMM-REGISTERED.NORMAL-SERVICE.

    	The UE shall set the update status to U2 NOT UPDATED.

    	If the UE is in CS/PS mode 1 of operation with "IMS voice not available" and the request was related to CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology and disable the E-UTRA capability (see subclause 4.5).

    	If the UE is in CS/PS mode 1 or CS/PS mode 2 mode of operation, the UE may provide a notification to the user or the upper layers that the CS domain is not available.

    	If the request was related to 1xCS fallback, the UE shall cancel upper layer actions related to 1xCS fallback and enter the state EMM-REGISTERED.NORMAL-SERVICE.

  #22	(Congestion);

    	If the T3346 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall proceed as described below, otherwise it shall be considered as an abnormal case and the behaviour of the UE for this case is specified in subclause 5.6.1.6.

    	If the rejected request was not for initiating a PDN connection for emergency bearer services, the UE shall abort the service request procedure and enter state EMM-REGISTERED, and stop timer T3417, T3417ext or T3417ext-mt if still running.

    	The UE shall stop timer T3346 if it is running.

    	If the SERVICE REJECT message is integrity protected, the UE shall start timer T3346 with the value provided in the T3346 value IE.

    	If the SERVICE REJECT message is not integrity protected, the UE shall start timer T3346 with a random value from the default range specified in 3GPP TS 24.008 [13].

    	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

  NOTE 7:	If the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.

    	If the service request was initiated for CS fallback for emergency call and a CS fallback cancellation request was not received, the UE may attempt to select GERAN or UTRAN radio access technology. It then proceeds with appropriate MM and CC specific procedures. The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer.

    	If the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.

    	If the service request was initiated for 1xCS fallback for emergency call, the UE may select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.

    	If the service request was initiated in EMM-CONNECTED mode with Control plane service type "mobile originating request" and with the "active" flag set to 1, the UE shall abort the procedure.

    	If the service request was initiated for an "originating MMTEL voice" call type, a notification that the service request was not accepted due to congestion shall be provided to the upper layers.

  NOTE 8:	This can result in the upper layers requesting establishment of the originating voice call on an alternative radio access network, if available (see 3GPP TS 24.173 [13E]).

    	For all other cases the UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

    	If the UE is using EPS services with control plane CIoT EPS optimization and if the T3448 value IE is present in the SERVICE REJECT message and the value indicates that this timer is neither zero nor deactivated, the UE shall:

    -	stop timer T3448 if it is running;

    -	consider the transport of user data via the control plane as unsuccessful; and

    -	start timer T3448:

       -	with the value provided in the T3448 value IE if the SERVICE REJECT message is integrity protected; or

       -	with a random value from the default range specified in table 10.2.1 if the SERVICE REJECT message is not integrity protected.

    	If the UE is using EPS services with control plane CIoT EPS optimization and if the T3448 value IE is present in the SERVICE REJECT message and the value indicates that this timer is either zero or deactivated, the UE shall consider this case as an abnormal case and follow the behaviour specified in subclause 5.6.1.6.

    	If the UE is operating in single-registration mode, the UE shall in addition handle the 5GMM parameters as specified in 3GPP TS 24.501 [54] for the case when the service request procedure is rejected with the 5GMM cause with the same value.

  #25	(Not authorized for this CSG);

    	EMM cause #25 is only applicable when received from a CSG cell. EMM cause #25 received from a non-CSG cell is considered as an abnormal case and the behaviour of the UE is specified in subclause 5.6.1.6.

    	The UE shall set the EPS update status to EU3 ROAMING NOT ALLOWED (and store it according to subclause 5.1.3.3). The UE shall enter the state EMM-REGISTERED.LIMITED-SERVICE.

    	If the CSG ID and associated PLMN identity of the cell where the UE has initiated the service request procedure are contained in the Allowed CSG list, the UE shall remove the entry corresponding to this CSG ID and associated PLMN identity from the Allowed CSG list.

    	If the CSG ID and associated PLMN identity of the cell where the UE has initiated the service request procedure are contained in the Operator CSG list, the UE shall apply the procedures defined in 3GPP TS 23.122 [6] subclause 3.1A.

    	The UE shall search for a suitable cell according to 3GPP TS 36.304 [21].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM parameters GMM state and GPRS update status as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause with the same value.

  #39	(CS service temporarily not available);

    	If the T3442 value received in the SERVICE REJECT message is not zero, the UE shall start timer T3442 and enter the state EMM-REGISTERED.NORMAL-SERVICE. If the T3442 value received in the SERVICE REJECT message is zero, the UE shall not start timer T3442.

    	The UE shall not try to send an EXTENDED SERVICE REQUEST message for mobile originating CS fallback to the network, except for mobile originating CS fallback for emergency calls, until timer T3442 expires or the UE sends a TRACKING AREA UPDATE REQUEST message.

  #40	(No EPS bearer context activated);

    	The UE shall enter the state EMM-DEREGISTERED.NORMAL-SERVICE. The UE shall delete any mapped EPS security context or partial native EPS security context.

    	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

    	If the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.

    	If the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, the UE shall perform a new attach procedure.

    	If the service request was initiated for any reason other than CS fallback or 1x CS fallback, the UE shall perform a new attach procedure.

  NOTE 9:	User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s) automatically.

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall handle the GMM state as specified in 3GPP TS 24.008 [13] for the case when the service request procedure is rejected with the GMM cause value #10 "Implicitly detached".

    	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation which is already IMSI attached for non-EPS services is still IMSI attached for non-EPS services in the network.

    	A UE operating in CS/PS mode 1 or CS/PS mode 2 of operation shall set the update status to U2 NOT UPDATED.

  #42	(Severe network failure);

    	The UE shall set the EPS update status to EU2 NOT UPDATED, and shall delete any GUTI, last visited registered TAI, eKSI, and list of equivalent PLMNs. The UE shall start an implementation specific timer, setting its value to 2 times the value of T as defined in 3GPP TS 23.122 [6]. While this timer is running, the UE shall not consider the PLMN + RAT combination that provided this reject cause as a candidate for PLMN selection. The UE then enters state EMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP TS 23.122 [6].

    	If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition set the GMM state to GMM-DEREGISTERED, GPRS update status to GU2 NOT UPDATED, and shall delete the P-TMSI, P-TMSI signature, RAI and GPRS ciphering key sequence number.

Other values are considered as abnormal cases. The specification of the UE behaviour in those cases is described in subclause 5.6.1.6.


5.6.1.5A	Service request procedure for initiating a PDN connection for emergency bearer services not accepted by the network

If the service request for initiating a PDN connection for emergency bearer services cannot be accepted by the network, the UE shall perform the procedures as described in subclause 5.6.1.5. Then if the UE is in the same selected PLMN where the last service request was attempted, the UE shall:

  a)	inform the upper layers of the failure of the procedure; or

  NOTE 1:	This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.

  b)	detach locally, if not detached already, attempt EPS attach for emergency bearer services.

If the service request for initiating a PDN connection for emergency bearer services fails due to abnormal case a) in subclause 5.6.1.6, the UE shall perform the actions as described in subclause 5.6.1.6 and inform the upper layers of the failure to access the network.

  NOTE 2:	This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.

If the service request for initiating a PDN connection for emergency bearer services fails due to abnormal cases b), c) or e) in subclause 5.6.1.6, the UE shall perform the procedures as described in subclause 5.6.1.6. Then if the UE is in the same selected PLMN where the last service request was attempted, the UE shall:

  a)	inform the upper layers of the failure of the procedure; or

  NOTE 3:	This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.

  b)	detach locally, if not detached already, attempt EPS attach for emergency bearer services.


5.6.1.6	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	Access barred because of access class barring, EAB, ACDC or NAS signalling connection establishment rejected by the network without "Extended wait time" received from lower layers

    	In WB-S1 mode, if the service request procedure is started in response to a paging request from the network, access class barring, EAB or ACDC is not applicable.

    	In NB-S1 mode, if the service request procedure is started in response to a paging request from the network, access barring is not applicable.

    	If the trigger for the service request procedure is the response to a paging request from the network and the NAS signalling connection establishment is rejected by the network, the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. During an implementation dependent time period, the service request procedure may be started when access for "terminating calls" is granted or upon a cell change.

    	If the service request was initiated for CS fallback and the access is barred for "mobile originating CS fallback" (see 3GPP TS 36.331 [22]) and the lower layer indicates "the barring is due to CSFB specific access barring information", the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started if it is still necessary, i.e. when access for "mobile originating CS fallback" is granted or because of a cell change.

    	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received and the access is barred for "mobile originating CS fallback" (see 3GPP TS 36.331 [22]) and the lower layer does not indicate "the barring is due to CSFB specific access barring information", the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

    	If the service request was initiated for 1xCS fallback and the access is barred for "originating calls" (see 3GPP TS 36.331 [22]), the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.

    	If the lower layer indicated the access was barred because of access class barring for "originating calls" (see 3GPP TS 36.331 [22]) and if:

    -	the service request is initiated due to a request from upper layers for user plane radio resources, and the MO MMTEL voice call is started, the MO MMTEL video call is started or the MO SMSoIP is started;

    -	the service request is initiated due to a mobile originated SMS over NAS or SMS over S102; or

    -	the service request is initiated due to a request from upper layers for user plane radio resources, ACDC is applicable to the request and the UE supports ACDC.

    	then the service request procedure shall be started. The call type used shall be per annex D of this document.

  NOTE 1:	If more than one of MO MMTEL voice call is started, MO MMTEL video call is started or MO SMSoIP is started conditions are satisfied, it is left to UE implementation to determine the call type based on annex D of this document.

    	If access is barred for a certain ACDC category (see 3GPP TS 36.331 [22]), and if the upper layers request user plane radio resources for a higher ACDC category and the UE supports ACDC, then the service request procedure shall be started.

    	If an access request for an uncategorized application is barred due to ACDC (see 3GPP TS 36.331 [22]), and if the upper layers request user plane radio resources for a certain ACDC category and the UE supports ACDC, then the service request procedure shall be started.

    	Otherwise:

    -	In WB-S1 mode, if access is barred for "originating calls" (see 3GPP TS 36.331 [22]), the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. The service request procedure may be started if it is still necessary when access for "originating calls" is granted or because of a cell change.

    -	In NB-S1 mode, if access is barred for "originating calls" (see 3GPP TS 36.331  [22]), the service request procedure shall not be started. The UE stays in the current serving cell and applies normal cell reselection process. Further UE behaviour is implementation specific, e.g. the service request procedure is started again after an implementation dependent time; or

       	In NB-S1 mode, if access is barred for "originating calls" (see 3GPP TS 36.331 [22]), and a request for an exceptional event is received from the upper layers, then the service request procedure shall be started.

  NOTE 2:	In NB-S1 mode, the EMM layer cannot receive the access barring alleviation indication from the lower layers (see 3GPP TS 36.331 [22]).

  b)	Lower layer failure or release of the NAS signalling connection without "Extended wait time", without "Extended wait time CP data", and without redirection indication received from lower layers before the service request procedure is completed (see subclause 5.6.1.4) or before SERVICE REJECT message is received

    	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

    	If the service request was initiated for CS fallback and a CS fallback cancellation request was received, the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

    	If the service request was initiated for 1xCS fallback, the UE shall either:

    -	attempt to select cdma2000® 1x radio access technology and proceed with appropriate cdma2000® 1x CS procedures. If the UE fails to select cdma2000® 1x radio access technology, the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE; or

    -	set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE, and perform cell selection according to 3GPP TS 36.304 [21].

    	If the service request was not initiated for CS fallback or 1xCS fallback, the UE shall enter state EMM-REGISTERED.

    	The UE shall abort the service request procedure, stop timer T3417, T3417ext or T3417ext-mt and locally release any resources allocated for the service request procedure.

  c)	T3417 expired

    	The UE shall enter the state EMM-REGISTERED.

    	If the UE triggered the service request procedure in EMM-IDLE mode in order to obtain packet services, then the EMM sublayer shall increment the service request attempt counter, abort the procedure and release locally any resources allocated for the service request procedure. The service request counter shall not be incremented, if:

    -	the service request procedure is initiated to establish a PDN connection for emergency bearer services;

    -	the UE has a PDN connection for emergency bearer services established;

    -	the UE is a UE configured to use AC11 – 15 in selected PLMN;

    -	the service request is initiated in response to paging from the network; or

    -	the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]).

    	If the service request attempt counter is greater than or equal to 5, the UE shall start timer T3325 (see 3GPP TS 24.008 [13]). Additionally if the service request was initiated for an "originating MMTEL voice" call type, a notification that the service request was not accepted and that timer T3325 is running shall be provided to the upper layers.

  NOTE 3:	This can result in the upper layers requesting establishment of a CS voice call (if not already attempted in the CS domain), or other implementation specific mechanisms (see 3GPP TS 24.173 [13E]).

    	The UE shall not attempt service request until expiry of timer T3325 unless:

    -	the service request is initiated in response to paging from the network;

    -	the UE is a UE configured to use AC11 – 15 in selected PLMN;

    -	the service request is initiated to establish a PDN connection for emergency bearer services;

    -	the UE has a PDN connection for emergency bearer services established;

    -	the UE is registered in a new PLMN; or

    -	the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]).

    	If the service request for "originating MMTEL voice" call type was triggered while T3325 is running, a notification that the service request was not accepted and that timer T3325 is running shall be provided to the upper layers.

  NOTE 4:	This can result in the upper layers requesting establishment of a CS voice call (if not already attempted in the CS domain), or other implementation specific mechanisms (see 3GPP TS 24.173 [13E]).

  NOTE 5:	The NAS signalling connection can also be released if the UE deems that the network has failed the authentication check as specified in subclause 5.4.2.7.

    	If the UE triggered the service request procedure in order to obtain services other than packet services from EMM-IDLE mode, then the EMM sublayer shall abort the procedure and release locally any resources allocated for the service request procedure.

    	If the UE triggered the service request procedure in EMM-CONNECTED mode, the EMM sublayer shall abort the procedure and consider the service request procedure with "active" flag or the 1xCS fallback procedure as failed. The UE shall stay in EMM-CONNECTED mode.

  d)	T3417ext or T3417ext-mt expired

    	If a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

    	If a CS fallback cancellation request was received the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

  e)	SERVICE REJECT received, other EMM cause values than those treated in subclause 5.6.1.5, and cases of EMM cause values #22 and #25, if considered as abnormal cases according to subclause 5.6.1.5

    	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

    	If the service request was initiated for CS fallback and a CS fallback cancellation request was received, the UE shall set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

    	If the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.

    	If the service request was initiated for 1xCS fallback and the UE has dual Rx/Tx configuration and supports enhanced 1xCS fallback, then upon entering EMM-IDLE mode the UE shall perform tracking area updating procedure.

    	If the service request was not initiated for CS fallback or 1xCS fallback, the UE shall enter state EMM-REGISTERED.

    	The UE shall abort the service request procedure, stop timer T3417, T3417ext or T3417ext-mt and locally release any resources allocated for the service request procedure.

  f)	Tracking area updating procedure is triggered

    	The UE shall abort the service request procedure, stop timer T3417, T3417ext or T3417ext-mt if running and perform the tracking area updating procedure. The "active" flag shall be set in the TRACKING AREA UPDATE REQUEST message. If the service request was initiated for CS fallback or 1xCS fallback, and the CS fallback cancellation request was not received, the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection after the completion of the tracking area updating procedure.

  g)	Switch off

    	If the UE is in state EMM-SERVICE-REQUEST-INITIATED at switch off, the detach procedure shall be performed.

  h)	Detach procedure collision

    	EPS detach containing detach type "re-attach required":

       	If the UE receives a DETACH REQUEST message from the network in state EMM-SERVICE-REQUEST-INITIATED, the UE shall take the following actions:

       -	If the service request was initiated for CS fallback, the UE shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM, CC and GMM specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer;

       -	If the service request was initiated for 1xCS fallback, the UE shall attempt to select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures; or

       -	If the service request was not initiated for CS fallback or 1xCS fallback, the detach procedure shall be progressed and the service request procedure shall be aborted.

    	EPS detach containing detach type "re-attach not required":

       	If the UE receives a DETACH REQUEST message from the network in state EMM-SERVICE-REQUEST-INITIATED, the UE shall take the following actions:

       -	If the DETACH REQUEST message contains an EMM cause other than #2 "IMSI unknown in HSS" or no EMM cause IE, the detach procedure shall be progressed and the service request procedure shall be aborted. Additionally, if the service request was initiated for CS fallback or 1xCS fallback, but not for CS fallback for emergency call or 1xCS fallback for emergency call, the EMM sublayer shall indicate to the MM sublayer or the cdma2000® upper layers that the CS fallback or 1xCS fallback procedure has failed; or

       	If the DETACH REQUEST message contains EMM cause #2 "IMSI unknown in HSS", the UE will follow the procedure as described below for the detach type "IMSI detach".

    	EPS detach containing detach type "IMSI detach":

       	If the UE receives a DETACH REQUEST message from the network in state EMM-SERVICE-REQUEST-INITIATED, the UE shall take the following actions:

       -	if the service request was initiated for SMS over NAS or CS fallback, but not for CS fallback for emergency call, the UE shall abort the service request procedure and progress the detach procedure; or

       -	otherwise the UE shall progress both procedures.

  i)	Transmission failure of SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message indication with TAI change from lower layers

    	If the current TAI is not in the TAI list, the service request procedure shall be aborted to perform the tracking area updating procedure. The "active" flag shall be set in the TRACKING AREA UPDATE REQUEST message. If the service request was initiated for CS fallback or 1xCS fallback, and the CS fallback cancellation request was not received, the UE shall send the EXTENDED SERVICE REQUEST message to the MME by using the existing NAS signalling connection after the completion of the tracking area updating procedure.

    	If the current TAI is still part of the TAI list, the UE shall restart the service request procedure.

  j)	Transmission failure of SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message indication without TAI change from lower layers

    	The UE shall restart the service request procedure.

  k)	Default or dedicated bearer set up failure

    	If the lower layers indicate a failure to set up a radio bearer, the UE shall locally deactivate the EPS bearer as described in subclause 6.4.4.6.

  l)	"Extended wait time" from the lower layers

    	The UE shall abort the service request procedure, enter state EMM-REGISTERED, and stop timer T3417, T3417ext or T3417ext-mt if still running.

    	If the EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message contained the low priority indicator set to "MS is configured for NAS signalling low priority", the UE shall start timer T3346 with the "Extended wait time" value.

    	If the SERVICE REQUEST message was sent by a UE configured for NAS signalling low priority, the UE shall start timer T3346 with the "Extended wait time" value.

    	If the EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message did not contain the low priority indicator set to "MS is configured for NAS signalling low priority" or if the SERVICE REQUEST message was sent by a UE not configured for NAS signalling low priority, the UE is operating in NB-S1 mode and the UE is not a UE configured to use AC11 – 15 in selected PLMN, then the UE shall start timer T3346 with the "Extended wait time" value.

    	In other cases the UE shall ignore the "Extended wait time".

    	The UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.

    	If the service request was initiated for CS fallback and a CS fallback cancellation request was not received, the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

  NOTE 5:	If the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.

    	If the service request was initiated for CS fallback for emergency call and a CS fallback cancellation request was not received, the UE may attempt to select GERAN or UTRAN radio access technology. It then proceeds with appropriate MM and CC specific procedures. The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer.

    	If the service request was initiated for 1xCS fallback, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.

    	If the service request was initiated for 1xCS fallback for emergency call, the UE may select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS procedures.

    	If the service request was initiated due to a request from the SMS entity to send an SMS and timer T3246 is not running, the UE, if operating in CS/PS mode 1 of operation, may select GERAN or UTRAN radio access technology. It then proceeds with the appropriate MM procedure.

  NOTE 6:	If the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.

  la)	"Extended wait time CP data" from the lower layers

    	The UE shall abort the service request procedure for transfer of user data via the control plane, enter state EMM-REGISTERED, and stop timer T3417 if still running.

    	If the UE is operating in NB-S1 mode and supports the timer T3448, the UE shall start the timer T3448 with the "Extended wait time CP data" value. If the UE is operating in NB-S1 mode and does not support the timer T3448, the UE shall start the timer T3346 with the "Extended wait time CP data" value.

    	In other cases the UE shall ignore the "Extended wait time CP data".

    	The UE stays in the current serving cell and applies normal cell reselection process. The service request procedure for transfer of user data via the control plane is started, if still necessary, when the timer T3448 expires or is stopped.

  m)	Timer T3346 is running

    	The UE shall not start the service request procedure unless:

    -	the UE receives a paging;

    -	the UE is a UE configured to use AC11 – 15 in selected PLMN;

    -	the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services;

    -	the UE is requested by the upper layer for a CS fallback for emergency call or a 1xCS fallback for emergency call;

    -	the UE has a PDN connection established without the NAS signalling low priority indication or is establishing a PDN connection without the NAS signalling low priority indication and if the timer T3346 was started due to rejection of a NAS request message (e.g. ATTACH REQUEST, TRACKING AREA UPDATE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST) which contained the low priority indicator set to "MS is configured for NAS signalling low priority"; or

    -	the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and:

       -	the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the	NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]); and

       -	timer T3346 was not started when NAS signaling connection was established with RRC establishment cause set to "MO exception data".

    	If the UE is in EMM-IDLE mode, the UE stays in the current serving cell and applies normal cell reselection process. The service request procedure is started, if still necessary, when timer T3346 expires or is stopped.

    	Upon upper layer's request for a mobile originated CS fallback which is not for emergency call, the UE in CS/PS mode 1 of operation shall attempt to select GERAN or UTRAN radio access technology. If the UE finds a suitable GERAN or UTRAN cell, it then proceeds with the appropriate MM and CC specific procedures and the EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer. Otherwise the EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer.

  NOTE 7:	If the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.

    	Upon upper layer's request for a CS fallback for emergency call, the UE may select GERAN or UTRAN radio access technology. It then proceeds with appropriate MM and CC specific procedures. The EMM sublayer shall not indicate the abort of the service request procedure to the MM sublayer.

    	Upon a request from the SMS entity to send an SMS and timer T3246 is not running, the UE, if operating in CS/PS mode 1 of operation, may select GERAN or UTRAN radio access technology. It then proceeds with the appropriate MM procedure.

  NOTE 8:	If the UE disables the E-UTRA capability, then subsequent mobile terminating calls could fail.

    	Upon upper layer's request for a mobile originated 1x CS fallback which is not for emergency call, the UE shall select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS call procedures.

    	Upon upper layer's request for a 1xCS fallback for emergency call, the UE may select cdma2000® 1x radio access technology. The UE then proceeds with appropriate cdma2000® 1x CS call procedures.

  n)	Failure to find a suitable GERAN or UTRAN cell, after release of the NAS signalling connection without "Extended wait time" and with redirection indication received from lower layers when the service request was initiated for CS fallback

    	The EMM sublayer shall indicate the abort of the service request procedure to the MM sublayer, and the UE shall also set the EPS update status to EU2 NOT UPDATED and enter the state EMM-REGISTERED.ATTEMPTING-TO-UPDATE.

    	The UE shall abort the service request procedure, stop timer T3417ext or T3417ext-mt and locally release any resources allocated for the service request procedure.

  o)	Timer T3448 is running

    	The UE in EMM-IDLE mode shall not initiate the service request procedure for transport of user data via the control plane unless:

    -	the UE is a UE configured to use AC11 – 15 in selected PLMN;

    -	the UE which is only using EPS services with control plane CIoT EPS optimization received a paging; or

    -	the UE in NB-S1 mode is requested by the upper layer to transmit user data related to an exceptional event and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]).

    	The UE stays in the current serving cell and applies the normal cell reselection process.

  p)	Timer T3447 is running

    	The UE shall not start any service request procedure unless:

    -	the UE receives a paging;

    -	the UE is a UE configured to use AC11 – 15 in selected PLMN;

    -	the UE has a PDN connection for emergency bearer services established or is establishing a PDN connection for emergency bearer services.

    	The UE stays in the current serving cell and applies the normal cell reselection process. The service request procedure is started, if still necessary, when timer T3447 expires.


5.6.1.7	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	Lower layer failure

    	If a lower layer failure occurs before a SERVICE REJECT message has been sent to the UE or the service request procedure has been completed by the network, the network enters/stays in EMM-IDLE.

  b)	Protocol error

    	If the SERVICE REQUEST, EXTENDED SERVICE REQUEST or the CONTROL PLANE SERVICE REQUEST message is received with a protocol error, the network shall return a SERVICE REJECT message with one of the following EMM cause values:

    #96:	invalid mandatory information;

    #99:	information element non-existent or not implemented;

    #100:	conditional IE error; or

    #111:	protocol error, unspecified.

    	The network stays in the current EMM mode.

  c)	More than one SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST received before the procedure has been completed (i.e., before SERVICE REJECT message has been sent or service request procedure has been completed)

    -	If one or more of the information elements in the SERVICE REQUEST message, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST for packet services differs from the ones received within the previous SERVICE REQUEST, CONTROL PLANE SERVICE REQUEST or EXTENDED SERVICE REQUEST message for packet services, the previously initiated service request procedure shall be aborted and the new service request procedure shall be progressed;

  NOTE:	The network actions are implementation dependent for the case that more than one EXTENDED SERVICE REQUEST messages for CS fallback or 1xCS fallback are received and their information elements differ.

    -	If the information elements do not differ, then the network shall continue with the previous service request procedure and shall not treat any further this SERVICE REQUEST, EXTENDED SERVICE REQUEST or CONTROL PLANE SERVICE REQUEST message.

  d)	ATTACH REQUEST received before a SERVICE REJECT message has been sent or the service request procedure has been completed

    	If an ATTACH REQUEST message is received and the service request procedure has not been completed or a SERVICE REJECT message has not been sent, the network may initiate the EMM common procedures, e.g. the EMM authentication procedure. The network may e.g. after a successful EMM authentication procedure execution, abort the service request procedure, delete the EMM context, EPS bearer contexts, if any, and progress the new ATTACH REQUEST.

  e)	TRACKING AREA UPDATE REQUEST message received before the service request procedure has been completed or a SERVICE REJECT message has been sent

    	If a TRACKING AREA UPDATE REQUEST message is received and the service request procedure has not been completed or a SERVICE REJECT message has not been sent, the network may initiate the EMM common procedures, e.g. the EMM authentication procedure. The network may e.g. after a successful EMM authentication procedure execution, abort the service request procedure and progress the tracking area updating procedure.

  f)	Default or dedicated bearer set up failure

    	If the lower layers indicate a failure to set up a radio or S1 bearer, the MME shall locally deactivate the EPS bearer as described in subclause 6.4.4.6.


5.6.2	Paging procedure


5.6.2.1	General

The paging procedure is used by the network to request the establishment or resumption of a NAS signalling connection to the UE. Another purpose of the paging procedure is to prompt the UE to reattach if necessary as a result of a network failure. If the UE is not attached when it receives a paging for EPS services, the UE shall ignore the paging.

Additionally, the network can use the paging procedure to initiate the mobile terminating CS fallback procedure or SMS or user data transfer via the MME.


5.6.2.2	Paging for EPS services


5.6.2.2.1	Paging for EPS services through E-UTRAN using S-TMSI


5.6.2.2.1.1	General

The network shall initiate the paging procedure for EPS services using S-TMSI with CN domain indicator set to "PS" when NAS signalling messages, cdma2000® signalling messages or user data is pending to be sent to the UE when no NAS signalling connection exists (see example in figure 5.6.2.2.1.1).

For the UE using eDRX, the network initiates the paging procedure when NAS signalling messages, cdma2000® signalling messages or user data is pending to be sent to the UE within the paging time window. If NAS signalling messages, cdma2000® signalling messages or user data is pending to be sent to the UE outside the paging time window and the eDRX value that the network provides to the UE in the Extended DRX parameters IE during the last attach procedure or the last tracking area updating procedure is not all zeros (i.e. the E-UTRAN eDRX cycle length duration is higher than 5.12 seconds), the network initiates the paging procedure at T time ahead of the beginning of the next paging time window.

  NOTE 1:	T time is a short time period based on implementation. The operator can take possible imperfections in the synchronization between the CN and the UE into account when choosing T time.

[pic]

Figure 5.6.2.2.1.1: Paging procedure using S-TMSI

To initiate the procedure the EMM entity in the network requests the lower layer to start paging (see 3GPP TS 36.300 [20], 3GPP TS 36.413 [23]) and shall start the timer:

  -	T3415 for this paging procedure, if the network accepted to use eDRX for the UE and the UE does not have a PDN connection for emergency bearer services.

  -	Otherwise, T3413 for this paging procedure.

If the network starts timer T3415, the network shall set timer T3415 to a value smaller than the value of timer T3-RESPONSE (see 3GPP TS 29.274 [16D] for further details on timer T3-RESPONSE).

The EMM entity may provide the lower layer with a list of CSG IDs, including the CSG IDs of both the expired and the not expired subscriptions. If there is a PDN connection for emergency bearer services established, the EMM entity in the network shall not provide the list of CSG IDs to the lower layer.

Upon reception of a paging indication, if control plane CIoT EPS optimization is not used by the UE, the UE shall stop the timer T3346, if running, and shall initiate:

  -	a service request procedure to respond to the paging (see 3GPP TS 23.401 [10] and 3GPP TS 36.413 [23]); or

  -	a tracking area update procedure as specified in subclauses 5.5.3.2.2 and 5.5.3.3.2.

and additionally if the UE is in the EMM-IDLE mode with suspend indication, resume the suspended NAS signalling connection to the MME as specified in subclause 5.3.1.3.

Upon reception of a paging indication, if control plane CIoT EPS optimization is used by the UE, the UE shall stop the timer T3346, if running, and shall additionally:

  -	initiate a service request procedure as specified in subclause 5.6.1.2.2 if the UE is in the EMM-IDLE mode without suspend indication;

  -	initiate a tracking area update procedure as specified in subclauses 5.5.3.2.2; or

  -	proceed the behaviour as specified in subclause 5.3.1.3 if the UE is in the EMM-IDLE mode with suspend indication.

  NOTE 2:	If the UE is in the EMM-IDLE mode without suspend indication and has an uplink user data to be sent to the network using control plane CIoT EPS optimization when receiving the paging indication, the UE can piggyback the uplink user data during the service request procedure initiated to respond to the paging, as specified in subclause 5.6.1.2.2.

If the paging for EPS services was received during an ongoing UE-initiated EMM specific procedure or service request procedure, then the UE shall ignore the paging. The network shall proceed with the EMM specific procedure or the service request procedure, and stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415). If the network receives an ATTACH REQUEST message when the paging procedure is ongoing, it should be considered as an abnormal case, and the behaviour of the network for this case is specified in subclause 5.6.2.2.1.2.

The network shall stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415) when an integrity-protected response is received from the UE and successfully integrity checked by the network or when the EMM entity in the MME receives an indication from the lower layer that it has received the S1-AP UE context resume request message as specified in 3GPP TS 36.413 [23]. If the response received is not integrity protected, or the integrity check is unsuccessful, the timer for the paging procedure (i.e. either timer T3413 or timer T3415) shall be kept running unless:

  -	the UE has a PDN connection for emergency bearer services; or

  -	the response received is a TRACKING AREA UPDATE REQUEST message and the security mode control procedure or authentication procedure performed during tracking area update procedure has completed successfully.

Upon expiry of timer T3413, the network may reinitiate paging.

If the network, while waiting for a response to the paging sent without paging priority, receives downlink signalling or downlink data associated with priority EPS bearers, the network shall stop the timer for the paging procedure (i.e. either timer T3413 or timer T3415), and then initiate the paging procedure with paging priority.

Upon expiry of timer T3415, the network shall abort the paging procedure and shall proceed as specified in 3GPP TS 23.401 [10].


5.6.2.2.1.2	Abnormal cases on the network side

The following abnormal case can be identified:

  a)	ATTACH REQUEST message received when paging procedure is ongoing.

    	If an integrity-protected ATTACH REQUEST message is received from the UE and successfully integrity checked by the network, the network shall abort the paging procedure. If the ATTACH REQUEST message received is not integrity protected, or the integrity check is unsuccessful, the paging procedure shall be progressed.The paging procedure shall be aborted when the EPS authentication procedure performed during attach procedure is completed successfully.


5.6.2.2.2	Paging for EPS services through E-UTRAN using IMSI

Paging for EPS services using IMSI is an abnormal procedure used for error recovery in the network.

The network may initiate paging for EPS services using IMSI with CN domain indicator set to "PS" if the S-TMSI is not available due to a network failure (see example in figure 5.6.2.2.2.1).

[pic]

Figure 5.6.2.2.2.1: Paging procedure using IMSI

In S1 mode, to initiate the procedure the EMM entity in the network requests the lower layer to start paging. If the TAI list is not available due to a network failure, the network may perform the paging within all tracking areas served by the MME (see 3GPP TS 36.331 [22] and 3GPP TS 36.413 [23]).

When a UE receives a paging for EPS services using IMSI from the network before a UE initiated EMM specific procedure has been completed, then the UE shall abort the EMM specific procedure and proceed according to the description in this subclause.

Upon reception of a paging for EPS services using IMSI, the UE shall stop timer T3346, if it is running, locally deactivate any EPS bearer context(s), if any, and locally detach from EPS. Additionally the UE shall delete the following parameters: last visited registered TAI, TAI list, GUTI and KSIASME. The UE shall set the EPS update status to EU2 NOT UPDATED and change the state to EMM-DEREGISTERED. The UE shall stop all timers T3396 that are running.

If A/Gb mode or Iu mode is supported by the UE, the UE shall in addition handle the GMM parameters GMM state, GPRS update status, P-TMSI, P-TMSI signature, RAI, and GPRS ciphering key sequence number as specified in 3GPP TS 24.008 [13] for the case when a paging for GPRS services using IMSI is received.

After performing the local detach, the UE shall then perform an attach procedure as described in subclause 5.5.1.2. If the UE is operating in CS/PS mode 1 or CS/PS mode 2 of operation, then the UE shall perform a combined attach procedure as described in subclause 5.5.1.3.

  NOTE 1:	In some cases, user interaction can be required, thus the UE cannot activate the dedicated bearer context(s), if any, automatically.

  NOTE 2:	The UE does not respond to the paging except with the ATTACH REQUEST message, hence timers T3413 and T3415 in the network are not used when paging with IMSI.


5.6.2.3	Paging for CS fallback to A/Gb or Iu mode


5.6.2.3.1	General

The network may initiate the paging procedure for CS fallback when the UE is IMSI attached for non-EPS services (see example in figure 5.6.2.3.1.1).

[pic]

Figure 5.6.2.3.1.1: Paging procedure for CS fallback to A/Gb or Iu mode

To initiate the procedure when no NAS signalling connection exists, the EMM entity in the network requests the lower layer to start paging (see 3GPP TS 36.300 [20], 3GPP TS 36.413 [23]). The EMM entity may provide the lower layer with a list of CSG IDs, including the CSG IDs of both the expired and the not expired subscriptions. If there is a PDN connection for emergency bearer services established, the EMM entity in the network shall not provide the list of CSG IDs to the lower layer. The paging message includes a UE Paging Identity set to either the UE's S-TMSI or the UE's IMSI, and a CN domain indicator set to "CS" in order to indicate that this is paging for CS fallback.

  NOTE:	The timers T3413 and T3415 are not started in the network when the paging procedure is initiated for CS fallback.

To notify the UE about an incoming mobile terminating CS service excluding SMS over SGs when a NAS signalling connection exists, the EMM entity in the network shall send a CS SERVICE NOTIFICATION message. This message may also include CS service related parameters (e.g. Calling Line Identification, SS or LCS related parameters).

Upon reception of a paging indication, a UE that is IMSI attached for non-EPS services shall initiate a service request procedure or combined tracking area update procedure as specified in subclause 5.5.3.3.2. If the paging is received in EMM-IDLE mode, the UE shall respond immediately. If the paging is received as a CS SERVICE NOTIFICATION message in EMM-CONNECTED mode, the UE may request upper layers input i.e. to accept or reject CS fallback before responding with an EXTENDED SERVICE REQUEST. The response is indicated in the CSFB response information element in the EXTENDED SERVICE REQUEST message in both EMM-IDLE and EMM-CONNECTED modes.


5.6.2.3.2	Abnormal cases in the UE

A UE that requested "SMS only" in the combined attach procedure or combined tracking area updating procedure may ignore the CS SERVICE NOTIFICATION message or the paging indication with the CN domain indicator set to "CS".


5.6.2.3.3	Abnormal cases on the network side

The following abnormal case can be identified:

  a)	Void

  b)	ATTACH REQUEST message received when paging procedure is ongoing.

    	If an integrity-protected ATTACH REQUEST message is received from the UE and successfully integrity checked by the network, the network shall abort the paging procedure. If the ATTACH REQUEST message received is not integrity protected, or the integrity check is unsuccessful, the paging procedure shall be progressed.The paging procedure shall be aborted when the EPS authentication procedure performed during attach procedure is completed successfully.

  c)	TRACKING AREA UPDATE REQUEST message received in response to a CS SERVICE NOTIFICATION message

    	If the network receives a TRACKING AREA UPDATE REQUEST message in response to a CS SERVICE NOTIFICATION message, the network shall progress the tracking area updating procedure.

  NOTE:	After completion of the tracking area updating procedure the UE can accept or reject the CS fallback by sending an EXTENDED SERVICE REQUEST message.

  d)	DETACH REQUEST message received in response to a CS SERVICE NOTIFICATION message

    	If the network receives a DETACH REQUEST message with detach type "IMSI detach" or "combined EPS/IMSI detach" in response to a CS SERVICE NOTIFICATION message, the network shall progress the detach procedure.


5.6.2.4	Paging for SMS

The network shall initiate the paging procedure when it receives an incoming mobile terminating SMS to the UE if the UE is:

  -	IMSI attached for non-EPS services or for "SMS only"; or

  -	attached for EPS services with CIoT EPS optimization and the UE has requested "SMS only" and the UE is in NB-S1 mode,

and no NAS signalling connection exists.

For the UE using eDRX, the network initiates the paging procedure when an incoming mobile terminating SMS is received within the paging time window. If an incoming mobile terminating SMS is received outside the paging time window and the eDRX value that the network provides to the UE in the Extended DRX parameters IE during the last attach procedure or the last tracking area updating procedure is not all zeros (i.e. the E-UTRAN eDRX cycle length duration is higher than 5.12 seconds), the network initiates the paging procedure at T time ahead of the beginning of the next paging time window.

  NOTE:	T time is a short time period based on implementation. The operator can take possible imperfections in the synchronization between the CN and the UE into account when choosing T time.

To initiate the procedure for SMS when no NAS signalling connection exists, the EMM entity in the network requests the lower layer to start paging (see 3GPP TS 36.413 [23]). The paging message shall include a CN domain indicator set to "PS". If the paging message includes a UE Paging Identity set to the UE's S-TMSI, the paging procedure is performed according to subclause 5.6.2.2.1. If the paging message includes a UE Paging Identity set to the UE's IMSI, the paging procedure is performed according to subclause 5.6.2.2.2. The MME shall not start timers T3413 and T3415 for this procedure.


5.6.3	Transport of NAS messages procedure


5.6.3.1	General

The purpose of the transport of NAS messages procedure is to carry SMS messages in an encapsulated form between the MME and the UE. The procedure may be initiated by the UE or the network and can only be used when the UE is attached for EPS services and non-EPS services or for EPS services and "SMS only", and the UE is in EMM-CONNECTED mode.

  NOTE 1:	If the UE is in EMM-IDLE mode and is using EPS services with control plane CIoT EPS optimization, the UE transports the first SMS message by encapsulating it in the NAS message container IE in the Control Plane Service Request message.

  NOTE 2:	When the UE is using EPS services with control plane CIoT EPS optimization, the network can initiate downlink transport of NAS messages procedure even if the UE does not have any PDN connections established.


5.6.3.2	UE initiated transport of NAS messages

Upon request from the SMS entity to send an SMS message, the EMM entity in the UE initiates the procedure by sending an UPLINK NAS TRANSPORT message including the SMS message in the NAS message container IE.

  NOTE:	When the UE is using for EPS services with control plane CIoT EPS optimization, the UE can initiate uplink transport of NAS messages procedure even if the UE does not any PDN connections established.


5.6.3.3	Network initiated transport of NAS messages

The network initiates the procedure by sending a DOWNLINK NAS TRANSPORT message. When receiving the DOWNLINK NAS TRANSPORT message, the EMM entity in the UE shall forward the contents of the NAS message container IE to the SMS entity.

  NOTE:	When the UE is using for EPS services with control plane CIoT EPS optimization, the network can initiate downlink transport of NAS messages procedure even if the UE does not any PDN connections established.


5.6.3.4	Abnormal cases in the UE

The following abnormal case can be identified:

  a)	Timer T3346 is running

    	The UE shall not send an UPLINK NAS TRANSPORT message unless:

    -	the UE is a UE configured to use AC11 – 15 in selected PLMN;

    -	the UE has a PDN connection for emergency bearer services established; or

    -	the UE is configured for dual priority and has a PDN connection established without low access priority but the timer T3346 was started in response to NAS signalling request with low access priority.

  -	The UPLINK NAS TRANSPORT message can be sent, if still necessary, when timer T3346 expires or is stopped.

  b)	Timer T3447 is running

    	The UE shall not send an UPLINK NAS TRANSPORT message when the UE is in EMM-CONNECTED mode after the UE attached without PDN connection, unless:

    -	the UE is a UE configured to use AC11 – 15 in the selected PLMN; or

    -	a network initiated signaling message has been received.

    	The UPLINK NAS TRANSPORT message can be sent, if still necessary, when timer T3447 expires.


5.6.3.5	Abnormal cases on the network side

The following abnormal case can be identified:

  a)	Lower layer indication of non-delivered NAS PDU

    	If the DOWNLINK NAS TRANSPORT message is not delivered for any reason, the MME may discard the message.


5.6.4	Generic transport of NAS messages procedure


5.6.4.1	General

The purpose of the generic transport of NAS messages procedure is to carry protocol messages from various applications (e.g., an LCS application to send an LPP message or a location service message) in an encapsulated form between the MME and the UE. The procedure may be initiated by the UE or the network and can only be used when the UE is attached for EPS services and is in EMM-CONNECTED mode.


5.6.4.2	UE initiated generic transport of NAS messages

Upon request from an application to send a message encapsulated in the generic transport of NAS message, the EMM entity in the UE initiates the procedure by sending an UPLINK GENERIC NAS TRANSPORT message including the corresponding message in the generic message container IE. The application may also request additional information to be included in the UPLINK GENERIC NAS TRANSPORT message in the Additional information IE. The content, coding and interpretation of this information element are dependent on the particular application.

The UE shall indicate the application protocol using the generic transport in the corresponding generic message container type. When receiving the UPLINK GENERIC NAS TRANSPORT message, the EMM entity in the MME shall provide the contents of the generic message container IE and the generic message container type IE to the corresponding application. If included, the EMM entity in the MME shall also provide the contents of the Additional information IE.


5.6.4.3	Network initiated transport of NAS messages

Upon request from an application to send a message encapsulated in the generic transport of NAS message, the EMM entity in the MME initiates the procedure by sending a DOWNLINK GENERIC NAS TRANSPORT message including the corresponding message in the generic message container IE. The application may also request additional information to be included in the DOWNLINK GENERIC NAS TRANSPORT message in the Additional information IE. The content, coding and interpretation of this information element are dependent on the particular application.

The MME shall indicate the application protocol using the generic transport in the corresponding generic message container type. When receiving the DOWNLINK GENERIC NAS TRANSPORT message, the EMM entity in the UE shall provide the contents of the generic message container IE and the generic message container type IE to the corresponding application. If included, the EMM entity in the UE shall also provide the contents of the Additional information IE.


5.6.4.4	Abnormal cases in the UE

The following abnormal case can be identified:

  a)	Timer T3346 is running

    	The UE shall not send an UPLINK GENERIC NAS TRANSPORT message unless:

       	the UE is a UE configured to use AC11 – 15 in selected PLMN;

    -	the UE has a PDN connection for emergency bearer services established; or

       	the UE is configured for dual priority and has a PDN connection established without low access priority but the timer T3346 was started in response to NAS signalling request with low access priority.

  -	The UPLINK GENERIC NAS TRANSPORT message can be sent, if still necessary, when timer T3346 expires or is stopped.


5.6.4.5	Abnormal cases on the network side

The following abnormal case can be identified:

  a)	Lower layer indication of non-delivered NAS PDU

    	If the DOWNLINK GENERIC NAS TRANSPORT message is not delivered for any reason, the MME may discard the message.


5.7	Reception of an EMM STATUS message by an EMM entity

The purpose of the sending of the EMM STATUS message is to report at any time certain error conditions detected upon receipt of EMM protocol data. The EMM STATUS message can be sent by both the MME and the UE (see example in figure 5.7.1).

On receipt of an EMM STATUS message no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible. The local actions to be taken by the MME or the UE on receipt of an EMM STATUS message are implementation dependent.

[pic]

Figure 5.7.1: EMM status procedure


6	Elementary procedures for EPS session management


6.1	Overview


6.1.1	General

This clause describes the procedures used for EPS session management (ESM) at the radio interface (reference point "LTE-Uu").

The main function of the ESM sublayer is to support the EPS bearer context handling in the UE and in the MME.

The ESM comprises procedures for:

  -	the activation, deactivation and modification of EPS bearer contexts;

  -	the request for resources (IP connectivity to a PDN or dedicated bearer resources) by the UE; and

  -	the transport of user data via the control plane between the UE and the MME.

Each EPS bearer context represents an EPS bearer between the UE and a PDN. EPS bearer contexts can remain activated even if the radio and S1 bearers constituting the corresponding EPS bearers between UE and MME are temporarily released.

An EPS bearer context can be either a default bearer context or a dedicated bearer context.

A default EPS bearer context is activated when the UE requests a connection to a PDN.

Generally, ESM procedures can be performed only if an EMM context has been established between the UE and the MME, and the secure exchange of NAS messages has been initiated by the MME by use of the EMM procedures described in clause 5. The first default EPS bearer context, however, can be activated during the EPS attach procedure (see subclause 4.2). Once the UE is successfully attached, and the first default EPS bearer context has been activated during or after the attach procedure, the UE can request the MME to set up connections to additional PDNs. For each additional connection, the MME will activate a separate default EPS bearer context. A default EPS bearer context remains activated throughout the lifetime of the connection to the PDN.

A dedicated EPS bearer context is always linked to a default EPS bearer context and represents additional EPS bearer resources between the UE and the PDN. The network can initiate the activation of dedicated EPS bearer contexts together with the activation of the default EPS bearer context or at any time later, as long as the default EPS bearer context remains activated. However, the network shall not initiate a dedicated bearer context activation procedure for established PDN connection(s) of "non IP" PDN type.

Default and dedicated EPS bearer contexts can be modified. Dedicated EPS bearer contexts can be released without affecting the default EPS bearer context. When the default EPS bearer context is released, then all dedicated EPS bearer contexts linked to it are released too.

The UE can request the network to allocate, modify or release EPS bearer resources. The network can fulfil such a request from the UE by activating a new dedicated EPS bearer context, modifying an EPS bearer context or deactivating an EPS bearer context.


6.1.2	Types of ESM procedures

Two types of ESM procedures can be distinguished:

  1)	Procedures related to EPS bearer contexts:

    	These procedures are initiated by the network and are used for the manipulation of EPS bearer contexts:

    -	default EPS bearer context activation;

    -	dedicated EPS bearer context activation;

    -	EPS bearer context modification;

    -	EPS bearer context deactivation.

    	This procedure is initiated by the network or by the UE and is used for the transport of user data via the control plane:

    -	transport of user data via the control plane procedure.

  2)	Transaction related procedures:

    	These procedures are initiated by the UE to request for resources, i.e. a new PDN connection or dedicated bearer resources, or to release these resources:

    -	PDN connectivity procedure;

    -	PDN disconnect procedure;

    -	bearer resource allocation procedure;

    -	bearer resource modification procedure.

    	This procedure is initiated by the ProSe UE-to-network relay and is used for the manipulation of EPS bearer contexts:

    -	remote UE report.

    	When combined with the attach procedure, the PDN connectivity procedure can trigger the network to execute the following transaction related procedure:

    -	ESM information request procedure.

    	When combined with the attach procedure, if EMM-REGISTERED without PDN connection is supported by the UE and the network and no PDN connectivity procedure is initiated during the attach procedure, the UE or the network executes the following transaction related procedure:

    -	ESM dummy message procedure.

A successful transaction related procedure initiated by the UE triggers the network to execute one of the procedures related to EPS bearer contexts. The UE treats the start of the procedure related to the EPS bearer context as completion of the transaction related procedure.

During procedures related to EPS bearer contexts, the MME and the UE shall not initiate the transport of user data via the control plane procedure until the ongoing procedure is completed.

  NOTE 1:	The UE determination of the completion of the transport of user data via the control plane procedure is left to the implementation.

  NOTE 2:	NAS signalling prioritization with respect to the transport of user data via the control plane cannot be guaranteed in the downlink direction in this version of the specification.

Except for the remote UE report procedure and ESM information request procedure, during transaction related procedures, the MME and the UE shall not initiate the transport of user data via the control plane procedure until the ongoing procedure is completed.

The following ESM procedures can be related to an EPS bearer context or to a procedure transaction:

  -	ESM status procedure;

  -	notification procedure.


6.1.3	ESM sublayer states


6.1.3.1	General

In this subclause the possible states of EPS bearer contexts in the UE and on the network side are described. Each EPS bearer context is associated with an individual state.


6.1.3.2	ESM sublayer states in the UE


6.1.3.2.1	BEARER CONTEXT INACTIVE

No EPS bearer context exists.


6.1.3.2.2	BEARER CONTEXT ACTIVE

The EPS bearer context is active in the UE.

[pic]

Figure 6.1.3.2.2.1: The ESM sublayer states for EPS bearer context handling in the UE (overview)


6.1.3.2.3	PROCEDURE TRANSACTION INACTIVE

No procedure transaction exists.


6.1.3.2.4	PROCEDURE TRANSACTION PENDING

The UE has initiated a procedure transaction towards the network.



[pic]

Figure 6.1.3.2.4.1: The procedure transaction states in the UE (overview)


6.1.3.3	ESM sublayer states in the MME


6.1.3.3.1	BEARER CONTEXT INACTIVE

No EPS bearer context exists.


6.1.3.3.2	BEARER CONTEXT ACTIVE PENDING

The network has initiated an EPS bearer context activation towards the UE.


6.1.3.3.3	BEARER CONTEXT ACTIVE

The EPS bearer context is active in the network.


6.1.3.3.4	BEARER CONTEXT INACTIVE PENDING

The network has initiated an EPS bearer context deactivation towards the UE.


6.1.3.3.5	BEARER CONTEXT MODIFY PENDING

The network has initiated an EPS bearer context modification towards the UE.

[pic]

Figure 6.1.3.3.5.1: The ESM sublayer states for EPS bearer context handling in the network (overview)


6.1.3.3.6	PROCEDURE TRANSACTION INACTIVE

No procedure transaction exists.


6.1.3.3.7	PROCEDURE TRANSACTION PENDING

The network has initiated a procedure transaction towards the UE.



[pic]

Figure 6.1.3.3.7.1: The procedure transaction states in the network (overview)


6.1.4	Coordination between ESM and SM

For inter-system change from S1 mode to A/Gb mode or Iu mode, SM uses the following parameters from each active EPS bearer context:

  -	EPS bearer identity to map to NSAPI;

  NOTE 1:	If the UE and the MME support signalling for a maximum number of 15 EPS bearer contexts, any active EPS bearer contexts using EPS bearer identity 1 to 4 are not mapped but deactivated locally before inter-system change to A/Gb mode or Iu mode.

  -	linked EPS bearer identity (if available) to map to linked TI;

  -	PDN address and APN of the default EPS bearer context to map to PDP address and APN of the default PDP context;

  -	TFT of the default EPS bearer context, if any, to map to the TFT of the default PDP context;

  -	TFTs of the dedicated EPS bearer contexts to map to TFTs of the secondary PDP contexts; and

  -	GERAN/UTRAN parameters as provided by the MME while on E-UTRAN access, i.e. R99 QoS, LLC SAPI, radio priority, packet flow identifier, transaction identifier and BCM (if available). If the MME also provided an Extended EPS QoS IE, then the bit rates signalled with this IE are also applicable to the R99 QoS.

  NOTE 2:	Some networks not supporting mobility from S1 mode to A/Gb mode or Iu mode or both do not provide the UE with the GERAN/UTRAN parameters. However, for this case there is no need for the UE to perform mapping to GERAN/UTRAN parameters (i.e. the PDP contexts cannot be transferred to A/Gb mode or Iu mode).

The MME performs the mapping from EPS to R99 QoS parameters according to 3GPP TS 23.401 [10], annex E.

At inter-system change from S1 mode to A/Gb mode, SM shall not activate the PDP context(s) if SM does not have the following parameters from the active EPS bearer context(s):

  -	LLC SAPI;

  -	radio priority;

  -	transaction identifier; and

  -	R99 QoS.

At inter-system change from S1 mode to Iu mode, SM shall not activate the PDP context(s) if SM does not have the following parameter from the active EPS bearer context(s):

  -	transaction identifier; and

  -	R99 QoS.

For inter-system change from A/Gb mode or Iu mode to S1 mode, ESM uses the following parameters from each active PDP context:

  -	NSAPI to map to EPS bearer identity;

  -	NSAPI of the default PDP context to map to linked EPS bearer identity;

  -	PDP address and APN of the default PDP context to map to PDN address and APN of the default EPS bearer context;

  -	TFT of the default PDP context, if any, to map to the TFT of the default EPS bearer context; and

  -	TFTs of the secondary PDP contexts to map to the TFTs of the dedicated EPS bearer contexts.

The MME and the UE perform the mapping from R99 to EPS QoS parameters according to 3GPP TS 23.401 [10], annex E. In particular the MME derives the APN-AMBR for the corresponding PDN connection from the MBR of the R99 subscribed QoS profile and the UE maps the MBR of its default PDP context to the APN-AMBR of the corresponding PDN connection.


6.1.4A	Coordination between ESM and 5GSM

See subclause 6.1.4 in 3GPP TS 24.501 [54].


6.1.5	Coordination between ESM and EMM for supporting ISR

The UE with its TIN set as "RAT-related TMSI" for which ISR is activated shall change its TIN to "GUTI" to locally deactivate ISR and stop the periodic routing area update timer T3312 or T3323, if running:

  -	upon modification of any EPS bearer context which was activated before the ISR is activated in the UE;

  -	at the time when the UE changes from S1 mode to A/Gb mode or Iu mode not due to PS handover procedure (see 3GPP TS 24.008 [13]), if any EPS bearer context activated after the ISR was activated in the UE exists; or

  -	upon deactivation of the last non-emergency EPS bearer context in the UE, if the UE has only a PDN connection for emergency bearer services remaining.

ISR remains activated on the network side in the above cases.


6.2	IP address allocation


6.2.1	General

The UE can configure an IPv4 address during the establishment of a default EPS bearer context. The UE can obtain an IPv4 address or an IPv6 prefix or both via an IETF-based IP address allocation mechanism once the default bearer is established.

The following IETF-based IP address/prefix allocation methods are specified for EPS (the corresponding procedures are specified in 3GPP TS 29.061 [16]):

  a)	/64 IPv6 default prefix allocation via IPv6 stateless address autoconfiguration. Optionally, allocation of additional IPv6 prefix(es) with length /64 or shorter via stateful DHCPv6 Prefix Delegation (see IETF RFC 3633 [24A]);

  b)	IPv4 address allocation and IPv4 parameter configuration via DHCPv4;

  c)	IPv6 parameter configuration via stateless DHCPv6.

  NOTE:	From the perspective of the UE, the procedure used to allocate a static IP address via NAS signalling is the same as the procedure used to allocate a dynamic IP address specified in subclause 6.2.2.

Upon deactivation of the default bearer of a PDN connection, the UE shall locally release any IPv4 address or IPv6 prefix allocated to the UE for the corresponding PDN connection.


6.2.2	IP address allocation via NAS signalling

The UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message, based on its IP stack configuration if it requests IP connectivity (e.g. the per APN settings specified in 3GPP TS 23.401 [10]) as follows:

  a)-	A UE, which is IPv6 and IPv4 capable and

    -	has not been allocated an IP address for this APN, shall set the PDN type IE to IPv4v6.

    -	has been allocated an IPv4 address for this APN and received the ESM cause #52 "single address bearers only allowed", and is requesting an IPv6 address, shall set the PDN type IE to IPv6.

    -	has been allocated an IPv6 address for this APN and received the ESM cause #52 "single address bearers only allowed", and is requesting an IPv4 address, shall set the PDN type IE to IPv4.

  b)	A UE, which is only IPv4 capable, shall set the PDN type IE to IPv4.

  c)	A UE, which is only IPv6 capable, shall set the PDN type IE to IPv6.

  d)	When the IP version capability of the UE is unknown in the UE (as in the case when the MT and TE are separated and the capability of the TE is not known in the MT), the UE shall set the PDN type IE to IPv4v6.

If the UE wants to use DHCPv4 for IPv4 address assignment, it shall indicate that to the network within the Protocol Configuration Options IE in the PDN CONNECTIVITY REQUEST.

If the UE wants to get PDN connectivity without IP, the UE shall set the PDN type IE in the PDN CONNECTIVITY REQUEST message to "non IP".

On receipt of the PDN CONNECTIVITY REQUEST message sent by the UE, the network when allocating an IP address shall take into account the PDN type IE, the operator policies of the home and visited network, and the user's subscription data and:

  -	if the UE requests for PDN type IPv4v6, but the subscription is limited to IPv4 only or IPv6 only for the requested APN, the network shall override the PDN type requested by the UE to be limited to a single address PDN type (IPv4 or IPv6). In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, the network shall set the PDN type value to either "IPv4" or "IPv6" and the ESM cause value to #50 "PDN type IPv4 only allowed", or #51 "PDN type IPv6 only allowed", respectively. The UE shall not subsequently initiate another UE requested PDN connectivity procedure to the same APN to obtain a PDN type different from the one allowed by the network until:

    a)	all EPS bearer contexts to the given APN are deactivated at the UE as a result of:

       i)	EPS bearer context synchronization during tracking area updating or service request procedure;

       ii)	an EPS bearer context deactivation procedure initiated by the network;

       iii)	a local EPS bearer context deactivation without NAS signalling as specified in subclause 6.4.4.6;

       iv)	a detach procedure; or

       v)	a tracking area updating procedure or service request procedure that is rejected with a cause which results in the UE entering state EMM-DEREGISTERED;

    b)	the PDN type which is used to access to the APN is changed;

  NOTE 1:	Request to send another PDN CONNECTIVITY REQUEST message with a specific PDN type has to come from upper layers.

  -	if the UE requests PDN type IPv4v6, but the PDN GW configuration dictates the use of IPv4 addressing only or IPv6 addressing only for this APN, the network shall override the PDN type requested by the UE to limit it to a single address PDN type (IPv4 or IPv6). In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, the network shall set the PDN type value to either "IPv4" or "IPv6" and the ESM cause value to #50 "PDN type IPv4 only allowed", or #51 "PDN type IPv6 only allowed", respectively. The UE shall not subsequently initiate another UE requested PDN connectivity procedure to the same APN to obtain a PDN type different from the one allowed by the network until:

    a)	all EPS bearer contexs to the given APN are deactivated at the UE and the network as a result of:

       i)	EPS bearer context synchronization during tracking area updating or service request procedure;

       ii)	an EPS bearer context deactivation procedure initiated by the network;

       iii)	a local EPS bearer context deactivation without NAS signalling as specified in subclause 6.4.4.6;

       iv)	a detach procedure; or

       v)	a tracking area updating procedure or service request procedure that is rejected with a cause which results in the UE entering state EMM-DEREGISTERED ;

    b)	the PDN type which is used to access to the APN is changed;

  NOTE 2:	Request to send another PDN CONNECTIVITY REQUEST message with a specific PDN type has to come from upper layers.

  -	if the UE requests PDN type IPv4v6, but the operator uses single addressing per bearer, e.g. due to interworking with nodes of earlier releases, the network shall override the PDN type requested by the UE to a single IP version only. In the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE, the network shall set the PDN type value to either "IPv4" or "IPv6" and the ESM cause value to #52 "single address bearers only allowed". The UE should subsequently request another PDN connection for the other IP version using the UE requested PDN connectivity procedure to the same APN with a single address PDN type (IPv4 or IPv6) other than the one already activated;

  NOTE 3:	If the MT and TE are separated, the UE might not be able to use ESM cause #52 "single address bearers only allowed" as a trigger for activating a second single-IP-stack EPS bearer context.

  -	if the network sets the PDN type to IPv4 or IPv4v6, the network shall include an IPv4 address in the PDN address information. In this case, if the IPv4 address is to be configured using DHCPv4, the network shall set the IPv4 address to 0.0.0.0; and

  -	if the network sets the PDN type to IPv6 or IPv4v6, the network shall include the interface identifier that the UE shall use for the link local address in the PDN address information.

The network shall include the PDN type and the PDN address information within the PDN address IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message sent to the UE.


6.2A	IP header compression

The UE and the MME may support robust header compression (ROHC) framework (see IETF RFC 5795 [37]) for IP header compression if control plane CIoT EPS optimization is supported for PDN connections of IP PDN type. If IP header compression for control plane CIoT EPS optimization is supported, the ROHC profiles defined in 3GPP TS 36.323 [38] may be supported. The ROHC configuration is negotiated and established during the UE requested PDN connectivity procedure as specified in subclause 6.5.1. Both the UE and the MME indicate whether IP header compression for control plane CIoT EPS optimization is supported during attach and tracking area updating procedures (see subclauses 5.5.1 and 5.5.3). The ROHC configuration can be re-negotiated by using the UE requested bearer resource modification procedure or the EPS bearer context modification procedure as specified in subclauses 6.4.3 and 6.5.4.


6.3	General on elementary ESM procedures


6.3.1	Services provided by lower layers

Unless explicitly stated otherwise, the procedures described in the following subclauses can only be executed whilst a NAS signalling exists between the UE and the MME.


6.3.2	Principles of address handling for ESM procedures

Transaction related procedures use the procedure transaction identity as address parameter in the ESM message header. When the UE or the network initiates a transaction related procedure, it shall include a valid procedure transaction identity value in the message header and set the EPS bearer identity to "no EPS bearer identity assigned". When the ProSe UE-to-network relay initiates the transaction related procedure remote UE report, it shall include a valid procedure transaction identity value in the message header and set the EPS bearer identity to a valid EPS bearer identity value.

If the response message is again a transaction related message, e.g. a PDN CONNECTIVITY REJECT, PDN DISCONNECT REJECT, BEARER RESOURCE ALLOCATION REJECT, BEARER RESOURCE MODIFICATION REJECT, ESM INFORMATION REQUEST message or ESM DUMMY MESSAGE from the network or an ESM INFORMATION RESPONSE message or ESM DUMMY MESSAGE from the UE, the sending entity shall include the procedure transaction identity value received with the request message and set the EPS bearer identity to "no EPS bearer identity assigned" (see examples in figures 6.3.2.1, 6.3.2.1a and 6.3.2.2). If the response message is the transaction related message REMOTE UE REPORT RESPONSE message from the network, the network shall include the procedure transaction identity value received with the request message and set the EPS bearer identity to the EPS bearer identity value received from the ProSe UE-to-network relay (see example in figure 6.3.2.3).

If an ESM DUMMY MESSAGE is sent in response to a received ESM DUMMY MESSAGE, the sending entity shall include the received procedure transaction identity value in the message header and set the EPS bearer identity to "no EPS bearer identity assigned".

[pic]

Figure 6.3.2.1: Transaction related procedure initiated by the UE and rejected by the network

[pic]

Figure 6.3.2.1a: Transaction related procedure initiated by the UE and responded by a network initiated transaction related request

[pic]

Figure 6.3.2.2: Transaction related procedure initiated by the network

[pic]

Figure 6.3.2.3: Transaction related procedure initiated by the UE

EPS bearer context related procedures use the EPS bearer identity as address parameter in the ESM message header. When the network initiates an EPS bearer context related procedure, it shall include a valid EPS bearer identity value in the message header. The procedure transaction identity value shall be set as follows:

  -	If the EPS bearer context related procedure was triggered by the receipt of a transaction related request message from the UE, the network shall include the procedure transaction identity value received with the transaction related request message in the message header of the EPS bearer context related request message (see example in figure 6.3.2.3).

  -	If the procedure was triggered network-internally, the network shall set the procedure transaction identity value in the message header of the EPS bearer context related request message to "no procedure transaction identity assigned" (see example in figure 6.3.2.4).

  -	If the procedure was triggered by the transport of user data via the control plane, the network shall set the procedure transaction identity value in the message header of the EPS bearer context related request message to "no procedure transaction identity assigned" (see example in figure 6.3.2.5).

In the response message of the EPS bearer context related procedure, the UE shall include the EPS bearer identity value received from the network and set the procedure transaction identity value to "no procedure transaction identity assigned".

When the UE initiates an EPS bearer context related procedure and the procedure was triggered by the transport of user data via the control plane, it shall include a valid EPS bearer identity value and set the procedure transaction identity value to "no procedure transaction identity assigned" in the message header (see example in figure 6.3.2.6).

[pic]

Figure 6.3.2.3: EPS bearer context related procedure triggered by a transaction related request

[pic]

Figure 6.3.2.4: EPS bearer context related procedure triggered network-internally

[pic]

Figure 6.3.2.5: EPS bearer context related procedure triggered by network for the transport of user data via the control plane

[pic]

Figure 6.3.2.6: EPS bearer context related procedure triggered by UE for the transport of user data via the control plane


6.3.3	Abnormal cases in the UE

The following abnormal case can be identified:

  a)	ESM uplink message transmission failure indication by lower layers

    	Unless the procedure descriptions in subclause 6.6 specify a different behaviour, the following applies:

       	If lower layers indicate a TAI change, but the current TAI is not in the TAI list, the ESM procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure.

       	If lower layers indicate a TAI change, but the current TAI is still part of the TAI list, it is up to the UE implementation how the ESM procedure is re-initiated.

       	If lower layers indicate the TAI has not changed, it is up to the UE implementation how the ESM procedure is re-initiated.

  NOTE 1:	The ESM procedure can typically be re-initiated using a retransmission mechanism of the uplink message (the one that has previously failed to be transmitted) with new sequence number and message authentication code information thus avoiding to restart the whole procedure.

The case a) above does not apply to the ESM INFORMATION RESPONSE message.

  NOTE 2:	The ESM INFORMATION RESPONSE message can not be subjected to a transmission failure by lower layers due to handover as no handover message can be accepted by the UE prior to reception of the ATTACH ACCEPT message (see 3GPP TS 36.331 [22]).

  b)	Transmission failure of the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message indication from EMM sublayer when the UE received any ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST messages during the attach procedure

    	It is up to the UE implementation how the dedicated EPS bearer context activation procedure is re-initiated.

  NOTE 3:	The ESM procedure can typically be re-initiated using a retransmission mechanism of the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message or ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message with new sequence number and message authentication code information thus avoiding to restart the whole procedure.


6.3.4	Abnormal cases in the network

The following abnormal case can be identified:

  a)	Lower layer indication of non-delivered NAS PDU due to handover

    	Unless the procedure descriptions in subclause 6.4, 6.5 or 6.6 specify a different behaviour, the following applies:

    	If the downlink ESM NAS message could not be delivered due to an intra MME handover and the target TA is included in the TAI list, then upon successful completion of the intra MME handover the MME shall retransmit the ESM message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the downlink ESM NAS message.

  b)	Lower layer indication of non-delivered NAS PDU due to inter-eNodeB connected mode mobility when the transport of user data via the control plane is used

    	If the downlink ESM NAS message could not be delivered due to inter-eNodeB connected mode mobility and the MME is not changed, then upon successful completion of inter-eNodeB connected mode mobility the MME shall retransmit the ESM message. If a failure of inter-eNodeB connected mode mobility is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the downlink ESM NAS message.

  NOTE:	If the downlink ESM NAS message could not be delivered due to inter-eNodeB connected mode mobility and the MME is changed, the retransmission of downlink ESM NAS message is not supported.


6.3.5	Handling of APN based congestion control

The network may detect and start performing the APN based congestion control when one or more APN congestion criteria as specified in 3GPP TS 23.401 [10] are met. The network may store an APN congestion back-off time on a per UE and congested APN basis. If the UE does not provide an APN for a non-emergency PDN connection, then the MME uses the APN which is used in PDN GW selection procedure as congested APN. When APN based congestion control is active, the network may reject session management requests except the modification of bearer resources requests from UEs or disconnect existing PDN connections with ESM cause value #26 "insufficient resources".

In the UE, EPS session management timers T3396 for APN based congestion control are started and stopped on a per APN basis. The APN associated with T3396 is the APN provided by the UE when the PDN connection is established. If no APN is included in the PDN CONNECTIVITY REQUEST or, when applicable, in the ESM INFORMATION RESPONSE message, then T3396 is associated with no APN. For this purpose the UE shall memorize the APN provided to the network during the PDN connection establishment. The timer T3396 associated with no APN will never be started due to any ESM procedure related to an emergency PDN connection. If the timer T3396 associated with no APN is running, it does not affect the ability of the UE to request an emergency PDN connection.

If timer T3396 is running or is deactivated, and the UE is a UE configured to use AC11 – 15 in selected PLMN, then the UE is allowed to initiate an attach procedure or any EPS session management procedure for the respective APN.


6.3.5A	Handling of group specific session management congestion control

The network may detect and start performing the group specific session management congestion control when one or more group congestion criteria as specified in 3GPP TS 23.401 [10] are met. When group specific session management congestion control is active, the mechanism for APN based congestion control as specified in subclause 6.3.5 shall be followed.


6.3.6	Handling of network rejection not due to APN based congestion control

The network may include a back-off timer value in an EPS session management reject message to regulate the time interval at which the UE may retry the same procedure. For ESM cause values other than #26 "insufficient resources", the network may also include the re-attempt indicator to indicate whether the UE is allowed to re-attempt the corresponding session management procedure for the same APN in A/Gb or Iu mode after inter-system change.

  NOTE 1:	If the network includes this back-off timer value, then the UE is blocked from sending another ESM request for the same procedure for the same PLMN and APN combination for the specified duration. Therefore, the operator needs to exercise caution in determining the use of this timer value.

  NOTE 2:	If the re-attempt indicator is not provided by the network, a UE registered in its HPLMN or in an EHPLMN can use the configured SM_RetryAtRATChange value specified in the NAS configuration MO or in the USIM NASCONFIG file to derive the re-attempt indicator as specified in subclauses 6.5.1.4.3, 6.5.3.4.3, and 6.5.4.4.3.

If re-attempt in A/Gb or Iu mode is allowed, the UE shall consider the back-off timer to be applicable only to the EPS session management in S1 mode for the rejected EPS session management procedure and the given PLMN and APN combination. If re-attempt in A/Gb or Iu mode is not allowed, the UE shall consider the back-off timer to be applicable to both NAS protocols, i.e. applicable to the EPS session management in S1 mode for the rejected EPS session management procedure and to the GPRS session management in A/Gb and Iu mode for the corresponding session management procedure and the given PLMN and APN combination.

The APN of the PLMN and APN combination associated with the back-off timer is the APN provided by the UE when the PDN connection is established. If no APN is included in the PDN CONNECTIVITY REQUEST or, when applicable, in the ESM INFORMATION RESPONSE message, then the back-off timer is associated with the combination of the PLMN and no APN. For this purpose the UE shall memorize the APN provided to the network during the PDN connection establishment. The back-off timer associated with the combination of a PLMN with no APN will never be started due to any ESM procedure related to an emergency PDN connection. If the back-off timer associated with the combination of a PLMN with no APN is running, it does not affect the ability of the UE to request an emergency PDN connection.

The network may additionally indicate in the re-attempt indicator that a command to back-off is applicable not only for the PLMN in which the UE received the EPS session management reject message, but for each PLMN included in the equivalent PLMN list at the time when the EPS session management reject message was received.

If the back-off timer is running or is deactivated for a given PLMN and APN combination, and the UE is a UE configured to use AC11 – 15 in selected PLMN, then the UE is allowed to initiate an attach procedure or any EPS session management procedure for this PLMN and APN combination.


6.3.7	Handling of WLAN offload control

In networks that support offloading of traffic to WLAN, as specified in 3GPP TS 36.331 [22], a permission to offload is determined for the UE and the PDN connection in accordance with 3GPP TS 23.401 [10] subclause 4.3.23.


6.3.8	Handling of serving PLMN rate control

Serving PLMN rate control enables the serving PLMN to protect its MME and the signalling radio bearers in the E-UTRAN from load generated by NAS messages with user data over control plane. The MME can inform the UE of any local serving PLMN rate control during the default EPS bearer context activation procedure (see subclause 6.4.1). If the serving PLMN rate control is enabled, the MME shall start the serving PLMN rate control for the PDN connection when the first NAS message with user data over control plane is received over the PDN connection. The UE shall limit the rate at which it generates uplink NAS messages with user data over control plane to comply with the serving PLMN policy provided by the network. The indicated rate in a NAS procedure applies to the PDN connection the NAS procedure corresponds to, and the indicated rate is valid until the PDN connection is released.

Serving PLMN rate control is applicable for PDN connections established for control plane CIoT EPS optimization only.

Any serving PLMN rate control information provided by the network to the UE is only applicable for the PLMN which provided this information. This serving PLMN rate control information shall be discarded when the UE successfully registers to another PLMN.

  NOTE:	The serving PLMN can discard or delay NAS messages including user data over control plane that exceed the limit provided for serving PLMN rate control.


6.3.9	Handling of APN rate control

APN rate control controls the maximum number of uplink user data messages including uplink exception data reporting sent by the UE in a time interval for the APN in accordance with 3GPP TS 23.401 [10]. The UE shall limit the rate at which it generates uplink user data messages to comply with the APN rate control policy. The NAS shall provide the indicated rates to upper layers for enforcement. The indicated rates in a NAS procedure applies to the APN the NAS procedure corresponds to, and the indicated rates are valid until a new value is indicated or the last PDN connection using this APN is released.

If the UE supports APN rate control, the UE shall provide the support indication of APN rate control and additional APN rate control for exception data reporting to the network. If the UE indicates support of additional APN rate control for exception data reporting, the network may provide the APN rate control parameters for exception data to the UE. If the UE does not indicate support of additional APN rate control for exception data reporting, the network shall not provide the APN rate control parameters for exception data to the UE.

If an allowed indication of additional exception reports is provided with the APN rate control parameters and:

    -	the additional APN rate control parameters for exception data is provided and the limit for additional rate for exception data reporting is not reached; or

    -	the additional APN rate control parameters for exception data is not provided,

the UE is allowed to send uplink exception reports even if the limit for the APN rate control has been reached.

  NOTE:	The HPLMN can discard or delay user data that exceeds the limit provided for APN rate control.


6.3.10	Handling of 3GPP PS data off

A UE, which supports 3GPP PS data off (see 3GPP TS 23.401 [10]), can be configured with up to two lists of 3GPP PS data off exempt services as specified in 3GPP TS 24.368 [15A] or in the EF3GPPPSDATAOFF USIM file as specified in 3GPP TS 31.102 [17]:

  -	a list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN; and

  -	a list of 3GPP PS data off exempt services to be used in the VPLMN.

If only the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN is configured at the UE, this list shall be also used in the VPLMN.

If the UE supports 3GPP PS data off, the UE shall provide the 3GPP PS data off UE status in the protocol configuration options IE during attach, UE-requested PDN connectivity, and UE-requested bearer resource modification procedure (see subclause 5.5.1, 6.5.1, and 6.5.4).

  NOTE 1:	The sending of the 3GPP PS data off UE status to the network happens also when the user activates or deactivates 3GPP PS data off while connected via WLAN access only, and then handover to 3GPP access occur.

The network informs the UE about the support of 3GPP PS data off during the activation of the the default bearer of a PDN connection (see subclause 6.4.1). If 3GPP PS data off support is not indicated in the protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall not indicate any change of 3GPP PS data off UE status for the PDN connection established by the default EPS bearer context activation procedure; otherwise the UE shall indicate change of the 3GPP PS data off UE status for the PDN connection by using the UE-requested bearer resource modification procedure as specified in subclause 6.5.4. If the network does not provide indication of support of 3GPP PS data off during default EPS bearer context activation procedure of the PDN connection, the UE behaviour for non-exempt service requests from the network is implementation dependent.

When the 3GPP PS data off UE status is "activated":

  a)	the UE does not send uplink IP packets except:

    -	for those services indicated in the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN as specified in 3GPP TS 24.368 [15A] when the UE is in its HPLMN or EHPLMN;

    -	for those services indicated in the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN when the UE is in the VPLMN, if only the list of 3GPP PS data off exempt services to be used in the HPLMN or EHPLMN is configured to the UE as specified in 3GPP TS 24.368 [15A];

    -	for those services indicated in the list of 3GPP PS data off exempt services to be used in the VPLMN when the UE is in the VPLMN, if the list of 3GPP PS data off exempt services to be used in the VPLMN is configured to the UE as specified in 3GPP TS 24.368 [15A];

    -	for those services indicated in the EF3GPPPSDATAOFF USIM file as specified in 3GPP TS 31.102 [17];

    -	any uplink traffic due to procedures specified in 3GPP TS 24.229 [13D]; and

    -	any uplink traffic due to procedures specified in 3GPP TS 24.623 [50]; and

  b)	the UE does not send uplink non-IP user data packets.

Otherwise the UE sends uplink user data packets without restriction.

  NOTE 2:	If the UE supports 3GPP PS data off, uplink IP packets are filtered as specified in 3GPP TS 24.229 [13D] in L.3.1.5.


6.3.11	Handling of Reliable Data Service

If the UE supports Reliable Data Service (see 3GPP TS 24.250 [51]), the UE may request data transfer using Reliable Data Service for a PDN connection in the extended protocol configuration options IE during attach and UE-requested PDN connectivity procedures (see subclause 5.5.1 and 6.5.1).

The Reliable Data Service may only be used with PDN connections for which the "Control plane only" indicator is set or with PDN connections using the control plane CIoT EPS optimization when the MME does not move such PDN connections to the user plane.

The SCEF or P-GW shall inform the UE about the acceptance of UE's request for Reliable Data Service usage during the activation of the default bearer of a PDN connection (see subclause 6.4.1) in the extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message.

If the SCEF or P-GW accepts the use of Reliable Data Service to transfer data for the specified PDN connection, the UE shall use this PDN connection exclusively for data transfer using Reliable Data Service; otherwise the UE shall not use this PDN connection for data transfer using Reliable Data Service.


6.4	Network initiated ESM procedures


6.4.1	Default EPS bearer context activation procedure


6.4.1.1	General

The purpose of the default bearer context activation procedure is to establish a default EPS bearer context between the UE and the EPC. The default EPS bearer context activation procedure is initiated by the network as a response to the PDN CONNECTIVITY REQUEST message from the UE. The default bearer context activation procedure can be part of the attach procedure, and if the attach procedure fails, the UE shall consider that the default bearer activation has implicitly failed. The default EPS bearer context does not have any TFT assigned during the activation procedure. This corresponds to using a match-all packet filter. The network may at anytime after the establishment of this bearer assign a TFT to the default EPS bearer and may subsequently modify the TFT or the packet filters of this default bearer.


6.4.1.2	Default EPS bearer context activation initiated by the network

The MME shall initiate the default bearer context activation procedure by sending an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and enter the state BEARER CONTEXT ACTIVE PENDING (see example in figure 6.4.1.2.1). When the default bearer is activated as part of the attach procedure, the MME shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message together with ATTACH ACCEPT and shall not start the timer T3485. When the default bearer is activated as the response to a stand-alone PDN CONNECTIVITY REQUEST message apart from the attach procedure, the MME shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message alone, and start the timer T3485.

The MME shall assign and include an EPS bearer identity in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message selecting a value as specified by subclause 9.3.2. The MME shall retrieve the PTI from the PDN CONNECTIVITY REQUEST message and include it in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message. Both the network identifier part and the operator identifier part shall be included in the Access Point Name IE.

[pic]

Figure 6.4.1.2.1: Default EPS bearer context activation procedure


6.4.1.3	Default EPS bearer context activation accepted by the UE

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396 if it is running for the APN provided by the UE. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. If the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message was received in response to a request for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. For any case, the UE shall then send an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message and enter the state BEARER CONTEXT ACTIVE. When the default bearer is activated as part of the attach procedure, the UE shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message together with ATTACH COMPLETE message. When the default bearer is activated as the response to the stand-alone PDN CONNECTIVITY REQUEST message, the UE shall send the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message alone.

If a WLAN offload indication information element is included in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the WLAN offload acceptability values for this PDN connection and use the E-UTRAN offload acceptability value to determine whether this PDN connection is offloadable to WLAN or not.

The UE checks the PTI in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message to identify the UE requested PDN connectivity procedure to which the default bearer context activation is related (see subclause 6.5.1).

If the UE receives a serving PLMN rate control IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the serving PLMN rate control IE value and use the stored serving PLMN rate control value as the maximum allowed limit of uplink User data container IEs included in ESM DATA TRANSPORT messages for the corresponding PDN connection in accordance with 3GPP TS 23.401 [10].

If the UE receives an APN rate control parameters container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the APN rate control parameters value and use the stored APN rate control parameters value as the maximum allowed limit of uplink user data related to the APN indicated in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored APN rate control parameters value for this APN, the UE shall replace the stored APN rate control parameters value for this APN with the received APN rate control parameters value.

If the UE receives an additional APN rate control parameters for exception data container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall store the additional APN rate control parameters for exception data value and use the stored additional APN rate control parameters for exception data value as the maximum allowed limit of uplink exception data related to the APN indicated in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored additional APN rate control parameters for exception data value for this APN, the UE shall replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value.

If the UE receives non-IP Link MTU parameter or IPv4 Link MTU parameter of the protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall pass the received Non-IP Link MTU or IPv4 Link MTU to the upper layer.

  NOTE:	The Non-IP Link MTU and the IPv4 Link MTU size correspond to the maximum length of user data that can be sent either in the user data container in the ESM DATA TRANSPORT message or via S1-U interface.

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message, the MME shall enter the state BEARER CONTEXT ACTIVE and stop the timer T3485, if the timer is running. If the PDN CONNECTIVITY REQUEST message included a low priority indicator set to "MS is configured for NAS signalling low priority", the MME shall store the NAS signalling low priority indication within the default EPS bearer context.


6.4.1.4	Default EPS bearer context activation not accepted by the UE

If the default EPS bearer context activation is part of the attach procedure, the ESM sublayer shall notify the EMM sublayer of an ESM failure. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the ESM sublayer shall additionally provide an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message to the EMM sublayer.

If the default EPS bearer context activation is not part of the attach procedure, the UE shall send an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message and enter the state BEARER CONTEXT INACTIVE.

The ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message contains an ESM cause that typically indicates one of the following cause values:

  #26:	insufficient resources;

  #31:	request rejected, unspecified; or

  #95 – 111:	protocol errors.

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message, the MME shall enter the state BEARER CONTEXT INACTIVE and stop the timer T3485, if the timer is running.


6.4.1.5	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	Default EPS bearer context activation request for an already activated default EPS bearer context:

    	If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated default EPS bearer context, the UE shall locally deactivate the existing default EPS bearer context and all the associated dedicated EPS bearer contexts, if any, and proceed with the requested default EPS bearer context activation.

  b)	Default EPS bearer context activation request for an already activated dedicated EPS bearer context:

    	If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated dedicated EPS bearer context, the UE shall locally deactivate the existing dedicated EPS bearer context and proceed with the requested default EPS bearer context activation.


6.4.1.6	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	Expiry of timer T3485:

    	On the first expiry of the timer T3485, the MME shall resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3485. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3485, the MME shall release possibly allocated resources for this activation and shall abort the procedure.

  b)	Lower layer indicates that the HeNB rejected the establishment of the default bearer (see 3GPP TS 36.413 [23]) for a LIPA PDN connection or SIPTO at the local network PDN connection due to a triggered handover:

    	The MME shall enter the state BEARER CONTEXT INACTIVE,stop timer T3485 and reject the PDN connectivity request procedure including the ESM cause value #34 "service option temporarily out of order" in the PDN CONNECTIVITY REJECT message. The MME shall release possibly allocated resources for this activation.


6.4.2	Dedicated EPS bearer context activation procedure


6.4.2.1	General

The purpose of the dedicated EPS bearer context activation procedure is to establish an EPS bearer context with specific QoS and TFT between the UE and the EPC.

In WB-S1 mode, the dedicated EPS bearer context activation procedure is initiated by the network, but may be requested by the UE by means of the UE requested bearer resource allocation procedure (see subclause 6.5.3) or the UE requested bearer resource modification procedure (see subclause 6.5.4). The dedicated bearer context activation procedure can be part of the attach procedure or be initiated together with the default EPS bearer context activation procedure when the UE initiated stand-alone PDN connectivity procedure. If the attach procedure or the default EPS bearer context activation procedure fails, the UE shall consider that the dedicated bearer activation has implicitly failed. The network may initiate the dedicated EPS bearer context activation procedure together with the completion of the service request procedure.

In NB-S1 mode, the dedicated EPS bearer contexts activation procedure is not used.

  NOTE:	3GPP TS 23.060 [74] subclause 9.3 specifies that a packet filter applicable for the downlink direction is not mandatory in a TFT.


6.4.2.2	Dedicated EPS bearer context activation initiated by the network

In WB-S1 mode, the MME shall initiate the dedicated bearer context activation procedure by sending an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, start the timer T3485, and enter the state BEARER CONTEXT ACTIVE PENDING (see example in figure 6.4.2.2.1).

The MME allocates the EPS bearer identity selecting a value as specified by subclause 9.3.2, and includes it in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message. The MME shall include the EPS bearer identity of the associated default bearer as the linked EPS bearer identity in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message. If this procedure was initiated by a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST shall contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE ALLOCATION REQUEST or BEARER RESOURCE MODIFICATION REQUEST respectively.

[pic]

Figure 6.4.2.2.1: Dedicated EPS bearer context activation procedure


6.4.2.3	Dedicated EPS bearer context activation accepted by the UE

Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, if the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396, if it is running for the APN provided by the UE. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. For any case, the UE shall then check the received TFT before taking it into use, send an ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message and enter the state BEARER CONTEXT ACTIVE. The ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message shall include the EPS bearer identity.

The linked EPS bearer identity included in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message indicates to the UE to which default bearer, IP address and PDN the dedicated bearer is linked.

If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 [12]), the UE uses the PTI to identify the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure to which the dedicated bearer context activation is related.

If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 [12]) and the PTI is associated to a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the UE shall release the traffic flow aggregate description associated to the PTI value provided.

The UE shall use the received TFT to apply mapping of uplink traffic flows to the radio bearer.

The UE shall treat any packet filter without explicit direction as being bi-directional.

If the UE receives an APN rate control parameters container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall store the APN rate control parameters value and use the stored APN rate control parameters value as the maximum allowed limit of uplink user data related to the corresponding APN in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored APN rate control parameters value for this APN, the UE shall replace the stored APN rate control parameters value for this APN with the received APN rate control parameters value.

If the UE receives an additional APN rate control parameters for exception data container in the protocol configuration options IE or extended protocol configuration options IE in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall store the additional APN rate control parameters for exception data value and use the stored additional APN rate control parameters for exception data value as the maximum allowed limit of uplink exception data related to the corresponding APN in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored additional APN rate control parameters for exception data value for this APN, the UE shall replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value.

If the UE receives QoS rule(s) of the 5GS QoS flow(s), which corresponds to the dedicated EPS bearer being activated, in the protocol configuration options IE or the extended protocol configuration options IE of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE stores the QoS rule(s) for use during inter-system change from S1 mode to N1 mode.

Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message, the MME shall stop the timerT3485 and enter the state BEARER CONTEXT ACTIVE.


6.4.2.4	Dedicated EPS bearer context activation not accepted by the UE

Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE may reject the request from the MME by sending an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message. The message shall include the EPS bearer identity and an ESM cause value indicating the reason for rejecting the dedicated EPS bearer context activation request.

The ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message contains an ESM cause that typically indicates one of the following ESM cause values:

  #26:	insufficient resources;

  #31:	request rejected, unspecified;

  #41:	semantic error in the TFT operation;

  #42:	syntactical error in the TFT operation;

  #43:	invalid EPS bearer identity;

  #44:	semantic error(s) in packet filter(s);

  #45:	syntactical error(s) in packet filter(s); or

  #95 – 111:	protocol errors.

The UE shall check the TFT in the request message for different types of TFT IE errors as follows:

  a)	Semantic errors in TFT operations:

    1)	When the TFT operation is an operation other than "Create a new TFT"

    	The UE shall reject the activation request with ESM cause #41 "semantic error in the TFT operation".

  b)	Syntactical errors in TFT operations:

    1)	When the TFT operation = "Create a new TFT" and the packet filter list in the TFT IE is empty.

    2)	When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.

    	The UE shall reject the activation request with ESM cause #42 "syntactical error in the TFT operation".

  c)	Semantic errors in packet filters:

    1)	When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.

    2)	When the resulting TFT does not contain any packet filter which applicable for the uplink direction.

    	The UE shall reject the activation request with ESM cause #44 "semantic errors in packet filter(s)".

  d)	Syntactical errors in packet filters:

    1)	When the TFT operation = "Create a new TFT" and two or more packet filters in the resultant TFT would have identical packet filter identifiers.

    2)	When the TFT operation = "Create a new TFT" and two or more packet filters in all TFTs associated with this PDN connection would have identical packet filter precedence values.

    3)	When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.

    	In case 2, if the old packet filters do not belong to the default EPS bearer context, the UE shall not diagnose an error, shall further process the new activation request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, by means of explicit peer-to-peer signalling between the network and the UE, the UE shall perform a UE requested bearer resource modification procedure to deactivate the EPS bearer context(s) for which it has deleted the packet filters.

    	In case 2, if one or more old packet filters belong to the default EPS bearer context, the UE shall release the relevant PDN connection. If the relevant PDN connection is the last one that the UE has and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall detach and re-attach to the network.

    	In cases 1 and 3 the UE shall reject the activation request with ESM cause #45 "syntactical errors in packet filter(s)".

Upon receipt of the ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message in state BEARER CONTEXT ACTIVE PENDING, the MME shall stop the timer T3485, enter the state BEARER CONTEXT INACTIVE and abort the dedicated EPS bearer context activation procedure. The MME also requests the lower layer to release the radio resources that were established during the dedicated EPS bearer context activation procedure.


6.4.2.5	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	Dedicated EPS bearer context activation request for an already activated default EPS bearer context:

    	If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated default EPS bearer context, the UE shall locally deactivate the existing default EPS bearer context and all the associated dedicated EPS bearer contexts, if any, and proceed with the requested dedicated EPS bearer context activation.

  b)	Dedicated EPS bearer context activation request for an already activated dedicated EPS bearer context

    	If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message with an EPS bearer identity identical to the EPS bearer identity of an already activated dedicated EPS bearer context, the UE shall locally deactivate the existing dedicated EPS bearer context and proceed with the requested dedicated EPS bearer context activation.

  c)	No default EPS bearer context with linked EPS bearer identity activated

    	If the linked EPS bearer identity included in the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message does not match the EPS bearer identity of any activated default EPS bearer context, the UE shall reply with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message with ESM cause #43 "invalid EPS bearer identity".

  d)	Dedicated EPS bearer context activation request when the PLMN's maximum number of EPS bearer contexts in S1 mode is reached at the UE:

    	If the PLMN's maximum number of EPS bearer contexts in S1 mode is reached at the UE and the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall clear the determination representing the PLMN's maximum number of EPS bearer contexts in S1 mode and proceed with the dedicated EPS bearer context activation procedure.


6.4.2.6	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	Expiry of timer T3485:

    	On the first expiry of the timer T3485, the MME shall resend the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3485. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3485, the MME shall abort the procedure, release any resources allocated for this activation and enter the state BEARER CONTEXT INACTIVE.

  b)	Collision of UE requested PDN disconnect procedure and dedicated EPS bearer context activation procedure:

    	When the MME receives a PDN DISCONNECT REQUEST message during the dedicated EPS bearer context activation procedure, and the EPS bearer to be activated belongs to the PDN connection the UE wants to disconnect, the MME shall terminate the dedicated bearer context activation procedure locally, release any resources related to this procedure and proceed with the PDN disconnect procedure.


6.4.3	EPS bearer context modification procedure


6.4.3.1	General

The purpose of the EPS bearer context modification procedure is to modify an EPS bearer context with a specific QoS and TFT, or re-negotiate header compression configuration associated to an EPS bearer context. The EPS bearer context modification procedure is initiated by the network, but it may also be initiated as part of the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure.

The network may also initiate the EPS bearer context modification procedure to update the APN-AMBR of the UE, for instance after an inter-system handover. See 3GPP TS 23.401 [10] annex E.

The MME may also initiate the EPS bearer context modification procedure to update the WLAN offload indication to the UE, for instance after the MME received an updated WLAN offload indication of a PDN Connection from HSS. See 3GPP TS 23.401 [10] subclause 4.3.23.

The MME may also initiate the EPS bearer context modification procedure to update information required for inter-system change from S1 mode to N1 mode (e.g. session-AMBR, QoS rule(s)). See 3GPP TS 24.501 [54].

The network may initiate the EPS bearer context modification procedure together with the completion of the service request procedure.


6.4.3.2	EPS bearer context modification initiated by the network

The MME shall initiate the EPS bearer context modification procedure by sending a MODIFY EPS BEARER CONTEXT REQUEST message to the UE, starting the timer T3486, and entering the state BEARER CONTEXT MODIFY PENDING (see example in figure 6.4.3.2.1).

The MME shall include an EPS bearer identity that identifies the EPS bearer context to be modified in the MODIFY EPS BEARER CONTEXT REQUEST message.

If this procedure was initiated by a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the MODIFY EPS BEARER CONTEXT REQUEST shall contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE ALLOCATION REQUEST or BEARER RESOURCE MODIFICATION REQUEST respectively.

If the UE indicated "Control plane CIoT EPS optimization supported" and "Header compression for control plane CIoT EPS optimization supported" in the UE network capability IE in the latest ATTACH REQUEST message or the TRACKING AREA UPDATE REQUEST message, and the MME supports Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization, the MME may include the Header compression configuration IE in the MODIFY EPS BEARER CONTEXT REQUEST message to re-negotiate header compression configuration associated to an EPS bearer context.

[pic]

Figure 6.4.3.2.1: EPS bearer context modification procedure


6.4.3.3	EPS bearer context modification accepted by the UE

Upon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message, if the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396, if it is running for the APN provided by the UE. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. If the MODIFY EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. For any case, the UE shall then check the received TFT before taking it into use and send a MODIFY EPS BEARER CONTEXT ACCEPT message to the MME.

If the MODIFY EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 [12]), the UE uses the PTI to identify the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure to which the EPS bearer context modification is related (see subclause 6.5.3 and subclause 6.5.4).

If the MODIFY EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 [12]) and the PTI is associated to a UE requested bearer resource allocation procedure or a UE requested bearer resource modification procedure, the UE shall release the traffic flow aggregate description associated to the PTI value provided.

If the EPS bearer context that is modified is a GBR bearer and the MODIFY EPS BEARER CONTEXT REQUEST message does not contain the Guaranteed Bit Rate (GBR) and the Maximum Bit Rate (MBR) values for uplink and downlink, the UE shall continue to use the previously received values for the Guaranteed Bit Rate (GBR) and the Maximum Bit Rate (MBR) for the corresponding bearer.

The UE shall use the received TFT to apply mapping of uplink traffic flows to the radio bearer if the TFT contains packet filters for the uplink direction.

If a WLAN offload indication information element is included in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the WLAN offload acceptability values for this PDN connection and use the E-UTRAN offload acceptability value to determine whether this PDN connection is offloadable to WLAN or not.

If the UE receives an APN rate control parameters container in the protocol configuration options IE or extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the APN rate control parameters value and use the stored APN rate control parameters value as the maximum allowed limit of uplink user data related to the corresponding APN in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored APN rate control parameters value for this APN, the UE shall replace the stored APN rate control parameters value for this APN with the received APN rate control parameters value.

If the UE receives an additional APN rate control parameters for exception data container in the protocol configuration options IE or extended protocol configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall store the additional APN rate control parameters for exception data value and use the stored additional APN rate control parameters for exception data value as the maximum allowed limit of uplink exception data related to the corresponding APN in accordance with 3GPP TS 23.401 [10]. If the UE has a previously stored additional APN rate control parameters for exception data value for this APN, the UE shall replace the stored additional APN rate control parameters for exception data value for this APN with the received additional APN rate control parameters for exception data value.

Upon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message with a session-AMBR and QoS rule(s) in the protocol configuration options IE or the extended protocol configuration options IE, the UE stores the session-AMBR and QoS rule(s) for use during inter-system change from S1 mode to N1 mode.

Upon receipt of the MODIFY EPS BEARER CONTEXT ACCEPT message, the MME shall stop the timer T3486 and enter the state BEARER CONTEXT ACTIVE.


6.4.3.4	EPS bearer context modification not accepted by the UE

Upon receipt of the MODIFY EPS BEARER CONTEXT REQUEST message, the UE may reject the request from the MME by sending a MODIFY EPS BEARER CONTEXT REJECT message to the MME. The message shall include the EPS bearer identity and an ESM cause value indicating the reason for rejecting the EPS bearer context modification request.

The MODIFY EPS BEARER CONTEXT REJECT message contains an ESM cause that typically indicates one of the following ESM cause values:

  #26:	insufficient resources;

  #41:	semantic error in the TFT operation;

  #42:	syntactical error in the TFT operation;

  #43:	invalid EPS bearer identity;

  #44:	semantic error(s) in packet filter(s);

  #45:	syntactical error(s) in packet filter(s); or

  #95 – 111:	protocol errors.

The UE shall check the TFT in the request message for different types of TFT IE errors as follows:

  a)	Semantic errors in TFT operations:

    1)	TFT operation = "Create a new TFT" when there is already an existing TFT for the EPS bearer context.

    2)	When the TFT operation is an operation other than "Create a new TFT" and there is no TFT for the EPS bearer context.

    3)	TFT operation = "Delete packet filters from existing TFT" when it would render the TFT empty.

    4)	TFT operation = "Delete existing TFT" for a dedicated EPS bearer context.

    	In case 4 the UE shall reject the modification request with ESM cause #41 "semantic error in the TFT operation".

    	In the other cases the UE shall not diagnose an error and perform the following actions to resolve the inconsistency:

    	In case 1 the UE shall further process the new activation request and, if it was processed successfully, delete the old TFT.

    	In case 2 the UE shall:

    -	process the new request and if the TFT operation is "Delete existing TFT" or "Delete packet filters from existing TFT", and if no error according to items b, c, and d was detected, consider the TFT as successfully deleted;

    -	process the new request as an activation request, if the TFT operation is "Add packet filters in existing TFT" or "Replace packet filters in existing TFT".

    	In case 3, if the packet filters belong to a dedicated EPS bearer context, the UE shall process the new deletion request and, if no error according to items b, c, and d was detected, the UE shall reject the modification request with ESM cause #41 "semantic error in the TFT operation".

    	In case 3, if the packet filters belong to the default EPS bearer context, the UE shall process the new deletion request and if no error according to items b, c, and d was detected then delete the existing TFT, this corresponds to using match-all packet filter for the default EPS bearer context.

  b)	Syntactical errors in TFT operations:

    1)	When the TFT operation = "Create a new TFT", "Add packet filters in existing TFT", "Replace packet filters in existing TFT" or "Delete packet filters from existing TFT" and the packet filter list in the TFT IE is empty.

    2)	TFT operation = "Delete existing TFT" or "No TFT operation" with a non-empty packet filter list in the TFT IE.

    3)	TFT operation = "Replace packet filters in existing TFT" when the packet filter to be replaced does not exist in the original TFT.

    4)	TFT operation = "Delete packet filters from existing TFT" when the packet filter to be deleted does not exist in the original TFT.

    5)	TFT operation = "Delete packet filters from existing TFT" with a packet filter list also including packet filters in addition to the packet filter identifiers.

    6)	When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.

    	In case 3 the UE shall not diagnose an error, further process the replace request and, if no error according to items c and d was detected, include the packet filters received to the existing TFT.

    	In case 4 the UE shall not diagnose an error, further process the deletion request and, if no error according to items c and d was detected, consider the respective packet filter as successfully deleted.

    	Otherwise the UE shall reject the modification request with ESM cause #42 "syntactical error in the TFT operation".

  c)	Semantic errors in packet filters:

    1)	When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the UE determines a semantic error in a packet filter is outside the scope of the present document.

    2)	When the resulting TFT, which is assigned to a dedicated EPS bearer context, does not contain any packet filter applicable for the uplink direction among the packet filters created on request from the network.

    	The UE shall reject the modification request with ESM cause #44 "semantic errors in packet filter(s)".

  d)	Syntactical errors in packet filters:

    1)	When the TFT operation = "Create a new TFT", "Add packet filters to existing TFT", and two or more packet filters in the resultant TFT would have identical packet filter identifiers.

    2)	When the TFT operation = "Create a new TFT", "Add packet filters to existing TFT" or "Replace packet filters in existing TFT", and two or more packet filters among all TFTs associated with this PDN connection would have identical packet filter precedence values.

    3)	When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.

    	In case 1, if two or more packet filters with identical packet filter identifiers are contained in the new request, the UE shall reject the modification request with ESM cause #45 "syntactical errors in packet filter(s)". Otherwise, the UE shall not diagnose an error, further process the new request and, if it was processed successfully, delete the old packet filters which have the identical packet filter identifiers.

    	In case 2, if the old packet filters do not belong to the default EPS bearer context, the UE shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, the UE shall perform a UE requested bearer resource modification request procedure to deactivate the dedicated EPS bearer context(s) for which it has deleted the packet filters.

    	In case 2, if one or more old packet filters belong to the default EPS bearer context, the UE shall release the relevant PDN connection. If the relevant PDN connection is the last one that the UE has and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall detach and re-attach to the network.

    	Otherwise the UE shall reject the modification request with ESM cause #45 "syntactical errors in packet filter(s)".

Upon receipt of the MODIFY EPS BEARER CONTEXT REJECT message with ESM cause value other than #43 "invalid EPS bearer identity" in state BEARER CONTEXT MODIFY PENDING, the MME shall stop the timer T3486, enter the state BEARER CONTEXT ACTIVE and abort the EPS bearer context modification procedure. If the network receives the MODIFY EPS BEARER CONTEXT REJECT message with ESM cause #43 "invalid EPS bearer identity", the MME locally deactivates the EPS bearer context(s) without peer-to-peer ESM signalling.When the MME detects that after the failed EPS bearer context modification there is a misalignment between the EPS bearer configuration and the EPS bearer context configuration or between the QoS on NAS and AS level, the MME should initiate the necessary procedures to achieve a re-alignment.


6.4.3.5	Abnormal cases in the UE

Apart from the case described in subclause 6.3.3, no abnormal cases have been identified.


6.4.3.6	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	Expiry of timer T3486:

    	On the first expiry of the timer T3486, the MME shall resend the MODIFY EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3486. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3486, the MME shall abort the procedure and enter the state BEARER CONTEXT ACTIVE.

    	The MME may continue to use the previous configuration of the EPS bearer context or initiate an EPS bearer context deactivation procedure.

  b)	Collision of UE requested PDN disconnect procedure and EPS bearer context modification:

    	When the MME receives a PDN DISCONNECT REQUEST message during an EPS bearer context modification procedure, and the EPS bearer to be modified belongs to the PDN connection the UE wants to disconnect, the MME shall terminate the EPS bearer context modification procedure locally, release any resources related to this procedure and proceed with the PDN disconnect procedure.


6.4.4	EPS bearer context deactivation procedure


6.4.4.1	General

The purpose of the EPS bearer context deactivation procedure is to deactivate an EPS bearer context or disconnect from a PDN by deactivating all EPS bearer contexts to the PDN. The EPS bearer context deactivation procedure is initiated by the network, and it may be triggered by the UE by means of the UE requested bearer resource modification procedure or UE requested PDN disconnect procedure.

In the case of EPS bearer context deactivation with reactivation requested for a PDN connection, if no NAS signalling connection exists, the MME follows the procedures for re-establishing the NAS signalling connection and deactivating the EPS bearer contexts to the PDN with reactivation requested, as specified in 3GPP TS 23.401 [10] subclauses 5.4.4.1 and 5.10.3 and 3GPP TS 23.380 [33] subclause 5.4.2.1.

If a UE is receiving emergency bearer services from a CSG cell, and the CSG subscription expires or is removed, the MME shall deactivate all non-emergency EPS bearers if any. The MME shall not deactivate the emergency EPS bearers.

If a detach is requested by the HSS for a UE that has bearers for emergency services, the MME shall send a DEACTIVATE EPS BEARER CONTEXT REQUEST message to the UE for all bearers that are not allocated for emergency services.


6.4.4.2	EPS bearer context deactivation initiated by the network

If a NAS signalling connection exists when the MME initiates the EPS bearer context deactivation procedure, the MME shall initiate the EPS bearer context deactivation procedure by sending a DEACTIVATE EPS BEARER CONTEXT REQUEST message to the UE, start the timer T3495, and enter the state BEARER CONTEXT INACTIVE PENDING (see example in figure 6.4.4.2.1). The DEACTIVATE EPS BEARER CONTEXT REQUEST message contains an ESM cause typically indicating one of the following:

  #8:	operator determined barring;

  #26:	insufficient resources;

  #29:	user authentication or authorization failed;

  #36:	regular deactivation;

  #38:	network failure;

  #39:	reactivation requested;

  #112:	APN restriction value incompatible with active EPS bearer context; or

  #113:	Multiple accesses to a PDN connection not allowed.

If the deactivation is triggered by a UE initiated bearer resource modification procedure or UE requested PDN disconnect procedure, the DEACTIVATE EPS BEARER CONTEXT REQUEST message shall contain the procedure transaction identity (PTI) value received by the MME in the BEARER RESOURCE MODIFICATION REQUEST or PDN DISCONNECT REQUEST respectively.

When the MME wants to deactivate all EPS bearer contexts of a PDN connection and thus disconnect the UE from the PDN, the MME shall include the EPS bearer identity of the default bearer associated to the PDN in the DEACTIVATE EPS BEARER CONTEXT REQUEST message. In this case, the MME shall not include the WLAN offload indication in the DEACTIVATE EPS BEARER CONTEXT REQUEST message, and if the UE receives the WLAN offload indication, the UE shall ignore the indication.

If no NAS signalling connection exists when the MME initiates the EPS bearer context deactivation, the ESM entity in the MME shall locally deactivate the EPS bearer context towards the UE without any peer-to-peer ESM signalling between the MME and the UE.

  NOTE:	The EPS bearer context state(s) can be synchronized between the UE and the MME at the next EMM-IDLE to EMM-CONNECTED transition, e.g. during a service request or tracking area updating procedure.

[pic]

Figure 6.4.4.2.1: EPS bearer context deactivation procedure


6.4.4.3	EPS bearer context deactivation accepted by the UE

Upon receipt of the DEACTIVATE EPS BEARER CONTEXT REQUEST message, the UE shall delete the EPS bearer context identified by the EPS bearer identity. After deactivating the identified EPS bearer context, the UE shall respond to the MME with the DEACTIVATE EPS BEARER CONTEXT ACCEPT.

If the EPS bearer identity indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST is that of the default bearer to a PDN, the UE shall delete all EPS bearer contexts associated to the PDN. After deactivating all EPS bearer contexts, the UE shall respond to the MME with the DEACTIVATE EPS BEARER CONTEXT ACCEPT.

Upon sending the DEACTIVATE EPS BEARER CONTEXT ACCEPT message, the UE shall enter the state BEARER CONTEXT INACTIVE. If due to the EPS bearer context deactivation only the PDN connection for emergency bearer services remains established, the UE shall consider itself attached for emergency bearer services only.

If the DEACTIVATE EPS BEARER CONTEXT REQUEST includes ESM cause #39 "reactivation requested" and the EPS bearer context is a default EPS bearer context, and the UE provided an APN for the establishment of the PDN connection, the UE shall stop timer T3396 if it is running for the APN provided by the UE. The UE should then re-initiate the UE requested PDN connectivity procedure for the same APN as the deactivated default EPS bearer context to reactivate the EPS bearer context. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running, and should re-initiate the UE requested PDN connectivity procedure without including an APN. Additionally, the UE should re-initiate the request(s) for dedicated bearer resources that have been activated on request of the UE and released as a result of this EPS bearer context deactivation procedure. If the DEACTIVATE EPS BEARER CONTEXT REQUEST message was received for an emergency PDN connection, the UE shall not stop the timer T3396 associated with no APN if it is running. The UE should then re-initiate the UE requested PDN connectivity procedure for the emergency PDN connection.

  NOTE 1:	User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer context(s) automatically.

  NOTE 2:	The UE behaviour is not specified for the case where the DEACTIVATE EPS BEARER CONTEXT REQUEST includes ESM cause #39 "reactivation requested" and the deactivated EPS bearer context was a dedicated EPS bearer context.

If the DEACTIVATE EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 [12]), the UE uses the PTI to identify the UE requested bearer resource modification procedure or UE requested PDN disconnect procedure to which the EPS bearer context deactivation is related (see subclause 6.5.4).

If the DEACTIVATE EPS BEARER CONTEXT REQUEST message contains a PTI value other than "no procedure transaction identity assigned" and "reserved" (see 3GPP TS 24.007 [12]), the UE shall release the traffic flow aggregate description associated to the PTI value provided.

If the ESM cause value is #26 "insufficient resources", the network may include a value for timer T3396 in the DEACTIVATE EPS BEARER CONTEXT REQUEST message. The UE shall take different actions depending on the timer value received for timer T3396 (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.5):

  i)	if the timer value indicates neither zero nor deactivated, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. The UE shall start timer T3396 with received value and not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until timer T3396 expires or the timer T3396 is stopped. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if it is running. The UE shall start timer T3396 with the received value and not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, until timer T3396 expires or timer T3396 is stopped. The UE shall not stop timer T3396 upon a PLMN change or inter-system change;

  ii)	if the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE , until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. The timer T3396 remains deactivated upon a PLMN change or inter-system change; and

  iii)	if the timer value indicates zero, the UE:

    -	shall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and

    -	if the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.

If the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.

If the UE is switched off when the timer T3396 is running, the UE shall behave as follows when the UE is switched on and the USIM in the UE remains the same:

  -	let t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;

  -	if prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5; and

  -	if prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5.

If the T3396 IE is not included, the UE shall proceed with deactivation procedure and then send DEACTIVATE EPS BEARER CONTEXT ACCEPT message.

Upon receipt of the DEACTIVATE EPS BEARER CONTEXT ACCEPT message, the MME shall enter the state BEARER CONTEXT INACTIVE and stop the timer T3495.


6.4.4.4	Abnormal cases in the UE

The following abnormal case can be identified:

  a)	UE is requested to deactivate a default EPS bearer context of the last PDN connection:

    	If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, and the UE determines that the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is the default EPS bearer of the last PDN connection that the UE has, then the UE shall respond by performing a detach procedure. Additionally, the UE should perform an attach procedure.

    	If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall proceed with the deactivation procedure as specified in subclause 6.4.4.3.

  NOTE:	User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer(s), if any, automatically.


6.4.4.5	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	Expiry of timer T3495:

    	On the first expiry of the timer T3495, the MME shall resend the DEACTIVATE EPS BEARER CONTEXT REQUEST and shall reset and restart timer T3495. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3495, the MME shall abort the procedure and deactivate the EPS bearer context locally without any peer-to-peer ESM signalling between the MME and the UE.

  b)	Collision of UE requested PDN disconnect procedure and EPS bearer context deactivation:

    	When the MME receives a PDN DISCONNECT REQUEST message during the EPS bearer context deactivation procedure, and the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is a dedicated EPS bearer belonging to the PDN connection the UE wants to disconnect, the MME shall proceed with both procedures. If the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is the default EPS bearer, the MME shall proceed with the EPS bearer context deactivation procedure.


6.4.4.6	Local EPS bearer context deactivation without NAS signalling

The UE and the MME deactivate EPS bearer contexts locally without peer-to-peer ESM signalling in the following cases:

  1)	during the service request procedure, if the E-UTRAN establishes the user plane radio bearers for one or more EPS bearer contexts but not for all the EPS bearer contexts, e.g. due to radio access control (see subclause 5.6.1.4 for details);

  1a)	during the resume of NAS signalling connection procedure as specified in subclause 5.3.1.3, if one or more but not all the suspended user plane radio bearers are resumed;

  2)	during the tracking area updating procedure with "active" flag, or without "active" flag but the network established the user plane radio bearers due to downlink pending data, if the E-UTRAN establishes the user plane radio bearers for one or more EPS bearer contexts but not for all the EPS bearer contexts indicated active by both UE and network;

  NOTE 1:	The synchronisation of the EPS bearers, for which the user plane radio bearers need to be established, indicated in EPS bearer context status information element in TRACKING AREA UPDATE ACCEPT message is not applicable in item 2.

  3)	during handover, if the target E-UTRAN does not establish all the user plane radio bearers for the UE;

  4)	if the E-UTRAN releases one or more user plane radio bearers but not all the user plane radio bearers of the UE due to E-UTRAN specific reasons; or

  5)	if triggered by an NBIFOM procedure (see 3GPP TS 24.161 [36]), for an NBIFOM multi-access PDN connection.

For cases 1) to 4), based on the indication from the lower layers, the UE and the MME shall locally deactivate the EPS bearer contexts for which no user plane radio bearers are set up.

  NOTE 2:	The above cases 1) to 4) do not apply for the UE when an RRC connection release occurs. The lower layers in the UE provide the user plane radio bearer context status to the ESM sublayer when a change in the user plane radio bearers is detected by the lower layers including establishment and release of user plane radio bearers for the UE in connected mode.

  NOTE 3:	The above cases 1) to 4) do not apply for the MME when the S1 release procedure occurs as specified in 3GPP TS 23.401 [10]).

If due to any of the cases described above the UE locally deactivates a default EPS bearer context, the UE shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context.

If the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall perform a local detach and enter state EMM-DEREGISTERED. If this occurs during a service request procedure for CS fallback, the UE shall reselect to GERAN or UTRAN and continue with the CS service, otherwise the UE shall initiate an attach procedure.

If the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE shall enter state EMM-REGISTERED.

If the UE locally deactivates the EPS bearer context(s) of the last remaining PDN connection for non-emergency bearer services and only the PDN connection for emergency bearer services remains established, the UE shall consider itself attached for emergency bearer services only.

The MME shall deactivate the GBR EPS bearer contexts locally without peer-to-peer ESM signalling, when the MME performs locally the release of the S1AP signalling connection due to the S1AP signalling connection is lost. All non-GBR EPS bearers established are preserved in the MME and in the PDN GW.

If the E-UTRAN requests the MME to release the S1AP signalling connection, the MME shall deactivate or preserve the GBR EPS bearer contexts according to 3GPP TS 23.401 [10], subclause 5.3.5. All non-GBR EPS bearer contexts established are preserved in the MME and in the PDN GW.

  NOTE 4:	The UE and the MME will synchronize the EPS bearer contexts subsequently during the next service request procedure, tracking area updating procedure or routing area updating procedure.

If due to any of the cases described above the MME locally deactivates a default EPS bearer context, the MME shall locally deactivate all EPS bearer contexts associated to the PDN connection with the default EPS bearer context without peer-to-peer ESM signalling to the UE.

If the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the MME shall perform a local detach and enter state EMM-DEREGISTERED.

If the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection, and EMM-REGISTERED without PDN connection is supported by the UE and the MME, the MME shall enter state EMM-REGISTERED.

For EPS bearer context deactivation procedure initiated by the network, if no NAS signalling connection exists, the MME locally deactivates the EPS bearer context(s) without peer-to-peer ESM signalling In the case of reactivation requested, the MME can perform this local deactivation only when the EMM-entity in the network was unable to re-establish the NAS signalling connection. The EPS bearer context deactivation procedure is not initiated by the network when the MME disconnects the UE from the last remaining PDN to which it is connected and EMM-REGISTERED without PDN connection is not supported by the UE or the MME. In this case, the MME initiates a network initiated detach procedure.

If the MME locally deactivates the EPS bearer context(s) of the last remaining PDN connection for non-emergency bearer services and only the PDN connection for emergency bearer services remains established for the UE, the MME shall consider the UE to be attached for emergency bearer services only.


6.5	UE requested ESM procedures


6.5.0	General

The UE's maximum number of active EPS bearer contexts in a PLMN is determined by whichever is the lowest of the maximum number of EPS bearer identities allowed by the protocol (as specified in 3GPP TS 24.007 [12] subclause 11.2.3.1.5), the PLMN's maximum number of EPS bearer contexts in S1 mode and the UE's implementation-specific maximum number of EPS bearer contexts.

  NOTE 1:	Subclauses 6.5.1.4 and 6.5.3.4 specify how the UE determines the PLMN's maximum number of EPS bearer contexts in S1 mode.

In earlier versions of the protocol, the maximum number of simultaneously active EPS bearer contexts was limited by lower layer protocols to 8.

In the present version of the protocol, the UE and the network may support a maximum number of 15 EPS bearer contexts.

A UE supporting signalling for a maximum number of 15 EPS bearer contexts shall support the extended range or EPS bearer identities from 0 to 15 (as specified in 3GPP TS 24.007 [12] subclause 11.2.3.1.5). The UE indicates support of signalling for a maximum number of 15 EPS bearer contexts by setting the 15 bearers bit in the UE Network Capability IE.

A network supporting signalling for a maximum number of 15 EPS bearer contexts shall support the extended range or EPS bearer identities from 0 to 15 (as specified in 3GPP TS 24.007 [12] subclause 11.2.3.1.5). The network indicates support of signalling for a maximum number of 15 EPS bearer contexts by setting the 15 bearers bit in the EPS network feature support IE.

  NOTE 2:	A UE and a network not supporting signalling for a maximum number of 15 EPS bearer contexts will treat the EPS bearer identity values 1 to 4 as 'reserved' values.


6.5.1	UE requested PDN connectivity procedure


6.5.1.1	General

The purpose of the UE requested PDN connectivity procedure is for a UE to request the setup of a default EPS bearer to a PDN. The UE requests connectivity to a PDN by sending a PDN CONNECTIVITY REQUEST message to the network. If accepted by the network, this procedure initiates the establishment of a default EPS bearer context. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the procedure is used either to establish the first default bearer by including the PDN CONNECTIVITY REQUEST message into the initial attach message, or to establish subsequent default bearers to additional PDNs in order to allow the UE simultaneous access to multiple PDNs by sending the message stand-alone. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the procedure is used to establish the first or subsequent default bearers to a PDN or additional PDNs by sending the PDN CONNECTIVITY REQUEST message stand-alone.

If the UE requests PDN connectivity for emergency bearer services, the MME shall not check for regional restrictions or subscription restrictions when processing the PDN CONNECTIVITY REQUEST message.

If there is already a PDN connection for emergency bearer services established, the UE shall not request an additional PDN connection for emergency bearer services.

A UE attached for emergency bearer services shall not request a PDN connection to any other PDN.

The UE may also initiate the UE requested PDN connectivity procedure to add 3GPP access to the PDN connection which is already established over WLAN as specified in the subclause 6.2.2 of 3GPP TS 23.161 [34].

The UE may also initiate the UE requested PDN connectivity procedure to transfer an existing PDU session in the 5GS to EPS as specified in 3GPP TS 24.501 [54].

If the UE supports the device triggering short message as specified in 3GPP TS 23.040 [57] and supports non-IP PDN type, then upon receiving from ESMS entity as specified in 3GPP TS 24.007 [12] an indication requesting establishment of a PDN connection for non-IP PDN type using the default APN as specified in 3GPP TS 24.011 [13A], the UE shall initiate the UE requested PDN connectivity procedure in order to request connectivity to a PDN using the default APN and non-IP PDN type.


6.5.1.2	UE requested PDN connectivity procedure initiation

In order to request connectivity to a PDN, the UE shall send a PDN CONNECTIVITY REQUEST message to the MME, start timer T3482 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.1.2.1).

When the PDN CONNECTIVITY REQUEST message is sent together with an ATTACH REQUEST message, the UE shall not start timer T3482 and shall not include the APN.

  NOTE 1:	If the UE needs to provide protocol configuration options which require ciphering or provide an APN, or both, during the attach procedure, the ESM information transfer flag is included in the PDN CONNECTIVITY REQUEST. The MME then at a later stage in the PDN connectivity procedure initiates the ESM information request procedure in which the UE can provide the MME with protocol configuration options or APN or both.

In order to request a PDN connection for emergency bearer services, the UE shall not include an APN in the PDN CONNECTIVITY REQUEST message or, when applicable, in the ESM INFORMATION RESPONSE message.

In order to request connectivity to a PDN using the default APN, the UE includes the access point name IE in the PDN CONNECTIVITY REQUEST message or, when applicable, in the ESM INFORMATION RESPONSE message, according to the following conditions:

  -	if use of a PDN using the default APN requires PAP/CHAP, then the UE should include the Access point name IE; and

  -	in all other conditions, the UE need not include the Access point name IE.

In order to request connectivity to an additional PDN using a specific APN, the UE shall include the requested APN in the PDN CONNECTIVITY REQUEST message.

In the PDN type IE the UE shall either indicate the IP version capability of the IP stack associated with the UE or non IP as specified in subclause 6.2.2.

If the PDN type value of the PDN type IE is set to IPv4 or IPv6 or IPv4v6 and the UE indicates "Control plane CIoT EPS optimization supported" in the UE network capability IE of the ATTACH REQUEST message, the UE may include the Header compression configuration IE in the PDN CONNECTIVITY REQUEST message.

The UE shall set the request type to "initial request" when the UE is establishing a new PDN connectivity to a PDN in an attach procedure or in a stand-alone PDN connectivity procedure. The UE shall set the request type to "emergency" when the UE is requesting a new PDN connectivity for emergency bearer services. The UE shall set the request type to "handover" when the connectivity to a PDN is to be transferred from a non-3GPP access network to the 3GPP access network, or when the UE initiates the procedure to add 3GPP access to the PDN connection which is already established over WLAN. The UE shall set the request type to "handover of emergency bearer services" when a PDN connection for emergency bearer services is to be transferred from a WLAN to the 3GPP access network.

If the UE supports DSMIPv6, the UE may include a request for obtaining the IPv6 address and optionally the IPv4 address of the home agent in the Protocol configuration options IE in the PDN CONNECTIVITY REQUEST message. The UE may also include a request for obtaining the IPv6 Home Network Prefix. The UE shall request the IPv6 Home Network Prefix only if the UE has requested the home agent IPv6 address. The requested home agent address(es) and the Home Network Prefix are related to the APN the UE requested connectivity for.

The UE may set the ESM information transfer flag in the PDN CONNECTIVITY REQUEST message to indicate that it has ESM information, i.e. protocol configuration options, APN, or both, that needs to be sent after the NAS signalling security has been activated between the UE and the MME.

If the UE supports A/Gb mode or Iu mode or both, the UE shall indicate the support of the network requested bearer control procedures (see 3GPP TS 24.008 [13]) in A/Gb mode or Iu mode in the protocol configuration options IE.

If the UE supports N1 mode and the request type is:

  a)	"initial request" or "emergency", the UE shall generate a PDU session ID, associate the PDU session ID with the PDN connection that is being established, and include the PDU session ID in the protocol configuration options IE or the extended protocol configuration options IE;

  b)	"handover" or "handover of emergency bearer services", and the UE requests:

    1)	transfer of an existing PDU session in 5GS, the UE shall associate the PDU session ID of the PDU session with the PDN connection that is being established for the existing PDU session and include the PDU session ID in the protocol configuration options IE or the extended protocol configuration options IE; or

    2)	transfer of an existing PDN connection in a non-3GPP access connected to the EPC and a PDU session ID is associated with the existing PDN connection, the UE shall include the PDU session ID in the protocol configuration options IE or the extended protocol configuration options IE.

If the UE supporting N1 mode supports receiving QoS rules with the length of two octets or QoS flow descriptions with the length of two octets via the extended protocol configuration options IE, the UE shall include the QoS rules with the length of two octets support indicator or the QoS flow descriptions with the length of two octets support indicator, respectively, in the protocol configuration options IE or the extended protocol configuration options IE.

Protocol configuration options provided in the ESM INFORMATION RESPONSE message replace any protocol configuration options provided in the PDN CONNECTIVITY REQUEST message.

When the UE initiates the procedure to add 3GPP access to the PDN connection that is already established over WLAN, the UE shall provide the same APN as that of the PDN connection established over WLAN in the PDN connectivity procedure as specified in the subclause 6.2.2 of 3GPP TS 23.161 [34].

If the UE supports APN rate control, the UE shall include an APN rate control support indicator and an additional APN rate control for exception data support indicator in the protocol configuration options IE or extended protocol configuration options IE.

[pic]

Figure 6.5.1.2.1: UE requested PDN connectivity procedure


6.5.1.3	UE requested PDN connectivity procedure accepted by the network

Upon receipt of the PDN CONNECTIVITY REQUEST message, the MME checks whether the ESM information transfer flag is included. If the flag is included the MME waits for completion of the ESM information request procedure before proceeding with the PDN connectivity procedure. The MME then checks if connectivity with the requested PDN can be established. If no requested APN is included in the PDN CONNECTIVITY REQUEST message or the ESM INFORMATION RESPONSE message and the request type is different from "emergency" and from "handover of emergency bearer services", the MME shall use the default APN as the requested APN. If the request type is "emergency" or "handover of emergency bearer services", the MME shall use the APN configured for emergency bearer services or select the statically configured PDN GW for unauthenticated UEs, if applicable.

If the network receives a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as an already existing PDN connection, and multiple PDN connections for a given APN are allowed, the network retains the existing EPS bearer contexts for the PDN connection and proceeds with the requested PDN connectivity procedure.

If the lower layers provide a GW Transport Layer Address value identifying a L-GW together with the PDN CONNECTIVITY REQUEST message and a PDN connection is established as a LIPA PDN connection due to the PDN CONNECTIVITY REQUEST message, then the MME shall store the GW Transport Layer Address value as the P-GW address in the EPS bearer context of the LIPA PDN connection.

If the lower layers provide a SIPTO L-GW Transport Layer Address value identifying a L-GW together with the PDN CONNECTIVITY REQUEST message and a PDN connection is established as a SIPTO at the local network PDN connection due to the PDN CONNECTIVITY REQUEST message, then the MME shall store the SIPTO L-GW Transport Layer Address value as the P-GW address in the EPS bearer context of the SIPTO at the local network PDN connection.

If the lower layers provide a LHN-ID value together with the PDN CONNECTIVITY REQUEST message and a PDN connection is established as a SIPTO at the local network PDN connection due to the PDN CONNECTIVITY REQUEST message, then the MME shall store the LHN-ID value in the EPS bearer context of the SIPTO at the local network PDN connection.

  NOTE:	The receipt of a LHN-ID value during the establishment of the PDN connection, during tracking area updating procedure or during inter-MME handover can be used as an indication by the MME that the SIPTO at the local nework PDN connection is established to a stand-alone GW (see 3GPP TS 23.401 [10]).

If connectivity with the requested PDN is accepted by the network, the MME shall initiate the default EPS bearer context activation procedure (see subclause 6.4.1).

If connectivity with the requested PDN is accepted and the network considers this PDN connection a LIPA PDN connection, then subject to operator policy the MME shall include in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message the Connectivity type IE indicating "the PDN connection is considered a LIPA PDN connection".

If connectivity with the requested PDN is accepted, but with a restriction of IP version (i.e. both an IPv4 address and an IPv6 prefix is requested, but only one particular IP version, or only single IP version bearers are supported/allowed by the network), ESM cause #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", or #52 "single address bearers only allowed", respectively, shall be included in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message.

If connectivity with the requested PDN is accepted and the UE provided the Header compression configuration IE in the PDN CONNECTIVITY REQUEST message, the MME may include the Header compression configuration IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message. Furthermore, if the MME decides that the associated PDN connection is only for control plane CIoT EPS optimization (see subclause 5.3.15), the MME shall include the Control plane only indication in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message.

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, the UE shall stop timer T3482 and enter the state PROCEDURE TRANSACTION INACTIVE. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see subclause 7.3.1).

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with the Connectivity type IE indicating "the PDN connection is considered a LIPA PDN connection", the UE provides an indication to the upper layers that the connectivity is provided by a LIPA PDN connection.

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if the 3GPP PS data off UE status is "activated", the UE behaves as described in subclause 6.3.10.

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if the SCEF or P-GW indicates acceptance of use of Reliable Data Service to transfer data for the PDN connection, the UE behaves as described in subclause 6.3.11.

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message, if an S-NSSAI and the PLMN ID that this S-NSSAI relates to are provided in the protocol configuration options IE or extended protocol configuration options IE, the UE shall store the S-NSSAI and the associated PLMN ID along with the corresponding PDU session ID that the UE provided in the PDN CONNECTIVITY REQUEST message. The usage of the PDU session ID and the corresponding S-NSSAI with the associated PLMN ID is specified in 3GPP TS 24.501 [54].

Upon receipt of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message with a session-AMBR and QoS rule(s), which correspond to the default EPS bearer of the PDN connectivity being activated, in the protocol configuration options IE or the extended protocol configuration options IE, the UE stores the session-AMBR and QoS rule(s) for use during inter-system change from S1 mode to N1 mode.


6.5.1.4	UE requested PDN connectivity procedure not accepted by the network


6.5.1.4.1	General

If connectivity with the requested PDN cannot be accepted by the network, the MME shall send a PDN CONNECTIVITY REJECT message to the UE. The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested PDN connectivity.

The ESM cause IE typically indicates one of the following ESM cause values:

  #8:	operator determined barring;

  #26:	insufficient resources;

  #27:	missing or unknown APN;

  #28:	unknown PDN type;

  #29:	user authentication or authorization failed;

  #30:	request rejected by Serving GW or PDN GW;

  #31:	request rejected, unspecified;

  #32:	service option not supported;

  #33:	requested service option not subscribed;

  #34:	service option temporarily out of order;

  #35:	PTI already in use;

  #38:	network failure;

  #50:	PDN type IPv4 only allowed;

  #51:	PDN type IPv6 only allowed;

  #53:	ESM information not received;

  #54:	PDN connection does not exist;

  #55:	multiple PDN connections for a given APN not allowed;

  #57:	PDN type IPv4v6 only allowed;

  #58:	PDN type non IP only allowed;

  #65:	maximum number of EPS bearers reached;

  #66:	requested APN not supported in current RAT and PLMN combination;

  #95 – 111:	protocol errors;

  #112:	APN restriction value incompatible with active EPS bearer context;

  #113:	Multiple accesses to a PDN connection not allowed.

The network may include a Back-off timer value IE in the PDN CONNECTIVITY REJECT message. If the ESM cause value is #26 "insufficient resources" and the PDN CONNECTIVITY REQUEST message was received via a NAS signalling connection established with RRC establishment cause "High priority access AC 11 – 15" or the request type in the PDN CONNECTIVITY REQUEST message was set to "emergency" or "handover of emergency bearer services", the network shall not include a Back-off timer value IE.

If the Back-off timer value IE is included and the ESM cause value is different from #26 "insufficient resources", #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed" and #65 "maximum number of EPS bearers reached", the network may include the Re-attempt indicator IE to indicate whether the UE is allowed to attempt a PDP context activation procedure in the PLMN for the same APN in A/Gb or Iu mode, and whether another attempt in A/Gb and Iu mode or in S1 mode is allowed in an equivalent PLMN.

If the ESM cause value is #50 "PDN type IPv4 only allowed",  #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed" or #58 "PDN type non IP only allowed", the network may include the Re-attempt indicator IE without Back-off timer value IE to indicate whether the UE is allowed to attempt a PDN connectivity procedure in an equivalent PLMN for the same APN in S1 mode using the same PDN type.

If the ESM cause value is #66 "requested APN not supported in current RAT and PLMN combination", the network may include the Re-attempt indicator IE without Back-off timer value IE to indicate whether the UE is allowed to attempt a PDN connectivity procedure in an equivalent PLMN for the same APN in S1 mode.

Upon receipt of the PDN CONNECTIVITY REJECT message, the UE shall stop timer T3482 and enter the state PROCEDURE TRANSACTION INACTIVE.

If the PDN CONNECTIVITY REJECT message is due to an ESM failure notified by EMM layer (i.e., EMM cause #19 "ESM failure" included in an ATTACH REJECT message), the UE may include a different APN in the PDN CONNECTIVITY REQUEST message.

  NOTE 1:	When receiving EMM cause #19 "ESM failure", coordination is required between the EMM and ESM sublayers in the UE to notify the ESM failure.

If the PDN CONNECTIVITY REQUEST message was sent with request type set to "emergency" or "handover of emergency bearer services" in a stand-alone PDN connectivity procedure and the UE receives a PDN CONNECTIVITY REJECT message, then the UE may:

  a)	inform the upper layers of the failure to establish the emergency bearer; or

  NOTE 2:	This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain) or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.

  b)	detach locally, if not detached already, attempt EPS attach for emergency bearer services.


6.5.1.4.2	Handling of network rejection due to ESM cause #26

If the ESM cause value is #26 "insufficient resources" and the Back-off timer value IE is included, the UE shall ignore the Re-attempt indicator IE provided by the network, if any, and behave as follows:

  1)	if the PDN CONNECTIVITY REQUEST message was sent standalone, the UE shall take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.5):

    i)	if the timer value indicates neither zero nor deactivated and an APN was included in the PDN CONNECTIVITY REQUEST message, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. If the timer value indicates neither zero nor deactivated, no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN if it is running. The UE shall then start timer T3396 with the value provided in the Back-off timer value IE and:

       -	shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and

       -	shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST for a non-emergency PDN connection established without an APN provided by the UE, if no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from "emergency" and from "handover of emergency bearer services", until timer T3396 expires or timer T3396 is stopped.

       The UE shall not stop timer T3396 upon a PLMN change or inter-system change;

    ii)	if the timer value indicates that this timer is deactivated, the UE:

       -	shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network; and

       -	shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, if no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from "emergency" and from "handover of emergency bearer services", until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE.

       The timer T3396 remains deactivated upon a PLMN change or inter-system change; and

    iii)	if the timer value indicates zero, the UE:

       -	shall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and

       -	if no APN was included in the PDN CONNECTIVITY REQUEST message and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE; and

  2)	if the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, the UE shall take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE and on the integrity protection of the ATTACH REJECT message (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.5):

    i)	if the ATTACH REJECT message is not integrity protected and an APN was sent by the UE during the attach procedure, the UE shall stop timer T3396 associated with the corresponding APN if it is running. If the ATTACH REJECT message is not integrity protected, the request type was different from "emergency" and from "handover of emergency bearer services", and an APN was not sent by the UE, the UE shall stop timer T3396 associated with no APN if it is running. The UE shall then start timer T3396 with a random value from a default range specified in table 11.2.3 defined in 3GPP TS 24.008 [13], and:

       a)	shall not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and

       b)	shall not initiate a new attach procedure without an APN and with request type different from "emergency" and from "handover of emergency bearer services" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until timer T3396 expires.

       	The UE shall not stop timer T3396 upon a PLMN change or inter-system change;

    ii)	if the ATTACH REJECT message is integrity protected, the UE shall proceed as follows:

       a)	if the timer value indicates neither zero nor deactivated and an APN was sent by the UE during the attach procedure, the UE shall stop timer T3396 associated with the corresponding APN if it is running. If the timer value indicates neither zero nor deactivated, the request type was different from "emergency" and from "handover of emergency bearer services", and an APN was not sent by the UE during the attach procedure, the UE shall stop timer T3396 associated with no APN if it is running. The UE shall then start timer T3396 with the value provided in the Back-off timer value IE and:

         -	shall not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, until timer T3396 expires or timer T3396 is stopped; and

         -	shall not initiate a new attach procedure without an APN and with request type different from "emergency" and from "handover of emergency bearer services" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until timer T3396 expires.

         	The UE shall not stop timer T3396 upon a PLMN change or inter-system change;

       b)	if the timer value indicates that this timer is deactivated, the UE:

         -	shall not initiate a new attach procedure with the same APN or send another PDN CONNECTIVITY REQUEST with the same APN that was sent by the UE, until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message for the same APN from the network; and

         -	shall not initiate a new attach procedure without an APN and with request type different from "emergency" and from "handover of emergency bearer services" or send another PDN CONNECTIVITY REQUEST without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.

         	The timer T3396 remains deactivated upon a PLMN change or inter-system change; and

       c)	if the timer value indicates that this timer is zero, the UE shall proceed as specified in subclause 5.5.1.2.6 item d.

If the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent standalone, then the UE may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN.

When the timer T3396 is running or the timer is deactivated, the UE is allowed to initiate an attach procedure or PDN connectivity procedure if the procedure is for emergency bearer services.

If the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.

If the UE is switched off when the timer T3396 is running, and if the USIM in the UE remains the same when the UE is switched on, the UE shall behave as follows:

  -	let t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;

  -	if prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5; and

  -	if prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5.


6.5.1.4.3	Handling of network rejection due to ESM cause other than ESM cause #26

If the ESM cause value is different from #26 "insufficient resources", #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #54 "PDN connection does not exist", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed", #65 "maximum number of EPS bearers reached", and #66 "requested APN not supported in current RAT and PLMN combination", and the Back-off timer value IE is included, the UE shall behave as follows:

  1)	if the PDN CONNECTIVITY REQUEST message was sent standalone, the UE shall take different actions depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.6):

    i)	if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure and PLMN and APN combination and

       -	shall not send another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and

       -	shall not send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services" if no APN was included in the PDN CONNECTIVITY REQUEST message, until the back-off timer expires, the UE is switched off or the USIM is removed;

    ii)	if the timer value indicates that this timer is deactivated, the UE:

       -	shall not send another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN until the UE is switched off or the USIM is removed; and

       -	shall not send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services" if no APN was included in the PDN CONNECTIVITY REQUEST message, until the UE is switched off or the USIM is removed; and

    iii)	if the timer value indicates zero, the UE:

       -	may send another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN; and

       -	may send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN; and

  2)	if the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, the UE shall take different actions depending on the timer value received in the Back-off timer value IE and on the integrity protection of the ATTACH REJECT message (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.6):

    i)	if the ATTACH REJECT message is not integrity protected, the UE shall start the back-off timer with a random value from a default range specified in table 11.2.3(see 3GPP TS 24.008 [13]), and:

       a)	shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and

       b)	shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency", until the back-off timer expires, the UE is switched off or the USIM is removed; and

    ii)	if the ATTACH REJECT message is integrity protected, the UE shall proceed as follows:

       a)	if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure and PLMN and APN combination and:

         -	shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and

         -	shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until the back-off timer expires, the UE is switched off or the USIM is removed;

       b)	if the timer value indicates that this timer is deactivated, the UE:

         -	shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN with the same APN that was sent by the UE, until the UE is switched off or the USIM is removed; and

         -	shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the PLMN without an APN and with request type different from "emergency" and from "handover of emergency bearer services", if the UE did not provide any APN during the attach procedure and the request type was different from "emergency" and from "handover of emergency bearer services", until the UE is switched off or the USIM is removed; and

       c)	if the timer value indicates that this timer is zero, the UE shall proceed as specified in subclause 5.5.1.2.6 item d.

If the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent standalone, then the UE shall ignore the Re-attempt indicator IE provided by the network in PDN CONNECTIVITY REJECT, if any.

  1)	Additionally, if the ESM cause value is #8 "operator determined barring", #27 "missing or unknown APN", #32 "service option not supported", or #33 "requested service option not subscribed", the UE shall proceed as follows:

    -	if the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list, the UE shall behave as described above in the present subclause, using the configured SM_RetryWaitTime value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, as back-off timer value; and

    -	otherwise, if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, or if the SM_RetryWaitTime value is not configured, the UE shall behave as described above in the present subclause, using the default value of 12 minutes for the back-off timer.

  2)	For ESM cause values different from #8 "operator determined barring", #27 "missing or unknown APN", #32 "service option not supported", or #33 "requested service option not subscribed", the UE behaviour regarding the start of a back-off timer is unspecified.

The UE shall not stop any back-off timer upon a PLMN change or inter-system change. If the network indicates that a back-off timer for the PDN connectivity procedure and PLMN and APN combination is deactivated, then it remains deactivated upon a PLMN change or inter-system change.

  NOTE 1:	This means the back-off timer can still be running or be deactivated for the given ESM procedure and PLMN and APN combination when the UE returns to the PLMN or when it performs inter-system change back from A/Gb or Iu mode to S1 mode. Thus the UE can still be prevented from sending another PDN CONNECTIVITY REQUEST message in the PLMN for the same APN.

If the Back-off timer value IE is not included and the PDN CONNECTIVITY REQUEST was sent together with an ATTACH REQUEST, the UE shall ignore the Re-attempt indicator IE provided by the network in PDN CONNECTIVITY REJECT, if any, and proceed as specified in subclause 5.5.1.2.6, item d.

If the back-off timer is started upon receipt of a PDN CONNECTIVITY REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, the UE behaves as follows:

  1)	after a PLMN change the UE may send a PDN CONNECTIVITY REQUEST message for the same APN in the new PLMN, if the back-off timer is not running and is not deactivated for the PDN connectivity procedure and the combination of new PLMN and APN;

    	Furthermore as an implementation option, for the ESM cause values #8 "operator determined barring", #27 "missing or unknown APN", #32 "service option not supported" or #33 "requested service option not subscribed", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE using the same PDN type, or the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message included in an ATTACH REQUEST message without an APN using the same PDN type if the UE did not provide any APN in the PDN connectivity procedure, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs.

  2)	if the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode is allowed, or the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, then:

    -	if the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list, the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, to determine whether the UE may attempt a PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode; and

    -	if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, or if the NAS configuration MO as specified in 3GPP TS 24.368 [15A] is not available and the value for inter-system change is not configured in the USIM file NASCONFIG, then the UE behaviour regarding a PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode is unspecified; and

  3)	if the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then depending on the timer value received in the Back-off timer value IE, for each combination of a PLMN from the equivalent PLMN list and the APN the UE shall start a back-off timer for the PDP connectivity procedure with the value provided by the network, or deactivate the respective back-off timer as follows:

    -	If the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode is allowed, the UE shall start or deactivate the back-off timer for S1 mode only; and

    -	otherwise the UE shall start or deactivate the back-off timer for A/Gb, Iu, and S1 mode.

If the back-off timer for a PLMN and APN combination was started or deactivated in A/Gb or Iu mode upon receipt of an ACTIVATE PDP CONTEXT REJECT message (see 3GPP TS 24.008 [13]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any PDN CONNECTIVITY REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed.

  NOTE 2:	The back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.

  NOTE 3:	Reference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation. This back-off timer is stopped when the UE is switched off or the USIM is removed.

When the back-off timer is running or the timer is deactivated, the UE is allowed to initiate an attach procedure or PDN connectivity procedure if the procedure is for emergency bearer services.

If the ESM cause value is #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed" or #58 "PDN type non IP only allowed", the UE shall ignore the Back-off timer value IE provided by the network, if any. The UE shall not automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE using the same PDN type until any of the following conditions is fulfilled:

  -	the UE is registered to a new PLMN, and either the network did not include a Re-attempt indicator IE in the PDN CONNECTIVITY REJECT message or the Re-attempt indicator IE included in the message indicated that re-attempt in an equivalent PLMN is allowed;

  -	the UE is registered to a new PLMN which was not in the list of equivalent PLMNs at the time when the PDN CONNECTIVITY REJECT message was received;

  -	the PDN type which is used to access to the APN is changed;

  -	the UE is switched off; or

  -	the USIM is removed.

For the ESM cause values #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed" and #58 "PDN type non IP only allowed", the UE shall ignore the value of the RATC bit in the Re-attempt indicator IE provided by the network, if any.

Furthermore as an implementation option, for the SM cause values #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed" and #58 "PDN type non IP only allowed", if the network does not include a Re-attempt indicator IE the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message for the same APN that was sent by the UE using the same PDN type, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs.

  NOTE 4:	Request to send another PDN CONNECTIVITY REQUEST message with a specific PDN type has to come from upper layers.

If the ESM cause value is #65 "maximum number of EPS bearers reached", the UE shall determine the PLMN's maximum number of EPS bearer contexts in S1 mode (see subclause 6.5.0) as the number of active EPS bearer contexts it has. The UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any.

  NOTE 5:	In some situations, when attempting to establish multiple EPS bearer contexts, the number of active EPS bearer contexts that the UE has when ESM cause #65 is received is not equal to the maximum number of EPS bearer contexts reached in the network.

  NOTE 6:	When the network supports emergency bearer services, it is not expected that ESM cause #65 is returned by the network when the UE requests a PDN connection for emergency bearer services.

The PLMN's maximum number of EPS bearer contexts in S1 mode applies to the PLMN in which the ESM cause #65 "maximum number of EPS bearers reached" is received. When the UE is switched off, when the USIM is removed, or when there is a change in the value indicated by the network in the 15 bearers bit of the EPS network feature support IE, the UE shall clear all previous determinations representing PLMNs maximum number of EPS bearer contexts in S1 mode. Upon successful registration with a new PLMN, the UE may clear previous determinations representing any PLMN's maximum number(s) of EPS bearer contexts in S1 mode.

If the ESM cause value is #66 "requested APN not supported in current RAT and PLMN combination", the UE shall take different actions depending on the Back-off timer value IE and the Re-attempt indicator IE optionally included:

  1)	If the PDN CONNECTIVITY REQUEST message was sent standalone, the Back-off timer value IE is not included, and either the Re-attempt indicator IE is not included or the Re-attempt indicator IE is included indicating that re-attempt in an equivalent PLMN is allowed, the UE shall not initiate an attach procedure or send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode until the UE is switched off or the USIM is removed;

  2)	if the PDN CONNECTIVITY REQUEST message was sent standalone, the Back-off timer value IE is not included, and the Re-attempt indicator IE is included and indicates that re-attempt in an equivalent PLMN is not allowed, the UE shall not initiate an attach procedure or send a PDN CONNECTIVITY REQUEST message for the same APN in any PLMN in the list of equivalent PLMNs in S1 mode until the UE is switched off or the USIM is removed;

  3)	if the PDN CONNECTIVITY REQUEST message was sent standalone and the Back-off timer value IE is included, the UE shall take different actions depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.6):

    i)	if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PLMN and APN combination and shall not send another PDN CONNECTIVITY REQUEST for the same APN in the current PLMN in S1 mode until the back-off timer expires, the UE is switched off or the USIM is removed;

    ii)	if the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode until the UE is switched off or the USIM is removed; and

    iii)	if the timer value indicates that this timer is zero, the UE may send a PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN; and

  4)	if the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST, the UE shall take different actions depending on the integrity protection of the ATTACH REJECT message (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.6):

    i)	if the ATTACH REJECT message is not integrity protected, regardless whether the Back-off timer IE is included, the UE shall start the back-off timer with a random value from a default range specified in table 11.2.3(see 3GPP TS 24.008 [13]), and shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed; and

    ii)	if the ATTACH REJECT message is integrity protected, the UE shall proceed as follows:

       a)	if the Back-off timer value IE is included and the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure and PLMN and APN combination and shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, until the back-off timer expires, the UE is switched off or the USIM is removed;

       b)	if the Back-off timer value IE is included and the timer value indicates that this timer is deactivated, the UE shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message in the current PLMN in S1 mode with the same APN that was sent by the UE, until the UE is switched off or the USIM is removed;

       c)	if the Back-off timer value IE is included and the timer value indicates that this timer is zero, the UE shall proceed as specified in subclause 5.5.1.2.6 item d;

       d)	if the Back-off timer value IE is not included, and either the Re-attempt indicator IE is not included or the Re-attempt indicator IE is included indicating that re-attempt in an equivalent PLMN is allowed, the UE shall not initiate a new attach procedure or send another PDN CONNECTIVITY REQUEST message for the same APN in the current PLMN in S1 mode until the UE is switched off or the USIM is removed; and

       e)	if the Back-off timer value IE is not included, and the Re-attempt indicator IE is included and indicates that re-attempt in an equivalent PLMN is not allowed, the UE shall not initiate a new attach procedure or send a PDN CONNECTIVITY REQUEST message for the same APN in any PLMN in the list of equivalent PLMNs in S1 mode until the UE is switched off or the USIM is removed.

  NOTE 7:	Receiving ESM cause value #66 during an attach procedure without APN is not expected and the UE behaviour is implementation specific.

If the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then

  -	for cases 3.i, 4.i and 4.ii.a the UE shall additionally start a back-off timer with the value provided in the Back-off timer value IE for the PDN connectivity procedure for each combination of a PLMN from the equivalent PLMN list and the APN; and

  -	for cases 3.ii and 4.ii.b the UE shall deactivate the respective back-off timers for the PDN connectivity procedure for each combination of a PLMN from the equivalent PLMN list and the APN.

For the ESM cause value #66 "requested APN not supported in current RAT and PLMN combination" the UE shall ignore the value of the RATC bit in the Re-attempt indicator IE provided by the network, if any.

As an implementation option, for cases 1, 3.i, 3.ii, 4.iv, 4.v.a and 4.v.b, if the Re-attempt indicator IE is not included, the UE may decide not to automatically send another PDN CONNECTIVITY REQUEST message for the same APN in a PLMN which is in the list of equivalent PLMNs.

If the ESM cause value is #54 "PDN connection does not exist", the UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any, and take different actions as follows:

  -	if the PDN CONNECTIVITY REQUEST message was sent standalone, the UE shall set the request type to "initial request" in the subsequent PDN CONNECTIVITY REQUEST message to establish a PDN connectivity to the same APN;

  -	if the PDN CONNECTIVITY REQUEST message was sent together with an ATTACH REQUEST message, the UE shall set the request type to "initial request" in the PDN CONNECTIVITY REQUEST message which is included in the subsequent ATTACH REQUEST message to establish a PDN connectivity to the same APN.

  NOTE 8:	User interaction is necessary in some cases when the UE cannot re-activate the EPS bearer context(s) automatically.


6.5.1.4A	Handling the maximum number of active EPS bearer contexts

If the maximum number of active EPS bearer contexts is reached at the UE (see subclause 6.5.0) and the upper layers of the UE request connectivity to a PDN the UE shall not send a PDN CONNECTIVITY REQUEST message unless an active EPS bearer is deactivated. If the UE needs to de-activate an active EPS bearer context, choosing which EPS bearer context to de-activate is implementation specific, however the UE shall not deactivate an EPS bearer context for emergency.

  NOTE:	Subclause 6.5.1.6 specifies that a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as an already existing, non-emergency PDN connection can be acceptable, in some cases. In these cases the UE does not need to de-activate an active EPS bearer context if the maximum number of active EPS bearer contexts is reached at the UE.

If the UE needs to de-activate an EPS bearer context in order to request an emergency EPS bearer context, it shall either de-activate an EPS bearer context locally or via explicit signalling. If the UE performs local de-activation, the UE shall perform tracking area updating procedure to indicate EPS bearer context status to the network.


6.5.1.4B	Void


6.5.1.5	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	T3482 expired

    	On the first expiry of the timer T3482:

    -	if the PDN CONNECTIVITY REQUEST message was sent with request type set to "emergency" or "handover of emergency bearer services" in a stand-alone PDN connectivity procedure, then the UE shall:

       a)	inform the upper layers of the failure to establish the emergency bearer; or

  NOTE:	This can result in the upper layers requesting establishment of a CS emergency call (if not already attempted in the CS domain), or other implementation specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [13D] can result in the emergency call being attempted to another IP-CAN.

       b)	detach locally, if not detached already, attempt EPS attach for emergency bearer services.

    -	otherwise, the UE shall resend the PDN CONNECTIVITY REQUEST and shall reset and restart timer T3482. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3482, the UE shall abort the procedure, release the PTI allocated for this invocation and enter the state PROCEDURE TRANSACTION INACTIVE.

  b)	T3447 is running

    	The UE shall not send a PDN CONNECTIVITY REQUEST message when the UE is in EMM-CONNECTED mode after the UE attached without PDN connection, unless:

    -	establishment of a PDN connection for emergency bearer services is requested;

    -	the UE is a UE configured to use AC11 – 15 in the selected PLMN; or

    -	a network initiated signalling message has been received.

    	The PDN CONNECTIVITY REQUEST message can be sent, if still necessary, when timer T3447 expires.


6.5.1.6	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	UE initiated PDN connectivity request for an already existing PDN connection:

    	If the network receives a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as an already existing PDN connection,

       	If the information elements in the PDN CONNECTIVITY REQUEST message do not differ from the ones received within the previous PDN CONNECTIVITY REQUEST message, and the MME has not received the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message from UE, the network shall resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and continue the previous procedure.

       	If one or more information elements in the PDN CONNECTIVITY REQUEST message differ from the ones received within the previous PDN CONNECTIVITY REQUEST message, and multiple PDN connections for a given APN are not allowed, the network may deactivate the existing EPS bearer contexts for the PDN connection locally without notification to the UE and proceed with the requested PDN connectivity procedure or may reject this PDN connectivity procedure including the ESM cause #55 "multiple PDN connections for a given APN not allowed", in the PDN CONNECTIVITY REJECT message.

    	If the network receives a PDN CONNECTIVITY REQUEST message with request type "emergency" and the MME has not received the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message from UE for the previous PDN connectivity request for emergency bearer services, the network shall resend the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message and continue the previous procedure. If there is already a PDN connection for emergency bearer services existing, the MME shall reject the request with ESM cause #55 "multiple PDN connections for a given APN not allowed" or deactivate the existing EPS bearer contexts for the PDN connection locally without notification to the UE and proceed with the requested PDN connectivity procedure.

  b)	UE initiated PDN connectivity request with request type "handover" for a PDN connection that does not exist:

    	If the network receives a PDN CONNECTIVITY REQUEST message for either a default APN or a specific APN with request type set to "handover" and the MME does not have any information about that PDN connection, then MME shall reject the PDN connectivity request procedure including the ESM cause #54 "PDN connection does not exist", in the PDN CONNECTIVITY REJECT message.

  c)	ESM information not received:

    	If the ESM information transfer flag in the PDN CONNECTIVITY REQUEST message has been set and the ESM information is not received before the final expiry of timer T3489 as described in subclause 6.6.1.2.6, the MME shall reject the PDN connectivity request procedure including the ESM cause #53 "ESM information not received", in the PDN CONNECTIVITY REJECT message.

  d)	Additional UE initiated PDN connectivity request received from a UE that is attached for emergency bearer services:

    	The MME shall reject the request with ESM cause #31 "request rejected, unspecified".

  e)	A PDN CONNECTIVITY REQUEST message with request type "handover of emergency bearer services" received from a UE and the MME does not have any information about a P-GW currently providing emergency bearer services for the UE or the MME is not configured with an address of a P-GW in the MME emergency configuration data:

    	MME shall reject the PDN connectivity request procedure including the ESM cause #54 "PDN connection does not exist", in the PDN CONNECTIVITY REJECT message.


6.5.1.7	Handling PDN connectivity request for UE configured for dual priority

If a PDN connection exists that was established due to a request including a low priority indicator set to "MS is configured for NAS signalling low priority" and the upper layers of the UE request to establish a PDN connection with the same APN and a low priority indicator set to "MS is not configured for NAS signalling low priority", when initiating the PDN connectivity request procedure, the UE shall:

  -	send a PDN CONNECTIVITY REQUEST message with the same combination of APN and PDN type as the existing PDN connection. If the UE receives a PDN CONNECTIVITY REJECT message with ESM cause #55 "multiple PDN connections for a given APN not allowed", the upper layers are informed of this; or

  -	send a PDN CONNECTIVITY REQUEST message with the same APN after the successful deactivation of the existing PDN connection.

  NOTE:	The above list of options also apply for the case when the existing PDN connection was established due to a request including a low priority indicator set to "MS is not configured for NAS signalling low priority" and the new request to establish a PDN connection with the same APN contains a low priority indicator set to "MS is configured for NAS signalling low priority".

As an alternative the upper layers of the UE can request to establish a PDN connection with a different APN.


6.5.2	UE requested PDN disconnect procedure


6.5.2.1	General

The purpose of the UE requested PDN disconnection procedure is for a UE to request disconnection from one PDN. If EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE can initiate this procedure to disconnect from any PDN as long as it is connected to at least one other PDN. If EMM-REGISTERED without PDN connection is supported by the UE and the MME, the UE can initiate this procedure to disconnect from any PDN. With this procedure, all EPS bearer contexts established towards this PDN, including the default EPS bearer context, are released.

The UE is allowed to initiate the PDN disconnection procedure even if the timer T3396 is running.


6.5.2.2	UE requested PDN disconnection procedure initiation

In order to request PDN disconnection from a PDN, the UE shall send a PDN DISCONNECT REQUEST message to the MME, start the timer T3492 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.2.2.1). The PDN DISCONNECT REQUEST message shall include the EPS bearer identity of the default bearer associated with the PDN to disconnect from as the linked EPS bearer identity in the PDN DISCONNECT REQUEST message.

[pic]

Figure 6.5.2.2.1: UE requested PDN disconnection procedure


6.5.2.3	UE requested PDN disconnection procedure accepted by the network

Upon receipt of the PDN DISCONNECT REQUEST message, if it is accepted by the network, the MME shall initiate the bearer context deactivation procedure by sending the DEACTIVATE EPS BEARER CONTEXT REQUEST message including the linked EPS bearer identity of the default bearer associated with the PDN to disconnect from and the PTI. The behaviour of the MME is described in subclause 6.4.4.

Upon receipt of the DEACTIVATE EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the PDN DISCONNECT REQUEST message, the UE shall stop the timer T3492 and enter the state PROCEDURE TRANSACTION INACTIVE. The behaviour of the UE is described in subclause 6.4.4. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received DEACTIVATE EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see subclause 7.3.1).

On reception of DEACTIVATE EPS BEARER CONTEXT ACCEPT message from the UE, the MME releases all the resources reserved for the PDN in the network.


6.5.2.4	UE requested PDN disconnection procedure not accepted by the network

Upon receipt of the PDN DISCONNECT REQUEST message, if it is not accepted by the network, the MME shall send a PDN DISCONNECT REJECT message to the UE. The PDN DISCONNECT REJECT message shall contain the PTI and an ESM cause IE that typically indicates one of the following ESM cause values:

  #35:	PTI already in use;

  #43:	invalid EPS bearer identity;

  #49:	last PDN disconnection not allowed;

  #95 – 111: protocol errors.

If EMM-REGISTERED without PDN connection is supported by the UE and the MME, then ESM cause #49 "last PDN disconnection not allowed" is not applicable.

Upon receipt of the PDN DISCONNECT REJECT message, the UE shall stop the timer T3492, enter the state PROCEDURE TRANSACTION INACTIVE and abort the PDN disconnection procedure. Additionally, in all cases with the exception of the UE having received ESM cause #49 "last PDN disconnection not allowed" if EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the UE shall deactivate all EPS bearer contexts for this PDN connection locally without peer-to-peer signalling between the UE and the MME. If the UE receives ESM cause #49 "last PDN disconnection not allowed" and the UE has any other PDN connections established, the UE may locally deactivate, without peer-to-peer signalling between the UE and the MME, all EPS bearer contexts associated with those other PDN connections.


6.5.2.5	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	Expiry of timer T3492:

    	On the first expiry of the timer T3492, the UE shall resend the PDN DISCONNECT REQUEST and shall reset and restart timer T3492. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3492, the UE shall abort the procedure, deactivate all EPS bearer contexts for this PDN connection locally without peer-to-peer signalling between the UE and the MME, release the PTI allocated for this invocation and enter the state PROCEDURE TRANSACTION INACTIVE. In order to synchronize EPS bearer contexts status with the MME, on indication of "back to E-UTRAN coverage" from the lower layers, the UE shall send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME.

  b)	Collision of UE requested PDN disconnect procedure and dedicated EPS bearer context activation procedure:

    	When the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, and the EPS bearer to be activated belongs to the PDN connection the UE wants to disconnect, the UE shall ignore the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message and proceed with the PDN disconnect procedure.

  c)	Collision of UE requested PDN disconnect procedure and EPS bearer context modification:

    	When the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, and the EPS bearer to be modified belongs to the PDN connection the UE wants to disconnect, the UE shall ignore the MODIFY EPS BEARER CONTEXT REQUEST message and proceed with the PDN disconnect procedure.

  d)	Collision of UE requested PDN disconnect procedure and EPS bearer context deactivation procedure:

    	When the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message during the PDN disconnect procedure, and the EPS bearer indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is a dedicated EPS bearer belonging to the PDN connection the UE wants to disconnect, the UE shall proceed with both procedures.


6.5.2.6	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	No PDN connection with the linked EPS bearer identity activated:

    	If the linked EPS bearer identity included in the PDN DISCONNECT REQUEST message does not belong to the default EPS bearer context of an established PDN connection, the MME shall reply with a PDN DISCONNECT REJECT message with ESM cause #43 "invalid EPS bearer identity".


6.5.3	UE requested bearer resource allocation procedure


6.5.3.1	General

The purpose of the UE requested bearer resource allocation procedure is for a UE to request an allocation of bearer resources for a traffic flow aggregate. The UE requests a specific QoS demand (QCI) and optionally sends a GBR requirement for a new traffic flow aggregate. If accepted by the network, this procedure invokes a dedicated EPS bearer context activation procedure (see subclause 6.4.2) or an EPS bearer context modification procedure (see subclause 6.4.3).

If there is a PDN connection for emergency bearer services established, the UE shall not request additional bearer resources for this PDN connection.


6.5.3.2	UE requested bearer resource allocation procedure initiation

In order to request the allocation of bearer resources for one traffic flow aggregate, the UE shall send a BEARER RESOURCE ALLOCATION REQUEST message to the MME, start timer T3480 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.3.2.1).

The UE shall include the EPS bearer identity of the default EPS bearer associated with the requested bearer resource in the Linked EPS bearer identity IE. The UE shall set the TFT operation code in the Traffic flow aggregate IE to "Create new TFT". The packet filters in the Traffic flow aggregate IE shall include at least one packet filter applicable for the uplink direction. In the Required traffic flow QoS IE, the UE shall indicate a QCI and, if the UE also includes a GBR, the additional GBR required for the traffic flow aggregate.

[pic]

Figure 6.5.3.2.1: UE requested bearer resource allocation procedure

For the NBIFOM procedures as defined in 3GPP TS 24.161 [36], the UE may send a BEARER RESOURCE ALLOCATION REQUEST message to the MME. If the traffic flow aggregate IE is not needed in those procedures, the UE shall set:

  -	the length indicator of the Traffic flow aggregate IE to the value 1;

  -	the TFT operation code to "000";

  -	the E bit to zero; and

  -	the number of packet filters to zero;

and in the Required traffic flow QoS IE:

  -	the length indicator to the value 1; and

  -	the QCI to zero.


6.5.3.3	UE requested bearer resource allocation procedure accepted by the network

Upon receipt of the BEARER RESOURCE ALLOCATION REQUEST message, the MME checks whether the resources requested by the UE can be established by verifying the EPS bearer identity given in the Linked EPS bearer identity IE to be any of the active default EPS bearer context(s).

If the bearer resource allocation requested is accepted by the network, the MME shall initiate either a dedicated EPS bearer context activation procedure or an EPS bearer context modification procedure. Upon receipt of an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the BEARER RESOURCE ALLOCATION REQUEST message, the UE shall stop timer T3480 and enter the state PROCEDURE TRANSACTION INACTIVE. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see subclause 7.3.1).

If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is received, the UE shall verify that the EPS bearer identity given in the EPS bearer identity IE is not already used by any EPS bearer context. The UE shall then proceed as described in subclause 6.4.2.3 or subclause 6.4.2.4.

If the MODIFY EPS BEARER CONTEXT REQUEST message is received, the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is any of the active EPS bearer contexts. The UE shall then proceed as described in subclause 6.4.3.3 or subclause 6.4.3.4.


6.5.3.4	UE requested bearer resource allocation procedure not accepted by the network


6.5.3.4.1	General

If the bearer resource allocation requested cannot be accepted by the network, the MME shall send a BEARER RESOURCE ALLOCATION REJECT message to the UE. The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested bearer resource allocation.

The ESM cause value typically indicates one of the following:

  #26:	insufficient resources;

  #30:	request rejected by Serving GW or PDN GW;

  #31:	request rejected, unspecified;

  #32:	service option not supported;

  #33:	requested service option not subscribed;

  #34:	service option temporarily out of order;

  #35:	PTI already in use;

  #37:	EPS QoS not accepted;

  #41:	semantic error in the TFT operation;

  #42:	syntactical error in the TFT operation;

  #43:	invalid EPS bearer identity;

  #44:	semantic error(s) in packet filter(s);

  #45:	syntactical error(s) in packet filter(s);

  #56:	collision with network initiated request;

  #59:	unsupported QCI value;

  #60:	bearer handling not supported;

  #65:	maximum number of EPS bearers reached; or

  #95 – 111:	protocol errors.

If the bearer resource allocation requested is for an established LIPA PDN connection or SIPTO at the local network PDN connection, then the network shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #60 "bearer handling not supported".

If the requested new TFT is not available, then the BEARER RESOURCE ALLOCATION REJECT message shall be sent.

The TFT in the request message is checked by the network for different types of TFT IE errors as follows:

  a)	Semantic errors in TFT operations:

    1)	When the TFT operation is an operation other than "Create a new TFT".

    	The network shall reject the allocation request with ESM cause #41 "semantic error in the TFT operation".

  b)	Syntactical errors in TFT operations:

    1)	When the TFT operation = "Create a new TFT" and the packet filter list in the TFT IE is empty.

    2)	When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.

    	The network shall reject the allocation request with ESM cause #42 "syntactical error in the TFT operation".

  c)	Semantic errors in packet filters:

    	When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the network determines a semantic error in a packet filter is outside the scope of the present document.

    	The network shall reject the allocation request with ESM cause #44 "semantic errors in packet filter(s)".

  d)	Syntactical errors in packet filters:

    1)	When the TFT operation = "Create a new TFT" and two or more packet filters among all TFTs associated with the PDN connection would have identical packet filter precedence values.

    2)	When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.

    	In case 1, if the old packet filters do not belong to the default EPS bearer context, the network shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, the network shall perform an EPS bearer context deactivation request procedure to deactivate the dedicated EPS bearer context(s) for which it has deleted the packet filters.

    	In case 1, if one or more old packet filters belong to the default EPS bearer context, the network shall release the relevant PDN connection using the EPS bearer context deactivation procedure.If it is the last remaining PDN connection and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the network shall detach the UE using detach type "re-attach required".

    	Otherwise the network shall reject the allocation request with ESM cause #45 "syntactical errors in packet filter(s)".

The network may include a Back-off timer value IE in the BEARER RESOURCE ALLOCATION REJECT message.

If the Back-off timer value IE is included and the ESM cause value is different from  #26 "insufficient resources" and #65 "maximum number of EPS bearers reached", the network may include the Re-attempt indicator IE to indicate whether the UE is allowed to attempt a secondary PDP context activation procedure in the PLMN for the same APN in A/Gb or Iu mode, and whether another attempt in A/Gb and Iu mode or in S1 mode is allowed in an equivalent PLMN.

Upon receipt of a BEARER RESOURCE ALLOCATION REJECT message, the UE shall stop the timer T3480, release the traffic flow aggregate description associated to the PTI value, and enter the state PROCEDURE TRANSACTION INACTIVE.


6.5.3.4.2	Handling of network rejection due to ESM cause #26

If the ESM cause value is #26 "insufficient resources" and the Back-off timer value IE is included, the UE shall ignore the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.5):

  i)	if the timer value indicates neither zero nor deactivated, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. The UE shall then start T3396 with the value provided in the Back-off timer value IE and not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until timer T3396 expires or timer T3396 is stopped. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. The UE shall start timer T3396 with the received value and not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, until timer T3396 expires or timer T3396 is stopped. The UE shall not stop timer T3396 upon a PLMN change or inter-system change;

  ii)	if the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE, until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. The timer T3396 remains deactivated upon a PLMN change or inter-system change; or

  iii)	if the timer value indicates zero, the UE:

    -	shall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and

    -	if the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.

If the Back-off timer value IE is not included, the UE may send a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST messages for the same APN.

The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.

If the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.

If the UE is switched off when the timer T3396 is running, and if the USIM in the UE remains the same when the UE is switched on, the UE behaves as follows:

  -	let t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;

  -	if prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5; and

  -	if prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5.


6.5.3.4.3	Handling of network rejection due to ESM cause other than ESM cause #26

If the ESM cause value is different from #26 "insufficient resources" and #65 "maximum number of EPS bearers reached", and the Back-off timer value IE is included, the UE shall behave as follows depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.6):

  -	if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the bearer resource allocation procedure and PLMN and APN combination and not send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN until the back-off timer expires, the UE is switched off or the USIM is removed;

  -	if the timer value indicates that this timer is deactivated, the UE shall not send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN until the UE is switched off or the USIM is removed; and

  -	if the timer value indicates zero, the UE may send another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN.

If the Back-off timer value IE is not included, then the UE shall ignore the Re-attempt Indicator IE provided by the network, if any.

  1)	Additionally, if the ESM cause value is #32 "service option not supported", or #33 "requested service option not subscribed", the UE shall proceed as follows:

    -	if the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list, the UE shall behave as described above in the present subclause, using the configured SM_RetryWaitTime value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, as back-off timer value; and

    -	otherwise, if the UE is not registered in its HPLMN or a PLMN that is within the EHPLMN list or the SM_RetryWaitTime value is not configured, the UE shall behave as described above in the present subclause, using the default value of 12 minutes for the back-off timer.

  2)	For ESM cause values different from #32 "service option not supported", or #33 "requested service option not subscribed", the UE behaviour regarding the start of a back-off timer is unspecified.

The UE shall not stop any back-off timer upon a PLMN change or inter-system change. If the network indicates that a back-off timer for the bearer resource allocation procedure and PLMN and APN combination is deactivated, then it remains deactivated upon a PLMN change or inter-system change.

  NOTE 1:	This means the back-off timer can still be running or be deactivated for the given ESM procedure and PLMN and APN combination when the UE returns to the PLMN or when it performs inter-system change back from A/Gb or Iu mode to S1 mode. Thus the UE can still be prevented from sending another BEARER RESOURCE ALLOCATION REQUEST message in the PLMN for the same APN.

If the back-off timer is started upon receipt of BEARER RESOURCE ALLOCATION REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, the UE behaves as follows:

  1)	after a PLMN change the UE may send a BEARER RESOURCE ALLOCATION REQUEST message for the same APN in the new PLMN, if the back-off timer is not running and is not deactivated for the bearer resource allocation procedure and the combination of new PLMN and APN;

    	Furthermore as an implementation option, for the ESM cause values #32 "service option not supported" or #33 "requested service option not subscribed", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another BEARER RESOURCE ALLOCATION REQUEST message for the same APN that was sent by the UE, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs.

  2)	if the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode is allowed, or the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, then:

    -	if the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list, the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, to determine whether the UE may attempt a secondary PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode; and

    -	if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, or if the NAS configuration MO as specified in 3GPP TS 24.368 [15A] is not available and the value for inter-system change is not configured in the USIM file NASCONFIG, then the UE behaviour regarding a secondary PDP context activation procedure for the same PLMN and APN combination in A/Gb or Iu mode is unspecified; and

  3)	if the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then depending on the timer value received in the Back-off timer value IE, for each combination of a PLMN from the equivalent PLMN list and the APN the UE shall start a back-off timer for the bearer resource allocation procedure with the value provided by the network, or deactivate the respective back-off timer as follows:

    -	If the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode is allowed, the UE shall start or deactivate the back-off timer for S1 mode only; and

    -	otherwise the UE shall start or deactivate the back-off timer for A/Gb, Iu, and S1 mode.

If the back-off timer for a PLMN and APN combination was started or deactivated in A/Gb or Iu mode upon receipt of an ACTIVATE SECONDARY PDP CONTEXT REJECT message (see 3GPP TS 24.008 [13]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any BEARER RESOURCE ALLOCATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed.

  NOTE 2:	The back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.

  NOTE 3:	Reference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation. This back-off timer is stopped when the UE is switched off or the USIM is removed.

If the ESM cause value is #65 "maximum number of EPS bearers reached", the UE shall determine the PLMN's maximum number of EPS bearer contexts in S1 mode (see subclause 6.5.0) as the number of active EPS bearer contexts it has. The UE shall ignore the Back-off timer value IE and Re-attempt indicator IE provided by the network, if any.

  NOTE 5:	In some situations, when attempting to establish multiple EPS bearer contexts, the number of active EPS bearer contexts in the UE when cause #65 is received is not equal to the maximum number of EPS bearer contexts reached in the network.

The PLMN's maximum number of EPS bearer contexts in S1 mode applies to the PLMN in which the ESM cause #65 "maximum number of EPS bearers reached" is received. When the UE is switched off or when the USIM is removed, the UE shall clear all previous determinations representing any PLMN's maximum number of EPS bearer contexts in S1 mode. Upon successful registration with a new PLMN, the UE may clear previous determinations representing any PLMN's maximum number of EPS bearer contexts in S1 mode.

The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.


6.5.3.4A	Handling the maximum number of active EPS bearer contexts

If the UE requests allocation of additional bearer resources, and the network has reached its maximum number of active EPS bearer contexts, then the network can:

  -	reject the request if the network decides that it is necessary to allocate a dedicated EPS bearer context; or

  -	accept the request by sending a MODIFY EPS BEARER CONTEXT REQUEST message.

  NOTE:	An example of where the network will reject the request for allocation of additional bearer resources is when the request includes a GBR requirement while all existing bearers are non-GBR bearers, and the maximum number of active EPS bearer contexts has been reached at the network.

If the maximum number of active EPS bearer contexts is reached at the UE (see subclause 6.5.0) and the UE de-activates an active EPS bearer context prior to sending the request for additional bearer resources, then choosing which EPS bearer context to de-activate is a implementation specific, however the UE shall not deactivate a default EPS bearer context for emergency.


6.5.3.5	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	Expiry of timer T3480:

    	On the first expiry of the timer T3480, the UE shall resend the BEARER RESOURCE ALLOCATION REQUEST and shall reset and restart timer T3480. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3480, the UE shall abort the procedure, release the PTI allocated for this activation and enter the state PROCEDURE TRANSACTION INACTIVE.

  b)	Unknown EPS bearer context

    	Upon receipt of the BEARER RESOURCE ALLOCATION REJECT message including ESM cause #43 "invalid EPS bearer identity", the UE shall deactivate the existing default EPS bearer context locally without peer-to-peer signalling between the UE and the MME.

  c)	Collision of a UE requested bearer resource allocation procedure and an EPS bearer context deactivation procedure.

    	When the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message for the default EPS bearer context related to the UE requested bearer resource allocation procedure, the UE shall abort the UE requested bearer resource allocation procedure and proceed with the EPS bearer context deactivation procedure.


6.5.3.6	Abnormal cases on the network side

The following abnormal case can be identified:

  a)	No PDN connection with the linked EPS bearer identity activated:

    	If the linked EPS bearer identity included in the BEARER RESOURCE ALLOCATION REQUEST message does not belong to the default EPS bearer context of an established PDN connection, the MME shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #43 "invalid EPS bearer identity".

  b)	BEARER RESOURCE ALLOCATION REQUEST message received for a PDN connection established for emergency bearer services:

    	The MME shall reply with a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #31 "request rejected, unspecified".


6.5.4	UE requested bearer resource modification procedure


6.5.4.1	General

The purpose of the UE requested bearer resource modification procedure is for a UE to request a modification, or release of bearer resources for a traffic flow aggregate, or modification of a traffic flow aggregate by replacing packet filters or adding packet filters, or re-negotiate header compression configuration associated to an EPS bearer context, or to indicate a change of 3GPP PS data off UE status for a PDN connection. When requesting a modification of bearer resources for a traffic flow aggregate or a modification of a traffic flow aggregate, the UE can modify the existing GBR. If accepted by the network, this procedure invokes a dedicated EPS bearer context activation procedure (see subclause 6.4.2), an EPS bearer context modification procedure (see subclause 6.4.3), or an EPS bearer context deactivation procedure (see subclause 6.4.4).

If there is a PDN connection for emergency bearer services established, the UE shall not request a modification of bearer resources for this PDN connection.

When the UE requested bearer resource modification procedure is used to indicate a change of 3GPP PS data off UE status for a PDN connection (see subclause 6.3.10), the UE shall initiate the UE requested bearer resource modification procedure even if the timer T3396 or the back-off timer is running or is deactivated.


6.5.4.2	UE requested bearer resource modification procedure initiation

In order to request the modification of bearer resources for one traffic flow aggregate, the UE shall send a BEARER RESOURCE MODIFICATION REQUEST message to the MME, start timer T3481 and enter the state PROCEDURE TRANSACTION PENDING (see example in figure 6.5.4.2.1).

The UE shall include the EPS bearer identity of the EPS bearer associated with the traffic flow aggregate in the EPS bearer identity for packet filter IE.

To request a change of the GBR without changing the packet filter(s), the UE shall set the TFT operation code in the Traffic flow aggregate IE to "no TFT operation" and include the packet filter identifier(s) to which the change of the GBR applies in the Packet filter identifier parameter in the parameters list. The UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE.

To request a modification of a traffic flow aggregate, the UE shall set the TFT operation code in the Traffic flow aggregate IE to "Replace packet filters in existing TFT" or "Add packet filters to existing TFT". If the TFT operation code is set to "Add packet filters to existing TFT", the UE shall include in the parameter list one existing packet filter identifier to which the newly added packet filter(s) is linked. If the EPS bearer is a GBR bearer and the UE also wishes to request a change of GBR, the UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE.

To request a release of bearer resources, the UE shall set the TFT operation code in the Traffic flow aggregate IE to "Delete packet filters from existing TFT". If the EPS bearer is a GBR bearer and the UE does not request the release of all bearer resources, the UE shall indicate the new GBR requested for the EPS bearer context in the Required traffic flow QoS IE.

To request re-negotiation of header compression configuration associated to an EPS bearer context, the UE shall include the Header compression configuration IE in the BEARER RESOURCE MODIFICATION REQUEST message if the network indicated "Control plane CIoT EPS optimization supported" and "Header compression for control plane CIoT EPS optimization supported" in the EPS network feature support IE.

To indicate a change of 3GPP PS data off UE status associated to a PDN connection, the UE shall include the protocol configuration options IE in the BEARER RESOURCE MODIFICATION REQUEST message and set the 3GPP PS data off UE status only if the network included the 3GPP PS data off support indication in the protocol configuration options IE in the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message when the PDN connection was established. The UE behaves as described in subclause 6.3.10.

If the UE requests the modification of a traffic flow aggregate, which is assigned to a dedicated EPS bearer context, it shall ensure that at least one packet filter applicable for the uplink direction remains among the packet filters created on request from the UE in that TFT, or no own packet filters.

  NOTE:	If the UE requests the release of all bearer resources of a GBR bearer and includes a Required traffic flow QoS IE in the BEARER RESOURCE MODIFICATION REQUEST message, the network ignores the Required traffic flow QoS IE.

If the UE includes the Required traffic flow QoS IE, the UE shall set the QCI to the current QCI value of the EPS bearer context.

If the UE requests the release of bearer resources, the ESM cause value typically indicates one of the following:

  #36:	regular deactivation.

[pic]

Figure 6.5.4.2.1: UE requested bearer resource modification procedure

For the NBIFOM procedures as defined in 3GPP TS 24.161 [36], the UE may send a BEARER RESOURCE MODIFICATION REQUEST message to the MME.

It is possible that the traffic flow aggregate IE is not needed in the following procedures:

  -	re-negotiation of header compression configuration associated to an EPS bearer context;

  -	indicating a change of 3GPP PS data off UE status associated to a PDN connection; or

  -	NBIFOM procedures.

If the traffic flow aggregate IE is not needed, the UE shall set:

  -	the length indicator of the Traffic flow aggregate IE to the value 1;

  -	the TFT operation code to "000";

  -	the E bit to zero; and

  -	the number of packet filters to zero.


6.5.4.3	UE requested bearer resource modification procedure accepted by the network

Upon receipt of the BEARER RESOURCE MODIFICATION REQUEST message, the MME checks whether the resources requested by the UE can be established, modified or released by verifying the EPS bearer identity given in the EPS bearer identity for packet filter IE.

If the bearer resource modification requested is accepted by the network, the MME shall initiate either a dedicated EPS bearer context activation procedure, an EPS bearer context modification procedure or an EPS bearer context deactivation procedure.

If the request to re-negotiate header compression configuration associated to an EPS bearer context is accepted by the network, the MME shall initiate an EPS bearer context modification procedure.

If the bearer resource modification requests a release of bearer resources that results in the TFT of the EPS bearer context containing only packet filters applicable to the uplink direction, the network may initiate the EPS bearer context deactivation procedure.

Upon receipt of an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST, MODIFY EPS BEARER CONTEXT REQUEST or DEACTIVATE EPS BEARER CONTEXT REQUEST message with a PTI which matches the value used for the BEARER RESOURCE MODIFICATION REQUEST message, the UE shall stop timer T3481 and enter the state PROCEDURE TRANSACTION INACTIVE. The UE should ensure that the procedure transaction identity (PTI) assigned to this procedure is not released immediately. The way to achieve this is implementation dependent. While the PTI value is not released, the UE regards any received ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST or DEACTIVATE EPS BEARER CONTEXT REQUEST message with the same PTI value as a network retransmission (see subclause 7.3.1).

  i)	If the ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message is received, the UE shall verify that the EPS bearer identity given in the EPS bearer identity IE is not already used by any EPS bearer context. The UE shall then proceed as described in subclause 6.4.2.3 or subclause 6.4.2.4.

  ii)	If the MODIFY EPS BEARER CONTEXT REQUEST message is received, the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is any of the active EPS bearer contexts. The UE shall then proceed as described in subclause 6.4.3.3 or subclause 6.4.3.4.

  iii)	If the DEACTIVATE EPS BEARER CONTEXT REQUEST message is received, the UE verifies that the EPS bearer identity given in the EPS bearer identity IE is one of the active EPS bearer contexts. The UE shall then proceed as described in subclause 6.4.4.3.

In case i, after successful completion of the dedicated EPS bearer context activation procedure, the network may initiate an EPS bearer context modification procedure to delete the packet filters which have packet filter identifiers indicated by the UE in the Traffic flow aggregate IE in the BEARER RESOURCE MODIFICATION REQUEST message and for which the network created new packet filters during the dedicated EPS bearer context activation procedure. In this case the MME shall set the procedure transaction identity value in the MODIFY EPS BEARER CONTEXT REQUEST message to "no procedure transaction identity assigned".


6.5.4.4	UE requested bearer resource modification procedure not accepted by the network


6.5.4.4.1	General

If the bearer resource modification requested cannot be accepted by the network, the MME shall send a BEARER RESOURCE MODIFICATION REJECT message to the UE. The message shall contain the PTI and an ESM cause value indicating the reason for rejecting the UE requested bearer resource modification.

The ESM cause value typically indicates one of the following:

  #26:	insufficient resources;

  #30:	request rejected by Serving GW or PDN GW;

  #31:	request rejected, unspecified;

  #32:	service option not supported;

  #33:	requested service option not subscribed;

  #34:	service option temporarily out of order;

  #35:	PTI already in use;

  #37:	EPS QoS not accepted;

  #41:	semantic error in the TFT operation;

  #42:	syntactical error in the TFT operation;

  #43:	invalid EPS bearer identity;

  #44:	semantic error(s) in packet filter(s);

  #45:	syntactical error(s) in packet filter(s);

  #56:	collision with network initiated request;

  #59:	unsupported QCI value;

  #60:	bearer handling not supported; or

  #95 – 111:	protocol errors.

If the bearer resource modification requested is for an established LIPA PDN connection or SIPTO at the local network PDN connection, then the network shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #60 "bearer handling not supported".

If the requested new TFT is not available, then the BEARER RESOURCE MODIFICATION REJECT message shall be sent.

The TFT in the request message is checked by the network for different types of TFT IE errors as follows:

  a)	Semantic errors in TFT operations:

    1)	When the TFT operation is an operation other than "Replace packet filters in existing TFT", "Add packet filters to existing TFT", "Delete packet filters from existing TFT" or "No TFT operation".

    2)	When the TFT operation is "Replace packet filters in existing TFT", "Add packet filters to existing TFT" or "Delete packet filters from existing TFT" and there is no TFT for the default EPS bearer context.

    3)	TFT operation = "Delete packet filters from existing TFT" when it would render the TFT empty.

    	In case 1 the network shall reject the modification request with ESM cause #41 "semantic error in the TFT operation".

    	In case 2, if the TFT operation is "Delete packet filters from existing TFT", the network shall further process the new request and, if no error according to items b, c, and d was detected, shall perform an EPS bearer context modification procedure including the value of EPS bearer identity for packet filter IE in the EPS bearer identity IE and a TFT IE with TFT operation = "Delete existing TFT" in the MODIFY EPS BEARER CONTEXT REQUEST message.

    	In case 2, if the TFT operation is "Replace packet filters in existing TFT" or "Add packet filters to existing TFT", the network shall process the new request as a request with TFT operation = "Create a new TFT".

    	In case 3, if the packet filters belong to a dedicated EPS bearer context, the network shall process the new deletion request and, if no error according to items b, c, and d was detected, delete the existing TFT. After successful deletion of the TFT, the network shall perform an EPS bearer context deactivation request procedure to deactivate the dedicated EPS bearer context between the UE and the network.

    	In case 3, if the packet filters belong to the default EPS bearer context, the network shall process the new deletion request and if no error according to items b, c, and d was detected then perform an EPS bearer context modification procedure to remove the existing TFT of the default EPS bearer context, this corresponds to using match-all packet filter for the default EPS bearer context.

  b)	Syntactical errors in TFT operations:

    1)	When the TFT operation = "Replace packet filters in existing TFT", "Add packet filters to existing TFT" or "Delete packet filters from existing TFT", and the packet filter list in the TFT IE is empty.

    2)	TFT operation = "No TFT operation" with a non-empty packet filter list in the TFT IE.

    3)	TFT operation = "Replace packet filters in existing TFT" when the packet filter to be replaced does not exist in the original TFT.

    4)	TFT operation = "Delete packet filters from existing TFT" when the packet filter to be deleted does not exist in the original TFT.

    5)	TFT operation = "Delete packet filters from existing TFT" with a packet filter list also including packet filters in addition to the packet filter identifiers.

    6)	When there are other types of syntactical errors in the coding of the TFT IE, such as a mismatch between the number of packet filters subfield, and the number of packet filters in the packet filter list.

    7)	TFT operation = "No TFT operation" with an empty parameters list.

    	In case 3 the network shall not diagnose an error, shall further process the replace request and, if no error according to items c and d was detected, shall perform an EPS bearer context modification procedure using TFT operation = "Add packet filters to existing TFT" to include the packet filters received to the existing TFT.

    	In case 4 the network shall not diagnose an error, shall further process the deletion request and, if no error according to items c and d was detected, shall perform an EPS bearer context modification procedure including the value of EPS bearer identity for packet filter IE in the EPS bearer identity IE and a TFT IE with TFT operation = "Delete packet filters from existing TFT" and the received packet filter identifier(s) in the MODIFY EPS BEARER CONTEXT REQUEST message.

    	Otherwise the network shall reject the modification request with ESM cause #42 "syntactical error in the TFT operation".

  c)	Semantic errors in packet filters:

    1)	When a packet filter consists of conflicting packet filter components which would render the packet filter ineffective, i.e. no IP packet will ever fit this packet filter. How the network determines a semantic error in a packet filter is outside the scope of the present document.

    2)	When the resulting TFT, which is assigned to a dedicated EPS bearer context, does not contain any packet filter applicable for the uplink direction.

    	The network shall reject the modification request with ESM cause #44 "semantic errors in packet filter(s)".

  d)	Syntactical errors in packet filters:

    1)	When the TFT operation = "Replace packet filters in existing TFT" and two or more packet filters in all TFTs associated with the PDN connection would have identical packet filter precedence values.

    2)	When there are other types of syntactical errors in the coding of packet filters, such as the use of a reserved value for a packet filter component identifier.

    	In case 1, if the old packet filters do not belong to the default EPS bearer context, the network shall not diagnose an error, shall further process the new request and, if it was processed successfully, shall delete the old packet filters which have identical filter precedence values. Furthermore, the network shall perform an EPS bearer context deactivation procedure to deactivate the dedicated EPS bearer context(s) for which it has deleted the packet filters.

    	In case 1, if one or more old packet filters belong to the default EPS bearer context, the network shall release the relevant PDN connection using the EPS bearer context deactivation procedure. If the relevant PDN connection is the last one and EMM-REGISTERED without PDN connection is not supported by the UE or the MME, the network shall detach the UE using detach type "re-attach required".

    	Otherwise the network shall reject the modification request with ESM cause #45 "syntactical errors in packet filter(s)".

The network may include a Back-off timer value IE in the BEARER RESOURCE MODIFICATION REJECT message.

The network shall not include the ESM cause value #26 "insufficient resources" in the BEARER RESOURCE MODIFICATION REJECT message due to APN based congestion control being active.

If the Back-off timer value IE is included and the ESM cause value is not #26 "insufficient resources", the network may include the Re-attempt indicator IE to indicate whether the UE is allowed to attempt a PDP context modification procedure in the PLMN for the same APN in A/Gb or Iu mode, and whether another attempt in A/Gb and Iu mode or in S1 mode is allowed in an equivalent PLMN.

Upon receipt of a BEARER RESOURCE MODIFICATION REJECT message, the UE shall stop the timer T3481, release the traffic flow aggregate description associated to the PTI value, and enter the state PROCEDURE TRANSACTION INACTIVE. If the ESM cause included in the BEARER RESOURCE MODIFICATION REJECT message is #43 "invalid EPS bearer identity", the UE locally deactivates the EPS bearer context(s) without peer-to-peer ESM signalling.


6.5.4.4.2	Handling of network rejection due to ESM cause #26

If the ESM cause value is #26 "insufficient resources" and the Back-off timer value IE is included, the UE shall ignore the Re-attempt indicator IE provided by the network, if any, and take different actions depending on the timer value received for timer T3396 in the Back-off timer value IE (if the UE is configured for dual priority, exceptions are specified in subclause 6.5.5; if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.5):

  i)	if the timer value indicates neither zero nor deactivated, the UE shall stop timer T3396 associated with the corresponding APN, if it is running. The UE shall then start T3396 with the value provided in the Back-off timer value IE and not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until timer T3396 expires or timer T3396 is stopped. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop the timer T3396 associated with no APN if it is running. The UE shall start timer T3396 with the received value and not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, until timer T3396 expires or timer T3396 is stopped. The UE shall not stop timer T3396 upon a PLMN change or inter-system change;

  ii)	if the timer value indicates that this timer is deactivated, the UE shall not send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for the same APN until the UE is switched off or the USIM is removed or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for the same APN from the network or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context for the same APN from the network. If the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall not send another PDN CONNECTIVITY REQUEST message without an APN and with request type different from "emergency" and from "handover of emergency bearer services", or another BEARER RESOURCE MODIFICATION REQUEST with exception of those identified in subclause 6.5.4.1, or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without APN provided by the UE, until the UE is switched off or the USIM is removed, or the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST or MODIFY EPS BEARER CONTEXT REQUEST message for a non-emergency PDN connection established without an APN provided by the UE, or a DEACTIVATE EPS BEARER CONTEXT REQUEST message including ESM cause #39 "reactivation requested" for a default EPS bearer context of a non-emergency PDN connection established without an APN provided by the UE. The timer T3396 remains deactivated upon a PLMN change or inter-system change; or

  iii)	if the timer value indicates zero, the UE:

    -	shall stop timer T3396 associated with the corresponding APN, if running, and may send another PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for the same APN; and

    -	if the UE did not provide an APN for the establishment of the PDN connection and the request type was different from "emergency" and from "handover of emergency bearer services", the UE shall stop timer T3396 associated with no APN, if running, and may send another PDN CONNECTIVITY REQUEST message without an APN, or another BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message for a non-emergency PDN connection established without an APN provided by the UE.

If the Back-off timer value IE is not included, the UE may send a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST messages for the same APN.

The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.

If the timer T3396 is running when the UE enters state EMM-DEREGISTERED, the UE remains switched on, and the USIM in the UE remains the same, then timer T3396 is kept running until it expires or it is stopped.

If the UE is switched off when the timer T3396 is running, and if the USIM in the UE remains the same when the UE is switched on, the UE behaves as follows:

  -	let t1 be the time remaining for T3396 timeout at switch off and let t be the time elapsed between switch off and switch on. If t1 is greater than t, then the timer shall be restarted with the value t1 – t. If t1 is equal to or less than t, then the timer need not be restarted. If the UE is not capable of determining t, then the UE shall restart the timer with the value t1;

  -	if prior to switch off, timer T3396 was running for a specific APN, because a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5; and

  -	if prior to switch off timer T3396 was running because a PDN CONNECTIVITY REQUEST without APN sent together with an ATTACH REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396, and if timer T3396 is restarted at switch on, then the UE configured for dual priority shall handle session management requests as indicated in subclause 6.5.5.


6.5.4.4.3	Handling of network rejection due to ESM cause other than ESM cause #26

If the ESM cause value is not #26 "insufficient resources", and the Back-off timer value IE is included, the UE shall behave as follows depending on the timer value received in the Back-off timer value IE (if the UE is a UE configured to use AC11 – 15 in selected PLMN, exceptions are specified in subclause 6.3.6):

  -	if the timer value indicates neither zero nor deactivated, the UE shall start the back-off timer with the value provided in the Back-off timer value IE for the bearer resource modification procedure and PLMN and APN combination and not send another BEARER RESOURCE MODIFICATION REQUEST message with exception of those identified in subclause 6.5.4.1, in the PLMN for the same APN until the back-off timer expires, the UE is switched off or the USIM is removed;

  -	if the timer value indicates that this timer is deactivated, the UE shall not send another BEARER RESOURCE MODIFICATION REQUEST message with exception of those identified in subclause 6.5.4.1, in the PLMN for the same APN until the UE is switched off or the USIM is removed; and

  -	if the timer value indicates zero, the UE may send another BEARER RESOURCE MODIFICATION REQUEST message in the PLMN for the same APN.

If the Back-off timer value IE is not included, then the UE shall ignore the Re-attempt indicator IE provided by the network, if any.

  1)	Additionally, if the ESM cause value is #32 "service option not supported", or #33 "requested service option not subscribed", the UE shall proceed as follows:

    -	if the UE is registered in the HPLMN or in a PLMN that is within the EHPLMN list, the UE shall behave as described above in the present subclause, using the configured SM_RetryWaitTime value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, as back-off timer value; and

    -	otherwise, if the UE is not registered in its HPLMN or a PLMN that is within the EHPLMN list or the SM_RetryWaitTime value is not configured, the UE shall behave as described above in the present subclause, using the default value of 12 minutes for the back-off timer.

  2)	For ESM cause values different from #32 "service option not supported", or #33 "requested service option not subscribed", the UE behaviour regarding the start of a back-off timer is unspecified.

The UE shall not stop any back-off timer upon a PLMN change or inter-system change. If the network indicates that a back-off timer for the bearer resource allocation procedure and PLMN and APN combination is deactivated, then it remains deactivated upon a PLMN change or inter-system change.

  NOTE 1:	This means the back-off timer can still be running or be deactivated for the given ESM procedure and PLMN and APN combination when the UE returns to the PLMN or when it performs inter-system change back from A/Gb or Iu mode to S1 mode. Thus the UE can still be prevented from sending another BEARER RESOURCE MODIFICATION REQUEST message with exception of those identified in subclause 6.5.4.1, in the PLMN for the same APN.

If the back-off timer is started upon receipt of BEARER RESOURCE MODIFICATION REJECT (i.e. the timer value was provided by the network, a configured value is available or the default value is used as explained above) or the back-off timer is deactivated, the UE behaves as follows:

  1)	after a PLMN change the UE may send a BEARER RESOURCE MODIFICATION REQUEST message for the same APN in the new PLMN, if the back-off timer is not running and is not deactivated for the bearer resource modification procedure and the combination of new PLMN and APN;

    	Furthermore as an implementation option, for the ESM cause values #32 "service option not supported" or #33 "requested service option not subscribed", if the network does not include a Re-attempt indicator IE, the UE may decide not to automatically send another BEARER RESOURCE MODIFICATION REQUEST message for the same APN that was sent by the UE, if the UE is registered to a new PLMN which is in the list of equivalent PLMNs.

  2)	if the network does not include the Re-attempt indicator IE to indicate whether re-attempt in A/Gb or Iu mode is allowed, or the UE ignores the Re-attempt indicator IE, e.g. because the Back-off timer value IE is not included, then:

    -	if the UE is registered in its HPLMN or in a PLMN that is within the EHPLMN list, the UE shall apply the configured SM_RetryAtRATChange value as specified in 3GPP TS 24.368 [15A] or in USIM file NASCONFIG as specified in 3GPP TS 31.102 [17], if available, to determine whether the UE may attempt a PDP context modification procedure for the same PLMN and APN combination in A/Gb or Iu mode; and

    -	if the UE is not registered in its HPLMN or in a PLMN that is within the EHPLMN list, or if the NAS configuration MO as specified in 3GPP TS 24.368 [15A] is not available and the value for inter-system change is not configured in the USIM file NASCONFIG, then the UE behaviour regarding a PDP context modification procedure for the same PLMN and APN combination in A/Gb or Iu mode is unspecified; and

  3)	if the network includes the Re-attempt indicator IE indicating that re-attempt in an equivalent PLMN is not allowed, then depending on the timer value received in the Back-off timer value IE, for each combination of a PLMN from the equivalent PLMN list and the APN the UE shall start a back-off timer for the bearer resource modification procedure with the value provided by the network, or deactivate the respective back-off timer as follows:

    -	If the Re-attempt indicator IE additionally indicates that re-attempt in A/Gb or Iu mode is allowed, the UE shall start or deactivate the back-off timer for A/Gb and Iu mode only; and

    -	otherwise the UE shall start or deactivate the back-off timer for A/Gb, Iu, and S1 mode.

If the back-off timer for a PLMN and APN combination was started or deactivated upon receipt of an MODIFY PDP CONTEXT REJECT message (see 3GPP TS 24.008 [13]) and the network indicated that re-attempt in S1 mode is allowed, then this back-off timer does not prevent the UE from sending a BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode. If the network indicated that re-attempt in S1 mode is not allowed, the UE shall not send any BEARER RESOURCE MODIFICATION REQUEST message in this PLMN for the same APN after inter-system change to S1 mode until the timer expires, the UE is switched off or the USIM is removed.

  NOTE 2:	The back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.

  NOTE 3:	Reference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation. This back-off timer is stopped when the UE is switched off or the USIM is removed.

The further actions to be performed by the UE are implementation dependent as part of upper layers responsibility.


6.5.4.5	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	Expiry of timer T3481:

    	On the first expiry of the timer T3481, the UE shall resend the BEARER RESOURCE MODIFICATION REQUEST and shall reset and restart timer T3481. This retransmission is repeated four times, i.e. on the fifth expiry of timer T3481, the UE shall abort the procedure, release the PTI allocated for this activation and enter the state PROCEDURE TRANSACTION INACTIVE. In addition, if the UE had initiated resource release for all the traffic flows for the bearer, it shall deactivate the EPS bearer context locally without peer-to-peer signalling between the UE and the MME. In order to synchronize the EPS bearer context status with the MME, on indication of "back to E-UTRAN coverage" from the lower layers, the UE shall send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME.

  b)	Unknown EPS bearer context

    	Upon receipt of the BEARER RESOURCE MODIFICATION REJECT message including ESM cause #43 "invalid EPS bearer identity", the UE shall deactivate the existing EPS bearer context locally without peer-to-peer signalling between the UE and the MME.

  c)	Collision of a UE requested bearer resource modification procedure and an EPS bearer context deactivation procedure.

    	When the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message during the bearer resource modification procedure, and the EPS bearer identity indicated in the DEACTIVATE EPS BEARER CONTEXT REQUEST message is a EPS bearer context the UE indicated in the UE requested bearer resource modification procedure, then the UE shall abort the UE requested bearer resource modification procedure and proceed with the EPS bearer context deactivation procedure.

  d)	Rejection of a UE requested bearer resource modification procedure when the UE has initiated the procedure to release all traffic flows for the bearer

    	Upon receipt of a BEARER RESOURCE MODIFICATION REJECT message with ESM cause value #31 "request rejected, unspecified", if the UE had initiated resource release for all the traffic flows for the bearer, it shall deactivate the EPS bearer context locally without peer-to-peer signalling between the UE and the MME. In order to synchronize the EPS bearer context status with the MME, the UE may send a TRACKING AREA UPDATE REQUEST message that includes the EPS bearer context status IE to the MME.


6.5.4.6	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	Unknown EPS bearer context

    	If the EPS bearer identity provided in the EPS bearer identity for packet filter IE in the BEARER RESOURCE MODIFICATION REQUEST message indicates an EPS bearer identity value and this does not belong to any already activated EPS bearer context, the MME shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #43 "invalid EPS bearer identity".

  b)	BEARER RESOURCE MODIFICATION REQUEST message received for a PDN connection established for emergency bearer services:

    	The MME shall reply with a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #30 "request rejected by Serving GW or PDN GW".


6.5.5	Handling session management request for UE configured for dual priority

If timer T3396 is running for a specific APN due to one of the following reasons:

  -	a PDN CONNECTIVITY REQUEST, BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396 and ESM cause value #26 "insufficient resources";

  -	a DEACTIVATE EPS BEARER CONTEXT REQUEST message was received with a timer value for timer T3396 and ESM cause value #26 "insufficient resources" for a PDN connection established with low priority indicator set to "MS is configured for NAS signalling low priority", or

  -	because the UE received a DEACTIVATE EPS BEARER CONTEXT REQUEST message containing a timer value for timer T3396 and ESM cause value #26 "insufficient resources" for a PDN connection established with low priority indicator set to "MS is configured for NAS signalling low priority",

upon request of the upper layers the UE can:

  -	send a PDN CONNECTIVITY REQUEST message to the same APN, with low priority indicator set to "MS is not configured for NAS signalling low priority"; or,

  -	send a BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message, with low priority indicator set to "MS is not configured for NAS signalling low priority", for a PDN connection established with low priority indicator set to "MS is not configured for NAS signalling low priority" exists.

If timer T3396 is running, because any of the following messages containing the low priority indicator set to "MS is configured for NAS signalling low priority" was rejected with a timer value for timer T3396 and ESM cause value #26 "insufficient resources":

  -	a PDN CONNECTIVITY REQUEST without APN and with request type different from "emergency" and from "handover of emergency bearer services", sent together with an ATTACH REQUEST message;

  -	a stand-alone PDN CONNECTIVITY REQUEST message without APN and with request type different from "emergency" and from "handover of emergency bearer services"; or

  -	a BEARER RESOURCE MODIFICATION REQUEST or BEARER RESOURCE ALLOCATION REQUEST message sent for a non-emergency PDN connection established without APN provided by the UE,

or because the UE received a DEACTIVATE EPS BEARER CONTEXT REQUEST message containing a timer value for timer T3396 and ESM cause value #26 "insufficient resources" for a non-emergency PDN connection established without APN provided by the UE and established with low priority indicator set to "MS is configured for NAS signalling low priority", then upon request of the upper layers the UE can initiate a new attach procedure or stand-alone PDN CONNECTIVITY REQUEST procedure without APN and with request type different from "emergency" and from "handover of emergency bearer services", with low priority indicator set to "MS is not configured for NAS signalling low priority".

For requests with low priority indicator set to "MS is configured for NAS signalling low priority", the UE shall follow the procedures specified in subclause 6.5.1.4.


6.6	Miscellaneous procedures


6.6.1	Exchange of protocol configuration options


6.6.1.1	General

The UE and the PDN GW can exchange protocol configuration options via the dedicated ESM information request procedure or via other ESM procedures.

If supported by the network and UE end-to-end for a PDN connection, protocol configuration options shall be exchanged via the extended protocol configuration options IE. Otherwise the protocol configuration options IE is used.

  NOTE 1:	In this version of the protocol inter-system mobility to and from NB-S1 mode is supported. During inter-system-mobility from NB-S1 mode to WB-S1 mode the end-to-end support of the extended protocol configuration options IE can be lost, e.g. if the new MME does not support the extended protocol configuration options IE.

For the UE, the extended protocol configuration options is supported by the network and the UE end-to-end for a PDN connection if

  -	the UE is in NB-S1 mode;

  -	the PDN Type requested for the PDN connection is non-IP;

  -	the UE supports N1 mode and the network has included the extended protocol configuration options IE in at least one EPS session management message received by the UE for this PDN connection; or

  -	the network has indicated support of the extended protocol configuration options IE in the last ATTACH ACCEPT or TRACKING AREA UPDATING ACCEPT message and the network has included the extended protocol configuration options IE in at least one EPS session management message received by the UE for this PDN connection.

For the MME, the extended protocol configuration options is supported by the network and the UE end-to-end for a PDN connection if

  -	the UE is in NB-S1 mode;

  -	the PDN Type requested for the PDN connection is non-IP;

  -	the MME supports inter-system change with 5GS; or

  -	the UE has indicated support of the extended protocol configuration options IE in the last ATTACH REQUEST or TRACKING AREA UPDATING REQUEST message, and the MME has received the extended protocol configuration options IE in at least one message sent by the PDN GW towards the UE for this PDN connection (for details see 3GPP TS 29.274 [16D]).

  NOTE 2:	For the PDN GW, the extended protocol configuration options is supported by the network and the UE end-to-end for a PDN connection if the last support indication received from the MME or S-GW indicates that extended protocol configuration options is supported for this PDN connection (for details see 3GPP TS 29.274 [16D]).


6.6.1.2	ESM information request procedure


6.6.1.2.1	General

The ESM information request procedure is used by the network to retrieve ESM information, i.e. protocol configuration options, APN, or both from the UE during the attach procedure if the UE indicated in the PDN CONNECTIVITY REQUEST message that it has ESM information that needs to be sent security protected. The purpose of this procedure is to provide privacy for the ESM information if ciphering is enabled in the network.


6.6.1.2.2	ESM information request initiated by the network

The network intiates the ESM information request procedure by sending a ESM INFORMATION REQUEST message to the UE, starting timer T3489 and entering the state PROCEDURE TRANSACTION PENDING (see example in figure 6.6.1.2.2.1). This message shall be sent only after the security context has been setup, and if the ESM information transfer flag has been set in the PDN CONNECTIVITY REQUEST message. The MME shall set the EPS bearer identity of the ESM INFORMATION REQUEST message to the value "no EPS bearer identity assigned" and include the PTI from the associated PDN CONNECTIVITY REQUEST message.

[pic]

Figure 6.6.1.2.2.1: ESM information request procedure


6.6.1.2.3	ESM information request completion by the UE

Upon receipt of the ESM INFORMATION REQUEST message, the UE shall send an ESM INFORMATION RESPONSE message to the network. The UE shall include all the protocol configuration options that need to be transferred security protected, and APN if required, to the network in the ESM INFORMATION RESPONSE message. The UE shall set the EPS bearer identity of the ESM INFORMATION RESPONSE message to the value "no EPS bearer identity assigned" and include the PTI from the ESM INFORMATION REQUEST message.


6.6.1.2.4	ESM information request completion by the network

Upon receipt of the ESM INFORMATION RESPONSE message, the network shall stop timer T3489 and enter the state PROCEDURE TRANSACTION INACTIVE. A protocol configuration options IE or extended protocol configuration options IE included in the ESM INFORMATION RESPONSE message replaces any protocol configuration options IE or extended protocol configuration options IE that the network previously may have received during the attach procedure execution.


6.6.1.2.5	Abnormal cases in the UE

Apart from the case described in subclause 6.3.3, no abnormal cases have been identified.


6.6.1.2.6	Abnormal cases on the network side

The following abnormal cases can be identified:

  a)	Expiry of timer T3489:

    	On the first expiry of the timer T3489, the MME shall resend the ESM INFORMATION REQUEST message and shall reset and restart timer T3489. This retransmission is repeated two times, i.e. on the third expiry of timer T3489, the MME shall abort the procedure, release any resources for this procedure and reject the associated PDN connectivity procedure including the ESM cause #53 "ESM information not received", in the PDN CONNECTIVITY REJECT message.


6.6.1.3	Exchange of protocol configuration options in other messages

The UE may include a protocol configuration options IE or extended protocol configuration options IE on EPS bearer context activation, EPS bearer context deactivation, EPS bearer context modification, PDN connectivity request, PDN disconnect request, bearer resource allocation request and bearer resource modification request if the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the PDN GW or the SCEF. In particular, the UE may use this procedure on EPS bearer context activation to perform the MSISDN notification procedure as specified in 3GPP TS 24.008 [13], subclause 6.4.

The PDN GW or the SCEF may include a protocol configuration options IE or extended protocol configuration options IE on EPS bearer context activation, EPS bearer context deactivation, EPS bearer context modification, PDN connectivity reject, PDN disconnect reject, bearer resource allocation reject and bearer resource modification reject if the PDN GW or the SCEF wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE. In particular, the PDN GW may use this procedure on EPS bearer context activation to perform the MSISDN notification procedure as specified in 3GPP TS 24.008 [13], subclause 6.4.


6.6.2	Notification procedure


6.6.2.1	General

The network can use the notification procedure to inform the UE about events which are relevant for the upper layer which is using an EPS bearer context or has requested a procedure transaction.

If the UE has indicated that it supports the notification procedure, the network may initiate the procedure at any time while a PDN connection exists or a procedure transaction is ongoing.


6.6.2.2	Notification procedure initiation by the network

The network initiates the notification procedure by sending a NOTIFICATION message to the UE (see example in figure 6.6.2.2.1).

[pic]

Figure 6.6.2.2.1: Notification procedure


6.6.2.3	Notification procedure in the UE

When the UE receives a NOTIFICATION message, the ESM protocol entity in the UE shall provide the notification indicator to the upper layer.

The notification indicator can have the following value:

  #1:	SRVCC handover cancelled, IMS session re-establishment required.


6.6.2.4	Abnormal cases on the network side

The following abnormal case can be identified:

  a)	Lower layer indication of non-delivered NAS PDU due to handover

    	If the NOTIFICATION message could not be delivered due to an intra MME handover, then upon successful completion of the intra MME handover the MME shall retransmit the NOTIFICATION message. If a failure of the handover procedure is reported by the lower layer and the S1 signalling connection exists, the MME shall retransmit the NOTIFICATION message.


6.6.3	Remote UE Report procedure


6.6.3.1	General

The purpose of the Remote UE Report procedure is for a UE acting as ProSe UE-to-network relay to notify the network that a remote UE is connected to the ProSe UE-to-network relay or disconnected from the ProSe UE-to-network relay as specified in 3GPP TS 23.303 [31].


6.6.3.2	Remote UE Report initiated by the UE

The UE initiates the Remote UE Report procedure by sending a REMOTE UE REPORT message to the network, starting timer T3493 and entering the state PROCEDURE TRANSACTION PENDING (see example in figure 6.6.3.2.1). The UE shall include information of newly connected or disconnected remote UEs to the network in the REMOTE UE REPORT message. If any encrypted IMSI remote UE identity is included in the REMOTE UE REPORT message, the UE shall include the corresponding ProSe Key Management Function address. The UE shall include the default EPS bearer identity of the PDN connection associated with the remote UE connected to the ProSe UE-to-network relay or disconnected from the ProSe UE-to-network relay.

  NOTE:	Encrypted IMSI remote UE identities corresponding to different ProSe Key Management Function addresses need to be reported using separate REMOTE UE REPORT messages.



[pic]

Figure 6.6.3.2.1: Remote UE Report procedure


6.6.3.3	Remote UE Report completion by the network

Upon receipt of the REMOTE UE REPORT message, the MME shall send an REMOTE UE REPORT RESPONSE message to the UE. The MME shall include the PTI from the REMOTE UE REPORT message.


6.6.3.4	Remote UE Report completion by the UE

Upon receipt of the REMOTE UE REPORT RESPONSE message, the UE shall stop timer T3493 and enter the state PROCEDURE TRANSACTION INACTIVE.


6.6.3.5	Abnormal cases in the UE

The following abnormal cases can be identified:

  a)	Expiry of timer T3493:

    	On the first expiry of the timer T3493, the UE shall resend the REMOTE UE REPORT message and shall reset and restart timer T3493. This retransmission is repeated two times, i.e. on the third expiry of timer T3493, the UE shall abort the procedure and release any resources for this procedure.

  NOTE:	After the abortion of the Remote UE Report procedure, the Remote UE Report procedure for the remote UE(s) can be restarted and how to restart the procedure is left to UE implementation.


6.6.3.6	Abnormal cases on the network side

No abnormal cases have been identified.


6.6.4	Transport of user data via the control plane procedure


6.6.4.1	General

The purpose of the transport of user data via the control plane procedure is to transfer user data via the control plane in an encapsulated form between the UE and the MME.

The procedure may be initiated by the UE or the network when the UE is in EMM-CONNECTED mode.

The procedure may also be initiated by the UE in EMM-IDLE mode by including the ESM DATA TRANSPORT message in a CONTROL PLANE SERVICE REQUEST message.


6.6.4.2	UE initiated transport of user data via the control plane

Upon receipt of a request to transfer user data via the control plane, if the UE is in EMM-CONNECTED mode, the UE initiates the procedure by sending the ESM DATA TRANSPORT message including the user data to be sent in the User data container IE (see example in figure 6.6.4.2.1). The length of the value part of the User data container IE should not exceed the link MTU size for the respective type of user data (IPv4, IPv6 or Non-IP).

  NOTE:	The recommended maximum size for link MTU is 1358 octets to prevent fragmentation in the backbone network (see 3GPP TS 23.060 [74]). Depending on the network configuration, setting link MTU size to a value larger than 1358 octets could lead to inefficient core network implementation due to fragmentation.

If the UE is in EMM-IDLE mode, the UE initiates the procedure by sending the ESM DATA TRANSPORT message included in a CONTROL PLANE SERVICE REQUEST message.

Based on information provided by the upper layers, the UE may include a Release assistance indication IE in the ESM DATA TRANSPORT message to inform the network that

  1)	subsequent to the current uplink data transmission no further uplink or downlink data transmission (e.g. an acknowledgement or response) is expected; i.e. the upper layers indicated that data exchanges have completed with the current UL data transfer; or

  2)	subsequent to the current uplink data transmission only a single downlink data transmission and no further uplink data transmission is expected; i.e. the upper layers indicated that data exchanges will have completed with the next downlink data transmission.

When receiving the ESM DATA TRANSPORT message, the MME shall identify the PDN connection to the SCEF or to the PDN GW, based on the EPS bearer identity included in message, and forward the contents of the User data container IE accordingly. If the ESM DATA TRANSPORT message includes a Release assistance indication IE, then ESM layer indicates to the EMM layer to initiate release of the NAS signalling connection,

  1)	if the release assistance indication indicates that no further uplink or downlink data transmission subsequent to the uplink data transmission is expected; or,

  2)	upon subsequent delivery of the next received downlink data transmission to the UE if the release assistance indication indicates that only a single downlink data transmission and no further uplink data transmission subsequent to the uplink data transmission is expected.




[pic]

Figure 6.6.4.2.1: UE initiated transport of user data via the control plane procedure


6.6.4.3	Network initiated transport of user data via the control plane

The network initiates the procedure by sending the ESM DATA TRANSPORT message (see example in figure 6.6.4.3.1). Upon receiving the ESM DATA TRANSPORT message, the UE shall:

  -	forward the contents of the User data container IE to the upper layers.

[pic]

Figure 6.6.4.3.1: Network initiated transport of user data via the control plane procedure


6.6.4.4	Abnormal cases in the UE

The following abnormal case can be identified:

  a)	T3396 is running

    	The UE shall not send an ESM DATA TRANSPORT message unless

    -	the UE is a UE configured to use AC11 – 15 in selected PLMN; or

    -	the ESM DATA TRANSPORT message is used for an exception data reporting and the UE is allowed to use exception data reporting (see the ExceptionDataReportingAllowed leaf of the NAS configuration MO in 3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]).

    	The ESM DATA TRANSPORT message can be sent, if still necessary, when timer T3396 expires or is stopped.

  b)	Transmission failure of the ESM DATA TRANSPORT message indication from lower layers

    	If lower layers indicate a TAI change and the current TAI is not in the TAI list, the transport of user data via the control plane procedure shall be aborted and re-initiated after successfully performing a tracking area updating procedure if the control plane CIoT EPS optimisation is still used and the user data exists. The "signalling active" flag shall be set in the TRACKING AREA UPDATE REQUEST message.

    	If lower layers indicate a TAI change, but the current TAI is still part of the TAI list, or the TAI has not changed, the transport of user data via the control plane procedure shall be re-initiated immediately if the user data still exists by including the ESM DATA TRANSPORT message in a CONTROL PLANE SERVICE REQUEST message.

  NOTE:	How the ESM sublayer handles the retransmission of user data via the control plane is up to the UE implementation.

  c)	NAS-MAC calculation indication from lower layers

    	If lower layers indicate to calculate an NAS-MAC, the UE shall calculate an NAS_MAC as specified in 3GPP TS 33.401 [19] and then provide the calculated NAS_MAC and 5 least significant bits of the uplink NAS COUNT used to calculate the NAS-MAC to lower layers (see 3GPP TS 36.331 [22]). The UE shall increase the uplink NAS COUNT by one after the calculation of the NAS_MAC.


6.6.4.5	Abnormal cases on the network side

  Apart from the case described in subclause 6.3.4, no other abnormal cases have been identified.


6.7	Reception of an ESM STATUS message by an ESM entity

The purpose of the sending of the ESM STATUS message is to report at any time certain error conditions detected upon receipt of ESM protocol data. The ESM STATUS message can be sent by both the MME and the UE (see example in figure 6.7.1).

If the ESM entity of the UE receives an ESM STATUS message the UE shall take different actions depending on the received ESM cause value:

  #43	(Invalid EPS bearer identity);

    	The UE shall abort any ongoing ESM procedure related to the received EPS bearer identity, stop any related timer, and deactivate the corresponding EPS bearer context locally (without peer to peer signalling between the UE and the MME).

  #81	(Invalid PTI value);

    	The UE shall abort any ongoing ESM procedure related to the received PTI value and stop any related timer.

  #97	(Message type non-existent or not implemented);

    	The UE shall abort any ongoing ESM procedure related to the PTI or EPS bearer identity and stop any related timer.

On receipt of an ESM STATUS message with any other ESM cause value no state transition and no specific action shall be taken as seen from the radio interface, i.e. local actions are possible.

If the ESM entity of the MME receives an ESM STATUS message the MME shall take different actions depending on the received ESM cause value:

  #43	(Invalid EPS bearer identity);

    	The MME shall abort any ongoing ESM procedure related to the received EPS bearer identity, stop any related timer, and deactivate the corresponding EPS bearer context locally (without peer to peer signalling between the MME and the UE).

  #81	(Invalid PTI value);

    	The MME shall abort any ongoing ESM procedure related to the received PTI value and stop any related timer.

  #97	(Message type non-existent or not implemented);

    	The MME shall abort any ongoing ESM procedure related to the PTI or EPS bearer identity and stop any related timer.

The local actions to be taken by the MME on receipt of an ESM STATUS message with any other ESM cause value are implementation dependent.

[pic]

Figure 6.7.1: ESM status procedure


7	Handling of unknown, unforeseen, and erroneous protocol data


7.1	General

The procedures specified in the present document apply to those messages which pass the checks described in this subclause.

This subclause also specifies procedures for the handling of unknown, unforeseen, and erroneous protocol data by the receiving entity. These procedures are called "error handling procedures", but in addition to providing recovery mechanisms for error situations they define a compatibility mechanism for future extensions of the protocols.

Subclauses 7.1 to 7.8 shall be applied in order of precedence.

Most error handling procedures are mandatory for the UE.

Detailed error handling procedures in the network are implementation dependent and may vary from PLMN to PLMN. However, when extensions of this protocol are developed, networks will be assumed to have the error handling that is indicated in this subclause as mandatory ("shall") and that is indicated as strongly recommended ("should").

Also, the error handling of the network is only considered as mandatory or strongly recommended when certain thresholds for errors are not reached during a dedicated connection.

For definition of semantical and syntactical errors see 3GPP TS 24.007 [12], subclause 11.4.2.


7.2	Message too short

When a message is received that is too short to contain a complete message type information element, that message shall be ignored, cf. 3GPP TS 24.007 [12].


7.3	Unknown or unforeseen procedure transaction identity or EPS bearer identity


7.3.1	Procedure transaction identity

The following network procedures shall apply for handling an unknown, erroneous, or unforeseen PTI received in an ESM message:

  a)	If the network receives a PDN CONNECTIVITY REQUEST message with an unassigned or reserved PTI value, the network shall respond with a PDN CONNECTIVITY REJECT message including ESM cause #81 "invalid PTI value".

  b)	If the network receives a PDN DISCONNECT REQUEST message with an unassigned or reserved PTI value, the network shall respond with a PDN DISCONNECT REJECT message including ESM cause #81 "invalid PTI value".

  c)	If the network receives a BEARER RESOURCE ALLOCATION REQUEST message with an unassigned or reserved PTI value, the network shall respond with a BEARER RESOURCE ALLOCATION REJECT message including ESM cause #81 "invalid PTI value".

  d)	If the network receives a BEARER RESOURCE MODIFICATION REQUEST message with an unassigned or reserved PTI value, the network shall respond with a BEARER RESOURCE MODIFICATION REJECT message including ESM cause #81 "invalid PTI value".

  e)	If the network receives an ESM INFORMATION RESPONSE message which includes an unassigned or reserved PTI value, the network shall ignore the message. If the PTI is an assigned value that does not match the PTI in use for any ongoing transaction related procedure, the network shall respond with an ESM STATUS message including ESM cause #81 "invalid PTI value".

  f)	If the network receives an ESM message other than those listed in items a through e above with a reserved PTI value, the network shall ignore the message.

The following UE procedures shall apply for handling an unknown, erroneous, or unforeseen PTI received in an ESM message:

  a)	If the UE receives a PDN CONNECTIVITY REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.

  b)	If the UE receives a PDN DISCONNECT REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.

  c)	If the UE receives a BEARER RESOURCE ALLOCATION REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.

  d)	If the UE receives a BEARER RESOURCE MODIFICATION REJECT message in which the PTI value is an unassigned or reserved value, or an assigned value that does not match any PTI in use, the UE shall ignore the message.

  e)	If the UE receives an ESM INFORMATION REQUEST message in which the PTI value is an unassigned or reserved value, the UE shall ignore the message. If the PTI is an assigned value that does not match a PTI in use for a pending UE requested PDN connectivity procedure for which the ESM information transfer flag was set in the PDN CONNECTIVITY REQUEST message, the UE shall respond with an ESM STATUS message including ESM cause #47 "PTI mismatch".

  f)	If the UE receives a NOTIFICATION message in which the PTI value is an unassigned value, the UE shall proceed as specified in subclause 7.3.2. If the PTI is a reserved value, the UE shall respond with an ESM STATUS message including ESM cause #81 "invalid PTI value". If the PTI is an assigned value that does not match any PTI in use, the UE shall respond with an ESM STATUS message including ESM cause #47 "PTI mismatch".

  g)	If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message in which the PTI value is an assigned value that does not match any PTI in use, if the UE detects that this request is a network retransmission of an already accepted request (see subclause 6.5.1.3) the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message. Otherwise, the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #47 "PTI mismatch".

  h)	If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message which contains a reserved or unassigned PTI value, the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #81 "invalid PTI value".

  i)	If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message in which the PTI value is an assigned value that does not match any PTI in use, if the UE detects that this request is a network retransmission of an already accepted request (see subclauses 6.5.3.3 and 6.5.4.3) the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message. Otherwise, the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #47 "PTI mismatch".

  j)	If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message which contains a reserved PTI value, the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #81 "invalid PTI value".

  k)	If the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message in which the PTI value is an assigned value that does not match any PTI in use, if the UE detects that this request is a network retransmission of an already accepted request (see subclauses 6.5.3.3 and 6.5.4.3) the UE shall respond with a MODIFY EPS BEARER CONTEXT ACCEPT message. Otherwise, the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #47 "PTI mismatch".

  l)	If the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message which contains a reserved PTI value, the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #81 "invalid PTI value".

  m)	If the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message in which the PTI value is a reserved value or an assigned value that does not match any PTI in use, the UE shall ignore the message.

  n)	If the UE receives an ESM message other than those listed in items a through m with a reserved PTI value or an assigned value that does not match any PTI in use, the UE shall ignore the message.


7.3.2	EPS bearer identity

The following network procedures shall apply for handling an unknown, erroneous, or unforeseen EPS bearer identity received in the header of an ESM message (specified as the header of a standard L3 message, see 3GPP TS 24.007 [12]):

  a)	If the network receives a PDN CONNECTIVITY REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a PDN CONNECTIVITY REJECT message including ESM cause #43 "invalid EPS bearer identity".

  b)	If the network receives a PDN DISCONNECT REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a PDN DISCONNECT REJECT message including ESM cause #43 "invalid EPS bearer identity".

  c)	If the network receives a BEARER RESOURCE ALLOCATION REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a BEARER RESOURCE ALLOCATION REJECT message including ESM cause #43 "invalid EPS bearer identity".

  d)	If the network receives a BEARER RESOURCE MODIFICATION REQUEST message which includes an assigned or reserved EPS bearer identity value, the network shall respond with a BEARER RESOURCE MODIFICATION REJECT message including ESM cause #43 "invalid EPS bearer identity".

  e)	If the network receives an ESM INFORMATION RESPONSE message which includes an assigned or reserved EPS bearer identity value, the network shall ignore the message.

  f)	If the network receives an ESM DATA TRANSPORT message which includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, the network shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity".

  g)	If the network receives an ESM message other than those listed in items a through e above in which the message includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, the network shall ignore the message.

The following UE procedures shall apply for handling an unknown, erroneous, or unforeseen EPS bearer identity received in the header of an ESM message:

  a)	If the UE receives a PDN CONNECTIVITY REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.

  b)	If the UE receives a PDN DISCONNECT REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.

  c)	If the UE receives a BEARER RESOURCE ALLOCATION REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.

  d)	If the UE receives a BEARER RESOURCE MODIFICATION REJECT message which includes an assigned or reserved EPS bearer identity value, the UE shall ignore the message.

  e)	If the UE receives an ESM INFORMATION REQUEST message which includes an assigned or reserved EPS bearer identity value, the UE shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity".

  f)	If the UE receives a NOTIFICATION message which includes a reserved EPS bearer identity value, an assigned EPS bearer identity value that does not match an existing EPS bearer context, or the combination of an unassigned PTI value and an unassigned EPS bearer identity value, the UE shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity".

  g)	If the UE receives an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value, the UE shall respond with an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message including ESM cause #43 "invalid EPS bearer identity".

  h)	If the UE receives an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value, the UE shall respond with an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message including ESM cause #43 "invalid EPS bearer identity".

  i)	If the UE receives a MODIFY EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value or an assigned EPS bearer identity value that does not match an existing EPS bearer context, the UE shall respond with a MODIFY EPS BEARER CONTEXT REJECT message including ESM cause #43 "invalid EPS bearer identity".

  j)	If the UE receives a DEACTIVATE EPS BEARER CONTEXT REQUEST message which includes an unassigned or reserved EPS bearer identity value or an assigned EPS bearer identity value that does not match an existing EPS bearer context, the UE shall respond with a DEACTIVATE EPS BEARER CONTEXT ACCEPT message with the EPS bearer identity set to the received EPS bearer identity.

  k)	If the UE receives an ESM DATA TRANSPORT message which includes a reserved EPS bearer identity value or an assigned value that does not match an existing EPS bearer context, the UE shall respond with an ESM STATUS message including ESM cause #43 "invalid EPS bearer identity".

  l)	If the UE receives an ESM message other than those listed in items a through j in which the message includes an unassigned or reserved EPS bearer identity value or a value that does not match an EPS bearer context of an established PDN connection, the UE shall ignore the message.


7.4	Unknown or unforeseen message type

If UE receives an EMM message or ESM message with message type not defined for the protocol discriminator (PD) or not implemented by the receiver, it shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #97 "message type non-existent or not implemented".

If the network receives an EMM or ESM message with message type not defined for the PD or not implemented by the receiver in a protocol state where reception of an unsolicited message with the given PD from the UE is not foreseen in the protocol, the network actions are implementation dependent. Otherwise, if the network receives a message with message type not defined for the PD or not implemented by the receiver, it shall ignore the message except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #97 "message type non-existent or not implemented".

  NOTE:	A message type not defined for the PD in the given direction is regarded by the receiver as a message type not defined for the PD, see 3GPP TS 24.007 [12].

If the UE receives a message not compatible with the protocol state, the UE shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #98 "message type not compatible with protocol state".

If the network receives a message not compatible with the protocol state, the network actions are implementation dependent.


7.5	Non-semantical mandatory information element errors


7.5.1	Common procedures

When on receipt of a message,

  -	an "imperative message part" error; or

  -	a "missing mandatory IE" error

is diagnosed or when a message containing:

  -	a syntactically incorrect mandatory IE;

  -	an IE unknown in the message, but encoded as "comprehension required" (see 3GPP TS 24.007 [12]); or

  -	an out of sequence IE encoded as "comprehension required" (see 3GPP TS 24.007 [12]) is received,

the UE shall proceed as follows:

    	If the message is not one of the messages listed in subclause 7.5.3, item a, b, c, or d, the UE shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #96 "invalid mandatory information"; and

the network shall proceed as follows:

    	If the message is not one of the messages listed in subclause 7.5.3, item e, f, g or h, the network shall either:

       -	try to treat the message (the exact further actions are implementation dependent); or

       -	ignore the message except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #96 "invalid mandatory information".


7.5.2	EPS mobility management

No exceptional cases are described for mobility management messages.

No semantical or syntactical diagnosis other than presence and length shall be performed on the ESM message container information element in the ATTACH REQUEST, ATTACH ACCEPT, ATTACH COMPLETE and CONTROL PLANE SERVICE REQUEST messages.


7.5.3	EPS session management

The following UE procedures shall apply for handling an error encountered with a mandatory information element in an ESM message:

  a)	If the message is an ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST, an ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.

  b)	If the message is an ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST, an ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.

  c)	If the message is a MODIFY EPS BEARER CONTEXT REQUEST, a MODIFY EPS BEARER CONTEXT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.

  d)	If the message is a DEACTIVATE EPS BEARER CONTEXT REQUEST, a DEACTIVATE EPS BEARER CONTEXT ACCEPT message shall be returned. All resources associated with that EPS bearer shall be released.

The following network procedures shall apply for handling an error encountered with a mandatory information element in an ESM message:

  e)	If the message is a PDN CONNECTIVITY REQUEST, a PDN CONNECTIVITY REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.

  f)	If the message is a PDN DISCONNECT REQUEST, a PDN DISCONNECT REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.

  g)	If the message is a BEARER RESOURCE ALLOCATION REQUEST, a BEARER RESOURCE ALLOCATION REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.

  h)	If the message is a BEARER RESOURCE MODIFICATION REQUEST, a BEARER RESOURCE MODIFICATION REJECT message with ESM cause #96 "invalid mandatory information", shall be returned.


7.6	Unknown and unforeseen IEs in the non-imperative message part


7.6.1	IEIs unknown in the message

The UE shall ignore all IEs unknown in a message which are not encoded as "comprehension required" (see 3GPP TS 24.007 [12]).

The network shall take the same approach.


7.6.2	Out of sequence IEs

The UE shall ignore all out of sequence IEs in a message which are not encoded as "comprehension required" (see 3GPP TS 24.007 [12]).

The network should take the same approach.


7.6.3	Repeated IEs

If an information element with format T, TV, TLV, or TLV-E is repeated in a message in which repetition of the information element is not specified in clause 8 of the present document, the UE shall handle only the contents of the information element appearing first and shall ignore all subsequent repetitions of the information element. When repetition of information elements is specified, the UE shall handle only the contents of specified repeated information elements. If the limit on repetition of information elements is exceeded, the UE shall handle the contents of information elements appearing first up to the limit of repetitions and shall ignore all subsequent repetitions of the information element.

The network should follow the same procedures.


7.7	Non-imperative message part errors

This category includes:

  -	syntactically incorrect optional IEs; and

  -	conditional IE errors.


7.7.1	Syntactically incorrect optional IEs

The UE shall treat all optional IEs that are syntactically incorrect in a message as not present in the message.

The network shall take the same approach.


7.7.2	Conditional IE errors

When upon receipt of a EMM or ESM message the UE diagnoses a "missing conditional IE" error or an "unexpected conditional IE" error, or when it receives a EMM or ESM message containing at least one syntactically incorrect conditional IE, the UE shall ignore the message and shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #100 "conditional IE error".

When the network receives a message and diagnoses a "missing conditional IE" error or an "unexpected conditional IE" error or when it receives a message containing at least one syntactically incorrect conditional IE, the network shall either:

  -	try to treat the message (the exact further actions are implementation dependent); or

  -	ignore the message except that it should return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #100 "conditional IE error".


7.8	Messages with semantically incorrect contents

When a message with semantically incorrect contents is received, the UE shall perform the foreseen reactions of the procedural part of the present document (i.e. of clauses 4, 5 and 6). If however no such reactions are specified, the UE shall ignore the message except that it shall return a status message (EMM STATUS or ESM STATUS depending on the PD) with cause #95 "semantically incorrect message".

The network should follow the same procedure except that a status message is not normally transmitted.


8	Message functional definitions and contents


8.1	Overview

This clause defines the structure of the messages of the Layer 3 (L3) protocols defined in the present document. These are standard L3 messages as defined in 3GPP TS 24.007 [12].

Each definition given in the present clause includes:

  a)	a brief description of the message direction and use, including whether the message has:

    1.	Local significance, i.e. relevant only on the originating or terminating access;

    2.	Access significance, i.e. relevant in the originating and terminating access, but not in the network;

    3.	Dual significance, i.e. relevant in either the originating or terminating access and in the network; or

    4.	Global significance, i.e. relevant in the originating and terminating access and in the network.

  b)	a table listing the Information Elements (IE) known in the message and the order of their appearance in the message. All IEs that may be repeated are explicitly indicated (The V, LV and LV-E formatted IEs, which compose the imperative part of the message, occur before the T, TV, TLV and TLV-E formatted IEs which compose the non-imperative part of the message, see 3GPP TS 24.007 [12]). In a (maximal) sequence of consecutive IEs with half octet length, the first IE with half octet length occupies bits 1 to 4 of octet N, the second IE bits 5 to 8 of octet N, the third IE bits 1 to 4 of octet N+1 etc. Such a sequence always has an even number of elements.

    	For each information element the table indicates:

    1.	The Information Element Identifier (IEI), in hexadecimal notation, if the IE has format T, TV, TLV or TLV-E. If the IEI has half octet length, it is specified by a notation representing the IEI as a hexadecimal digit followed by a "-" (example: B-).

  NOTE:	The same IEI can be used for different information element types in different messages of the same protocol.

    2.	The name of the information element (which may give an idea of the semantics of the element). The name of the information element followed by "IE" or "information element" is used in this technical report as reference to the information element within a message.

    3.	The name of the type of the information element (which indicates the coding of the value part of the IE), and generally, the referenced subclause of clause 9 of the present document describing the value part of the information element.

    4.	The presence requirement indication (M, C, or O) for the IE as defined in 3GPP TS 24.007 [12].

    5.	The format of the information element (T, V, TV, LV, TLV, LV-E or TLV-E) as defined in 3GPP TS 24.007 [12].

    6.	The length of the information element (or permissible range of lengths), in octets, in the message, where "?" means that the maximum length of the IE is only constrained by link layer protocol. This indication is non-normative.

  c)	subclauses specifying, where appropriate, conditions for IEs with presence requirement C or O in the relevant message which together with other conditions specified in the present document define when the information elements shall be included or not, what non-presence of such IEs means, and – for IEs with presence requirement C – the static conditions for presence or non-presence of the IEs or for both cases (see 3GPP TS 24.007 [12]).


8.2	EPS mobility management messages


8.2.1	Attach accept


8.2.1.1	Message definition

This message is sent by the network to the UE to indicate that the corresponding attach request has been accepted. See table 8.2.1.1.

  Message type:	ATTACH ACCEPT

  Significance:	dual

  Direction:	network to UE

Table 8.2.1.1: ATTACH ACCEPT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |Attach accept message identity           |Message type                                 |M               |V           |1           |
|       |                                         |9.8                                          |                |            |            |
|       |EPS attach result                        |EPS attach result                            |M               |V           |1/2         |
|       |                                         |9.9.3.10                                     |                |            |            |
|       |Spare half octet                         |Spare half octet                             |M               |V           |1/2         |
|       |                                         |9.9.2.9                                      |                |            |            |
|       |T3412 value                              |GPRS timer                                   |M               |V           |1           |
|       |                                         |9.9.3.16                                     |                |            |            |
|       |TAI list                                 |Tracking area identity list                  |M               |LV          |7-97        |
|       |                                         |9.9.3.33                                     |                |            |            |
|       |ESM message container                    |ESM message container                        |M               |LV-E        |5-n         |
|       |                                         |9.9.3.15                                     |                |            |            |
|50     |GUTI                                     |EPS mobile identity                          |O               |TLV         |13          |
|       |                                         |9.9.3.12                                     |                |            |            |
|13     |Location area identification             |Location area identification                 |O               |TV          |6           |
|       |                                         |9.9.2.2                                      |                |            |            |
|23     |MS identity                              |Mobile identity                              |O               |TLV         |7-10        |
|       |                                         |9.9.2.3                                      |                |            |            |
|53     |EMM cause                                |EMM cause                                    |O               |TV          |2           |
|       |                                         |9.9.3.9                                      |                |            |            |
|17     |T3402 value                              |GPRS timer                                   |O               |TV          |2           |
|       |                                         |9.9.3.16                                     |                |            |            |
|59     |T3423 value                              |GPRS timer                                   |O               |TV          |2           |
|       |                                         |9.9.3.16                                     |                |            |            |
|4A     |Equivalent PLMNs                         |PLMN list                                    |O               |TLV         |5-47        |
|       |                                         |9.9.2.8                                      |                |            |            |
|34     |Emergency number list                    |Emergency number list                        |O               |TLV         |5-50        |
|       |                                         |9.9.3.37                                     |                |            |            |
|64     |EPS network feature support              |EPS network feature support                  |O               |TLV         |3-4         |
|       |                                         |9.9.3.12A                                    |                |            |            |
|F-     |Additional update result                 |Additional update result                     |O               |TV          |1           |
|       |                                         |9.9.3.0A                                     |                |            |            |
|5E     |T3412 extended value                     |GPRS timer 3                                 |O               |TLV         |3           |
|       |                                         |9.9.3.16B                                    |                |            |            |
|6A     |T3324 value                              |GPRS timer 2                                 |O               |TLV         |3           |
|       |                                         |9.9.3.16A                                    |                |            |            |
|6E     |Extended DRX parameters                  |Extended DRX parameters                      |O               |TLV         |3           |
|       |                                         |9.9.3.46                                     |                |            |            |
|65     |DCN-ID                                   |DCN-ID                                       |O               |TLV         |4           |
|       |                                         |9.9.3.48                                     |                |            |            |
|E-     |SMS services status                      |SMS services status                          |O               |TV          |1           |
|       |                                         |9.9.3.4B                                     |                |            |            |
|D-     |Non-3GPP NW provided policies            |Non-3GPP NW provided policies                |O               |TV          |1           |
|       |                                         |9.9.3.49                                     |                |            |            |
|6B     |T3448 value                              |GPRS timer 2                                 |O               |TLV         |3           |
|       |                                         |9.9.3.16A                                    |                |            |            |
|C-     |Network policy                           |Network policy                               |O               |TV          |1           |
|       |                                         |9.9.3.52                                     |                |            |            |
|6C     |T3447 value                              |GPRS timer 3                                 |O               |TLV         |3           |
|       |                                         |9.9.3.16B                                    |                |            |            |
|7A     |Extended emergency number list           |Extended emergency number list               |O               |TLV-E       |7-65538     |
|       |                                         |9.9.3.37A                                    |                |            |            |
|7C     |Ciphering key data                       |Ciphering key data                           |O               |TLV-E       |35-2291     |
|       |                                         |9.9.3.56                                     |                |            |            |



8.2.1.2	GUTI

This IE may be included to assign a GUTI to the UE during attach or combined EPS/IMSI attach.


8.2.1.3	Location area identification

This IE may be included to assign a new location area identification to a UE during a combined attach.


8.2.1.4	MS identity

This IE may be included to assign or unassign a new TMSI to a UE during a combined attach.


8.2.1.5	EMM cause

This IE shall be included when IMSI attach for non-EPS services is not successful during a combined EPS/IMSI attach procedure.


8.2.1.6	T3402 value

This IE may be included to indicate a value for timer T3402.


8.2.1.7	T3423 value

This IE may be included to indicate a value for timer T3423.

If this IE is not included, the UE shall use the default value.


8.2.1.8	Equivalent PLMNs

This IE may be included in order to assign a new equivalent PLMNs list to a UE.


8.2.1.9	Emergency number list

This IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers valid within the same country as in the PLMN from which this IE is received.


8.2.1.9A	Extended emergency number list

This IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers (with URN information) valid within the same country as in the PLMN from which this IE is received or valid only in the PLMN from which this IE is received.


8.2.1.10	EPS network feature support

The network may include this IE to inform the UE of the support of certain features. If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero, except for the S1-u data transfer (S1-U data) (octet 4, bit 2).

  NOTE: In this exceptional case, the UE deems that the network supports S1-u data transfer.


8.2.1.11	Additional update result

The network may include this IE to provide the UE with additional information about the result of:

  -	a combined attach procedure if the procedure was successful for EPS services and non-EPS services, or for EPS services and "SMS only"; or

  -	an attach procedure requested for CIoT EPS optimizations if the procedure was successful for EPS services and "SMS only".


8.2.1.12	T3412 extended value

The network may include this IE to provide the UE with longer periodic tracking area update timer.


8.2.1.13	T3324 value

The network shall include the T3324 value IE if:

  -	the UE included the T3324 value IE in the ATTACH REQUEST message; and

  -	the network supports PSM and accepts the use of PSM.


8.2.1.14	Extended DRX parameters

The network shall include the Extended DRX parameters IE if:

  -	the UE included the Extended DRX parameters IE in the ATTACH REQUEST message; and

  -	the network supports eDRX and accepts the use of eDRX.


8.2.1.15	DCN-ID

This IE is included in the message when the network wishes to provide a DCN-ID to the UE.


8.2.1.16	SMS services status

This IE may be included when a normal attach procedure for EPS services and "SMS only" was successful for EPS services only.


8.2.1.17	Non-3GPP NW provided policies

This IE is included if the network needs to indicate whether emergency numbers provided via non-3GPP access can be used to initiate UE detected emergency calls (see 3GPP TS 24.302 [48]). If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.


8.2.1.18	T3448 value

The network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.


8.2.1.19	Network policy

This IE is included if the network needs to indicate network policy information to the UE, If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.


8.2.1.20	T3447 value

The network may include T3447 value IE if:

  -	the UE has indicated support for service gap control in the ATTACH REQUEST message; and

  -	the EMM context contains a service gap time value.


8.2.1.21	Ciphering key data

This IE is included if the network needs to send ciphering key data to the UE for ciphered broadcast assistance data.


8.2.2	Attach complete

This message is sent by the UE to the network in response to an ATTACH ACCEPT message. See table 8.2.2.1.

  Message type:	ATTACH COMPLETE

  Significance:	dual

  Direction:	UE to network

Table 8.2.2.1: ATTACH COMPLETE message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |Attach complete message identity         |Message type                                 |M               |V           |1           |
|       |                                         |9.8                                          |                |            |            |
|       |ESM message container                    |ESM message container                        |M               |LV-E        |5-n         |
|       |                                         |9.9.3.15                                     |                |            |            |



8.2.3	Attach reject


8.2.3.1	Message definition

This message is sent by the network to the UE to indicate that the corresponding attach request has been rejected. See table 8.2.3.1.

  Message type:	ATTACH REJECT

  Significance:	dual

  Direction:	network to UE

Table 8.2.3.1: ATTACH REJECT message content

|IEI    |Information Element                      |Type/Reference                                |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                        |M               |V           |1/2         |
|       |                                         |9.2                                           |                |            |            |
|       |Security header type                     |Security header type                          |M               |V           |1/2         |
|       |                                         |9.3.1                                         |                |            |            |
|       |Attach reject message identity           |Message type                                  |M               |V           |1           |
|       |                                         |9.8                                           |                |            |            |
|       |EMM cause                                |EMM cause                                     |M               |V           |1           |
|       |                                         |9.9.3.9                                       |                |            |            |
|78     |ESM message container                    |ESM message container                         |O               |TLV-E       |6-n         |
|       |                                         |9.9.3.15                                      |                |            |            |
|5F     |T3346 value                              |GPRS timer 2                                  |O               |TLV         |3           |
|       |                                         |9.9.3.16A                                     |                |            |            |
|16     |T3402 value                              |GPRS timer 2                                  |O               |TLV         |3           |
|       |                                         |9.9.3.16A                                     |                |            |            |
|A-     |Extended EMM cause                       |Extended EMM cause                            |O               |TV          |1           |
|       |                                         |9.9.3.26A                                     |                |            |            |



8.2.3.2	ESM message container

This IE is included to carry a single ESM message.


8.2.3.3	T3346 value

The MME may include this IE when the NAS level mobility management congestion control is active.


8.2.3.4	T3402 value

This IE may be included to indicate a value for timer T3402.


8.2.3.5	Extended EMM cause

This IE may be included by the network to indicate additional information associated with the EMM cause.


8.2.4	Attach request


8.2.4.1	Message definition

This message is sent by the UE to the network in order to perform an attach procedure. See table 8.2.4.1.

  Message type:	ATTACH REQUEST

  Significance:	dual

  Direction:	UE to network

Table 8.2.4.1: ATTACH REQUEST message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |Attach request message identity          |Message type                                 |M               |V           |1           |
|       |                                         |9.8                                          |                |            |            |
|       |EPS attach type                          |EPS attach type                              |M               |V           |1/2         |
|       |                                         |9.9.3.11                                     |                |            |            |
|       |NAS key set identifier                   |NAS key set identifier                       |M               |V           |1/2         |
|       |                                         |9.9.3.21                                     |                |            |            |
|       |EPS mobile identity                      |EPS mobile identity                          |M               |LV          |5-12        |
|       |                                         |9.9.3.12                                     |                |            |            |
|       |UE network capability                    |UE network capability                        |M               |LV          |3-14        |
|       |                                         |9.9.3.34                                     |                |            |            |
|       |ESM message container                    |ESM message container                        |M               |LV-E        |5-n         |
|       |                                         |9.9.3.15                                     |                |            |            |
|19     |Old P-TMSI signature                     |P-TMSI signature                             |O               |TV          |4           |
|       |                                         |9.9.3.26                                     |                |            |            |
|50     |Additional GUTI                          |EPS mobile identity                          |O               |TLV         |13          |
|       |                                         |9.9.3.12                                     |                |            |            |
|52     |Last visited registered TAI              |Tracking area identity                       |O               |TV          |6           |
|       |                                         |9.9.3.32                                     |                |            |            |
|5C     |DRX parameter                            |DRX parameter                                |O               |TV          |3           |
|       |                                         |9.9.3.8                                      |                |            |            |
|31     |MS network capability                    |MS network capability                        |O               |TLV         |4-10        |
|       |                                         |9.9.3.20                                     |                |            |            |
|13     |Old location area identification         |Location area identification                 |O               |TV          |6           |
|       |                                         |9.9.2.2                                      |                |            |            |
|9-     |TMSI status                              |TMSI status                                  |O               |TV          |1           |
|       |                                         |9.9.3.31                                     |                |            |            |
|11     |Mobile station classmark 2               |Mobile station classmark 2                   |O               |TLV         |5           |
|       |                                         |9.9.2.4                                      |                |            |            |
|20     |Mobile station classmark 3               |Mobile station classmark 3                   |O               |TLV         |2-34        |
|       |                                         |9.9.2.5                                      |                |            |            |
|40     |Supported Codecs                         |Supported Codec List                         |O               |TLV         |5-n         |
|       |                                         |9.9.2.10                                     |                |            |            |
|F-     |Additional update type                   |Additional update type                       |O               |TV          |1           |
|       |                                         |9.9.3.0B                                     |                |            |            |
|5D     |Voice domain preference and UE's usage   |Voice domain preference and UE's usage       |O               |TLV         |3           |
|       |setting                                  |setting                                      |                |            |            |
|       |                                         |9.9.3.44                                     |                |            |            |
|D-     |Device properties                        |Device properties                            |O               |TV          |1           |
|       |                                         |9.9.2.0A                                     |                |            |            |
|E-     |Old GUTI type                            |GUTI type                                    |O               |TV          |1           |
|       |                                         |9.9.3.45                                     |                |            |            |
|C-     |MS network feature support               |MS network feature support                   |O               |TV          |1           |
|       |                                         |9.9.3.20A                                    |                |            |            |
|10     |TMSI based NRI container                 |Network resource identifier container        |O               |TLV         |4           |
|       |                                         |9.9.3.24A                                    |                |            |            |
|6A     |T3324 value                              |GPRS timer 2                                 |O               |TLV         |3           |
|       |                                         |9.9.3.16A                                    |                |            |            |
|5E     |T3412 extended value                     |GPRS timer 3                                 |O               |TLV         |3           |
|       |                                         |9.9.3.16B                                    |                |            |            |
|6E     |Extended DRX parameters                  |Extended DRX parameters                      |O               |TLV         |3           |
|       |                                         |9.9.3.46                                     |                |            |            |
|6F     |UE additional security capability        |UE additional security capability            |O               |TLV         |6           |
|       |                                         |9.9.3.53                                     |                |            |            |
|6D     |UE status                                |UE status                                    |O               |TLV         |3           |
|       |                                         |9.9.3.54                                     |                |            |            |
|17     |Additional information requested         |Additional information requested             |O               |TV          |2           |
|       |                                         |9.9.3.55                                     |                |            |            |



8.2.4.2	Old P-TMSI signature

The UE shall include this IE if the UE holds a valid P-TMSI signature, P-TMSI and RAI, and the TIN either indicates "P-TMSI" or is deleted. If the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] and is attaching in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs, the UE shall not include this IE.


8.2.4.3	Additional GUTI

The UE shall include this IE if the TIN indicates "P-TMSI" and the UE holds a valid GUTI, P-TMSI and RAI. If the UE is configured for "AttachWithIMSI" as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17] and is attaching in a new PLMN that is neither the registered PLMN nor in the list of equivalent PLMNs, the UE shall not include this IE.


8.2.4.4	Last visited registered TAI

This IE shall be included if the UE holds a valid last visited registered TAI.


8.2.4.5	DRX parameter

This IE is included if UE supports A/Gb mode or Iu mode or if the UE wants to indicate its UE specific DRX parameters to the network.


8.2.4.6	MS network capability

A UE supporting A/Gb mode or Iu mode shall include this IE to indicate its capabilities to the network.


8.2.4.7	Old location area identification

The UE shall include this IE during a combined attach procedure if it has a valid location area identification.


8.2.4.8	TMSI status

The UE shall include this IE during combined attach procedure if it has no valid TMSI available.


8.2.4.9	Mobile station classmark 2

This IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN (see 3GPP TS 23.216 [8]), or if the UE is performing a combined attach procedure.


8.2.4.10	Mobile station classmark 3

This IE shall be included if the UE supports SRVCC to GERAN.


8.2.4.11	Supported Codecs

This IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN to indicate its supported speech codecs for CS speech calls.


8.2.4.12	Additional update type

The UE shall include this IE if the UE requests "SMS only" or CIoT EPS optimizations.


8.2.4.13	Voice domain preference and UE's usage setting

This IE shall be included in WB-S1 mode if the UE supports:

  -	CS fallback and SMS over SGs; or

  -	if the UE is configured to support IMS voice, but does not support 1xCS fallback.


8.2.4.14	Device properties

This IE shall be included if the UE is configured for NAS signalling low priority.


8.2.4.15	Old GUTI type

The UE shall include this IE if the type of identity in the EPS mobile identity IE is set to "GUTI".


8.2.4.16	MS network feature support

This IE shall be included if the UE supports extended periodic timer T3412.


8.2.4.17	TMSI based NRI container

The UE shall include this IE during a combined attach procedure if it has a valid TMSI.


8.2.4.18	T3324 value

The UE may include this IE to request the use of PSM.


8.2.4.19	T3412 extended value

The UE may include this IE to request a particular T3412 value if the T3324 value IE is included.


8.2.4.20	Extended DRX parameters

The UE may include this IE to request the use of eDRX.


8.2.4.21	UE additional security capability

The UE shall include this IE if the UE supports dual connectivity with NR or if the UE supports N1 mode.


8.2.4.22	UE status

This IE shall be included if the UE wants to provide the network with information concerning aspects of the current UE registration status which is used for interworking with 5GS.


8.2.4.23	Additional information requested

The UE shall include this IE if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys for ciphered broadcast assistance data.


8.2.5	Authentication failure


8.2.5.1	Message definition

This message is sent by the UE to the network to indicate that authentication of the network has failed. See table 8.2.5.1.

  Message type:	AUTHENTICATION FAILURE

  Significance:	dual

  Direction:	UE to network

Table 8.2.5.1: AUTHENTICATION FAILURE message content

|IEI      |Information element                      |Type/Reference                           |Presence         |Format       |Length              |
|         |Protocol discriminator                   |Protocol discriminator                   |M                |V            |1/2                 |
|         |                                         |9.2                                      |                 |             |                    |
|         |Security header type                     |Security header type                     |M                |V            |1/2                 |
|         |                                         |9.3.1                                    |                 |             |                    |
|         |Authentication failure                   |Message type                             |M                |V            |1                   |
|         |message type                             |9.8                                      |                 |             |                    |
|         |EMM cause                                |EMM cause                                |M                |V            |1                   |
|         |                                         |9.9.3.9                                  |                 |             |                    |
|30       |Authentication failure parameter         |Authentication failure parameter         |O                |TLV          |16                  |
|         |                                         |9.9.3.1                                  |                 |             |                    |



8.2.5.2	Authentication failure parameter

This IE shall be sent if and only if the EMM cause was #21 "synch failure". It shall include the response to the authentication challenge from the USIM, which is made up of the AUTS parameter (see 3GPP TS 33.102 [18]).


8.2.6	Authentication reject

This message is sent by the network to the UE to indicate that the authentication procedure has failed and that the UE shall abort all activities. See table 8.2.6.1.

  Message type:	AUTHENTICATION REJECT

  Significance:	dual

  Direction:	network to UE

Table 8.2.6.1: AUTHENTICATION REJECT message content

|IEI      |Information element                      |Type/Reference                           |Presence         |Format       |Length              |
|         |Protocol discriminator                   |Protocol discriminator                   |M                |V            |1/2                 |
|         |                                         |9.2                                      |                 |             |                    |
|         |Security header type                     |Security header type                     |M                |V            |1/2                 |
|         |                                         |9.3.1                                    |                 |             |                    |
|         |Authentication reject message type       |Message type                             |M                |V            |1                   |
|         |                                         |9.8                                      |                 |             |                    |



8.2.7	Authentication request

This message is sent by the network to the UE to initiate authentication of the UE identity. See table 8.2.7.1.

  Message type:	AUTHENTICATION REQUEST

  Significance:	dual

  Direction:	network to UE

Table 8.2.7.1: AUTHENTICATION REQUEST message content

|IEI      |Information element                      |Type/Reference                           |Presence         |Format       |Length              |
|         |Protocol discriminator                   |Protocol discriminator                   |M                |V            |1/2                 |
|         |                                         |9.2                                      |                 |             |                    |
|         |Security header type                     |Security header type                     |M                |V            |1/2                 |
|         |                                         |9.3.1                                    |                 |             |                    |
|         |Authentication request message type      |Message type                             |M                |V            |1                   |
|         |                                         |9.8                                      |                 |             |                    |
|         |NAS key set identifierASME               |NAS key set identifier                   |M                |V            |1/2                 |
|         |                                         |9.9.3.21                                 |                 |             |                    |
|         |Spare half octet                         |Spare half octet                         |M                |V            |1/2                 |
|         |                                         |9.9.2.9                                  |                 |             |                    |
|         |Authentication parameter RAND (EPS       |Authentication parameter RAND            |M                |V            |16                  |
|         |challenge)                               |9.9.3.3                                  |                 |             |                    |
|         |Authentication parameter AUTN (EPS       |Authentication parameter AUTN            |M                |LV           |17                  |
|         |challenge)                               |9.9.3.2                                  |                 |             |                    |



8.2.8	Authentication response

This message is sent by the UE to the network to deliver a calculated authentication response to the network. See table 8.2.8.1.

  Message type:	AUTHENTICATION RESPONSE

  Significance:	dual

  Direction:	UE to network

Table 8.2.8.1: AUTHENTICATION RESPONSE message content

|IEI      |Information element                      |Type/Reference                           |Presence         |Format       |Length              |
|         |Protocol discriminator                   |Protocol discriminator                   |M                |V            |1/2                 |
|         |                                         |9.2                                      |                 |             |                    |
|         |Security header type                     |Security header type                     |M                |V            |1/2                 |
|         |                                         |9.3.1                                    |                 |             |                    |
|         |Authentication response message type     |Message type                             |M                |V            |1                   |
|         |                                         |9.8                                      |                 |             |                    |
|         |Authentication response parameter        |Authentication response parameter        |M                |LV           |5-17                |
|         |                                         |9.9.3.4                                  |                 |             |                    |



8.2.9	CS service notification


8.2.9.1	Message definition

This message is sent by the network when a paging request with CS call indicator was received via SGs for a UE, and a NAS signalling connection is already established for the UE. See table 8.2.9.1.

  Message type:	CS SERVICE NOTIFICATION

  Significance:	dual

  Direction:	network to UE

Table 8.2.9.1: CS SERVICE NOTIFICATION message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |CS service notification message identity |Message type                                 |M               |V           |1           |
|       |                                         |9.8                                          |                |            |            |
|       |Paging identity                          |Paging identity                              |M               |V           |1           |
|       |                                         |9.9.3.25A                                    |                |            |            |
|60     |CLI                                      |CLI                                          |O               |TLV         |3-14        |
|       |                                         |9.9.3.38                                     |                |            |            |
|61     |SS Code                                  |SS Code                                      |O               |TV          |2           |
|       |                                         |9.9.3.39                                     |                |            |            |
|62     |LCS indicator                            |LCS indicator                                |O               |TV          |2           |
|       |                                         |9.9.3.40                                     |                |            |            |
|63     |LCS client identity                      |LCS client identity                          |O               |TLV         |3-257       |
|       |                                         |9.9.3.41                                     |                |            |            |



8.2.9.2	CLI

The network shall send this IE if it was received via SGs. It contains the identification of the calling line for the mobile terminating call in the CS domain, which triggered the paging via SGs.


8.2.9.3	SS Code

The network shall send this IE if it was received via SGs. It contains information on the supplementary service transaction in the CS domain, which triggered the paging via SGs.


8.2.9.4	LCS indicator

The network shall send this IE if it was received via SGs. It indicates that the paging was triggered by a terminating LCS request in the CS domain.


8.2.9.5	LCS client identity

The network shall send this IE if received via SGs. It contains information related to the requestor of the terminating LCS request in the CS domain.


8.2.10	Detach accept


8.2.10.1	Detach accept (UE originating detach)

This message is sent by the network to indicate that the detach procedure has been completed. See table 8.2.10.1.1.

  Message type:	DETACH ACCEPT

  Significance:	dual

  Direction:	network to UE

Table 8.2.10.1.1: DETACH ACCEPT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |Detach accept message identity           |Message type                                 |M               |V           |1           |
|       |                                         |9.8                                          |                |            |            |



8.2.10.2	Detach accept (UE terminated detach)

This message is sent by the UE to indicate that the detach procedure has been completed. See table 8.2.10.2.1.

  Message type:	DETACH ACCEPT

  Significance:	dual

  Direction:	UE to network

Table 8.2.10.2.1: DETACH ACCEPT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |Detach accept message identity           |Message type                                 |M               |V           |1           |
|       |                                         |9.8                                          |                |            |            |



8.2.11	Detach request


8.2.11.1	Detach request (UE originating detach)

This message is sent by the UE to request the release of an EMM context. See table 8.2.11.1.1.

  Message type:	DETACH REQUEST

  Significance:	dual

  Direction:	UE to network

Table 8.2.11.1.1: DETACH REQUEST message content

|IEI    |Information Element                      |Type/Reference                                |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                        |M               |V           |1/2         |
|       |                                         |9.2                                           |                |            |            |
|       |Security header type                     |Security header type                          |M               |V           |1/2         |
|       |                                         |9.3.1                                         |                |            |            |
|       |Detach request message identity          |Message type                                  |M               |V           |1           |
|       |                                         |9.8                                           |                |            |            |
|       |Detach type                              |Detach type                                   |M               |V           |1/2         |
|       |                                         |9.9.3.7                                       |                |            |            |
|       |NAS key set identifier                   |NAS key set identifier                        |M               |V           |1/2         |
|       |                                         |9.9.3.21                                      |                |            |            |
|       |EPS mobile identity                      |EPS mobile identity                           |M               |LV          |5-12        |
|       |                                         |9.9.3.12                                      |                |            |            |



8.2.11.2	Detach request (UE terminated detach)


8.2.11.2.1	Message definition

This message is sent by the network to request the release of an EMM context. See table 8.2.11.2.1.

  Message type:	DETACH REQUEST

  Significance:	dual

  Direction:	network to UE

Table 8.2.11.2.1: DETACH REQUEST message content

|IEI    |Information Element                      |Type/Reference                                |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                        |M               |V           |1/2         |
|       |                                         |9.2                                           |                |            |            |
|       |Security header type                     |Security header type                          |M               |V           |1/2         |
|       |                                         |9.3.1                                         |                |            |            |
|       |Detach request message identity          |Message type                                  |M               |V           |1           |
|       |                                         |9.8                                           |                |            |            |
|       |Detach type                              |Detach type                                   |M               |V           |1/2         |
|       |                                         |9.9.3.7                                       |                |            |            |
|       |Spare half octet                         |Spare half octet                              |M               |V           |1/2         |
|       |                                         |9.9.2.9                                       |                |            |            |
|53     |EMM cause                                |EMM cause                                     |O               |TV          |2           |
|       |                                         |9.9.3.9                                       |                |            |            |



8.2.11.2.2	EMM cause

This information element is included if an EMM cause is provided.


8.2.12	Downlink NAS Transport

This message is sent by the network to the UE in order to carry an SMS message in encapsulated format. See table 8.2.12.1.

  Message type:	DOWNLINK NAS TRANSPORT

  Significance:	dual

  Direction:	network to UE

Table 8.2.12.1: DOWNLINK NAS TRANSPORT message content

|IEI  |Information Element                      |Type/Reference                               |Presence        |Format        |Length        |
|     |Protocol discriminator                   |Protocol discriminator                       |M               |V             |1/2           |
|     |                                         |9.2                                          |                |              |              |
|     |Security header type                     |Security header type                         |M               |V             |1/2           |
|     |                                         |9.3.1                                        |                |              |              |
|     |Downlink NAS transport message identity  |Message type                                 |M               |V             |1             |
|     |                                         |9.8                                          |                |              |              |
|     |NAS message container                    |NAS message container                        |M               |LV            |3-252         |
|     |                                         |9.9.3.22                                     |                |              |              |



8.2.13	EMM information


8.2.13.1	Message definition

This message is sent by the network at any time during EMM context is established to send certain information to the UE. See table 8.2.13.1.

  Message type:	EMM INFORMATION

  Significance:	local

  Direction:	network to UE

Table 8.2.13.1: EMM INFORMATION message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |EMM information message identity         |Message type                                 |M               |V           |1           |
|       |                                         |9.8                                          |                |            |            |
|43     |Full name for network                    |Network name                                 |O               |TLV         |3-n         |
|       |                                         |9.9.3.24                                     |                |            |            |
|45     |Short name for network                   |Network name                                 |O               |TLV         |3-n         |
|       |                                         |9.9.3.24                                     |                |            |            |
|46     |Local time zone                          |Time zone                                    |O               |TV          |2           |
|       |                                         |9.9.3.29                                     |                |            |            |
|47     |Universal time and local time zone       |Time zone and time                           |O               |TV          |8           |
|       |                                         |9.9.3.30                                     |                |            |            |
|49     |Network daylight saving time             |Daylight saving time                         |O               |TLV         |3           |
|       |                                         |9.9.3.6                                      |                |            |            |



8.2.13.2	Full name for network

This IE may be sent by the network. If this IE is sent, the contents of this IE indicate the "full length name of the network" that the network wishes the UE to associate with the MCC and MNC contained in the last visited tracking area identification.


8.2.13.3	Short name for network

This IE may be sent by the network. If this IE is sent, the contents of this IE indicate the "abbreviated name of the network" that the network wishes the UE to associate with the MCC and MNC contained in the last visited tracking area identification.


8.2.13.4	Local time zone

This IE may be sent by the network. The UE should assume that this time zone applies to the tracking area of the current cell, and also applies to the tracking area list if available in the UE.

  NOTE:	The time information can be inaccurate, especially when the TAI list includes tracking areas belonging to different time zones.

If the local time zone has been adjusted for daylight saving time, the network shall indicate this by including the Network daylight saving time IE.


8.2.13.5	Universal time and local time zone

This IE may be sent by the network. The UE should assume that this time zone applies to the tracking area the UE is currently in, and also applies to the tracking area list if available in the UE. The UE shall not assume that the time information is accurate.

  NOTE:	The time information can be inaccurate, especially when the TAI list includes tracking areas belonging to different time zones.

If the local time zone has been adjusted for daylight saving time, the network shall indicate this by including the Network daylight saving time IE.


8.2.13.6	Network daylight saving time

This IE may be sent by the network. If this IE is sent, the contents of this IE indicates the value that has been used to adjust the local time zone.


8.2.14	EMM status

This message is sent by the UE or by the network at any time to report certain error conditions listed in clause 7. See table 8.2.14.1.

  Message type:	EMM STATUS

  Significance:	local

  Direction:	both

Table 8.2.14.1: EMM STATUS message content

|IEI  |Information Element                      |Type/Reference                               |Presence        |Format        |Length        |
|     |Protocol discriminator                   |Protocol discriminator                       |M               |V             |1/2           |
|     |                                         |9.2                                          |                |              |              |
|     |Security header type                     |Security header type                         |M               |V             |1/2           |
|     |                                         |9.3.1                                        |                |              |              |
|     |EMM status message identity              |Message type                                 |M               |V             |1             |
|     |                                         |9.8                                          |                |              |              |
|     |EMM cause                                |EMM cause                                    |M               |V             |1             |
|     |                                         |9.9.3.9                                      |                |              |              |



8.2.15	Extended service request


8.2.15.1	Message definition

This message is sent by the UE to the network

  -	to initiate a CS fallback or 1xCS fallback call or respond to a mobile terminated CS fallback or 1xCS fallback request from the network; or

  -	to request the establishment of a NAS signalling connection and of the radio and S1 bearers for packet services, if the UE needs to provide additional information that cannot be provided via a SERVICE REQUEST message.

  See table 8.2.15.1.

  Message type:	EXTENDED SERVICE REQUEST

  Significance:	dual

  Direction:	UE to network

Table 8.2.15.1: EXTENDED SERVICE REQUEST message content

|IEI  |Information Element                      |Type/Reference                               |Presence        |Format        |Length        |
|     |Protocol discriminator                   |Protocol discriminator                       |M               |V             |1/2           |
|     |                                         |9.2                                          |                |              |              |
|     |Security header type                     |Security header type                         |M               |V             |1/2           |
|     |                                         |9.3.1                                        |                |              |              |
|     |Extended service request message identity|Message type                                 |M               |V             |1             |
|     |                                         |9.8                                          |                |              |              |
|     |Service type                             |Service type                                 |M               |V             |1/2           |
|     |                                         |9.9.3.27                                     |                |              |              |
|     |NAS key set identifier                   |NAS key set identifier                       |M               |V             |1/2           |
|     |                                         |9.9.3.21                                     |                |              |              |
|     |M-TMSI                                   |Mobile identity                              |M               |LV            |6             |
|     |                                         |9.9.2.3                                      |                |              |              |
|B-   |CSFB response                            |CSFB response                                |C               |TV            |1             |
|     |                                         |9.9.3.5                                      |                |              |              |
|57   |EPS bearer context status                |EPS bearer context status                    |O               |TLV           |4             |
|     |                                         |9.9.2.1                                      |                |              |              |
|D-   |Device properties                        |Device properties                            |O               |TV            |1             |
|     |                                         |9.9.2.0A                                     |                |              |              |



8.2.15.2	CSFB response

The UE shall include this IE only if the Service type information element indicates "mobile terminating CS fallback or 1xCS fallback".

  NOTE:	The UE does not include this IE for mobile terminating 1xCS fallback.


8.2.15.3	EPS bearer context status

This IE shall be included if the UE wants to indicate the EPS bearer contexts that are active within the UE.


8.2.15.4	Device properties

The UE shall include this IE if the UE is configured for NAS signalling low priority.


8.2.16	GUTI reallocation command


8.2.16.1	Message definition

This message is sent by the network to the UE to reallocate a GUTI and optionally to provide a new TAI list or a new DCN-ID or both. See table 8.2.16.1.

  Message type:	GUTI REALLOCATION COMMAND

  Significance:	dual

  Direction:	network to UE

Table 8.2.16.1: GUTI REALLOCATION COMMAND message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |GUTI reallocation command message        |Message type                                 |M               |V           |1           |
|       |identity                                 |9.8                                          |                |            |            |
|       |GUTI                                     |EPS mobile identity                          |M               |LV          |12          |
|       |                                         |9.9.3.12                                     |                |            |            |
|54     |TAI list                                 |Tracking area identity list                  |O               |TLV         |8-98        |
|       |                                         |9.9.3.33                                     |                |            |            |
|65     |DCN-ID                                   |DCN-ID                                       |O               |TLV         |4           |
|       |                                         |9.9.3.48                                     |                |            |            |



8.2.16.2	TAI list

This IE may be included to assign a TAI list to the UE.


8.2.16.3	DCN-ID

This IE may be included to assign a new DCN-ID to the UE.


8.2.17	GUTI reallocation complete

This message is sent by the UE to the network to indicate that reallocation of a GUTI has taken place. See table 8.2.17.1.

  Message type:	GUTI REALLOCATION COMPLETE

  Significance:	dual

  Direction:	UE to network

Table 8.2.17.1: GUTI REALLOCATION COMPLETE message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |GUTI reallocation complete message       |Message type                                 |M               |V           |1           |
|       |identity                                 |9.8                                          |                |            |            |



8.2.18	Identity request

This message is sent by the network to the UE to request the UE to provide the specified identity. See table 8.2.18.1.

  Message type:	IDENTITY REQUEST

  Significance:	dual

  Direction:	network to UE

Table 8.2.18.1: IDENTITY REQUEST message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |Identity request message identity        |Message type                                 |M               |V           |1           |
|       |                                         |9.8                                          |                |            |            |
|       |Identity type                            |Identity type 2                              |M               |V           |1/2         |
|       |                                         |9.9.3.17                                     |                |            |            |
|       |Spare half octet                         |Spare half octet                             |M               |V           |1/2         |
|       |                                         |9.9.2.9                                      |                |            |            |



8.2.19	Identity response

This message is sent by the UE to the network in response to an IDENTITY REQUEST message and provides the requested identity. See table 8.2.19.1.

  Message type:	IDENTITY RESPONSE

  Significance:	dual

  Direction:	UE to network

Table 8.2.19.1: IDENTITY RESPONSE message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |Identity response message                |Message type                                 |M               |V           |1           |
|       |                                         |9.8                                          |                |            |            |
|       |Mobile identity                          |Mobile identity                              |M               |LV          |4-10        |
|       |                                         |9.9.2.3                                      |                |            |            |



8.2.20	Security mode command


8.2.20.1	Message definition

This message is sent by the network to the UE to establish NAS signalling security. See table 8.2.20.1.

  Message type:	SECURITY MODE COMMAND

  Significance:	dual

  Direction:	network to UE

Table 8.2.20.1: SECURITY MODE COMMAND message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |Security mode command message identity   |Message type                                 |M               |V           |1           |
|       |                                         |9.8                                          |                |            |            |
|       |Selected NAS security algorithms         |NAS security algorithms                      |M               |V           |1           |
|       |                                         |9.9.3.23                                     |                |            |            |
|       |NAS key set identifier                   |NAS key set identifier                       |M               |V           |1/2         |
|       |                                         |9.9.3.21                                     |                |            |            |
|       |Spare half octet                         |Spare half octet                             |M               |V           |1/2         |
|       |                                         |9.9.2.9                                      |                |            |            |
|       |Replayed UE security capabilities        |UE security capability                       |M               |LV          |3-6         |
|       |                                         |9.9.3.36                                     |                |            |            |
|C-     |IMEISV request                           |IMEISV request                               |O               |TV          |1           |
|       |                                         |9.9.3.18                                     |                |            |            |
|55     |Replayed nonceUE                         |Nonce                                        |O               |TV          |5           |
|       |                                         |9.9.3.25                                     |                |            |            |
|56     |NonceMME                                 |Nonce                                        |O               |TV          |5           |
|       |                                         |9.9.3.25                                     |                |            |            |
|4F     |HashMME                                  |HashMME                                      |O               |TLV         |10          |
|       |                                         |9.9.3.50                                     |                |            |            |
|6F     |Replayed UE additional security          |UE additional security capability            |O               |TLV         |6           |
|       |capability                               |9.9.3.53                                     |                |            |            |



8.2.20.2	IMEISV request

The MME may include this information element to request the UE to send its IMEISV with the corresponding SECURITY MODE COMPLETE message.


8.2.20.3	Replayed nonceUE

The MME may include this information element to indicate to the UE to use the replayed nonceUE.


8.2.20.4	NonceMME

The MME may include this information element to indicate to the UE to use the nonceMME.


8.2.20.5	HashMME

The MME shall include this information element when the MME is initiating a SECURITY MODE COMMAND during an attach or tracking area updating procedure and the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message was received without integrity protection or did not successfully pass the integrity check at the MME.


8.2.20.6	Replayed UE additional security capability

The MME shall include this IE if the MME supports handling of UE additional security capabilities, the MME is initiating a SECURITY MODE COMMAND during an attach or tracking area updating procedure and the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message included a UE additional security capability IE.


8.2.21	Security mode complete


8.2.21.1	Message definition

This message is sent by the UE to the network in response to a SECURITY MODE COMMAND message. See table 8.2.21.1.

  Message type:	SECURITY MODE COMPLETE

  Significance:	dual

  Direction:	UE to network

Table 8.2.21.1: SECURITY MODE COMPLETE message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |Security mode complete message identity  |Message type                                 |M               |V           |1           |
|       |                                         |9.8                                          |                |            |            |
|23     |IMEISV                                   |Mobile identity                              |O               |TLV         |11          |
|       |                                         |9.9.2.3                                      |                |            |            |
|79     |Replayed NAS message container           |Replayed NAS message container               |O               |TLV-E       |3-n         |
|       |                                         |9.9.3.51                                     |                |            |            |



8.2.21.2	IMEISV

The UE shall include this information element, if the IMEISV was requested within the corresponding SECURITY MODE COMMAND message.


8.2.21.3	Replayed NAS message container

The UE shall include this information element, if during an ongoing attach or tracking area updating procedure, the MME included HASHMME in the SECURITY MODE COMMAND message and HASHMME has a different value from the hash value locally calculated at the UE as described in 3GPP TS 33.401 [19].


8.2.22	Security mode reject

This message is sent by the UE to the network to indicate that the corresponding security mode command has been rejected. See table 8.2.22.1.

  Message type:	SECURITY MODE REJECT

  Significance:	dual

  Direction:	UE to network

Table 8.2.22.1: SECURITY MODE REJECT message content

|IEI    |Information Element                      |Type/Reference                                |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                        |M               |V           |1/2         |
|       |                                         |9.2                                           |                |            |            |
|       |Security header type                     |Security header type                          |M               |V           |1/2         |
|       |                                         |9.3.1                                         |                |            |            |
|       |Security mode reject message identity    |Message type                                  |M               |V           |1           |
|       |                                         |9.8                                           |                |            |            |
|       |EMM cause                                |EMM cause                                     |M               |V           |1           |
|       |                                         |9.9.3.9                                       |                |            |            |



8.2.23	Security protected NAS message

This message is sent by the UE or the network to transfer a NAS message together with the sequence number and the message authentication code protecting the message. See table 8.2.23.1.

  Message type:	SECURITY PROTECTED NAS MESSAGE

  Significance:	dual

  Direction:	both

Table 8.2.23.1: SECURITY PROTECTED NAS MESSAGE message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |Message authentication code              |Message authentication code                  |M               |V           |4           |
|       |                                         |9.5                                          |                |            |            |
|       |Sequence number                          |Sequence number                              |M               |V           |1           |
|       |                                         |9.6                                          |                |            |            |
|       |NAS message                              |NAS message                                  |M               |V           |1-n         |
|       |                                         |9.7                                          |                |            |            |



8.2.24	Service reject


8.2.24.1	Message definition

This message is sent by the network to the UE in order to reject the service request procedure. See table 8.2.24.1.

  Message type:	SERVICE REJECT

  Significance:	dual

  Direction:	network to UE

Table 8.2.24.1: SERVICE REJECT message content

|IEI  |Information Element                      |Type/Reference                               |Presence        |Format        |Length        |
|     |Protocol discriminator                   |Protocol discriminator                       |M               |V             |1/2           |
|     |                                         |9.2                                          |                |              |              |
|     |Security header type                     |Security header type                         |M               |V             |1/2           |
|     |                                         |9.3.1                                        |                |              |              |
|     |Service reject message identity          |Message type                                 |M               |V             |1             |
|     |                                         |9.8                                          |                |              |              |
|     |EMM cause                                |EMM cause                                    |M               |V             |1             |
|     |                                         |9.9.3.9                                      |                |              |              |
|5B   |T3442 value                              |GPRS timer                                   |C               |TV            |2             |
|     |                                         |9.9.3.16                                     |                |              |              |
|5F   |T3346 value                              |GPRS timer 2                                 |O               |TLV           |3             |
|     |                                         |9.9.3.16A                                    |                |              |              |
|6B   |T3448 value                              |GPRS timer 2                                 |O               |TLV           |3             |
|     |                                         |9.9.3.16A                                    |                |              |              |



8.2.24.2	T3442 value

The MME shall include this IE when the EMM cause value is #39 "CS service temporarily not available".


8.2.24.3	T3346 value

The MME may include this IE when the general NAS level mobility management congestion control is active.


8.2.24.4	T3448 value

The network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.


8.2.25	Service request

This message is sent by the UE to the network to request the establishment of a NAS signalling connection and of the radio and S1 bearers. Its structure does not follow the structure of a standard layer 3 message. See table 8.2.25.1.

  Message type:	SERVICE REQUEST

  Significance:	dual

  Direction:	UE to network

Table 8.2.25.1: SERVICE REQUEST message content

|IEI  |Information Element                      |Type/Reference                               |Presence        |Format        |Length        |
|     |Protocol discriminator                   |Protocol discriminator                       |M               |V             |1/2           |
|     |                                         |9.2                                          |                |              |              |
|     |Security header type                     |Security header type                         |M               |V             |1/2           |
|     |                                         |9.3.1                                        |                |              |              |
|     |KSI and sequence number                  |KSI and sequence number                      |M               |V             |1             |
|     |                                         |9.9.3.19                                     |                |              |              |
|     |Message authentication code (short)      |Short MAC                                    |M               |V             |2             |
|     |                                         |9.9.3.28                                     |                |              |              |



8.2.26	Tracking area update accept


8.2.26.1	Message definition

This message is sent by the network to the UE to provide the UE with EPS mobility management related data in response to a tracking area update request message. See table 8.2.26.1.

  Message type:	TRACKING AREA UPDATE ACCEPT

  Significance:	dual

  Direction:	network to UE

Table 8.2.26.1: TRACKING AREA UPDATE ACCEPT message content

|IEI    |Information Element                |Type/Reference                         |Presence       |Format     |Length     |
|       |Protocol discriminator             |Protocol discriminator                 |M              |V          |1/2        |
|       |                                   |9.2                                    |               |           |           |
|       |Security header type               |Security header type                   |M              |V          |1/2        |
|       |                                   |9.3.1                                  |               |           |           |
|       |Tracking area update accept message|Message type                           |M              |V          |1          |
|       |identity                           |9.8                                    |               |           |           |
|       |EPS update result                  |EPS update result                      |M              |V          |1/2        |
|       |                                   |9.9.3.13                               |               |           |           |
|       |Spare half octet                   |Spare half octet                       |M              |V          |1/2        |
|       |                                   |9.9.2.9                                |               |           |           |
|5A     |T3412 value                        |GPRS timer                             |O              |TV         |2          |
|       |                                   |9.9.3.16                               |               |           |           |
|50     |GUTI                               |EPS mobile identity                    |O              |TLV        |13         |
|       |                                   |9.9.3.12                               |               |           |           |
|54     |TAI list                           |Tracking area identity list            |O              |TLV        |8-98       |
|       |                                   |9.9.3.33                               |               |           |           |
|57     |EPS bearer context status          |EPS bearer context status              |O              |TLV        |4          |
|       |                                   |9.9.2.1                                |               |           |           |
|13     |Location area identification       |Location area identification           |O              |TV         |6          |
|       |                                   |9.9.2.2                                |               |           |           |
|23     |MS identity                        |Mobile identity                        |O              |TLV        |7-10       |
|       |                                   |9.9.2.3                                |               |           |           |
|53     |EMM cause                          |EMM cause                              |O              |TV         |2          |
|       |                                   |9.9.3.9                                |               |           |           |
|17     |T3402 value                        |GPRS timer                             |O              |TV         |2          |
|       |                                   |9.9.3.16                               |               |           |           |
|59     |T3423 value                        |GPRS timer                             |O              |TV         |2          |
|       |                                   |9.9.3.16                               |               |           |           |
|4A     |Equivalent PLMNs                   |PLMN list                              |O              |TLV        |5-47       |
|       |                                   |9.9.2.8                                |               |           |           |
|34     |Emergency number list              |Emergency number list                  |O              |TLV        |5-50       |
|       |                                   |9.9.3.37                               |               |           |           |
|64     |EPS network feature support        |EPS network feature support            |O              |TLV        |3-4        |
|       |                                   |9.9.3.12A                              |               |           |           |
|F-     |Additional update result           |Additional update result               |O              |TV         |1          |
|       |                                   |9.9.3.0A                               |               |           |           |
|5E     |T3412 extended value               |GPRS timer 3                           |O              |TLV        |3          |
|       |                                   |9.9.3.16B                              |               |           |           |
|6A     |T3324 value                        |GPRS timer 2                           |O              |TLV        |3          |
|       |                                   |9.9.3.16A                              |               |           |           |
|6E     |Extended DRX parameters            |Extended DRX parameters                |O              |TLV        |3          |
|       |                                   |9.9.3.46                               |               |           |           |
|68     |Header compression configuration   |Header compression configuration status|O              |TLV        |4          |
|       |status                             |9.9.4.27                               |               |           |           |
|65     |DCN-ID                             |DCN-ID                                 |O              |TLV        |4          |
|       |                                   |9.9.3.48                               |               |           |           |
|E-     |SMS services status                |SMS services status                    |O              |TV         |1          |
|       |                                   |9.9.3.4B                               |               |           |           |
|D-     |Non-3GPP NW policies               |Non-3GPP NW provided policies          |O              |TV         |1          |
|       |                                   |9.9.3.49                               |               |           |           |
|6B     |T3448 value                        |GPRS timer 2                           |O              |TLV        |3          |
|       |                                   |9.9.3.16A                              |               |           |           |
|C-     |Network policy                     |Network policy                         |O              |TV         |1          |
|       |                                   |9.9.3.52                               |               |           |           |
|6C     |T3447 value                        |GPRS timer 3                           |O              |TLV        |3          |
|       |                                   |9.9.3.16B                              |               |           |           |
|7A     |Extended emergency number list     |Extended emergency number list         |O              |TLV-E      |7-65538    |
|       |                                   |9.9.3.37A                              |               |           |           |
|7C     |Ciphering key data                 |Ciphering key data                     |O              |TLV-E      |35-2291    |
|       |                                   |9.9.3.56                               |               |           |           |



8.2.26.2	T3412 value

The MME shall include this IE during normal and combined tracking area updating procedure, and may include this IE during periodic tracking area updating procedure.

The MME shall include this IE if it includes the T3412 extended value IE.


8.2.26.3	GUTI

This IE may be included to assign a GUTI to a UE.


8.2.26.4	TAI list

This IE may be included to assign a TAI list to a UE.


8.2.26.5	EPS bearer context status

This IE shall be included if the network wants to indicate the EPS bearer contexts that are active for the UE in the network.


8.2.26.6	Location area identification

This IE may be included to assign a new location area identification to a UE during a combined TA/LA update.


8.2.26.7	MS identity

This IE may be included to assign or unassign a new TMSI to a UE during a combined TA/LA update.


8.2.26.8	EMM cause

This IE shall be included if the combined tracking area updating procedure was successful for EPS services only.


8.2.26.9	T3402 value

This IE may be included to indicate a value for timer T3402.


8.2.26.10	T3423 value

This IE may be included to indicate a value for timer T3423.

If this IE is not included, the UE shall use the default value.


8.2.26.11	Equivalent PLMNs

This IE may be included in order to assign a new equivalent PLMNs list to a UE.


8.2.26.12	Emergency number list

This IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers valid within the same country as in the PLMN from which this IE is received.


8.2.26.12A	Extended emergency number list

This IE may be sent by the network. If this IE is sent, the contents of this IE indicates a list of emergency numbers (with URN information) valid within the same country as in the PLMN from which this IE is received or valid only in the PLMN from which this IE is received.


8.2.26.13	EPS network feature support

The network may include this IE to inform the UE of the support of certain features. If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero, except for the S1-u data transfer (S1-U data) (octet 4, bit 2).

  NOTE: In this exceptional case, the UE deems that the network supports S1-u data transfer.


8.2.26.14	Additional update result

The network may include this IE to provide the UE with additional information about the result of:

  -	a combined tracking area updating procedure if the procedure was successful for EPS services and non-EPS services, or for EPS services and "SMS only"; or

  -	a normal tracking area updating procedure requested for CIoT EPS optimizations if the procedure was successful for EPS services and "SMS only".


8.2.26.15	T3412 extended value

The network may include this IE to provide the UE with a longer periodic tracking area update timer.


8.2.26.16	T3324 value

The network shall include the T3324 value IE if:

  -	the UE included the T3324 value IE in the TRACKING AREA UPDATE REQUEST message; and

  -	the network supports PSM and accepts the use of PSM.


8.2.26.17	Extended DRX parameters

The network shall include the Extended DRX parameters IE if:

  -	the UE included the Extended DRX parameters IE in the TRACKING AREA UPDATE REQUEST message; and

  -	the network supports eDRX and accepts the use of eDRX.


8.2.26.18	DCN-ID

This IE is included in the message when the network wishes to provide a DCN-ID to the UE.


8.2.26.19	SMS services status

This IE may be included when a normal tracking area updating procedure for EPS services and "SMS only" was successful for EPS services only.


8.2.26.20	Non-3GPP NW provided policies

This IE is included if the network needs to indicate whether emergency numbers provided via non-3GPP access can be used to initiate UE detected emergency calls (see 3GPP TS 24.302 [48]). If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.


8.2.26.21	T3448 value

The network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.


8.2.26.22	Network policy

This IE is included if the network needs to indicate network policy information to the UE, If this IE is not included then the UE shall interpret this as a receipt of an information element with all bits of the value part coded as zero.


8.2.26.23	T3447 value

The network may include T3447 value IE if:

  -	the UE has indicated support for service gap control in the TRACKING AREA UPDATE REQUEST messages; and

  -	the EMM context contains a service gap time value.


8.2.26.24	Ciphering key data

This IE is included if the network needs to send ciphering key data to the UE for ciphered broadcast assistance data.


8.2.27	Tracking area update complete

This message shall be sent by the UE to the network in response to a tracking area update accept message if a GUTI has been changed or a new TMSI has been assigned. See table 8.2.27.1.

  Message type:	TRACKING AREA UPDATE COMPLETE

  Significance:	dual

  Direction:	UE to network

Table 8.2.27.1: TRACKING AREA UPDATE COMPLETE message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |Tracking area update complete message    |Message type                                 |M               |V           |1           |
|       |identity                                 |9.8                                          |                |            |            |



8.2.28	Tracking area update reject


8.2.28.1	Message definition

This message is sent by the network to the UE in order to reject the tracking area updating procedure. See table 8.2.28.1.

  Message type:	TRACKING AREA UPDATE REJECT

  Significance:	dual

  Direction:	network to UE

Table 8.2.28.1: TRACKING AREA UPDATE REJECT message content

|IEI  |Information Element                      |Type/Reference                               |Presence        |Format        |Length        |
|     |Protocol discriminator                   |Protocol discriminator                       |M               |V             |1/2           |
|     |                                         |9.2                                          |                |              |              |
|     |Security header type                     |Security header type                         |M               |V             |1/2           |
|     |                                         |9.3.1                                        |                |              |              |
|     |Tracking area update reject              |Message type                                 |M               |V             |1             |
|     |message identity                         |9.8                                          |                |              |              |
|     |EMM cause                                |EMM cause                                    |M               |V             |1             |
|     |                                         |9.9.3.9                                      |                |              |              |
|5F   |T3346 value                              |GPRS timer 2                                 |O               |TLV           |3             |
|     |                                         |9.9.3.16A                                    |                |              |              |
|A-   |Extended EMM cause                       |Extended EMM cause                           |O               |TV            |1             |
|     |                                         |9.9.3.26A                                    |                |              |              |



8.2.28.2	T3346 value

The MME may include this IE when the general NAS level mobility management congestion control is active.


8.2.28.3	Extended EMM cause

This IE may be included by the network to indicate additional information associated with the EMM cause.


8.2.29	Tracking area update request


8.2.29.1	Message definition

The purposes of sending the tracking area update request by the UE to the network are described in subclause 5.5.3.1. See table 8.2.29.1.

  Message type:	TRACKING AREA UPDATE REQUEST

  Significance:	dual

  Direction:	UE to network

Table 8.2.29.1: TRACKING AREA UPDATE REQUEST message content

|IEI    |Information Element                |Type/Reference                         |Presence       |Format     |Length     |
|       |Protocol discriminator             |Protocol discriminator                 |M              |V          |1/2        |
|       |                                   |9.2                                    |               |           |           |
|       |Security header type               |Security header type                   |M              |V          |1/2        |
|       |                                   |9.3.1                                  |               |           |           |
|       |Tracking area update request       |Message type                           |M              |V          |1          |
|       |message identity                   |9.8                                    |               |           |           |
|       |EPS update type                    |EPS update type                        |M              |V          |1/2        |
|       |                                   |9.9.3.14                               |               |           |           |
|       |NAS key set identifier             |NAS key set identifier                 |M              |V          |1/2        |
|       |                                   |9.9.3.21                               |               |           |           |
|       |Old GUTI                           |EPS mobile identity                    |M              |LV         |12         |
|       |                                   |9.9.3.12                               |               |           |           |
|B-     |Non-current native NAS key set     |NAS key set identifier                 |O              |TV         |1          |
|       |identifier                         |9.9.3.21                               |               |           |           |
|8-     |GPRS ciphering key sequence number |Ciphering key sequence number          |O              |TV         |1          |
|       |                                   |9.9.3.4a                               |               |           |           |
|19     |Old P-TMSI signature               |P-TMSI signature                       |O              |TV         |4          |
|       |                                   |9.9.3.26                               |               |           |           |
|50     |Additional GUTI                    |EPS mobile identity                    |O              |TLV        |13         |
|       |                                   |9.9.3.12                               |               |           |           |
|55     |NonceUE                            |Nonce                                  |O              |TV         |5          |
|       |                                   |9.9.3.25                               |               |           |           |
|58     |UE network capability              |UE network capability                  |O              |TLV        |4-15       |
|       |                                   |9.9.3.34                               |               |           |           |
|52     |Last visited registered TAI        |Tracking area identity                 |O              |TV         |6          |
|       |                                   |9.9.3.32                               |               |           |           |
|5C     |DRX parameter                      |DRX parameter                          |O              |TV         |3          |
|       |                                   |9.9.3.8                                |               |           |           |
|A-     |UE radio capability information    |UE radio capability information update |O              |TV         |1          |
|       |update needed                      |needed                                 |               |           |           |
|       |                                   |9.9.3.35                               |               |           |           |
|57     |EPS bearer context status          |EPS bearer context status              |O              |TLV        |4          |
|       |                                   |9.9.2.1                                |               |           |           |
|31     |MS network capability              |MS network capability                  |O              |TLV        |4-10       |
|       |                                   |9.9.3.20                               |               |           |           |
|13     |Old location area identification   |Location area identification           |O              |TV         |6          |
|       |                                   |9.9.2.2                                |               |           |           |
|9-     |TMSI status                        |TMSI status                            |O              |TV         |1          |
|       |                                   |9.9.3.31                               |               |           |           |
|11     |Mobile station classmark 2         |Mobile station classmark 2             |O              |TLV        |5          |
|       |                                   |9.9.2.4                                |               |           |           |
|20     |Mobile station classmark 3         |Mobile station classmark 3             |O              |TLV        |2-34       |
|       |                                   |9.9.2.5                                |               |           |           |
|40     |Supported Codecs                   |Supported Codec List                   |O              |TLV        |5-n        |
|       |                                   |9.9.2.10                               |               |           |           |
|F-     |Additional update type             |Additional update type                 |O              |TV         |1          |
|       |                                   |9.9.3.0B                               |               |           |           |
|5D     |Voice domain preference and UE's   |Voice domain preference and UE's usage |O              |TLV        |3          |
|       |usage setting                      |setting                                |               |           |           |
|       |                                   |9.9.3.44                               |               |           |           |
|E-     |Old GUTI type                      |GUTI type                              |O              |TV         |1          |
|       |                                   |9.9.3.45                               |               |           |           |
|D-     |Device properties                  |Device properties                      |O              |TV         |1          |
|       |                                   |9.9.2.0A                               |               |           |           |
|C-     |MS network feature support         |MS network feature support             |O              |TV         |1          |
|       |                                   |9.9.3.20A                              |               |           |           |
|10     |TMSI based NRI container           |Network resource identifier container  |O              |TLV        |4          |
|       |                                   |9.9.3.24A                              |               |           |           |
|6A     |T3324 value                        |GPRS timer 2                           |O              |TLV        |3          |
|       |                                   |9.9.3.16                               |               |           |           |
|5E     |T3412 extended value               |GPRS timer 3                           |O              |TLV        |3          |
|       |                                   |9.9.3.16B                              |               |           |           |
|6E     |Extended DRX parameters            |Extended DRX parameters                |O              |TLV        |3          |
|       |                                   |9.9.3.46                               |               |           |           |
|6F     |UE additional security capability  |UE additional security capability      |O              |TLV        |6          |
|       |                                   |9.9.3.53                               |               |           |           |
|6D     |UE status                          |UE status                              |O              |TLV        |3          |
|       |                                   |9.9.3.54                               |               |           |           |
|17     |Additional information requested   |Additional information requested       |O              |TV         |2          |
|       |                                   |9.9.3.55                               |               |           |           |



8.2.29.2	Non-current native NAS key set identifier

The UE shall include this IE if the UE has a valid non-current native EPS security context when the UE performs an A/Gb mode or Iu mode or N1 mode to S1 mode inter-system change in EMM-CONNECTED mode and the UE uses a mapped EPS security context to protect the TRACKING AREA UPDATE REQUEST message.


8.2.29.3	GPRS ciphering key sequence number

The UE shall include this IE if the UE performs an A/Gb mode or Iu mode to S1 mode inter-system change in EMM-IDLE mode and the TIN indicates "P-TMSI".


8.2.29.4	Old P-TMSI signature

The UE shall include this IE if the TIN indicates "P-TMSI" and the UE holds a valid P-TMSI signature, P-TMSI and RAI.


8.2.29.5	Additional GUTI

The UE shall include this IE if the TIN indicates "P-TMSI" and the UE holds a valid GUTI, P-TMSI and RAI.


8.2.29.6	NonceUE

This IE is included if the UE performs an A/Gb mode or Iu mode to S1 mode inter-system change in idle mode and the TIN is set to "P-TMSI".


8.2.29.7	UE network capability

The UE shall include this IE, unless the UE performs a periodic tracking area updating procedure.


8.2.29.8	Last visited registered TAI

This IE shall be included if the UE holds a valid last visited registered TAI.


8.2.29.9	DRX parameter

This IE is included by the UE to indicate a change of UE specific DRX parameters to the network.


8.2.29.10	UE radio capability information update needed

The UE shall include this IE if the UE radio capability information in the network needs to be updated.


8.2.29.11	EPS bearer context status

This IE shall be included if the UE wants to indicate the EPS bearer contexts that are active within the UE.


8.2.29.12	MS network capability

A UE supporting A/Gb mode or Iu mode shall include this IE, unless the UE performs a periodic tracking area updating procedure.


8.2.29.13	Old location area identification

The UE shall include this IE during a combined tracking area updating procedure if it has a valid location area identification.


8.2.29.14	TMSI status

The UE shall include this IE during a combined tracking area updating procedure if it has no valid TMSI available.


8.2.29.15	Mobile station classmark 2

This IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN (see 3GPP TS 23.216 [8]), or if the UE is performing a combined tracking area updating procedure.


8.2.29.16	Mobile station classmark 3

This IE shall be included if the UE supports SRVCC to GERAN.


8.2.29.17	Supported Codecs

This IE shall be included if the UE supports SRVCC to GERAN or UTRAN or supports vSRVCC to UTRAN to indicate its supported speech codecs for CS speech calls.


8.2.29.18	Additional update type

The UE shall include this IE if the UE requests "SMS only" or CIoT EPS optimizations, unless the UE performs a periodic tracking area updating procedure.


8.2.29.19	Voice domain preference and UE's usage setting

This IE shall be included in WB-S1 mode if the UE supports:

  -	CS fallback and SMS over SGs; or

  -	if the UE is configured to support IMS voice, but does not support 1xCS fallback.


8.2.29.20	Old GUTI type

The UE shall include this IE.


8.2.29.21	Device properties

This IE shall be included if the UE is configured for NAS signalling low priority.


8.2.29.22	MS network feature support

This IE shall be included if the UE supports extended periodic timer T3412.


8.2.29.23	TMSI based NRI container

The UE shall include this IE if it has a valid TMSI.


8.2.29.24	T3324 value

The UE may include this IE to request the use of PSM.


8.2.29.25	T3412 extended value

The UE may include this IE to request a particular T3412 value if the T3324 value IE is included.


8.2.29.26	Extended DRX parameters

The UE may include this IE to request the use of eDRX.


8.2.29.27	UE additional security capability

The UE shall include this IE if the UE supports dual connectivity with NR or if the UE supports N1 mode.


8.2.29.28	UE status

This IE shall be included if the UE wants to provide the network with information concerning aspects of the current UE registration status which is used for interworking with 5GS.


8.2.29.29	Additional information requested

The UE shall include this IE if the UE supports ciphered broadcast assistance data and the UE needs to obtain new ciphering keys for ciphered broadcast assistance data.


8.2.30	Uplink NAS Transport

This message is sent by the UE to the network in order to carry an SMS message in encapsulated format. See table 8.2.30.1.

  Message type:	UPLINK NAS TRANSPORT

  Significance:	dual

  Direction:	UE to network

Table 8.2.30.1: UPLINK NAS TRANSPORT message content

|IEI  |Information Element                      |Type/Reference                               |Presence        |Format        |Length        |
|     |Protocol discriminator                   |Protocol discriminator                       |M               |V             |1/2           |
|     |                                         |9.2                                          |                |              |              |
|     |Security header type                     |Security header type                         |M               |V             |1/2           |
|     |                                         |9.3.1                                        |                |              |              |
|     |Uplink NAS transport message identity    |Message type                                 |M               |V             |1             |
|     |                                         |9.8                                          |                |              |              |
|     |NAS message container                    |NAS message container                        |M               |LV            |3-252         |
|     |                                         |9.9.3.22                                     |                |              |              |



8.2.31	Downlink generic NAS transport


8.2.31.1	Message definition

This message is sent by the network to the UE in order to carry an application message in encapsulated format. See table 8.2.31.1.

  Message type:	DOWNLINK GENERIC NAS TRANSPORT

  Significance:	dual

  Direction:	network to UE

Table 8.2.31.1: DOWNLINK GENERIC NAS TRANSPORT message content

|IEI  |Information Element                      |Type/Reference                               |Presence        |Format        |Length        |
|     |Protocol discriminator                   |Protocol discriminator                       |M               |V             |1/2           |
|     |                                         |9.2                                          |                |              |              |
|     |Security header type                     |Security header type                         |M               |V             |1/2           |
|     |                                         |9.3.1                                        |                |              |              |
|     |Downlink generic NAS transport message   |Message type                                 |M               |V             |1             |
|     |identity                                 |9.8                                          |                |              |              |
|     |Generic message container type           |Generic message container type               |M               |V             |1             |
|     |                                         |9.9.3.42                                     |                |              |              |
|     |Generic message container                |Generic message container                    |M               |LV-E          |3-n           |
|     |                                         |9.9.3.43                                     |                |              |              |
|65   |Additional information                   |Additional information                       |O               |TLV           |3-n           |
|     |                                         |9.9.2.0                                      |                |              |              |



8.2.31.2	Additional information

The MME may include this information element if the application wants to send any additional information.


8.2.32	Uplink generic NAS transport


8.2.32.1	Message definition

This message is sent by the UE to the network in order to carry an application protocol message in encapsulated format. See table 8.2.32.1.

  Message type:	UPLINK GENERIC NAS TRANSPORT

  Significance:	dual

  Direction:	UE to network

Table 8.2.32.1: UPLINK GENERIC NAS TRANSPORT message content

|IEI  |Information Element                      |Type/Reference                               |Presence        |Format        |Length        |
|     |Protocol discriminator                   |Protocol discriminator                       |M               |V             |1/2           |
|     |                                         |9.2                                          |                |              |              |
|     |Security header type                     |Security header type                         |M               |V             |1/2           |
|     |                                         |9.3.1                                        |                |              |              |
|     |Uplink generic NAS transport message     |Message type                                 |M               |V             |1             |
|     |identity                                 |9.8                                          |                |              |              |
|     |Generic message container type           |Generic message container type               |M               |V             |1             |
|     |                                         |9.9.3.42                                     |                |              |              |
|     |Generic message container                |Generic message container                    |M               |LV-E          |3-n           |
|     |                                         |9.9.3.43                                     |                |              |              |
|65   |Additional information                   |Additional information                       |O               |TLV           |3-n           |
|     |                                         |9.9.2.0                                      |                |              |              |



8.2.32.2	Additional information

The UE may include this information element if the application wants to send any additional information.


8.2.33	CONTROL PLANE SERVICE REQUEST


8.2.33.1	Message definition

This message is sent by the UE to the network when the UE is using EPS services with control plane CIoT EPS optimization. See table 8.2.33.1.

  Message type:	CONTROL PLANE SERVICE REQUEST

  Significance:	dual

  Direction:	UE to network

Table 8.2.33.1: CONTROL PLANE SERVICE REQUEST message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format        |Length        |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V             |1/2           |
|       |                                         |9.2                                          |                |              |              |
|       |Security header type                     |Security header type                         |M               |V             |1/2           |
|       |                                         |9.3.1                                        |                |              |              |
|       |Control plane service request message    |Message type                                 |M               |V             |1             |
|       |identity                                 |9.8                                          |                |              |              |
|       |Control plane service type               |Control plane service type                   |M               |V             |1/2           |
|       |                                         |9.9.3.47                                     |                |              |              |
|       |NAS key set identifier                   |NAS key set identifier                       |M               |V             |1/2           |
|       |                                         |9.9.3.21                                     |                |              |              |
|78     |ESM message container                    |ESM message container                        |O               |TLV-E         |3-n           |
|       |                                         |9.9.3.15                                     |                |              |              |
|67     |NAS message container                    |NAS message container                        |O               |TLV           |4-253         |
|       |                                         |9.9.3.22                                     |                |              |              |
|57     |EPS bearer context status                |EPS bearer context status                    |O               |TLV           |4             |
|       |                                         |9.9.2.1                                      |                |              |              |
|D-     |Device properties                        |Device properties                            |O               |TV            |1             |
|       |                                         |9.9.2.0A                                     |                |              |              |



8.2.33.2	ESM message container

The UE shall include this IE, if it wants to send an ESM message to the network.


8.2.33.3	NAS message container

The UE shall include this IE, if it is in EMM-IDLE mode and has pending SMS messages to be sent.


8.2.33.4	EPS bearer context status

The UE shall include this IE, if it wants to indicate the EPS bearer contexts that are active within the UE.


8.2.33.5	Device properties

The UE shall include this IE if the UE is configured for NAS signalling low priority.


8.2.34	Service Accept


8.2.34.1	Message definition

This message is sent by the network in response to the SERVICE REQUEST message, the EXTENDED SERVICE REQUEST message or the CONTROL PLANE SERVICE REQUEST message. See table 8.2.34.1.

  Message type:	SERVICE ACCEPT

  Significance:	dual

  Direction:	network to UE

Table 8.2.34.1: SERVICE ACCEPT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format      |Length      |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V           |1/2         |
|       |                                         |9.2                                          |                |            |            |
|       |Security header type                     |Security header type                         |M               |V           |1/2         |
|       |                                         |9.3.1                                        |                |            |            |
|       |Service accept message identity          |Message type                                 |M               |V           |1           |
|       |                                         |9.8                                          |                |            |            |
|57     |EPS bearer context status                |EPS bearer context status                    |O               |TLV         |4           |
|       |                                         |9.9.2.1                                      |                |            |            |
|6B     |T3448 value                              |GPRS timer 2                                 |O               |TLV         |3           |
|       |                                         |9.9.3.16A                                    |                |            |            |



8.2.34.2	EPS bearer context status

This IE shall be included if the network wants to indicate the EPS bearer contexts that are active for the UE in the network.


8.2.34.3	T3448 value

The network may include this IE if the congestion control for transport of user data via the control plane is active and the UE supports timer T3448.


8.3	EPS session management messages


8.3.1	Activate dedicated EPS bearer context accept


8.3.1.1	Message definition

This message is sent by the UE to the network to acknowledge activation of a dedicated EPS bearer context associated with the same PDN address(es) and APN as an already active EPS bearer context. See table 8.3.1.1.

  Message type:	ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT

  Significance:	dual

  Direction:	UE to network

Table 8.3.1.1: ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Activate dedicated EPS bearer context    |Message type                                 |M               |V               |1               |
|       |accept message identity                  |9.8                                          |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|33     |NBIFOM container                         |NBIFOM container                             |O               |TLV             |3-257           |
|       |                                         |9.9.4.19                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |



8.3.1.2	Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.1.3	NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


8.3.1.4	Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.2	Activate dedicated EPS bearer context reject


8.3.2.1	Message definition

This message is sent by UE to the network to reject activation of a dedicated EPS bearer context. See table 8.3.2.1.

  Message type:	ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT

  Significance:	dual

  Direction:	UE to network

Table 8.3.2.1: ACTIVATE DEDICATED EPS BEARER CONTEXT REJECT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Activate dedicated EPS bearer context    |Message type                                 |M               |V               |1               |
|       |reject message identity                  |9.8                                          |                |                |                |
|       |ESM cause                                |ESM cause                                    |M               |V               |1               |
|       |                                         |9.9.4.4                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|33     |NBIFOM container                         |NBIFOM container                             |O               |TLV             |3-257           |
|       |                                         |9.9.4.19                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |



8.3.2.2	Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.2.3	NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


8.3.2.4	Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.3	Activate dedicated EPS bearer context request


8.3.3.1	Message definition

This message is sent by the network to the UE to request activation of a dedicated EPS bearer context associated with the same PDN address(es) and APN as an already active default EPS bearer context. See table 8.3.3.1.

  Message type:	ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST

  Significance:	dual

  Direction:	network to UE

Table 8.3.3.1: ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Activate dedicated EPS bearer context    |Message type                                 |M               |V               |1               |
|       |request message identity                 |9.8                                          |                |                |                |
|       |Linked EPS bearer identity               |Linked EPS bearer identity                   |M               |V               |1/2             |
|       |                                         |9.9.4.6                                      |                |                |                |
|       |Spare half octet                         |Spare half octet                             |M               |V               |1/2             |
|       |                                         |9.9.2.9                                      |                |                |                |
|       |EPS QoS                                  |EPS quality of service                       |M               |LV              |2-14            |
|       |                                         |9.9.4.3                                      |                |                |                |
|       |TFT                                      |Traffic flow template                        |M               |LV              |2-256           |
|       |                                         |9.9.4.16                                     |                |                |                |
|5D     |Transaction identifier                   |Transaction identifier                       |O               |TLV             |3-4             |
|       |                                         |9.9.4.17                                     |                |                |                |
|30     |Negotiated QoS                           |Quality of service                           |O               |TLV             |14-22           |
|       |                                         |9.9.4.12                                     |                |                |                |
|32     |Negotiated LLC SAPI                      |LLC service access point identifier          |O               |TV              |2               |
|       |                                         |9.9.4.7                                      |                |                |                |
|8-     |Radio priority                           |Radio priority                               |O               |TV              |1               |
|       |                                         |9.9.4.13                                     |                |                |                |
|34     |Packet flow Identifier                   |Packet flow Identifier                       |O               |TLV             |3               |
|       |                                         |9.9.4.8                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|C-     |WLAN offload indication                  |WLAN offload acceptability                   |O               |TV              |1               |
|       |                                         |9.9.4.18                                     |                |                |                |
|33     |NBIFOM container                         |NBIFOM container                             |O               |TLV             |3-257           |
|       |                                         |9.9.4.19                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |
|5C     |Extended EPS QoS                         |Extended quality of service                  |O               |TLV             |12              |
|       |                                         |9.9.4.30                                     |                |                |                |



8.3.3.2	Transaction identifier

If the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include this IE


8.3.3.3	Negotiated QoS

If the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include the corresponding R99 QoS parameter values of a PDP context.


8.3.3.4	Negotiated LLC SAPI

If the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


8.3.3.5	Radio priority

If the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


8.3.3.6	Packet flow identifier

If the UE supports A/Gb mode and BSS packet flow procedures, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


8.3.3.7	Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.3.8	WLAN offload indication

This IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in subclause 9.9.4.18.


8.3.3.9	NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


8.3.3.10	Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.3.11	Extended EPS QoS

This IE shall be included in the message only if the network wishes to transmit the maximum and guaranteed bit rate values to the UE and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in subclause 9.9.4.3.


8.3.4	Activate default EPS bearer context accept


8.3.4.1	Message definition

This message is sent by the UE to the network to acknowledge activation of a default EPS bearer context. See table 8.3.4.1.

  Message type:	ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT

  Significance:	dual

  Direction:	UE to network

Table 8.3.4.1: ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Activate default EPS bearer context      |Message type                                 |M               |V               |1               |
|       |accept message identity                  |9.8                                          |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |



8.3.4.2	Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.4.3	Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.5	Activate default EPS bearer context reject


8.3.5.1	Message definition

This message is sent by UE to the network to reject activation of a default EPS bearer context. See table 8.3.5.1.

  Message type:	ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT

  Significance:	dual

  Direction:	UE to network

Table 8.3.5.1: ACTIVATE DEFAULT EPS BEARER CONTEXT REJECT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Activate default EPS bearer context      |Message type                                 |M               |V               |1               |
|       |reject message identity                  |9.8                                          |                |                |                |
|       |ESM cause                                |ESM cause                                    |M               |V               |1               |
|       |                                         |9.9.4.4                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |



8.3.5.2	Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.5.3	Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.6	Activate default EPS bearer context request


8.3.6.1	Message definition

This message is sent by the network to the UE to request activation of a default EPS bearer context. See table 8.3.6.1.

  Message type:	ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST

  Significance:	dual

  Direction:	network to UE

Table 8.3.6.1: ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Activate default EPS bearer context      |Message type                                 |M               |V               |1               |
|       |request message identity                 |9.8                                          |                |                |                |
|       |EPS QoS                                  |EPS quality of service                       |M               |LV              |2-14            |
|       |                                         |9.9.4.3                                      |                |                |                |
|       |Access point name                        |Access point name                            |M               |LV              |2-101           |
|       |                                         |9.9.4.1                                      |                |                |                |
|       |PDN address                              |PDN address                                  |M               |LV              |6-14            |
|       |                                         |9.9.4.9                                      |                |                |                |
|5D     |Transaction identifier                   |Transaction identifier                       |O               |TLV             |3-4             |
|       |                                         |9.9.4.17                                     |                |                |                |
|30     |Negotiated QoS                           |Quality of service                           |O               |TLV             |14-22           |
|       |                                         |9.9.4.12                                     |                |                |                |
|32     |Negotiated LLC SAPI                      |LLC service access point identifier          |O               |TV              |2               |
|       |                                         |9.9.4.7                                      |                |                |                |
|8-     |Radio priority                           |Radio priority                               |O               |TV              |1               |
|       |                                         |9.9.4.13                                     |                |                |                |
|34     |Packet flow Identifier                   |Packet flow Identifier                       |O               |TLV             |3               |
|       |                                         |9.9.4.8                                      |                |                |                |
|5E     |APN-AMBR                                 |APN aggregate maximum bit rate               |O               |TLV             |4-8             |
|       |                                         |9.9.4.2                                      |                |                |                |
|58     |ESM cause                                |ESM cause                                    |O               |TV              |2               |
|       |                                         |9.9.4.4                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|B-      |Connectivity type                        |Connectivity type                             |O               |TV              |1               |
|        |                                         |9.9.4.2A                                      |                |                |                |
|C-      |WLAN offload indication                  |WLAN offload acceptability                    |O               |TV              |1               |
|        |                                         |9.9.4.18                                      |                |                |                |
|33      |NBIFOM container                         |NBIFOM container                              |O               |TLV             |3-257           |
|        |                                         |9.9.4.19                                      |                |                |                |
|66      |Header compression configuration         |Header compression configuration              |O               |TLV             |5-257           |
|        |                                         |9.9.4.22                                      |                |                |                |
|9-      |Control plane only indication            |Control plane only indication                 |O               |TV              |1               |
|        |                                         |9.9.4.23                                      |                |                |                |
|7B      |Extended protocol configuration options  |Extended protocol configuration options       |O               |TLV-E           |4-65538         |
|        |                                         |9.9.4.26                                      |                |                |                |
|6E      |Serving PLMN rate control                |Serving PLMN rate control                     |O               |TLV             |4               |
|        |                                         |9.9.4.28                                      |                |                |                |
|5F      |Extended APN-AMBR                        |Extended APN aggregate maximum bit rate       |O               |TLV             |8               |
|        |                                         |9.9.4.29                                      |                |                |                |



8.3.6.2	Transaction identifier

If the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include this IE.


8.3.6.3	Negotiated QoS

If the UE supports A/Gb mode or Iu mode or both, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include the corresponding R99 QoS parameter values of a PDP context.


8.3.6.4	Negotiated LLC SAPI

If the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


8.3.6.5	Radio priority

If the UE supports A/Gb mode, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


8.3.6.6	Packet flow identifier

If the UE supports A/Gb mode and BSS packet flow procedures, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


8.3.6.7	APN-AMBR

This IE is included in the message when the network wishes to transmit the APN-AMBR to the UE for possible uplink policy enforcement.


8.3.6.8	ESM cause

The network shall include this IE, if the network allocated a PDN address of a PDN type which is different from the PDN type requested by the UE.


8.3.6.9	Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).

This IE shall be included if the network supports Local IP address in the traffic flow aggregate description and TFT filter, the PDN Type is different from Non-IP, and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.6.10	Connectivity type

The network shall include the Connectivity type IE if:

  -	the network is configured to indicate when a PDN connection is a LIPA PDN connection; and

  -	the present PDN connection is a LIPA PDN connection.


8.3.6.11	WLAN offload indication

This IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in subclause 9.9.4.18.


8.3.6.12	NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


8.3.6.13	Header compression configuration

The network may include the Header compression configuration IE if:

  -	the network accepts an IP PDN type; and

  -	control plane CIoT EPS optimization is selected.


8.3.6.14	Control plane only indication

The network shall include the Control plane only indication IE if the associated PDN connection is only for control plane CIoT EPS optimization.


8.3.6.15	Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).

This IE shall be included if the network supports Local IP address in the traffic flow aggregate description and TFT filter, the PDN Type is different from Non-IP, and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.6.16	Serving PLMN rate control

This IE shall be included when the network wishes to indicate the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send per 6 minute interval.


8.3.6.17	Extended APN aggregate maximum bit rate

This IE shall be included in the message only if the network wishes to transmit the APN-AMBR values to the UE for possible uplink policy enforcement and at least one of the values to be transmitted exceeds the maximum value specified in the APN aggregate maximum bit rate information element in subclause 9.9.4.2.


8.3.7	Bearer resource allocation reject


8.3.7.1	Message definition

This message is sent by the network to the UE to reject the allocation of a dedicated bearer resource. See table 8.3.7.1.

  Message type:	BEARER RESOURCE ALLOCATION REJECT

  Significance:	dual

  Direction:	network to UE

Table 8.3.7.1: BEARER RESOURCE ALLOCATION REJECT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Bearer resource allocation reject message|Message type                                 |M               |V               |1               |
|       |identity                                 |9.8                                          |                |                |                |
|       |ESM cause                                |ESM cause                                    |M               |V               |1               |
|       |                                         |9.9.4.4                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|37     |Back-off timer value                     |GPRS timer 3                                 |O               |TLV             |3               |
|       |                                         |9.9.3.16B                                    |                |                |                |
|6B     |Re-attempt indicator                     |Re-attempt indicator                         |O               |TLV             |3               |
|       |                                         |9.9.4.13A                                    |                |                |                |
|33     |NBIFOM container                         |NBIFOM container                             |O               |TLV             |3-257           |
|       |                                         |9.9.4.19                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |



8.3.7.2	Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.7.3	Back-off timer value

The network may include this IE if the ESM cause is not #65 "maximum number of EPS bearers reached", to request a minimum time interval before procedure retry is allowed.


8.3.7.4	Re-attempt indicator

The network may include this IE only if it includes the Back-off timer value IE and the ESM cause value is not #26 "insufficient resources".


8.3.7.5	NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


8.3.7.6	Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.8	Bearer resource allocation request


8.3.8.1	Message definition

This message is sent by the UE to the network to request the allocation of a dedicated bearer resource. See table 8.3.8.1.

  Message type:	BEARER RESOURCE ALLOCATION REQUEST

  Significance:	dual

  Direction:	UE to network

Table 8.3.8.1: BEARER RESOURCE ALLOCATION REQUEST message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Bearer resource allocation request       |Message type                                 |M               |V               |1               |
|       |message identity                         |9.8                                          |                |                |                |
|       |Linked EPS bearer identity               |Linked EPS bearer identity                   |M               |V               |1/2             |
|       |                                         |9.9.4.6                                      |                |                |                |
|       |Spare half octet                         |Spare half octet                             |M               |V               |1/2             |
|       |                                         |9.9.2.9                                      |                |                |                |
|       |Traffic flow aggregate                   |Traffic flow aggregate description           |M               |LV              |2-256           |
|       |                                         |9.9.4.15                                     |                |                |                |
|       |Required traffic flow QoS                |EPS quality of service                       |M               |LV              |2-14            |
|       |                                         |9.9.4.3                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|C-     |Device properties                        |Device properties                            |O               |TV              |1               |
|       |                                         |9.9.2.0A                                     |                |                |                |
|33     |NBIFOM container                         |NBIFOM container                             |O               |TLV             |3-257           |
|       |                                         |9.9.4.19                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |
|5C     |Extended EPS QoS                         |Extended quality of service                  |O               |TLV             |12              |
|       |                                         |9.9.4.30                                     |                |                |                |



8.3.8.2	Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.8.3	Device properties

The UE shall include this IE if the UE is configured for NAS signalling low priority.


8.3.8.4	NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


8.3.8.5	Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.8.6	Extended EPS QoS

This IE shall be included in the message only if the UE wishes to transmit the maximum and guaranteed bit rate values to the network and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in subclause 9.9.4.3.


8.3.9	Bearer resource modification reject


8.3.9.1	Message definition

This message is sent by the network to the UE to reject the modification of a dedicated bearer resource. See table 8.3.9.1.

  Message type:	BEARER RESOURCE MODIFICATION REJECT

  Significance:	dual

  Direction:	network to UE

Table 8.3.9.1: BEARER RESOURCE MODIFICATION REJECT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Bearer resource modification reject      |Message type                                 |M               |V               |1               |
|       |message identity                         |9.8                                          |                |                |                |
|       |ESM cause                                |ESM cause                                    |M               |V               |1               |
|       |                                         |9.9.4.4                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|37     |Back-off timer value                     |GPRS timer 3                                 |O               |TLV             |3               |
|       |                                         |9.9.3.16B                                    |                |                |                |
|6B     |Re-attempt indicator                     |Re-attempt indicator                         |O               |TLV             |3               |
|       |                                         |9.9.4.13A                                    |                |                |                |
|33     |NBIFOM container                         |NBIFOM container                             |O               |TLV             |3-257           |
|       |                                         |9.9.4.19                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |



8.3.9.2	Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.9.3	Back-off timer value

The network may include this IE to request a minimum time interval before procedure retry is allowed.


8.3.9.4	Re-attempt indicator

The network may include this IE only if it includes the Back-off timer value IE and the ESM cause value is not #26 "insufficient resources".


8.3.9.5	NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


8.3.9.6	Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.10	Bearer resource modification request


8.3.10.1	Message definition

This message is sent by the UE to the network to request the modification of a dedicated bearer resource, or to request re-negotiation of header compression configuration associated to an EPS bearer context if the network has previously indicated support of Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization. See table 8.3.10.1.

  Message type:	BEARER RESOURCE MODIFICATION REQUEST

  Significance:	dual

  Direction:	UE to network

Table 8.3.10.1: BEARER RESOURCE MODIFICATION REQUEST message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Bearer resource modification request     |Message type                                 |M               |V               |1               |
|       |message identity                         |9.8                                          |                |                |                |
|       |EPS bearer identity for packet filter    |Linked EPS bearer identity                   |M               |V               |1/2             |
|       |                                         |9.9.4.6                                      |                |                |                |
|       |Spare half octet                         |Spare half octet                             |M               |V               |1/2             |
|       |                                         |9.9.2.9                                      |                |                |                |
|       |Traffic flow aggregate                   |Traffic flow aggregate description           |M               |LV              |2-256           |
|       |                                         |9.9.4.15                                     |                |                |                |
|5B     |Required traffic flow QoS                |EPS quality of service                       |O               |TLV             |3-15            |
|       |                                         |9.9.4.3                                      |                |                |                |
|58     |ESM cause                                |ESM cause                                    |O               |TV              |2               |
|       |                                         |9.9.4.4                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|C-     |Device properties                        |Device properties                            |O               |TV              |1               |
|       |                                         |9.9.2.0A                                     |                |                |                |
|33     |NBIFOM container                         |NBIFOM container                             |O               |TLV             |3-257           |
|       |                                         |9.9.4.19                                     |                |                |                |
|66     |Header compression configuration         |Header compression configuration             |O               |TLV             |5-257           |
|       |                                         |9.9.4.22                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |
|5C     |Extended EPS QoS                         |Extended quality of service                  |O               |TLV             |12              |
|       |                                         |9.9.4.30                                     |                |                |                |



8.3.10.2	Required traffic flow QoS

This IE is included in the message when the UE requests a change of QoS for the indicated traffic flows and does not request to release all bearer resources for the EPS bearer context.


8.3.10.3	ESM cause

This IE is included in the message when the UE requests the release of a dedicated bearer resource.


8.3.10.4	Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.10.5	Device properties

The UE shall include this IE if the UE is configured for NAS signalling low priority.


8.3.10.6	NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


8.3.10.7	Header compression configuration

This IE is included in the message if the UE wishes to re-negotiate header compression configuration associated to an EPS bearer context and both the UE and the network supports Control plane CIoT EPS optimization and header compression.


8.3.10.8	Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.10.9	Extended EPS QoS

This IE shall be included in the message only if the UE wishes to transmit the maximum and guaranteed bit rate values to the network and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in subclause 9.9.4.3.


8.3.11	Deactivate EPS bearer context accept


8.3.11.1	Message definition

This message is sent by the UE to acknowledge deactivation of the EPS bearer context requested in the corresponding Deactivate EPS bearer context request message. See table 8.3.11.1.

  Message type:	DEACTIVATE EPS BEARER CONTEXT ACCEPT

  Significance:	dual

  Direction:	UE to network

Table 8.3.11.1: DEACTIVATE EPS BEARER CONTEXT ACCEPT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Deactivate EPS bearer context accept     |Message type                                 |M               |V               |1               |
|       |message identity                         |9.8                                          |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |



8.3.11.2	Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.11.3	Void


8.3.11.4	Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.12	Deactivate EPS bearer context request


8.3.12.1	Message definition

This message is sent by the network to request deactivation of an active EPS bearer context. See table 8.3.12.1.

  Message type:	DEACTIVATE EPS BEARER CONTEXT REQUEST

  Significance:	dual

  Direction:	network to UE

Table 8.3.12.1: DEACTIVATE EPS BEARER CONTEXT REQUEST message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Deactivate EPS bearer context request    |Message type                                 |M               |V               |1               |
|       |message identity                         |9.8                                          |                |                |                |
|       |ESM cause                                |ESM cause                                    |M               |V               |1               |
|       |                                         |9.9.4.4                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|37     |T3396 value                              |GPRS timer 3                                 |O               |TLV             |3               |
|       |                                         |9.9.3.16B                                    |                |                |                |
|C-     |WLAN offload indication                  |WLAN offload acceptability                   |O               |TV              |1               |
|       |                                         |9.9.4.18                                     |                |                |                |
|33     |NBIFOM container                         |NBIFOM container                             |O               |TLV             |3-257           |
|       |                                         |9.9.4.19                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |



8.3.12.2	Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.12.3	T3396 value

The network may include this IE if the ESM cause is #26 "insufficient resources".


8.3.12.4	WLAN offload indication

This IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in subclause 9.9.4.18. If the MME wishes to deactivate all EPS bearer contexts of a PDN connection, MME shall not include this IE.


8.3.12.5	NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


8.3.12.6	Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.12A	ESM dummy message

This message is sent by the UE or the network included in an ESM message container information element during an attach procedure, if the UE does not request for PDN connection. See table 8.3.12A.1.

  Message type:	ESM DUMMY MESSAGE

  Significance:	dual

  Direction:	both

Table 8.3.12A.1: ESM DUMMY MESSAGE message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |ESM dummy message                        |Message type                                 |M               |V               |1               |
|       |message identity                         |9.8                                          |                |                |                |



8.3.13	ESM information request

This message is sent by the network to the UE to request the UE to provide ESM information, i.e. protocol configuration options or APN or both. See table 8.3.13.1.

  Message type:	ESM INFORMATION REQUEST

  Significance:	dual

  Direction:	network to UE

Table 8.3.13.1: ESM INFORMATION REQUEST message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |ESM information request message identity |Message type                                 |M               |V               |1               |
|       |                                         |9.8                                          |                |                |                |



8.3.14	ESM information response


8.3.14.1	Message definition

This message is sent by the UE to the network in response to an ESM INFORMATION REQUEST message and provides the requested ESM information. See table 8.3.14.1.

  Message type:	ESM INFORMATION RESPONSE

  Significance:	dual

  Direction:	UE to network

Table 8.3.14.1: ESM INFORMATION RESPONSE message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |ESM information response message identity|Message type                                 |M               |V               |1               |
|       |                                         |9.8                                          |                |                |                |
|28     |Access point name                        |Access point name                            |O               |TLV             |3-102           |
|       |                                         |9.9.4.1                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |



8.3.14.2	Access point name

This IE is included in the message when the UE wishes to request network connectivity as defined by a certain access point name during the attach procedure.


8.3.14.3	Protocol configuration options

This IE is included in the message when, during the attach procedure, the UE wishes to transmit security protected (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, the UE is in WB-S1 mode and the PDN Type requested is different from Non-IP.

This IE shall be included if the UE supports local IP address in traffic flow aggregate description and TFT filter, the UE is in WB-S1 mode and the PDN Type requested is different from Non-IP.

This IE shall not be included if the Extended protocol configuration options IE is included in the message.


8.3.14.4	Extended protocol configuration options

This IE is included in the message when, during the attach procedure, the UE wishes to transmit security protected (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, and the UE is in NB-S1 mode or Non-IP PDN Type is requested.

This IE shall be included if the UE supports local IP address in traffic flow aggregate description and TFT filter, the UE is in NB-S1 mode and the PDN Type requested is different from Non-IP.

This IE shall not be included if the Protocol configuration options IE is included in the message.


8.3.15	ESM status

This message is sent by the network or the UE to pass information on the status of the indicated EPS bearer context and report certain error conditions (e.g. as listed in clause 7). See table 8.3.15.1.

  Message type:	ESM STATUS

  Significance:	dual

  Direction:	both

Table 8.3.15.1: ESM STATUS message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |ESM status message identity              |Message type                                 |M               |V               |1               |
|       |                                         |9.8                                          |                |                |                |
|       |ESM cause                                |ESM cause                                    |M               |V               |1               |
|       |                                         |9.9.4.4                                      |                |                |                |



8.3.16	Modify EPS bearer context accept


8.3.16.1	Message definition

This message is sent by the UE to the network to acknowledge the modification of an active EPS bearer context. See table 8.3.16.1.

  Message type:	MODIFY EPS BEARER CONTEXT ACCEPT

  Significance:	dual

  Direction:	UE to network

Table 8.3.16.1: MODIFY EPS BEARER CONTEXT ACCEPT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Modify EPS bearer context accept message |Message type                                 |M               |V               |1               |
|       |identity                                 |9.8                                          |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|33     |NBIFOM container                         |NBIFOM container                             |O               |TLV             |3-257           |
|       |                                         |9.9.4.19                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |



8.3.16.2	Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.16.3	NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


8.3.16.4	Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.17	Modify EPS bearer context reject


8.3.17.1	Message definition

This message is sent by the UE or the network to reject a modification of an active EPS bearer context. See table 8.3.17.1.

  Message type:	MODIFY EPS BEARER CONTEXT REJECT

  Significance:	dual

  Direction:	UE to network

Table 8.3.17.1: MODIFY EPS BEARER CONTEXT REJECT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Modify EPS bearer context reject message |Message type                                 |M               |V               |1               |
|       |identity                                 |9.8                                          |                |                |                |
|       |ESM cause                                |ESM cause                                    |M               |V               |1               |
|       |                                         |9.9.4.4                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|33     |NBIFOM container                         |NBIFOM container                             |O               |TLV             |3-257           |
|       |                                         |9.9.4.19                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |



8.3.17.2	Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.17.3	NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


8.3.17.4	Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.18	Modify EPS bearer context request


8.3.18.1	Message definition

This message is sent by the network to the UE to request modification of an active EPS bearer context, or to request re-negotiation of header compression configuration associated to an EPS bearer context if the UE has previously indicated support of Control plane CIoT EPS optimization and Header compression for control plane CIoT EPS optimization. See table 8.3.18.1.

  Message type:	MODIFY EPS BEARER CONTEXT REQUEST

  Significance:	dual

  Direction:	network to UE

Table 8.3.18.1: MODIFY EPS BEARER CONTEXT REQUEST message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Modify EPS bearer context request message|Message type                                 |M               |V               |1               |
|       |identity                                 |9.8                                          |                |                |                |
|5B     |New EPS QoS                              |EPS quality of service                       |O               |TLV             |3-15            |
|       |                                         |9.9.4.3                                      |                |                |                |
|36     |TFT                                      |Traffic flow template                        |O               |TLV             |3-257           |
|       |                                         |9.9.4.16                                     |                |                |                |
|30     |New QoS                                  |Quality of service                           |O               |TLV             |14-22           |
|       |                                         |9.9.4.12                                     |                |                |                |
|32     |Negotiated LLC SAPI                      |LLC service access point identifier          |O               |TV              |2               |
|       |                                         |9.9.4.7                                      |                |                |                |
|8-     |Radio priority                           |Radio priority                               |O               |TV              |1               |
|       |                                         |9.9.4.13                                     |                |                |                |
|34     |Packet flow Identifier                   |Packet flow Identifier                       |O               |TLV             |3               |
|       |                                         |9.9.4.8                                      |                |                |                |
|5E     |APN-AMBR                                 |APN aggregate maximum bit rate               |O               |TLV             |4-8             |
|       |                                         |9.9.4.2                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|C-     |WLAN offload indication                  |WLAN offload acceptability                   |O               |TV              |1               |
|       |                                         |9.9.4.18                                     |                |                |                |
|33     |NBIFOM container                         |NBIFOM container                             |O               |TLV             |3-257           |
|       |                                         |9.9.4.19                                     |                |                |                |
|66     |Header compression configuration         |Header compression configuration             |O               |TLV             |5-257           |
|       |                                         |9.9.4.22                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |
|5F     |Extended APN-AMBR                        |Extended APN aggregate maximum bit rate      |O               |TLV             |8               |
|       |                                         |9.9.4.29                                     |                |                |                |
|5C     |Extended EPS QoS                         |Extended quality of service                  |O               |TLV             |12              |
|       |                                         |9.9.4.30                                     |                |                |                |



8.3.18.2	New EPS QoS

When the EPS QoS of the EPS bearer context is modified, the network shall include the modified EPS QoS assigned to the EPS bearer context.


8.3.18.3	TFT

This IE provides the UE with packet filters.


8.3.18.4	New QoS

If the UE supports A/Gb mode or Iu mode or both and when the corresponding R99 QoS of the EPS bearer context is modified, a network supporting mobility from S1 mode to A/Gb mode or Iu mode or both shall include the corresponding R99 QoS parameter values of a PDP context.


8.3.18.5	Negotiated LLC SAPI

If the UE supports A/Gb mode and when the negotiated LLC SAPI is modified, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


8.3.18.6	Radio priority

If the UE supports A/Gb mode and when the radio priority is modified, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


8.3.18.7	Packet flow identifier

If the UE supports A/Gb mode and BSS packet flow procedures, a network supporting mobility from S1 mode to A/Gb mode shall include this IE.


8.3.18.8	APN-AMBR

This IE is included when the APN-AMBR has been changed by the network.


8.3.18.9	Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.18.10	WLAN offload indication

This IE shall be included in the message when the network wishes to indicate if the UE is allowed to offload the traffic of the associated PDN connection to WLAN(s), as specified in subclause 9.9.4.18.


8.3.18.11	NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


8.3.18.12	Header compression configuration

  This IE is included in the message if the network wishes to re-negotiate header compression configuration associated to an EPS bearer context and both the UE and the network support Control plane CIoT EPS optimization and header compression.


8.3.18.13	Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.18.14	Extended APN-AMBR

This IE shall be included in the message only if at least one of the APN-AMBR values has been changed by the network and at least one of the values to be transmitted exceeds the maximum value specified in the APN aggregate maximum bit rate information element in subclause 9.9.4.2.


8.3.18.15	Extended EPS QoS

This IE shall be included in the message only if the network wishes to transmit the maximum and guaranteed bit rate values to the UE and at least one of the values to be transmitted exceeds the maximum value specified in the EPS quality of service information element in subclause 9.9.4.3.


8.3.18A	Notification

This message is sent by the network to inform the UE about events which are relevant for the upper layer using an EPS bearer context or having requested a procedure transaction. See table 8.3.18A.1.

  Message type:	NOTIFICATION

  Significance:	local

  Direction:	network to UE

Table 8.3.18A.1: NOTIFICATION message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Notification message identity            |Message type                                 |M               |V               |1               |
|       |                                         |9.8                                          |                |                |                |
|       |Notification indicator                   |Notification indicator                       |M               |LV              |2               |
|       |                                         |9.9.4.7A                                     |                |                |                |



8.3.19	PDN connectivity reject


8.3.19.1	Message definition

This message is sent by the network to the UE to reject establishment of a PDN connection. See table 8.3.19.1.

  Message type:	PDN CONNECTIVITY REJECT

  Significance:	dual

  Direction:	network to UE

Table 8.3.19.1: PDN CONNECTIVITY REJECT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |PDN connectivity reject message identity |Message type                                 |M               |V               |1               |
|       |                                         |9.8                                          |                |                |                |
|       |ESM cause                                |ESM cause                                    |M               |V               |1               |
|       |                                         |9.9.4.4                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|37     |Back-off timer value                     |GPRS timer 3                                 |O               |TLV             |3               |
|       |                                         |9.9.3.16B                                    |                |                |                |
|6B     |Re-attempt indicator                     |Re-attempt indicator                         |O               |TLV             |3               |
|       |                                         |9.9.4.13A                                    |                |                |                |
|33     |NBIFOM container                         |NBIFOM container                             |O               |TLV             |3-257           |
|       |                                         |9.9.4.19                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |



8.3.19.2	Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.19.3	Back-off timer value

The network may include this IE if the ESM cause is not #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #54 "PDN connection does not exist", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed", nor #65 "maximum number of EPS bearers reached", to request a minimum time interval before procedure retry is allowed.


8.3.19.4	Re-attempt indicator

The network may include this IE only if the ESM cause value is #50 "PDN type IPv4 only allowed", #51 "PDN type IPv6 only allowed", #57 "PDN type IPv4v6 only allowed", #58 "PDN type non IP only allowed", or #66 "requested APN not supported in current RAT and PLMN combination", or if the network includes the Back-off timer value IE and the ESM cause value is not #26 "insufficient resources".


8.3.19.5	Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.20	PDN connectivity request


8.3.20.1	Message definition

This message is sent by the UE to the network to initiate establishment of a PDN connection. See table 8.3.20.1.

  Message type:	PDN CONNECTIVITY REQUEST

  Significance:	dual

  Direction:	UE to network

Table 8.3.20.1: PDN CONNECTIVITY REQUEST message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |PDN connectivity request message identity|Message type                                 |M               |V               |1               |
|       |                                         |9.8                                          |                |                |                |
|       |Request type                             |Request type                                 |M               |V               |1/2             |
|       |                                         |9.9.4.14                                     |                |                |                |
|       |PDN type                                 |PDN type                                     |M               |V               |1/2             |
|       |                                         |9.9.4.10                                     |                |                |                |
|D-     |ESM information transfer flag            |ESM information transfer flag                |O               |TV              |1               |
|       |                                         |9.9.4.5                                      |                |                |                |
|28     |Access point name                        |Access point name                            |O               |TLV             |3-102           |
|       |                                         |9.9.4.1                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|C-     |Device properties                        |Device properties                            |O               |TV              |1               |
|       |                                         |9.9.2.0A                                     |                |                |                |
|33     |NBIFOM container                         |NBIFOM container                              |O               |TLV             |3-257           |
|       |                                         |9.9.4.19                                      |                |                |                |
|66     |Header compression configuration         |Header compression configuration              |O               |TLV             |5-257           |
|       |                                         |9.9.4.22                                      |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options       |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                      |                |                |                |



8.3.20.2	ESM information transfer flag

The UE shall include this IE in the PDN CONNECTIVITY REQUEST message sent during the attach procedure if the UE has protocol configuration options that need to be transferred security protected or wishes to provide an access point name for the PDN connection to be established during the attach procedure.


8.3.20.3	Access point name

This IE is included in the message when the UE wishes to request network connectivity as defined by a certain access point name. This IE shall not be included when the PDN CONNECTIVITY REQUEST message is included in an ATTACH REQUEST message or if the request type indicates "emergency" or "handover of emergency bearer services".


8.3.20.4	Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, the UE is in WB-S1 mode and the PDN Type requested is different from Non-IP.

This IE shall be included if the UE supports local IP address in traffic flow aggregate description and TFT filter, the UE is in WB-S1 mode and the PDN Type requested is different from Non-IP.

This IE shall not be included if the Extended protocol configuration options IE is included in the message.


8.3.20.5	Device properties

The UE shall include this IE if the UE is configured for NAS signalling low priority.


8.3.20.6	NBIFOM container

This information element is used to transfer information associated with network-based IP flow mobility, see 3GPP TS 24.161 [36].


8.3.20.7	Header compression configuration

The UE shall include the Header compression configuration IE if:

  -	the PDN type value of the PDN type IE is set to IPv4 or IPv6 or IPv4v6;

  -	the UE indicates "Control Plane CIoT EPS optimization supported" in the UE network capability IE of the ATTACH REQUEST message; and

  -	the UE supports header compression.


8.3.20.8	Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network, and the UE is in NB-S1 mode or Non-IP PDN Type is requested.

This IE shall be included if the UE supports local IP address in traffic flow aggregate description and TFT filter, the UE is in NB-S1 mode and the PDN Type requested is different from Non-IP.

This IE shall not be included if the Protocol configuration options IE is included in the message.


8.3.21	PDN disconnect reject


8.3.21.1	Message definition

This message is sent by the network to the UE to reject release of a PDN connection. See table 8.3.21.1.

  Message type:	PDN DISCONNECT REJECT

  Significance:	dual

  Direction:	network to UE

Table 8.3.21.1: PDN DISCONNECT REJECT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |PDN disconnect reject message identity   |Message type                                 |M               |V               |1               |
|       |                                         |9.8                                          |                |                |                |
|       |ESM cause                                |ESM cause                                    |M               |V               |1               |
|       |                                         |9.9.4.4                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |



8.3.21.2	Protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.21.3	Extended protocol configuration options

This IE is included in the message when the network wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the UE and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.22	PDN disconnect request


8.3.22.1	Message definition

This message is sent by the UE to the network to initiate release of a PDN connection. See table 8.3.22.1.

  Message type:	PDN DISCONNECT REQUEST

  Significance:	dual

  Direction:	UE to network

Table 8.3.22.1: PDN DISCONNECT REQUEST message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |PDN disconnect request message identity  |Message type                                 |M               |V               |1               |
|       |                                         |9.8                                          |                |                |                |
|       |Linked EPS bearer identity               |Linked EPS bearer identity                   |M               |V               |1/2             |
|       |                                         |9.9.4.6                                      |                |                |                |
|       |Spare half octet                         |Spare half octet                             |M               |V               |1/2             |
|       |                                         |9.9.2.9                                      |                |                |                |
|27     |Protocol configuration options           |Protocol configuration options               |O               |TLV             |3-253           |
|       |                                         |9.9.4.11                                     |                |                |                |
|7B     |Extended protocol configuration options  |Extended protocol configuration options      |O               |TLV-E           |4-65538         |
|       |                                         |9.9.4.26                                     |                |                |                |



8.3.22.2	Protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is not supported by the UE or the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.22.3	Extended protocol configuration options

This IE is included in the message when the UE wishes to transmit (protocol) data (e.g. configuration parameters, error codes or messages/events) to the network and the extended protocol configuration options is supported by both the UE and the network end-to-end for the PDN connection (see subclause 6.6.1.1).


8.3.23	Remote UE report


8.3.23.1	Message definition

This message is sent by the UE to the network to report connection or disconnection of remote UE(s). See table 8.3.23.1.

  Message type:	REMOTE UE REPORT

  Significance:	dual

  Direction:	UE to network

Table 8.3.23.1: REMOTE UE REPORT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Remote UE report message identity        |Message type                                 |M               |V               |1               |
|       |                                         |9.8                                          |                |                |                |
|79     |Remote UE Context Connected              |Remote UE context list IE                    |O               |TLV-E           |3-65538         |
|       |                                         |9.9.4.20                                     |                |                |                |
|7A     |Remote UE Context Disconnected           |Remote UE context list IE                    |O               |TLV-E           |3-65538         |
|       |                                         |9.9.4.20                                     |                |                |                |
|6F     |ProSe Key Management Function address    |PKMF address IE                              |O               |TLV             |3-19            |
|       |                                         |9.9.4.21                                     |                |                |                |



8.3.23.2	Remote UE Context Connected

This IE is included in the message by the UE acting as ProSe UE-to-network relay to provide the network with newly connected remote UE information as specified in 3GPP TS 23.303 [31].


8.3.23.3	Remote UE Context Disconnected

This IE is included in the message by the UE acting as ProSe UE-to-Network Relay to provide the network with disconnected remote UE information as specified in 3GPP TS 23.303 [31].


8.3.23.4	ProSe Key Management Function Address

This IE is included in the message by the UE acting as ProSe UE-to-network relay to provide the network with the address of the ProSe Key Management Function associated with the remote UEs connected to or disconnected from the ProSe UE-to-network relay.


8.3.24	Remote UE report response


8.3.24.1	Message definition

This message is sent by the network to the UE to acknowledge receipt of a Remote UE report message. See table 8.3.24.1.

  Message type:	REMOTE UE REPORT RESPONSE

  Significance:	dual

  Direction:	network to UE

Table 8.3.24.1: REMOTE UE REPORT RESPONSE message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format          |Length          |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V               |1/2             |
|       |                                         |9.2                                          |                |                |                |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V               |1/2             |
|       |                                         |9.3.2                                        |                |                |                |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V               |1               |
|       |                                         |9.4                                          |                |                |                |
|       |Remote UE report response message        |Message type                                 |M               |V               |1               |
|       |identity                                 |9.8                                          |                |                |                |



8.3.25	ESM DATA TRANSPORT


8.3.25.1	Message definition

This message is sent by the UE or the network in order to carry user data in an encapsulated format. See table 8.3.25.1.

  Message type:	ESM DATA TRANSPORT

  Significance:	dual

  Direction:	both

Table 8.3.25.1: ESM DATA TRANSPORT message content

|IEI    |Information Element                      |Type/Reference                               |Presence        |Format        |Length        |
|       |Protocol discriminator                   |Protocol discriminator                       |M               |V             |1/2           |
|       |                                         |9.2                                          |                |              |              |
|       |EPS bearer identity                      |EPS bearer identity                          |M               |V             |1/2           |
|       |                                         |9.3.2                                        |                |              |              |
|       |Procedure transaction identity           |Procedure transaction identity               |M               |V             |1             |
|       |                                         |9.4                                          |                |              |              |
|       |ESM data transport message identity      |Message type                                 |M               |V             |1             |
|       |                                         |9.8                                          |                |              |              |
|       |User data container                      |User data container                          |M               |LV-E          |2-n           |
|       |                                         |9.9.4.24                                     |                |              |              |
|F-     |Release assistance indication            |Release assistance indication                |O               |TV            |1             |
|       |                                         |9.9.4.25                                     |                |              |              |



8.3.25.2	Release assistance indication

The UE may include this IE to inform the network whether

  -	no further uplink or downlink data transmission is expected; or

  -	only a single downlink data transmission (e.g. acknowledgement or response to uplink data) and no further uplink data transmission subsequent to the uplink data transmission is expected.



9	General message format and information elements coding


9.1	Overview

Within the protocols defined in the present document, every message, except the SERVICE REQUEST message, is a standard L3 message as defined in 3GPP TS 24.007 [12]. This means that the message consists of the following parts:

  1)	if the message is a plain NAS message:

    a)	protocol discriminator;

    b)	EPS bearer identity or security header type;

    c)	procedure transaction identity;

    d)	message type;

    e)	other information elements, as required.

  2)	if the message is a security protected NAS message:

    a)	protocol discriminator;

    b)	security header type;

    c)	message authentication code;

    d)	sequence number;

    e)	plain NAS message, as defined in item 1.

The organization of a plain NAS message is illustrated in the example shown in figure 9.1.1.



|8                                        |7                                        |6               |
|Procedure transaction identity                                                      |octet 1a*       |
|Message type                                                                        |octet 2         |
|                                                                                    |octet 3         |
|Other information elements as required                                              |                |
|                                                                                    |octet n         |


Figure 9.1.1: General message organization example for a plain NAS message

The organization of a security protected NAS message is illustrated in the example shown in figure 9.1.2.

|8                                        |7                                        |6               |
|                                                                                    |octet 2         |
|Message authentication code                                                         |                |
|                                                                                    |                |
|                                                                                    |octet 5         |
|Sequence number                                                                     |octet 6         |
|                                                                                    |octet 7         |
|NAS message                                                                         |                |
|                                                                                    |octet n         |

Figure 9.1.2: General message organization example for a security protected NAS message

The EPS bearer identity and the procedure transaction identity are only used in messages with protocol discriminator EPS session management. Octet 1a with the procedure transaction identity shall only be included in these messages.

Unless specified otherwise in the message descriptions of clause 8, a particular information element shall not be present more than once in a given message.

When a field extends over more than one octet, the order of bit values progressively decreases as the octet number increases. The most significant bit of the field is represented by the highest numbered bit of the lowest numbered octet of the field. The least significant bit of the field is represented by the lowest numbered bit of the highest numbered octet of the field.


9.2	Protocol discriminator

The Protocol Discriminator (PD) and its use are defined in 3GPP TS 24.007 [12]. The protocol discriminator in the header (see 3GPP TS 24.007 [12]) of a security protected NAS message is encoded as "EPS mobility management messages".


9.3	Security header type and EPS bearer identity


9.3.1	Security header type

Bits 5 to 8 of the first octet of every EPS Mobility Management (EMM) message contain the Security header type IE. This IE includes control information related to the security protection of a NAS message. The total size of the Security header type IE is 4 bits.

The Security header type IE can take the values shown in table 9.3.1.

Table 9.3.1: Security header type

|Security header type (octet 1)                                                                           |
|                                                                                                         |
|8  |7  |6  |5  |                                                                                        |
|0  |0  |0  |0  |Plain NAS message, not security protected                                               |
|   |   |   |   |                                                                                        |
|   |   |   |   |Security protected NAS message:                                                         |
|0  |0  |0  |1  |Integrity protected                                                                     |
|0  |0  |1  |0  |Integrity protected and ciphered                                                        |
|0  |0  |1  |1  |Integrity protected with new EPS security context (NOTE 1)                              |
|0  |1  |0  |0  |Integrity protected and ciphered with new EPS security context (NOTE 2)                 |
|0  |1  |0  |1  |Integrity protected and partially ciphered NAS message (NOTE 4)                         |
|   |   |   |   |                                                                                        |
|   |   |   |   |Non-standard L3 message:                                                                |
|1  |1  |0  |0  |Security header for the SERVICE REQUEST message                                         |
|   |   |   |   |                                                                                        |
|1  |1  |0  |1  |These values are not used in this version of the protocol.                              |
|to              |If received they shall be interpreted as '1100'. (NOTE 3)                               |
|1  |1  |1  |1  |                                                                                        |
|   |   |   |   |                                                                                        |
|All other values are reserved.                                                                           |
|                                                                                                         |
|NOTE 1: This codepoint may be used only for a SECURITY MODE COMMAND message.                             |
|NOTE 2: This codepoint may be used only for a SECURITY MODE COMPLETE message.                            |
|NOTE 3: When bits 7 and 8 are set to '11', bits 5 and 6 can be used for future extensions of the SERVICE |
|REQUEST message.                                                                                         |
|NOTE 4: This codepoint may be used only for a CONTROL PLANE SERVICE REQUEST message.                     |


An EMM message received with the security header type encoded as 0000 shall be treated as not security protected, plain NAS message. A protocol entity sending a not security protected EMM message shall send the message as plain NAS message and encode the security header type as 0000.


9.3.2	EPS bearer identity

Bits 5 to 8 of the first octet of every EPS Session Management (ESM) message contain the EPS bearer identity. The EPS bearer identity and its use to identify a message flow are defined in 3GPP TS 24.007 [12].

If the UE or the MME or both do not support signalling for a maximum number of 15 EPS bearer contexts, the MME shall select the EPS bearer identity from the value range 5 to 15, or select the value 0 when it needs to indicate that no EPS bearer identity is assigned.

  NOTE:	When assigning EPS bearer identities from the range 1 to 4, the MME can take into account that these EPS bearer contexts will be subject to local deactivation if the UE performs inter-system change to A/Gb mode or Iu mode or if it performs a change to an MME not supporting signalling for a maximum number of 15 EPS bearer contexts.


9.4	Procedure transaction identity

Bits 1 to 8 of the second octet (octet 1a) of every EPS Session Management (ESM) message contain the procedure transaction identity. The procedure transaction identity and its use are defined in 3GPP TS 24.007 [12].


9.5	Message authentication code

The Message authentication code (MAC) information element contains the integrity protection information for the message. The MAC IE shall be included in the security protected NAS message if a valid EPS security context exists and security functions are started. The usage of MAC is specified in subclause 4.4.3.3.


9.6	Sequence number

This IE includes the NAS message sequence number (SN) which consists of the eight least significant bits of the NAS COUNT for a security protected NAS message The usage of SN is specified in subclause 4.4.3.


9.7	NAS message

This IE includes a complete plain NAS message as specified in subclause 8.2 and 8.3. The SECURITY PROTECTED NAS MESSAGE and the SERVICE REQUEST message are not plain NAS messages and shall not be included in this IE.


9.8	Message type

The message type IE and its use are defined in 3GPP TS 24.007 [12]. Tables 9.8.1 and 9.8.2 define the value part of the message type IE used in the EPS mobility management protocol and EPS session management protocol.

Table 9.8.1: Message types for EPS mobility management

|Bits                             |   |                                                          |
|8                                |7  |6                                                         |
|8                                                                                       |7                     |
|Additional information length                                                           |octet 2               |
|Additional information value                                                            |octets 3-n            |

Figure 9.9.2.0.1: Additional information information element

Table 9.9.2.0.1: Additional information information element

|Additional information value (octet 3 to octet n)                                                        |
|                                                                                                         |
|The coding of the additional information value is dependent on the generic message container type.       |



9.9.2.0A	Device properties

See subclause 10.5.7.8 in 3GPP TS 24.008 [13].


9.9.2.1	EPS bearer context status

The purpose of the EPS bearer context status information element is to indicate the state of each EPS bearer context that can be identified by an EPS bearer identity.

The EPS bearer context status information element is coded as shown in figure 9.9.2.1.1 and table 9.9.2.1.1.

The EPS bearer context status information element is a type 4 information element with 4 octets length.



|8                                                                                   |7               |
|Length of EPS bearer context status contents                                        |octet 2         |
|EBI                                                                                                                                   |
|(7)                                                                                                                                   |



9.9.2.2	Location area identification

See subclause 10.5.1.3 in 3GPP TS 24.008 [13].


9.9.2.3	Mobile identity

See subclause 10.5.1.4 in 3GPP TS 24.008 [13].


9.9.2.4	Mobile station classmark 2

See subclause 10.5.1.6 in 3GPP TS 24.008 [13].


9.9.2.5	Mobile station classmark 3

See subclause 10.5.1.7 in 3GPP TS 24.008 [13].


9.9.2.6	NAS security parameters from E-UTRA

The purpose of the NAS security parameters from E-UTRA information element is to provide the UE with information that enables the UE to create a mapped UMTS security context.

The NAS security parameters from E-UTRA information element is coded as shown in figure 9.9.2.6.1 and table 9.9.2.6.1.

The NAS security parameters from E-UTRA is a type 3 information element with a length of 2 octets.

The value part of the NAS security parameters from E-UTRA information element is included in specific information elements within some RRC messages sent to the UE; see 3GPP TS 36.331 [22]. For these cases the coding of the information element identifier and length information is defined in 3GPP TS 36.331 [22].



|8                                                                                       |7                     |
|0         |0         |0         |0         |DL NAS COUNT value                         |                      |
|          |          |          |          |(short)                                    |octet 2               |
|Spare                                      |                                           |                      |

Figure 9.9.2.6.1: NAS security parameters from E-UTRA information element

Table 9.9.2.6.1: NAS security parameters from E-UTRA information element

|DL NAS COUNT value (short) (octet 2, bit 1 to 4)                                                         |
|                                                                                                         |
|This field contains the 4 least significant bits of the binary representation of the downlink NAS COUNT  |
|value applicable when this information element is sent.                                                  |
|                                                                                                         |
|Bit 5 to 8 of octet 2 are spare and shall be coded as zero.                                              |



9.9.2.7	NAS security parameters to E-UTRA

The purpose of the NAS security parameters to E-UTRA information element is to provide the UE with parameters that enable the UE to create a mapped EPS security context and take this context into use after inter-system handover to S1 mode.

The NAS security parameters to E-UTRA information element is coded as shown in figure 9.9.2.7.1 and table 9.9.2.7.1.

The NAS security parameters to E-UTRA is a type 3 information element with a length of 7 octets.

The value part of the NAS security parameters to E-UTRA information element is included in specific information elements within some RRC messages sent to the UE; see 3GPP TS 36.331 [22]. For these cases the coding of the information element identifier and length information is defined in 3GPP TS 36.331 [22].



|8                                                                                       |7                     |
|                                                                                        |octet 2               |
|NonceMME value                                                                          |                      |
|                                                                                        |octet 5               |
|0         |Type of ciphering algorithm     |0         |Type of integrity protection    |                      |
|spare     |                                |spare     |algorithm                       |octet 6               |
|0         |0         |0         |0         |TSC       |NAS key set identifier          |                      |
|          |          |          |          |          |                                |octet 7               |
|spare                                      |          |                                |                      |

Figure 9.9.2.7.1: NAS security parameters to E-UTRA information element

Table 9.9.2.7.1: NAS security parameters to E-UTRA information element

|NonceMME value (octet 2 to 5)                                                                            |
|                                                                                                         |
|This field is coded as the nonce value in the Nonce information element (see subclause 9.9.3.25).        |
|                                                                                                         |
|Type of integrity protection algorithm (octet 6, bit 1 to 3) and                                         |
|type of ciphering algorithm (octet 6, bit 5 to 7)                                                        |
|                                                                                                         |
|These fields are coded as the type of integrity protection algorithm and type of ciphering algorithm in  |
|the NAS security algorithms information element (see subclause 9.9.3.23).                                |
|                                                                                                         |
|Bit 4 and 8 of octet 6 are spare and shall be coded as zero.                                             |
|                                                                                                         |
|NAS key set identifier (octet 7, bit 1 to 3) and                                                         |
|type of security context flag (TSC) (octet 7, bit 4)                                                     |
|                                                                                                         |
|These fields are coded as the NAS key set identifier and type of security context flag in the NAS key set|
|identifier information element (see subclause 9.9.3.21).                                                 |
|                                                                                                         |
|Bit 5 to 8 of octet 7 are spare and shall be coded as zero.                                              |
|                                                                                                         |



9.9.2.8	PLMN list

See subclause 10.5.1.13 in 3GPP TS 24.008 [13].


9.9.2.9	Spare half octet

This element is used in the description of EMM and ESM messages when an odd number of half octet type 1 information elements are used. This element is filled with spare bits set to zero and is placed in bits 5 to 8 of the octet unless otherwise specified.


9.9.2.10	Supported codec list

See subclause 10.5.4.32 in 3GPP TS 24.008 [13].


9.9.3	EPS Mobility Management (EMM) information elements


9.9.3.0A	Additional update result

The purpose of the Additional update result information element is to provide additional information about the result of a combined attach procedure or a combined tracking area updating procedure.

The Additional update result information element is coded as shown in figure 9.9.3.0A.1 and table 9.9.3.0A.1.

The Additional update result is a type 1 information element.



|8                                        |7         |6         |5                   |4                     |

Figure 9.9.3.0A.1: Additional update result information element

Table 9.9.3.0A.1: Additional update result information element

|Additional update result value (octet 1)                                                                 |
|                                                                                                         |
|Bits                                                                                                     |
|2  |1  |                                                                                                |
|0  |0  |no additional information                                                                       |
|0  |1  |CS Fallback not preferred                                                                       |
|1  |0  |SMS only                                                                                        |
|1  |1  |reserved                                                                                        |
|                                                                                                         |
|Bits 4 and 3 of octet 1 are spare and shall all be coded as zero.                                        |
|                                                                                                         |
|NOTE: Bits 4 and 3 of octet 1 were used in earlier versions of this release of this specification.       |



9.9.3.0B	Additional update type

The purpose of the Additional update type information element is to provide additional information about the type of request for an attach or a tracking area updating procedure.

The Additional update type information element is coded as shown in figure 9.9.3.0B.1 and table 9.9.3.0B.1.

The Additional update type is a type 1 information element.



|8                                        |7                    |6        |5        |4                     |

Figure 9.9.3.0B.1: Additional update type information element

Table 9.9.3.0B.1: Additional update type information element

|Additional update type value (AUTV) (octet 1)                                                            |
|                                                                                                         |
|Bit                                                                                                      |
|1  |                                                                                                    |
|0  |no additional information. If received it shall be interpreted as request for combined attach or    |
|   |combined tracking area updating.                                                                    |
|1  |SMS only                                                                                            |
|                                                                                                         |
|"Signalling active" flag (SAF) (octet 1)                                                                 |
|                                                                                                         |
|Bit                                                                                                      |
|2  |                                                                                                    |
|0  |keeping the NAS signalling connection is not required after the completion of the tracking area     |
|   |updating procedure                                                                                  |
|1  |keeping the NAS signalling connection is required after the completion of the tracking area updating|
|   |procedure                                                                                           |
|                                                                                                         |
|Preferred CIoT network behaviour (PNB-CIoT) (octet 1)                                                    |
|                                                                                                         |
|Bit                                                                                                      |
|4  |3  |                                                                                                |
|0  |0  |no additional information                                                                       |
|0  |1  |control plane CIoT EPS optimization                                                             |
|1  |0  |user plane CIoT EPS optimization                                                                |
|1  |1  |reserved                                                                                        |
|                                                                                                         |
|                                                                                                         |
|                                                                                                         |



9.9.3.1	Authentication failure parameter

See subclause 10.5.3.2.2 in 3GPP TS 24.008 [13].


9.9.3.2	Authentication parameter AUTN

See subclause 10.5.3.1.1 in 3GPP TS 24.008 [13].


9.9.3.3	Authentication parameter RAND

See subclause 10.5.3.1 in 3GPP TS 24.008 [13].


9.9.3.4	Authentication response parameter

The purpose of the Authentication response parameter information element is to provide the network with the authentication response calculated in the USIM.

The Authentication response parameter information element is coded as shown in figure 9.9.3.4.1 and table 9.9.3.4.1.

The Authentication response parameter is a type 4 information element with a minimum length of 6 octets and a maximum length of 18 octets.

In an EPS authentication challenge, the response calculated in the USIM (RES) is minimum 4 octets and may be up to 16 octets in length.

In a 5G AKA authentication challenge, the response calculated in the ME (RES*) is 16 octets in length.



|8                                                                                   |7               |
|Length of Authentication response parameter contents                                |octet 2         |
|RES or RES*                                                                         |octet 3         |
|                                                                                    |                |
|                                                                                    |octet 18        |

Figure 9.9.3.4.1: Authentication response parameter information element

Table 9.9.3.4.1: Authentication response parameter information element

|RES value (octet 3 to 18)                                                                                             |
|                                                                                                                      |
|This contains the RES or RES*.                                                                                        |



9.9.3.4A	Ciphering key sequence number

See subclause 10.5.1.2 in 3GPP TS 24.008 [13].


9.9.3.4B	SMS services status

The purpose of the SMS services status information element is to indicate the status of availability for SMS services requested by the UE during the normal attach procedure or tracking area updating procedure.

The SMS services status information element is coded as shown in figure 9.9.3.4B.1 and table 9.9.3.4B.1.

The SMS services status is a type 1 information element.



|8         |7         |6         |5         |4          |3        |2         |1         |                      |
|SMS services status IEI                  |0          |SMS services status value     |octet 1               |
|                                         |Spare      |                              |                      |

Figure 9.9.3.4B.1: SMS services status information element

Table 9.9.3.4B.1: SMS services status information element

|SMS services status value (octet 1, bit 1 to 3)                                                         |
|                                                                                                        |
|Bits                                                                                                    |
|                                                                                                        |
|3  |2  |1  |   |                                                                                        |
|0  |0  |0  |   |SMS services not available                                                              |
|0  |0  |1  |   |SMS services not available in this PLMN                                                 |
|0  |1  |0  |   |Network failure                                                                         |
|0  |1  |1  |   |Congestion                                                                              |
|                                                                                                        |
|All other values are unused and shall be treated as abnormal case, if received by the UE.               |
|                                                                                                        |
|Bit 4 of octet 1 is spare and shall be coded as zero.                                                   |



9.9.3.5	CSFB response

The purpose of the CSFB response information element is to indicate whether the UE accepts or rejects a paging for CS fallback.

The CSFB response information element is coded as shown in figure 9.9.3.5.1 and table 9.9.3.5.1.

The CSFB response is a type 1 information element.



|8                                        |7         |6                              |5                     |

Figure 9.9.3.5.1: CSFB response information element

Table 9.9.3.5.1: CSFB response information element

|CSFB response value (octet 1)                                                                            |
|                                                                                                         |
|Bits                                                                                                     |
|3                                                                                                        |
|                                                                                                         |



9.9.3.6	Daylight saving time

See subclause 10.5.3.12 in 3GPP TS 24.008 [13].


9.9.3.7	Detach type

The purpose of the Detach type information element is to indicate the type of detach.

The Detach type information element is coded as shown in figure 9.9.3.7.1 and table 9.9.3.7.1.

The Detach type is a type 1 information element.



|8                                          |7         |6                                |5                     |

Figure 9.9.3.7.1: Detach type information element

Table 9.9.3.7.1: Detach type information element

|Type of detach (octet 1)                                                                                 |
|                                                                                                         |
|In the UE to network direction:                                                                          |
|Bits                                                                                                     |
|3  |2  |1  |   |                                                                                        |
|0  |0  |1  |   |EPS detach                                                                              |
|0  |1  |0  |   |IMSI detach                                                                             |
|0  |1  |1  |   |combined EPS/IMSI detach                                                                |
|1  |1  |0  |   |reserved                                                                                |
|1  |1  |1  |   |reserved                                                                                |
|                                                                                                         |
|All other values are interpreted as "combined EPS/IMSI detach" in this version of the protocol.          |
|                                                                                                         |
|In the network to UE direction:                                                                          |
|Bits                                                                                                     |
|3  |2  |1  |   |                                                                                        |
|0  |0  |1  |   |re-attach required                                                                      |
|0  |1  |0  |   |re-attach not required                                                                  |
|0  |1  |1  |   |IMSI detach                                                                             |
|1  |1  |0  |   |reserved                                                                                |
|1  |1  |1  |   |reserved                                                                                |
|                                                                                                         |
|All other values are interpreted as "re-attach not required" in this version of the protocol.            |
|                                                                                                         |
|Switch off (octet 1)                                                                                     |
|                                                                                                         |
|In the UE to network direction:                                                                          |
|Bit                                                                                                      |
|4  |   |   |   |                                                                                        |
|0  |   |   |   |normal detach                                                                           |
|1  |   |   |   |switch off                                                                              |
|                                                                                                         |
|In the network to UE direction bit 4 is spare. The network shall set this bit to zero.                   |



9.9.3.8	DRX parameter

See subclause 10.5.5.6 in 3GPP TS 24.008 [13].


9.9.3.9	EMM cause

The purpose of the EMM cause information element is to indicate the reason why an EMM request from the UE is rejected by the network.

The EMM cause information element is coded as shown in figure 9.9.3.9.1 and table 9.9.3.9.1.

The EMM cause is a type 3 information element with 2 octets length.



|8                                                                                       |7                     |
|Cause value                                                                             |octet 2               |

Figure 9.9.3.9.1: EMM cause information element

Table 9.9.3.9.1: EMM cause information element

|Cause value (octet 2)                                                                                    |
|                                                                                                         |
|Bits                                                                                                     |
|8                                                                                                        |
|                                                                                                         |



9.9.3.10	EPS attach result

The purpose of the EPS attach result information element is to specify the result of an attach procedure.

The EPS attach result information element is coded as shown in figure 9.9.3.10.1 and table 9.9.3.10.1.

The EPS attach result is a type 1 information element.



|8                                        |7         |6                              |5                     |

Figure 9.9.3.10.1: EPS attach result information element

Table 9.9.3.10.1: EPS attach result information element

|EPS attach result value (octet 1)                                                                        |
|Bits                                                                                                     |
|3  |2  |1  |   |                                                                                        |
|0  |0  |1  |   |EPS only                                                                                |
|0  |1  |0  |   |combined EPS/IMSI attach                                                                |
|                                                                                                         |
|All other values are reserved.                                                                           |
|                                                                                                         |
|Bit 4 of octet 1 is spare and shall be coded as zero.                                                    |
|                                                                                                         |



9.9.3.11	EPS attach type

The purpose of the EPS attach type information element is to indicate the type of the requested attach.

The EPS attach type information element is coded as shown in figure 9.9.3.11.1 and table 9.9.3.11.1.

The EPS attach type is a type 1 information element.



|8                                        |7         |6                              |5                     |

Figure 9.9.3.11.1: EPS attach type information element

Table 9.9.3.11.1: EPS attach type information element

|EPS attach type value (octet 1)                                                                          |
|Bits                                                                                                     |
|3  |2  |1  |   |                                                                                        |
|0  |0  |1  |   |EPS attach                                                                              |
|0  |1  |0  |   |combined EPS/IMSI attach                                                                |
|1  |1  |0  |   |EPS emergency attach                                                                    |
|1  |1  |1  |   |reserved                                                                                |
|                                                                                                         |
|All other values are unused and shall be interpreted as "EPS attach", if received by the network.        |
|                                                                                                         |
|Bit 4 of octet 1 is spare and shall be coded as zero.                                                    |
|                                                                                                         |



9.9.3.12	EPS mobile identity

The purpose of the EPS mobile identity information element is to provide either the IMSI, the GUTI or the IMEI.

The EPS mobile identity information element is coded as shown in figures 9.9.3.12.1 and 9.9.3.12.2 and table 9.9.3.12.1.

The EPS mobile identity is a type 4 information element with a minimum length of 3 octets and a maximum length of 13 octets.



|8                                                                                   |7               |
|                                                                                    |                |
|Length of EPS mobile identity contents                                              |octet 2         |
|1         |1         |1         |1         |odd/      |Type of identity               |                |
|          |          |          |          |even      |                               |octet 3         |
|          |          |          |          |indic     |                               |                |
|                                         |                                         |                |
|MCC digit 2                              |MCC digit 1                              |octet 4         |
|                                         |                                         |                |
|MNC digit 3                              |MCC digit 3                              |octet 5         |
|                                         |                                         |                |
|MNC digit 2                              |MNC digit 1                              |octet 6         |
|                                                                                    |                |
|MME Group ID                                                                        |octet 7         |
|                                                                                    |                |
|MME Group ID (continued)                                                            |octet 8         |
|                                                                                    |                |
|MME Code                                                                            |octet 9         |
|                                                                                    |                |
|M-TMSI                                                                              |octet 10        |
|                                                                                    |                |
|M-TMSI (continued)                                                                  |octet 11        |
|                                                                                    |                |
|M-TMSI (continued)                                                                  |octet 12        |
|                                                                                    |                |
|M-TMSI (continued)                                                                  |octet 13        |

Figure 9.9.3.12.1: EPS mobile identity information element for type of identity "GUTI"



|8                                                                                   |7               |
|                                                                                    |                |
|Length of EPS mobile identity contents                                              |octet 2         |
|                                         |odd/      |                               |                |
|Identity digit 1                         |even      |Type of identity               |octet 3         |
|                                         |indic     |                               |                |
|                                         |                                         |                |
|Identity digit p+1                       |Identity digit p                         |octet 4*        |

Figure 9.9.3.12.2: EPS mobile identity information element for type of identity "IMSI" or "IMEI"

Table 9.9.3.12.1: EPS mobile identity information element

|Type of identity (octet 3)                                                                          |
|Bits                                                                                                |
|3  |2  |1  |                                                                                        |
|0  |0  |1  |IMSI                                                                                    |
|1  |1  |0  |GUTI                                                                                    |
|0  |1  |1  |IMEI                                                                                    |
|                                                                                                    |
|All other values are reserved.                                                                      |
|                                                                                                    |
|Odd/even indication (octet 3)                                                                       |
|Bit                                                                                                 |
|4  |   |   |                                                                                        |
|0  |   |   |even number of identity digits and also when the GUTI is used                           |
|1  |   |   |odd number of identity digits                                                           |
|                                                                                                    |
|Identity digits (octet 4 etc)                                                                       |
|                                                                                                    |
|For the IMSI, this field is coded using BCD coding. If the number of identity digits is even then   |
|bits 5 to 8 of the last octet shall be filled with an end mark coded as "1111".                     |
|                                                                                                    |
|For the GUTI, then bits 5 to 8 of octet 3 are coded as "1111", octet 4 through 6 contain the MCC and|
|MNC values as specified below, and bit 8 of octet 7 is the most significant bit and bit 1 of the    |
|last octet the least significant bit for the subsequent fields. The required fields for the GUTI are|
|as defined in 3GPP TS 23.003 [2].                                                                   |
|MCC, Mobile country code (octet 4, octet 5 bits 1 to 4)                                             |
|                                                                                                    |
|The MCC field is coded as in ITU-T Recommendation E.212 [30], annex A.                              |
|                                                                                                    |
|MNC, Mobile network code (octet 5 bits 5 to 8, octet 6)                                             |
|                                                                                                    |
|The coding of this field is the responsibility of each administration but BCD coding shall be used. |
|The MNC shall consist of 2 or 3 digits. If a network operator decides to use only two digits in the |
|MNC, bits 5 to 8 of octet 5 shall be coded as "1111".                                               |
|                                                                                                    |
|The contents of the MCC and MNC digits are coded as octets 6 to 8 of the Temporary Mobile Group     |
|Identity IE in figure 10.5.154 of 3GPP TS 24.008 [13].                                              |
|                                                                                                    |
|For the IMEI, this field is coded using BCD coding. The format of the IMEI is described in          |
|3GPP TS 23.003 [2].                                                                                 |
|                                                                                                    |



9.9.3.12A	EPS network feature support

The purpose of the EPS network feature support information element is to indicate whether certain features are supported by the network.

The EPS network feature support information element is coded as shown in figure 9.9.3.12A.1 and table 9.9.3.12A.1.

The EPS network feature support is a type 4 information element with a minimum length of 3 octets and a maximum length of 4 octets.

If the network does not include octet 4 as defined below in the present version of the protocol, then the UE shall interpret this as a receipt of an information element with all bits of octet 4 coded as zero.

|8                                                                                    |7               |
|Length of EPS network feature support contents                                       |octet 2         |
|CP CIoT                                                                                                  |
|                                                                                                         |
|Bit                                                                                                      |
|1  |   |   |   |                                                                                        |
|0  |   |   |   |IMS voice over PS session in S1 mode not supported                                      |
|1  |   |   |   |IMS voice over PS session in S1 mode supported                                          |
|                                                                                                         |
|Emergency bearer services indicator (EMC BS) (octet 3, bit 2)                                            |
|                                                                                                         |
|Bit                                                                                                      |
|2  |   |   |   |                                                                                        |
|0  |   |   |   |emergency bearer services in S1 mode not supported                                      |
|1  |   |   |   |emergency bearer services in S1 mode supported                                          |
|                                                                                                         |
|Location services indicator in EPC (EPC-LCS) (octet 3, bit 3)                                            |
|                                                                                                         |
|Bit                                                                                                      |
|3  |   |   |   |                                                                                        |
|0  |   |   |   |location services via EPC not supported                                                 |
|1  |   |   |   |location services via EPC supported                                                     |
|                                                                                                         |
|Location services indicator in CS (CS-LCS) (octet 3, bit 4 to 5)                                         |
|                                                                                                         |
|Bit                                                                                                      |
|   |   |   |   |                                                                                        |
|5  |4  |   |   |                                                                                        |
|0  |0  |   |   |no information about support of location services via CS domain is available            |
|0  |1  |   |   |location services via CS domain supported                                               |
|1  |0  |   |   |location services via CS domain not supported                                           |
|1  |1  |   |   |reserved                                                                                |
|                                                                                                         |
|Support of EXTENDED SERVICE REQUEST for packet services (ESRPS)                                          |
|(octet 3, bit 6)                                                                                         |
|                                                                                                         |
|Bit                                                                                                      |
|6  |   |   |   |                                                                                        |
|0  |   |   |   |network does not support use of EXTENDED SERVICE REQUEST to request for packet services |
|1  |   |   |   |network supports use of EXTENDED SERVICE REQUEST to request for packet services         |
|                                                                                                         |
|EMM REGISTERED without PDN connectivity (ERw/oPDN)                                                       |
|(octet 3, bit 7)                                                                                         |
|This bit indicates the capability for EMM-REGISTERED without PDN connection                              |
|Bit                                                                                                      |
|7  |   |   |   |                                                                                        |
|0  |   |   |   |EMM-REGISTERED without PDN connection not supported                                     |
|1  |   |   |   |EMM-REGISTERED without PDN connectionsupported                                          |
|                                                                                                         |
|Control plane CIoT EPS optimization (CP CIoT)                                                            |
|(octet 3, bit 8)                                                                                         |
|This bit indicates the capability for control plane CIoT EPS optimization                                |
|Bit                                                                                                      |
|8                                                                                                        |
|0  |   |   |   |Control plane CIoT EPS optimization not supported                                       |
|1  |   |   |   |Control plane CIoT EPS optimization supported                                           |
|                                                                                                         |
|User plane CIoT EPS optimization (UP CIoT)                                                               |
|(octet 4, bit 1)                                                                                         |
|This bit indicates the capability for user plane CIoT EPS optimization                                   |
|Bit                                                                                                      |
|1                                                                                                        |
|0  |   |   |   |User plane CIoT EPS optimization not supported                                          |
|1  |   |   |   |User plane CIoT EPS optimization supported                                              |
|                                                                                                         |
|S1-u data transfer (S1-U data)                                                                           |
|(octet 4, bit 2)                                                                                         |
|This bit indicates the capability for S1-u data transfer. This bit shall be considered only if the       |
|Control plane CIoT EPS optimization (CP CIoT) bit (octet 3, bit 8) is set to 1. If the Control plane CIoT|
|EPS optimization (CP CIoT) bit (octet 3, bit 8) is set to 0, the UE shall assume S1-u data transfer is   |
|supported.                                                                                               |
|Bit                                                                                                      |
|2                                                                                                        |
|0  |   |   |   |S1-u data transfer not supported                                                        |
|1  |   |   |   |S1-u data transfer supported                                                            |
|                                                                                                         |
|Header compression for control plane CIoT EPS optimization (HC-CP CIoT)                                  |
|(octet 4, bit 3)                                                                                         |
|This bit indicates the capability for header compression for control plane CIoT EPS optimization         |
|Bit                                                                                                      |
|3                                                                                                        |
|0  |   |   |   |Header compression for control plane CIoT EPS optimization not supported                |
|1  |   |   |   |Header compression for control plane CIoT EPS optimization supported                    |
|                                                                                                         |
|                                                                                                         |
|Extended protocol configuration options (ePCO) (octet 4, bit 4)                                          |
|This bit indicates the support of the extended protocol configuration options IE.                        |
|Bit                                                                                                      |
|4                                                                                                        |
|0  |   |   |   |Extended protocol configuration options IE not supported                                |
|1  |   |   |   |Extended protocol configuration options IE supported                                    |
|                                                                                                         |
|                                                                                                         |
|Restriction on enhanced coverage (RestrictEC) (octet 4, bit 5)                                           |
|This bit indicates if the use of enhanced coverage is restricted or not.                                 |
|Bit                                                                                                      |
|5                                                                                                        |
|0  |   |   |   |Use of enhanced coverage is not restricted                                              |
|1  |   |   |   |Use of enhanced coverage is restricted                                                  |
|                                                                                                         |
|Restriction on the use of dual connectivity with NR (RestrictDCNR) (octet 4, bit 6)                      |
|This bit indicates if the use of dual connectivity with NR is restricted or not.                         |
|Bit                                                                                                      |
|6                                                                                                        |
|0  |   |   |   |Use of dual connectivity with NR is not restricted                                      |
|1  |   |   |   |Use of dual connectivity with NR is restricted                                          |
|                                                                                                         |
|Interworking without N26 interface indicator (IWK N26) (octet 4, bit 7)                                  |
|This bit indicates whether interworking without N26 interface is supported.                              |
|Bit                                                                                                      |
|7                                                                                                        |
|0  |   |   |   |Interworking without N26 interface not supported                                        |
|1  |   |   |   |Interworking without N26 interface supported                                            |
|                                                                                                         |
|Signalling for a maximum number of 15 EPS bearer contexts (15 bearers) (octet 4, bit 8)                  |
|This bit indicates the support of signalling for a maximum number of 15 EPS bearer contexts.             |
|Bit                                                                                                      |
|8                                                                                                        |
|0  |   |   |   |Signalling for a maximum number of 15 EPS bearer contexts not supported                 |
|1  |   |   |   |Signalling for a maximum number of 15 EPS bearer contexts supported                     |
|                                                                                                         |



9.9.3.13	EPS update result

The purpose of the EPS update result information element is to specify the result of the associated updating procedure.

The EPS update result information element is coded as shown in figure 9.9.3.13.1 and table 9.9.3.13.1.

The EPS update result is a type 1 information element.



|8                                        |7         |6                              |5                     |

Figure 9.9.3.13.1: EPS update result information element

Table 9.9.3.13.1: EPS update result information element

|EPS update result value (octet 1, bit 1 to 3)                                                            |
|Bits                                                                                                     |
|3  |2  |1  |   |                                                                                        |
|0  |0  |0  |   |TA updated                                                                              |
|0  |0  |1  |   |combined TA/LA updated                                                                  |
|1  |0  |0  |   |TA updated and ISR activated (NOTE)                                                     |
|1  |0  |1  |   |combined TA/LA updated and ISR activated (NOTE)                                         |
|                                                                                                         |
|All other values are reserved.                                                                           |
|                                                                                                         |
|Bit 4 of octet 1 is spare and shall be coded as zero.                                                    |
|                                                                                                         |
|NOTE: Values "TA updated and ISR activated" and "combined TA/LA updated and ISR activated" are used only |
|for a UE supporting also A/Gb or Iu mode.                                                                |



9.9.3.14	EPS update type

The purpose of the EPS update type information element is to specify the area the updating procedure is associated with.

The EPS update type information element is coded as shown in figure 9.9.3.14.1 and table 9.9.3.14.1.

The EPS update type is a type 1 information element.



|8                                        |7          |6                             |5                     |

Figure 9.9.3.14.1: EPS update type information element

Table 9.9.3.14.1: EPS update type information element

|EPS update type value (octet 1, bit 1 to 3)                                                              |
|                                                                                                         |
|Bits                                                                                                     |
|                                                                                                         |
|3  |2  |1  |   |                                                                                        |
|0  |0  |0  |   |TA updating                                                                             |
|0  |0  |1  |   |combined TA/LA updating                                                                 |
|0  |1  |0  |   |combined TA/LA updating with IMSI attach                                                |
|0  |1  |1  |   |periodic updating                                                                       |
|1  |0  |0  |   |unused; shall be interpreted as "TA updating", if received by the network.              |
|1  |0  |1  |   |unused; shall be interpreted as "TA updating", if received by the network.              |
|                                                                                                         |
|All other values are reserved.                                                                           |
|                                                                                                         |
|"Active" flag (octet 1, bit 4)                                                                           |
|Bit                                                                                                      |
|                                                                                                         |
|4  |   |   |   |                                                                                        |
|0  |   |   |   |No bearer establishment requested                                                       |
|1  |   |   |   |Bearer establishment requested                                                          |
|                                                                                                         |



9.9.3.15	ESM message container

The purpose of the ESM message container information element is to enable piggybacked transfer of a single ESM message within an EMM message. The ESM message included in this IE shall be coded as specified in subclause 8.3, i.e. without NAS security header.

The ESM message container information element is coded as shown in figure 9.9.3.15.1 and table 9.9.3.15.1.

The ESM message container is a type 6 information element.



|8                                                                                       |7                     |
|Length of ESM message container contents                                                |octet 2               |
|                                                                                        |octet 3               |
|                                                                                        |octet 4               |
|ESM message container contents                                                          |                      |
|                                                                                        |octet n               |

Figure 9.9.3.15.1: ESM message container information element

Table 9.9.3.15.1: ESM message container information element

|ESM message container contents (octet 4 to octet n); Max value of 65535 octets                           |
|                                                                                                         |
|This IE can contain any ESM PDU as defined in subclause 8.3.                                             |
|                                                                                                         |



9.9.3.16	GPRS timer

See subclause 10.5.7.3 in 3GPP TS 24.008 [13].


9.9.3.16A	GPRS timer 2

See subclause 10.5.7.4 in 3GPP TS 24.008 [13].


9.9.3.16B	GPRS timer 3

See subclause 10.5.7.4a in 3GPP TS 24.008 [13].


9.9.3.17	Identity type 2

See subclause 10.5.5.9 in 3GPP TS 24.008 [13].


9.9.3.18	IMEISV request

See subclause 10.5.5.10 in 3GPP TS 24.008 [13].


9.9.3.19	KSI and sequence number

The purpose of the KSI and sequence number information element is to provide the network with the key set identifier (KSI) value of the current EPS security context and the 5 least significant bits of the NAS COUNT value applicable for the message including this information element.

The KSI and sequence number information element is coded as shown in figure 9.9.3.19.1 and table 9.9.3.19.1.

The KSI and sequence number is a type 3 information element with a length of 2 octets.



|8                                                                                       |7                     |
|KSI                             |Sequence number (short)                               |octet 2               |

Figure 9.9.3.19.1: KSI and sequence number information element

Table 9.9.3.19.1: KSI and sequence number information element

|Sequence number (short) (octet 2, bit 1 to 5)                                                            |
|                                                                                                         |
|This field contains the 5 least significant bits of the NAS COUNT value applicable when this message is  |
|sent.                                                                                                    |
|                                                                                                         |
|KSI (octet 2, bit 6 to 8)                                                                                |
|                                                                                                         |
|This field contains the key set identifier value, as specified in bit 1 to 3 of octet 1 of the NAS key   |
|set identifier information element. (see subclause 9.9.3.21.)                                            |
|                                                                                                         |



9.9.3.20	MS network capability

See subclause 10.5.5.12 in 3GPP TS 24.008 [13].


9.9.3.20A	MS network feature support

See subclause 10.5.1.15 in 3GPP TS 24.008 [13].


9.9.3.21	NAS key set identifier

The NAS key set identifier is allocated by the network.

The NAS key set identifier information element is coded as shown in figure 9.9.3.21.1 and table 9.9.3.21.1.

The NAS key set identifier is a type 1 information element.



|8                                        |7         |6                              |5               |

Figure 9.9.3.21.1: NAS key set identifier information element

Table 9.9.3.21.1: NAS key set identifier information element

|Type of security context flag (TSC) (octet 1)                                                       |
|                                                                                                    |
|Bit                                                                                                 |
|4  |   |   |                                                                                        |
|0  |   |   |native security context (for KSIASME)                                                   |
|1  |   |   |mapped security context (for KSISGSN)                                                   |
|                                                                                                    |
|TSC does not apply for NAS key set identifier value "111".                                          |
|                                                                                                    |
|NAS key set identifier (octet 1)                                                                    |
|                                                                                                    |
|Bits                                                                                                |
|3  |2  |1  |                                                                                        |
|   |   |   |                                                                                        |
|0  |0  |0  |                                                                                        |
|through     |possible values for the NAS key set identifier                                          |
|1  |1  |0  |                                                                                        |
|   |   |   |                                                                                        |
|1  |1  |1  |no key is available (UE to network);                                                    |
|   |   |   |reserved (network to UE)                                                                |



9.9.3.22	NAS message container

This information element is used to encapsulate the SMS messages transferred between the UE and the network.The NAS message container information element is coded as shown in figure 9.9.3.22.1 and table 9.9.3.22.1.

The NAS message container is a type 4 information element with a minimum length of 4 octets and a maximum length of 253 octets.



|8                                                                                       |7                     |
|Length of NAS message container contents                                                |octet 2               |
|                                                                                        |octet 3               |
|NAS message container contents                                                          |                      |
|                                                                                        |octet n               |

Figure 9.9.3.22.1: NAS message container information element

Table 9.9.3.22.1: NAS message container information element

|NAS message container contents (octet 3 to octet n)                                                      |
|                                                                                                         |
|This IE can contain an SMS message (i.e. CP-DATA, CP-ACK or CP-ERROR) as defined in subclause 7.2 in     |
|3GPP TS 24.011 [13A].                                                                                    |
|                                                                                                         |



9.9.3.23	NAS security algorithms

The purpose of the NAS security algorithms information element is to indicate the algorithms to be used for ciphering and integrity protection.

The NAS security algorithms information element is coded as shown in figure 9.9.3.23.1 and table 9.9.3.23.1.

The NAS security algorithms is a type 3 information element with a length of 2 octets.



|8                                                                                       |7                     |
|0         |Type of ciphering algorithm     |0         |Type of integrity protection    |octet 2               |
|spare     |                                |spare     |algorithm                       |                      |

Figure 9.9.3.23.1: NAS security algorithms information element

Table 9.9.3.23.1: NAS security algorithms information element

|Type of integrity protection algorithm (octet 2, bit 1 to 3)                                             |
|Bits                                                                                                     |
|3  |2  |1  |   |                                                                                        |
|0  |0  |0  |   |EPS integrity algorithm EIA0 (null integrity protection algorithm)                      |
|0  |0  |1  |   |EPS integrity algorithm 128-EIA1                                                        |
|0  |1  |0  |   |EPS integrity algorithm 128-EIA2                                                        |
|0  |1  |1  |   |EPS integrity algorithm 128-EIA3                                                        |
|1  |0  |0  |   |EPS integrity algorithm EIA4                                                            |
|1  |0  |1  |   |EPS integrity algorithm EIA5                                                            |
|1  |1  |0  |   |EPS integrity algorithm EIA6                                                            |
|1  |1  |1  |   |EPS integrity algorithm EIA7                                                            |
|                                                                                                         |
|Type of ciphering algorithm (octet 2, bit 5 to 7)                                                        |
|Bits                                                                                                     |
|7  |6  |5  |   |                                                                                        |
|0  |0  |0  |   |EPS encryption algorithm EEA0 (null ciphering algorithm)                                |
|0  |0  |1  |   |EPS encryption algorithm 128-EEA1                                                       |
|0  |1  |0  |   |EPS encryption algorithm 128-EEA2                                                       |
|0  |1  |1  |   |EPS encryption algorithm 128-EEA3                                                       |
|1  |0  |0  |   |EPS encryption algorithm EEA4                                                           |
|1  |0  |1  |   |EPS encryption algorithm EEA5                                                           |
|1  |1  |0  |   |EPS encryption algorithm EEA6                                                           |
|1  |1  |1  |   |EPS encryption algorithm EEA7                                                           |
|                                                                                                         |
|Bit 4 and 8 of octet 2 are spare and shall be coded as zero.                                             |
|                                                                                                         |



9.9.3.24	Network name

See subclause 10.5.3.5a in 3GPP TS 24.008 [13].


9.9.3.24A	Network resource identifier container

See subclause 10.5.5.31 in 3GPP TS 24.008 [13].


9.9.3.25	Nonce

The purpose of the Nonce information element is to transfer a 32-bit nonce value to support deriving a new mapped EPS security context.

The Nonce information element is coded as shown in figure 9.9.3.25.1 and table 9.9.3.25.1.

The Nonce is a type 3 information element with a length of 5 octets.



|8         |7         |6         |5         |4         |3         |2         |1         |                |
|Nonce IEI                                                                           |octet 1         |
|                                                                                    |octet 2         |
|Nonce value                                                                         |                |
|                                                                                    |octet 5         |

Figure 9.9.3.25.1: Nonce information element

Table 9.9.3.25.1: Nonce information element

|Nonce value (octet 2 to 5)                                                                               |
|                                                                                                         |
|This field contains the binary representation of the nonce. Bit 8 of octet 2 represents the most         |
|significant bit of the nonce and bit 1 of octet 5 the least significant bit.                             |
|                                                                                                         |



9.9.3.25A	Paging identity

The purpose of the Paging identity information element is to indicate the identity used for paging for non-EPS services.

The Paging identity information element is coded as shown in figure 9.9.3.25A.1 and table 9.9.3.25A.1.

The Paging identity is a type 3 information element with 2 octets length.



|8                                                                                       |7                     |
|0                                                                            |0         |0                     |

Figure 9.9.3.25A.1: Paging identity information element

Table 9.9.3.25A.1: Paging identity information element

|Paging identity value (octet 2)                                                                          |
|                                                                                                         |
|Bit                                                                                                      |
|1                                                                                                        |
|0 IMSI                                                                                                   |
|1 TMSI                                                                                                   |
|                                                                                                         |



9.9.3.26	P-TMSI signature

See subclause 10.5.5.8 in 3GPP TS 24.008 [13].


9.9.3.26A	Extended EMM cause

The purpose of the extended EMM cause information element is to indicate additional information associated with the EMM cause.

The Extended EMM cause information element is coded as shown in figure 9.9.3.26A.1 and table 9.9.3.26A.1.

The Extended EMM cause is a type 1 information element.

|8                                              |7          |6           |5           |4             |3             |

Figure 9.9.3.26A.1: Extended EMM cause information element

Table 9.9.3.26A.1: Extended EMM cause information element

|E-UTRAN allowed value (octet 1, bit 1)                                                                   |
|                                                                                                         |
|Bit                                                                                                      |
|1  |   |                                                                                                |
|0  |   |E-UTRAN allowed                                                                                 |
|1  |   |E-UTRAN not allowed                                                                             |
|                                                                                                         |
|EPS optimization info (octet 1, bit 2)                                                                   |
|                                                                                                         |
|Bit                                                                                                      |
|0  |   |No EPS optimization information                                                                 |
|1  |   |requested EPS optimization not supported                                                        |
|                                                                                                         |
|NB-IoT allowed value (octet 1, bit 3)                                                                    |
|                                                                                                         |
|Bit                                                                                                      |
|0  |   |NB-IoT allowed                                                                                  |
|1  |   |NB-IoT not allowed                                                                              |
|                                                                                                         |
|Bit 4 of octet 1 is spare and shall be coded as zero.                                                    |
|                                                                                                         |



9.9.3.27	Service type

The purpose of the Service type information element is to specify the purpose of the service request procedure.

The Service type information element is coded as shown in figure 9.9.3.27.1 and table 9.9.3.27.1.

The Service type is a type 1 information element.



|8                                        |7                                        |6                     |

Figure 9.9.3.27.1: Service type information element

Table 9.9.3.27.1: Service type information element

|Service type value (octet 1)                                                                             |
|                                                                                                         |
|Service type value                                                                                       |
|Bits                                                                                                     |
|4                                                                                                        |
|All other values are reserved.                                                                           |
|                                                                                                         |



9.9.3.28	Short MAC

The purpose of the Short MAC information element is to protect the integrity of a SERVICE REQUEST message.

The integrity protection shall include octet 1 and 2 of the SERVICE REQUEST message. For the used algorithm and other input parameters to the algorithm see subclause 9.5. Only the 2 least significant octets of the resulting message authentication code are included in the information element.

The Short MAC information element is coded as shown in figure 9.9.3.28.1 and table 9.9.3.28.1.

The Short MAC is a type 3 information element with a length of 3 octets.



|8                                                                                       |7                     |
|Short MAC value                                                                         |octet 2               |
|Short MAC value (continued)                                                             |octet 3               |

Figure 9.9.3.28.1: Short MAC information element

Table 9.9.3.28.1: Short MAC information element

|Short MAC value (octet 2 and 3)                                                                          |
|                                                                                                         |
|This field contains the 2 least significant octets of the message authentication code calculated for the |
|SERVICE REQUEST message. Bit 1 of octet 3 contains the least significant bit, and bit 8 of octet 2 the   |
|most significant bit of these 2 octets.                                                                  |
|                                                                                                         |



9.9.3.29	Time zone

See subclause 10.5.3.8 in 3GPP TS 24.008 [13].


9.9.3.30	Time zone and time

See subclause 10.5.3.9 in 3GPP TS 24.008 [13].


9.9.3.31	TMSI status

See subclause 10.5.5.4 in 3GPP TS 24.008 [13].


9.9.3.32	Tracking area identity

The purpose of the Tracking area identity information element is to provide an unambiguous identification of tracking areas within the area covered by the 3GPP system.

The Tracking area identity information element is coded as shown in figure 9.9.3.32.1 and table 9.9.3.32.1.

The Tracking area identity is a type 3 information element with a length of 6 octets.



|8                                                                                   |7               |
|                                         |                                         |                |
|MCC digit 2                              |MCC digit 1                              |octet 2         |
|                                         |                                         |                |
|MNC digit 3                              |MCC digit 3                              |octet 3         |
|                                         |                                         |                |
|MNC digit 2                              |MNC digit 1                              |octet 4         |
|                                                                                    |                |
|TAC                                                                                 |octet 5         |
|                                                                                    |                |
|TAC (continued)                                                                     |octet 6         |

Figure 9.9.3.32.1: Tracking area identity information element

Table 9.9.3.32.1: Tracking area identity information element

|                                                                                                    |
|MCC, Mobile country code (octet 2 and 3)                                                            |
|The MCC field is coded as in ITU-T Rec. E212 [30], annex A.                                         |
|                                                                                                    |
|If the TAI is deleted the MCC and MNC shall take the value from the deleted TAI.                    |
|                                                                                                    |
|In abnormal cases, the MCC stored in the UE can contain elements not in the set {0, 1 ... 9}. In    |
|such cases the UE should transmit the stored values using full hexadecimal encoding. When receiving |
|such an MCC, the network shall treat the TAI as deleted.                                            |
|                                                                                                    |
|MNC, Mobile network code (octet 3 bits 5 to 8, octet 4)                                             |
|The coding of this field is the responsibility of each administration, but BCD coding shall be used.|
|The MNC shall consist of 2 or 3 digits. For PCS 1900 for NA, Federal regulation mandates that a     |
|3-digit MNC shall be used. However a network operator may decide to use only two digits in the MNC  |
|in the TAI over the radio interface. In this case, bits 5 to 8 of octet 3 shall be coded as "1111". |
|Mobile equipment shall accept a TAI coded in such a way.                                            |
|                                                                                                    |
|In abnormal cases, the MNC stored in the UE can have:                                               |
|- digit 1 or 2 not in the set {0, 1 ... 9}, or                                                      |
|- digit 3 not in the set {0, 1 ... 9, F} hex.                                                       |
|In such cases the UE shall transmit the stored values using full hexadecimal encoding. When         |
|receiving such an MNC, the network shall treat the TAI as deleted.                                  |
|                                                                                                    |
|The same handling shall apply for the network, if a 3-digit MNC is sent by the UE to a network using|
|only a 2-digit MNC.                                                                                 |
|                                                                                                    |
|TAC, Tracking area code (octet 5 and 6)                                                             |
|In the TAC field bit 8 of octet 5 is the most significant bit and bit 1 of octet 6 the least        |
|significant bit.                                                                                    |
|The coding of the tracking area code is the responsibility of each administration except that two   |
|values are used to mark the TAC, and hence the TAI, as deleted. Coding using full hexadecimal       |
|representation may be used. The tracking area code consists of 2 octets.                            |
|If a TAI has to be deleted then all bits of the tracking area code shall be set to one with the     |
|exception of the least significant bit which shall be set to zero. If a USIM is inserted in a mobile|
|equipment with the tracking area code containing all zeros, then the mobile equipment shall         |
|recognise this TAC as part of a deleted TAI.                                                        |



9.9.3.33	Tracking area identity list

The purpose of the Tracking area identity list information element is to transfer a list of tracking areas from the network to the UE.

The coding of the information element allows combining different types of lists. The lists of type "00" and "01" allow a more compact encoding, when the different TAIs are sharing the PLMN identity.

The Tracking area identity list information element is coded as shown in figure 9.9.3.33.1, figure 9.9.3.33.2, figure 9.9.3.33.3, figure 9.9.3.33.4 and table 9.9.3.33.1.

The Tracking area identity list is a type 4 information element, with a minimum length of 8 octets and a maximum length of 98 octets. The list can contain a maximum of 16 different tracking area identities.



|8         |7         |6         |5         |4         |3         |2         |1         |                   |
|Tracking area identity list IEI                                                     |octet 1            |
|Length of tracking area identity list contents                                      |octet 2            |
|                                                                                    |octet 3            |
|Partial tracking area identity list 1                                               |                   |
|                                                                                    |octet i            |
|                                                                                    |octet i+1*         |
|Partial tracking area identity list 2                                               |                   |
|                                                                                    |octet l*           |
|                                                                                    |octet l+1*         |
|…                                                                                   |                   |
|                                                                                    |octet m*           |
|                                                                                    |octet m+1*         |
|Partial tracking area identity list p                                               |                   |
|                                                                                    |octet n*           |

Figure 9.9.3.33.1: Tracking area identity list information element



|8         |7         |6         |5         |4         |3         |2         |1         |                   |
|0         |Type of list        |Number of elements                                  |octet 1            |
|Spare     |                    |                                                    |                   |
|                                         |                                         |                   |
|MCC digit 2                              |MCC digit 1                              |octet 2            |
|                                         |                                         |                   |
|MNC digit 3                              |MCC digit 3                              |octet 3            |
|                                         |                                         |                   |
|MNC digit 2                              |MNC digit 1                              |octet 4            |
|                                                                                    |                   |
|TAC 1                                                                               |octet 5            |
|                                                                                    |                   |
|TAC 1 (continued)                                                                   |octet 6            |
|…                                                                                   |…                  |
|…                                                                                   |…                  |
|                                                                                    |                   |
|TAC k                                                                               |octet 2k+3*        |
|                                                                                    |                   |
|TAC k (continued)                                                                   |octet 2k+4*        |

Figure 9.9.3.33.2: Partial tracking area identity list – type of list = "00"



|8         |7         |6         |5         |4         |3         |2         |1         |                   |
|0         |Type of list        |Number of elements                                  |octet 1            |
|Spare     |                    |                                                    |                   |
|                                         |                                         |                   |
|MCC digit 2                              |MCC digit 1                              |octet 2            |
|                                         |                                         |                   |
|MNC digit 3                              |MCC digit 3                              |octet 3            |
|                                         |                                         |                   |
|MNC digit 2                              |MNC digit 1                              |octet 4            |
|                                                                                    |                   |
|TAC 1                                                                               |octet 5            |
|                                                                                    |                   |
|TAC 1 (continued)                                                                   |octet 6            |

Figure 9.9.3.33.3: Partial tracking area identity list – type of list = "01"



|8         |7         |6         |5         |4         |3         |2         |1         |                   |
|0         |Type of list        |Number of elements                                  |octet 1            |
|Spare     |                    |                                                    |                   |
|                                         |                                         |                   |
|MCC digit 2                              |MCC digit 1                              |octet 2            |
|                                         |                                         |                   |
|MNC digit 3                              |MCC digit 3                              |octet 3            |
|                                         |                                         |                   |
|MNC digit 2                              |MNC digit 1                              |octet 4            |
|                                                                                    |                   |
|TAC 1                                                                               |octet 5            |
|                                                                                    |                   |
|TAC 1 (continued)                                                                   |octet 6            |
|                                         |                                         |                   |
|MCC digit 2                              |MCC digit 1                              |octet 7*           |
|                                         |                                         |                   |
|MNC digit 3                              |MCC digit 3                              |octet 8*           |
|                                         |                                         |                   |
|MNC digit 2                              |MNC digit 1                              |octet 9*           |
|                                                                                    |                   |
|TAC 2                                                                               |octet 10*          |
|                                                                                    |                   |
|TAC 2 (continued)                                                                   |octet 11*          |
|…                                                                                   |                   |
|…                                                                                   |                   |
|                                         |                                         |                   |
|MCC digit 2                              |MCC digit 1                              |octet 5k-3*        |
|                                         |                                         |                   |
|MNC digit 3                              |MCC digit 3                              |octet 5k-2*        |
|                                         |                                         |                   |
|MNC digit 2                              |MNC digit 1                              |octet 5k-1*        |
|                                                                                    |                   |
|TAC k                                                                               |octet 5k*          |
|                                                                                    |                   |
|TAC k (continued)                                                                   |octet 5k+1*        |

Figure 9.9.3.33.4: Partial tracking area identity list – type of list = "10"

Table 9.9.3.33.1: Tracking area identity list information element

|Value part of the Tracking area identity list information element (octet 3 to n)                         |
|                                                                                                         |
|The value part of the Tracking area identity list information element consists of one or several partial |
|tracking area identity lists. The length of each partial tracking area identity list can be determined   |
|from the 'type of list' field and the 'number of elements' field in the first octet of the partial       |
|tracking area identity list.                                                                             |
|The UE shall store the complete list received. If more than 16 TAIs are included in this information     |
|element, the UE shall store the first 16 TAIs and ignore the remaining octets of the information element.|
|                                                                                                         |
|                                                                                                         |
|Partial tracking area identity list:                                                                     |
|                                                                                                         |
|Type of list (octet 1)                                                                                   |
|Bits                                                                                                     |
|7  |6  |                                                                                                |
|0  |0  |list of TACs belonging to one PLMN, with non-consecutive TAC values                             |
|0  |1  |list of TACs belonging to one PLMN, with consecutive TAC values                                 |
|1  |0  |list of TAIs belonging to different PLMNs (see NOTE)                                            |
|                                                                                                         |
|All other values are reserved.                                                                           |
|                                                                                                         |
|Number of elements (octet 1)                                                                             |
|Bits                                                                                                     |
|5  |4  |3  |2  |1  |                                                                                    |
|0  |0  |0  |0  |0  | 1 element                                                                          |
|0  |0  |0  |0  |1  | 2 elements                                                                         |
|0  |0  |0  |1  |0  | 3 elements                                                                         |
|…                   |                                                                                    |
|0  |1  |1  |0  |1  | 14 elements                                                                        |
|0  |1  |1  |1  |0  | 15 elements                                                                        |
|0  |1  |1  |1  |1  | 16 elements                                                                        |
|                                                                                                         |
|All other values are unused and shall be interpreted as 16, if received by the UE.                       |
|                                                                                                         |
|Bit 8 of octet 1 is spare and shall be coded as zero.                                                    |
|                                                                                                         |
|                                                                                                         |
|For type of list = "00" and number of elements = k:                                                      |
|                                                                                                         |
|octet 2 to 4 contain the MCC+MNC, and                                                                    |
|for j = 1, k:                                                                                            |
|octet 2j+3 and 2j+4 contain the TAC of the j-th TAI belonging to the partial list,                       |
|                                                                                                         |
|For type of list = "01" and number of elements = k:                                                      |
|                                                                                                         |
|octet 2 to 4 contain the MCC+MNC, and                                                                    |
|octet 5 and 6 contain the TAC of the first TAI belonging to the partial list.                            |
|The TAC values of the other k-1 TAIs are TAC+1, TAC+2, …, TAC+k-1.                                       |
|                                                                                                         |
|For type of list = "10" and number of elements = k:                                                      |
|                                                                                                         |
|for j = 1, k.                                                                                            |
|octet 5j-3 to 5j-1 contain the MCC+MNC, and                                                              |
|octet 5j and 5j+1 contain the TAC of the j-th TAI belonging to the partial list.                         |
|                                                                                                         |
|                                                                                                         |
|MCC, Mobile country code                                                                                 |
|                                                                                                         |
|The MCC field is coded as in ITU-T Recommendation E.212 [30], annex A.                                   |
|                                                                                                         |
|MNC, Mobile network code                                                                                 |
|                                                                                                         |
|The coding of this field is the responsibility of each administration but BCD coding shall be used. The  |
|MNC shall consist of 2 or 3 digits. If a network operator decides to use only two digits in the MNC, MNC |
|digit 3 shall be coded as "1111".                                                                        |
|                                                                                                         |
|TAC, Tracking area code                                                                                  |
|                                                                                                         |
|In the TAC field bit 8 of the first octet is the most significant bit and bit 1 of second octet the least|
|significant bit.                                                                                         |
|The coding of the tracking area code is the responsibility of each administration. Coding using full     |
|hexadecimal representation may be used. The tracking area code consists of 2 octets.                     |
|                                                                                                         |
|NOTE: If the "list of TAIs belonging to different PLMNs" is used, the PLMNs included in the list need to |
|be present in the list of "equivalent PLMNs".                                                            |



9.9.3.34	UE network capability

The purpose of the UE network capability information element is to provide the network with information concerning aspects of the UE related to EPS or interworking with GPRS. The contents might affect the manner in which the network handles the operation of the UE. The UE network capability information indicates general UE characteristics and it shall therefore, except for fields explicitly indicated, be independent of the frequency band of the channel it is sent on.

The UE network capability information element is coded as shown in figure 9.9.3.34.1 and table 9.9.3.34.1.

The UE network capability is a type 4 information element with a minimum length of 4 octets and a maximum length of 15 octets.

  NOTE:	The requirements for the support of UMTS security algorithms in the UE are specified in 3GPP TS 33.102 [18], and the requirements for the support of EPS security algorithms in 3GPP TS 33.401 [19].



|8                                                                                    |7               |
|Length of UE network capability contents                                             |octet 2         |
|                                                                                     |128-            |
|EEA0                                                                                 |EEA1            |

Figure 9.9.3.34.1: UE network capability information element

Table 9.9.3.34.1: UE network capability information element

|EPS encryption algorithms supported (octet 3)                                                            |
|                                                                                                         |
|EPS encryption algorithm EEA0 supported (octet 3, bit 8)                                                 |
|0  |   |   |   |EPS encryption algorithm EEA0 not supported                                              |
|1  |   |   |   |EPS encryption algorithm EEA0 supported                                                  |
|                                                                                                         |
|EPS encryption algorithm 128-EEA1 supported (octet 3, bit 7)                                             |
|0  |   |   |   |EPS encryption algorithm 128-EEA1 not supported                                          |
|1  |   |   |   |EPS encryption algorithm 128-EEA1 supported                                              |
|                                                                                                         |
|EPS encryption algorithm 128-EEA2 supported (octet 3, bit 6)                                             |
|0  |   |   |   |EPS encryption algorithm 128-EEA2 not supported                                          |
|1  |   |   |   |EPS encryption algorithm 128-EEA2 supported                                              |
|                                                                                                         |
|EPS encryption algorithm 128-EEA3 supported (octet 3, bit 5)                                             |
|0  |   |   |   |EPS encryption algorithm 128-EEA3 not supported                                          |
|1  |   |   |   |EPS encryption algorithm 128-EEA3 supported                                              |
|                                                                                                         |
|EPS encryption algorithm EEA4 supported (octet 3, bit 4)                                                 |
|0  |   |   |   |EPS encryption algorithm EEA4 not supported                                              |
|1  |   |   |   |EPS encryption algorithm EEA4 supported                                                  |
|                                                                                                         |
|EPS encryption algorithm EEA5 supported (octet 3, bit 3)                                                 |
|0  |   |   |   |EPS encryption algorithm EEA5 not supported                                              |
|1  |   |   |   |EPS encryption algorithm EEA5 supported                                                  |
|                                                                                                         |
|EPS encryption algorithm EEA6 supported (octet 3, bit 2)                                                 |
|0  |   |   |   |EPS encryption algorithm EEA6 not supported                                              |
|1  |   |   |   |EPS encryption algorithm EEA6 supported                                                  |
|                                                                                                         |
|EPS encryption algorithm EEA7 supported (octet 3, bit 1)                                                 |
|0  |   |   |   |EPS encryption algorithm EEA7 not supported                                              |
|1  |   |   |   |EPS encryption algorithm EEA7 supported                                                  |
|                                                                                                         |
|EPS integrity algorithms supported (octet 4)                                                             |
|                                                                                                         |
|EPS integrity algorithm EIA0 supported (octet 4, bit 8)                                                  |
|0  |   |   |   |EPS integrity algorithm EIA0 not supported                                               |
|1  |   |   |   |EPS integrity algorithm EIA0 supported                                                   |
|                                                                                                         |
|EPS integrity algorithm 128-EIA1 supported (octet 4, bit 7)                                              |
|0  |   |   |   |EPS integrity algorithm 128-EIA1 not supported                                           |
|1  |   |   |   |EPS integrity algorithm 128-EIA1 supported                                               |
|                                                                                                         |
|EPS integrity algorithm 128-EIA2 supported (octet 4, bit 6)                                              |
|0  |   |   |   |EPS integrity algorithm 128-EIA2 not supported                                           |
|1  |   |   |   |EPS integrity algorithm 128-EIA2 supported                                               |
|                                                                                                         |
|EPS integrity algorithm 128-EIA3 supported (octet 4, bit 5)                                              |
|0  |   |   |   |EPS integrity algorithm 128-EIA3 not supported                                           |
|1  |   |   |   |EPS integrity algorithm 128-EIA3 supported                                               |
|                                                                                                         |
|EPS integrity algorithm EIA4 supported (octet 4, bit 4)                                                  |
|0  |   |   |   |EPS integrity algorithm EIA4 not supported                                               |
|1  |   |   |   |EPS integrity algorithm EIA4 supported                                                   |
|                                                                                                         |
|EPS integrity algorithm EIA5 supported (octet 4, bit 3)                                                  |
|0  |   |   |   |EPS integrity algorithm EIA5 not supported                                               |
|1  |   |   |   |EPS integrity algorithm EIA5 supported                                                   |
|                                                                                                         |
|EPS integrity algorithm EIA6 supported (octet 4, bit 2)                                                  |
|0  |   |   |   |EPS integrity algorithm EIA6 not supported                                               |
|1  |   |   |   |EPS integrity algorithm EIA6 supported                                                   |
|                                                                                                         |
|EPS integrity algorithm EIA7 supported (octet 4, bit 1)                                                  |
|0  |   |   |   |EPS integrity algorithm EIA7 not supported                                               |
|1  |   |   |   |EPS integrity algorithm EIA7 supported                                                   |
|                                                                                                         |
|UMTS encryption algorithms supported (octet 5)                                                           |
|                                                                                                         |
|UMTS encryption algorithm UEA0 supported (octet 5, bit 8)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA0 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA0 supported                                                 |
|                                                                                                         |
|UMTS encryption algorithm UEA1 supported (octet 5, bit 7)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA1 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA1 supported                                                 |
|                                                                                                         |
|UMTS encryption algorithm UEA2 supported (octet 5, bit 6)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA2 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA2 supported                                                 |
|                                                                                                         |
|UMTS encryption algorithm UEA3 supported (octet 5, bit 5)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA3 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA3 supported                                                 |
|                                                                                                         |
|UMTS encryption algorithm UEA4 supported (octet 5, bit 4)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA4 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA4 supported                                                 |
|                                                                                                         |
|UMTS encryption algorithm UEA5 supported (octet 5, bit 3)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA5 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA5 supported                                                 |
|                                                                                                         |
|UMTS encryption algorithm UEA6 supported (octet 5, bit 2)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA6 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA6 supported                                                 |
|                                                                                                         |
|UMTS encryption algorithm UEA7 supported (octet 5, bit 1)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA7 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA7 supported                                                 |
|                                                                                                         |
|UCS2 support (UCS2) (octet 6, bit 8)                                                                     |
|This information field indicates the likely treatment of UCS2 encoded character strings by the UE.       |
|                                                                                                         |
|0  |   |   |   |The UE has a preference for the default alphabet (defined in                             |
|   |   |   |   |3GPP TS 23.038 [3]) over UCS2 (see ISO/IEC 10646 [29]).                                  |
|1  |   |   |   |The UE has no preference between the use of the default alphabet and                     |
|   |   |   |   |the use of UCS2.                                                                         |
|                                                                                                         |
|UMTS integrity algorithms supported (octet 6)                                                            |
|                                                                                                         |
|UMTS integrity algorithm UIA1 supported (octet 6, bit 7)                                                 |
|0  |   |   |   |UMTS integrity algorithm UIA1 not supported                                              |
|1  |   |   |   |UMTS integrity algorithm UIA1 supported                                                  |
|                                                                                                         |
|UMTS integrity algorithm UIA2 supported (octet 6, bit 6)                                                 |
|0  |   |   |   |UMTS integrity algorithm UIA2 not supported                                              |
|1  |   |   |   |UMTS integrity algorithm UIA2 supported                                                  |
|                                                                                                         |
|UMTS integrity algorithm UIA3 supported (octet 6, bit 5)                                                 |
|0  |   |   |   |UMTS integrity algorithm UIA3 not supported                                              |
|1  |   |   |   |UMTS integrity algorithm UIA3 supported                                                  |
|                                                                                                         |
|UMTS integrity algorithm UIA4 supported (octet 6, bit 4)                                                 |
|0  |   |   |   |UMTS integrity algorithm UIA4 not supported                                              |
|1  |   |   |   |UMTS integrity algorithm UIA4 supported                                                  |
|                                                                                                         |
|UMTS integrity algorithm UIA5 supported (octet 6, bit 3)                                                 |
|0  |   |   |   |UMTS integrity algorithm UIA5 not supported                                              |
|1  |   |   |   |UMTS integrity algorithm UIA5 supported                                                  |
|                                                                                                         |
|UMTS integrity algorithm UIA6 supported (octet 6, bit 2)                                                 |
|0  |   |   |   |UMTS integrity algorithm UIA6 not supported                                              |
|1  |   |   |   |UMTS integrity algorithm UIA6 supported                                                  |
|                                                                                                         |
|UMTS integrity algorithm UIA7 supported (octet 6, bit 1)                                                 |
|0  |   |   |   |UMTS integrity algorithm UIA7 not supported                                              |
|1  |   |   |   |UMTS integrity algorithm UIA7 supported                                                  |
|                                                                                                         |
|NF capability (octet 7, bit 1)                                                                           |
|0  |   |   |   |notification procedure not supported                                                     |
|1  |   |   |   |notification procedure supported                                                         |
|                                                                                                         |
|1xSRVCC capability (octet 7, bit 2)                                                                      |
|0  |   |   |   |SRVCC from E-UTRAN to cdma2000® 1x CS not supported                                      |
|1  |   |   |   |SRVCC from E-UTRAN to cdma2000® 1x CS supported                                          |
|   |   |   |   |(see 3GPP TS 23.216 [8])                                                                 |
|                                                                                                         |
|Location services (LCS) notification mechanisms capability (octet 7, bit 3)                              |
|0  |   |   |   |LCS notification mechanisms not supported                                                |
|1  |   |   |   |LCS notification mechanisms supported (see 3GPP TS 24.171 [13C])                         |
|                                                                                                         |
|LTE Positioning Protocol (LPP) capability (octet 7, bit 4)                                               |
|0  |   |   |   |LPP not supported                                                                        |
|1  |   |   |   |LPP supported (see 3GPP TS 36.355 [22A])                                                 |
|                                                                                                         |
|Access class control for CSFB (ACC-CSFB) capability (octet 7, bit 5)                                     |
|0  |   |   |   |eNodeB-based access class control for CSFB not supported                                 |
|1  |   |   |   |eNodeB-based access class control for CSFB supported                                     |
|   |   |   |   |(see 3GPP TS 22.011 [1A])                                                                |
|                                                                                                         |
|H.245 After SRVCC Handover capability (H.245-ASH) (octet 7, bit 6)                                       |
|This bit indicates the capability for H.245 with support and use of pre-defined codecs, and if needed,   |
|H.245 codec negotiation after SRVCC handover.                                                            |
|0  |   |   |   |H.245 after SRVCC handover capability not supported                                      |
|1  |   |   |   |H.245 after SRVCC handover capability supported                                          |
|   |   |   |   |(see 3GPP TS 23.216 [8])                                                                 |
|                                                                                                         |
|ProSe (octet 7, bit 7)                                                                                   |
|This bit indicates the capability for ProSe.                                                             |
|0  |   |   |   |ProSe not supported                                                                      |
|1  |   |   |   |ProSe supported                                                                          |
|                                                                                                         |
|ProSe direct discovery (ProSe-dd) (octet 7, bit 8)                                                       |
|This bit indicates the capability for ProSe direct discovery.                                            |
|0  |   |   |   |ProSe direct discovery not supported                                                     |
|1  |   |   |   |ProSe direct discovery supported                                                         |
|                                                                                                         |
|ProSe direct communication (ProSe-dc) (octet 8, bit 1)                                                   |
|This bit indicates the capability for ProSe direct communication.                                        |
|0  |   |   |   |ProSe direct communication not supported                                                 |
|1  |   |   |   |ProSe direct communication supported                                                     |
|                                                                                                         |
|ProSe UE-to-network-relay (ProSe-relay) (octet 8, bit 2)                                                 |
|This bit indicates the capability to act as a ProSe UE-to-network relay                                  |
|0  |   |   |   |Acting as a ProSe UE-to-network relay not supported                                      |
|1  |   |   |   |Acting as a ProSe UE-to-network relay supported                                          |
|                                                                                                         |
|Control plane CIoT EPS optimization (CP CIoT) (octet 8, bit 3)                                           |
|This bit indicates the capability for control plane CIoT EPS optimization.                               |
|0  |   |   |   |Control plane CIoT EPS optimization not supported                                        |
|1  |   |   |   |Control plane CIoT EPS optimization supported                                            |
|                                                                                                         |
|User plane CIoT EPS optimization (UP CIoT) (octet 8, bit 4)                                              |
|This bit indicates the capability for user plane CIoT EPS optimization.                                  |
|0  |   |   |   |User plane CIoT EPS optimization not supported                                           |
|1  |   |   |   |User plane CIoT EPS optimization supported                                               |
|                                                                                                         |
|S1-u data transfer (S1-U data) (octet 8, bit 5)                                                          |
|This bit indicates the capability for S1-u data transfer.                                                |
|0  |   |   |   |S1-U data transfer not supported                                                         |
|1  |   |   |   |S1-U data transfer supported                                                             |
|                                                                                                         |
|EMM-REGISTERED without PDN connection (ERw/oPDN) (octet 8, bit 6)                                        |
|This bit indicates the capability for EMM REGISTERED without PDN connectivity.                           |
|0  |   |   |   |EMM-REGISTERED without PDN connection not supported                                      |
|1  |   |   |   |EMM-REGISTERED without PDN connection supported                                          |
|                                                                                                         |
|Header compression for control plane CIoT EPS optimization (HC-CP CIoT) (octet 8, bit 7)                 |
|This bit indicates the capability for header compression for control plane CIoT EPS optimization.        |
|0  |   |   |   |Header compression for control plane CIoT EPS optimization not supported                 |
|1  |   |   |   |Header compression for control plane CIoT EPS optimization supported                     |
|                                                                                                         |
|Extended protocol configuration options (ePCO) (octet 8, bit 8)                                          |
|This bit indicates the support of the extended protocol configuration options IE.                        |
|0  |   |   |   |Extended protocol configuration options IE not supported                                 |
|1  |   |   |   |Extended protocol configuration options IE supported                                     |
|                                                                                                         |
|Multiple DRB support (multipleDRB) (octet 9, bit 1)                                                      |
|This bit indicates the capability to support multiple user plane radio bearers (see 3GPP TS 36.306 [44], |
|3GPP TS 36.331 [22]) in NB-S1 mode.                                                                      |
|0  |   |   |   |Multiple DRB not supported                                                               |
|1  |   |   |   |Multiple DRB supported                                                                   |
|                                                                                                         |
|V2X communication over PC5 (V2X PC5) (octet 9, bit 2)                                                    |
|This bit indicates the capability for V2X communication over PC5.                                        |
|0  |   |   |   |V2X communication over PC5 not supported                                                 |
|1  |   |   |   |V2X communication over PC5 supported                                                     |
|                                                                                                         |
|Restriction on use of enhanced coverage support (RestrictEC) (octet 9, bit 3)                            |
|This bit indicates the capability to support restriction on use of enhanced coverage.                    |
|0  |   |   |   |Restriction on use of enhanced coverage not supported                                    |
|1  |   |   |   |Restriction on use of enhanced coverage supported                                        |
|                                                                                                         |
|Control plane data backoff support (CP backoff) (octet 9, bit 4)                                         |
|This bit indicates the support of back-off timer for transport of user data via the control plane..      |
|0  |   |   |   |back-off timer for transport of user data via the control plane not supported            |
|1  |   |   |   |back-off timer for transport of user data via the control plane supported                |
|                                                                                                         |
|Dual connectivity with NR (DCNR) (octet 9, bit 5)                                                        |
|This bit indicates the capability for dual connecitivity with NR.                                        |
|0  |   |   |   |dual connectivity with NR not supported                                                  |
|1  |   |   |   |dual connectivity with NR supported                                                      |
|                                                                                                         |
|N1 mode supported (N1mode) (octet 9, bit 6)                                                              |
|This bit indicates the capability for N1 mode.                                                           |
|0  |   |   |   |N1 mode not supported                                                                    |
|1  |   |   |   |N1 mode supported                                                                        |
|                                                                                                         |
|Service gap control (SGC) (octet 9, bit 7)                                                               |
|This bit indicates the capability for service gap control                                                |
|0  |   |   |   |service gap control not supported                                                        |
|1  |   |   |   |service gap control supported                                                            |
|                                                                                                         |
|Signalling for a maximum number of 15 EPS bearer contexts (15 bearers) (octet 9, bit 8)                  |
|This bit indicates the support of signalling for a maximum number of 15 EPS bearer contexts              |
|0  |   |   |   |Signalling for a maximum number of 15 EPS bearer contexts not supported                  |
|1  |   |   |   |Signalling for a maximum number of 15 EPS bearer contexts supported                      |
|                                                                                                         |
|All other bits in octet 10 to 15 are spare and shall be coded as zero, if the respective octet is        |
|included in the information element.                                                                     |
|                                                                                                         |
|NOTE 1: For a UE supporting dual connectivity with NR, if the UE supports one of the encryption          |
|algorithms for E-UTRAN (bits 8 to 5 of octet 3), it shall support the same algorithm for NR-PDCP as      |
|specified in 3GPP TS 33.401 [19]. The NR-PDCP is specified in 3GPP TS 38.323 [53].                       |
|                                                                                                         |
|NOTE 2: For a UE supporting dual connectivity with NR, if the UE supports one of the integrity algorithms|
|for E-UTRAN (bits 8 to 5 of octet 4), it shall support the same algorithm for NR-PDCP as specified in    |
|3GPP TS 33.401 [19].                                                                                     |



9.9.3.35	UE radio capability information update needed

The purpose of the UE radio capability information update needed information element is to indicate whether the MME shall delete the stored UE radio capability information, if any.

The UE radio capability information update needed information element is coded as shown in figure 9.9.3.35.1and table 9.9.3.35.1.

The UE radio capability information update needed is a type 1 information element.



|8                                           |7         |6         |5         |4         |3                      |
|                                            |spare                          |          |                       |

Figure 9.9.3.35.1: UE radio capability information update needed information element

Table 9.9.3.35.1: UE radio capability information update needed information element

|UE radio capability information update needed flag (URC upd) (octet 1)                                   |
|Bit                                                                                                      |
|1  |   |   |   |                                                                                        |
|0  |   |   |   |UE radio capability information update not needed                                       |
|1  |   |   |   |UE radio capability information update needed                                           |
|                                                                                                         |



9.9.3.36	UE security capability

The UE security capability information element is used by the network to indicate which security algorithms are supported by the UE in S1 mode, Iu mode and Gb mode. Security algorithms supported in S1 mode are supported both for NAS and for AS security. If the UE supports S101 mode, then these security algorithms are also supported for NAS security in S101 mode.

The UE security capability information element is coded as shown in figure 9.9.3.36.1 and table 9.9.3.36.1.

The UE security capability is a type 4 information element with a minimum length of 4 octets and a maximum length of 7 octets.

Octets 5, 6, and 7 are optional. If octet 5 is included, then also octet 6 shall be included and octet 7 may be included.

If a UE did not indicate support of any security algorithm for Gb mode, octet 7 shall not be included. If the UE did not indicate support of any security algorithm for Iu mode and Gb mode, octets 5, 6, and 7 shall not be included.

If the UE did not indicate support of any security algorithm for Iu mode but indicated support of a security algorithm for Gb mode, octets 5, 6, and 7 shall be included. In this case octets 5 and 6 are filled with the value of zeroes.



|8                                                                                    |7               |
|Length of UE security capability contents                                            |octet 2         |
|                                                                                                         |
|EEA0                                                                                                     |
|                                                                                                         |
|EPS encryption algorithm EEA0 supported (octet 3, bit 8)                                                 |
|0  |   |   |   |EPS encryption algorithm EEA0 not supported                                              |
|1  |   |   |   |EPS encryption algorithm EEA0 supported                                                  |
|                                                                                                         |
|EPS encryption algorithm 128-EEA1 supported (octet 3, bit 7)                                             |
|0  |   |   |   |EPS encryption algorithm 128-EEA1 not supported                                          |
|1  |   |   |   |EPS encryption algorithm 128-EEA1 supported                                              |
|                                                                                                         |
|EPS encryption algorithm 128-EEA2 supported (octet 3, bit 6)                                             |
|0  |   |   |   |EPS encryption algorithm 128-EEA2 not supported                                          |
|1  |   |   |   |EPS encryption algorithm 128-EEA2 supported                                              |
|                                                                                                         |
|EPS encryption algorithm 128-EEA3 supported (octet 3, bit 5)                                             |
|0  |   |   |   |EPS encryption algorithm 128-EEA3 not supported                                          |
|1  |   |   |   |EPS encryption algorithm 128-EEA3 supported                                              |
|                                                                                                         |
|EPS encryption algorithm EEA4 supported (octet 3, bit 4)                                                 |
|0  |   |   |   |EPS encryption algorithm EEA4 not supported                                              |
|1  |   |   |   |EPS encryption algorithm EEA4 supported                                                  |
|                                                                                                         |
|EPS encryption algorithm EEA5 supported (octet 3, bit 3)                                                 |
|0  |   |   |   |EPS encryption algorithm EEA5 not supported                                              |
|1  |   |   |   |EPS encryption algorithm EEA5 supported                                                  |
|                                                                                                         |
|EPS encryption algorithm EEA6 supported (octet 3, bit 2)                                                 |
|0  |   |   |   |EPS encryption algorithm EEA6 not supported                                              |
|1  |   |   |   |EPS encryption algorithm EEA6 supported                                                  |
|                                                                                                         |
|EPS encryption algorithm EEA7 supported (octet 3, bit 1)                                                 |
|0  |   |   |   |EPS encryption algorithm EEA7 not supported                                              |
|1  |   |   |   |EPS encryption algorithm EEA7 supported                                                  |
|                                                                                                         |
|EPS integrity algorithms supported (octet 4)                                                             |
|                                                                                                         |
|EPS integrity algorithm EIA0 supported (octet 4, bit 8)                                                  |
|0  |   |   |   |EPS integrity algorithm EIA0 not supported                                               |
|1  |   |   |   |EPS integrity algorithm EIA0 supported                                                   |
|                                                                                                         |
|EPS integrity algorithm 128-EIA1 supported (octet 4, bit 7)                                              |
|0  |   |   |   |EPS integrity algorithm 128-EIA1 not supported                                           |
|1  |   |   |   |EPS integrity algorithm 128-EIA1 supported                                               |
|                                                                                                         |
|EPS integrity algorithm 128-EIA2 supported (octet 4, bit 6)                                              |
|0  |   |   |   |EPS integrity algorithm 128-EIA2 not supported                                           |
|1  |   |   |   |EPS integrity algorithm 128-EIA2 supported                                               |
|                                                                                                         |
|EPS integrity algorithm 128-EIA3 supported (octet 4, bit 5)                                              |
|0  |   |   |   |EPS integrity algorithm 128-EIA3 not supported                                           |
|1  |   |   |   |EPS integrity algorithm 128-EIA3 supported                                               |
|                                                                                                         |
|EPS integrity algorithm EIA4 supported (octet 4, bit 4)                                                  |
|0  |   |   |   |EPS integrity algorithm EIA4 not supported                                               |
|1  |   |   |   |EPS integrity algorithm EIA4 supported                                                   |
|                                                                                                         |
|EPS integrity algorithm EIA5 supported (octet 4, bit 3)                                                  |
|0  |   |   |   |EPS integrity algorithm EIA5 not supported                                               |
|1  |   |   |   |EPS integrity algorithm EIA5 supported                                                   |
|                                                                                                         |
|EPS integrity algorithm EIA6 supported (octet 4, bit 2)                                                  |
|0  |   |   |   |EPS integrity algorithm EIA6 not supported                                               |
|1  |   |   |   |EPS integrity algorithm EIA6 supported                                                   |
|                                                                                                         |
|EPS integrity algorithm EIA7 supported (octet 4, bit 1)                                                  |
|0  |   |   |   |EPS integrity algorithm EIA7 not supported                                               |
|1  |   |   |   |EPS integrity algorithm EIA7 supported                                                   |
|                                                                                                         |
|UMTS encryption algorithms supported (octet 5)                                                           |
|                                                                                                         |
|UMTS encryption algorithm UEA0 supported (octet 5, bit 8)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA0 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA0 supported                                                 |
|                                                                                                         |
|UMTS encryption algorithm UEA1 supported (octet 5, bit 7)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA1 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA1 supported                                                 |
|                                                                                                         |
|UMTS encryption algorithm UEA2 supported (octet 5, bit 6)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA2 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA2 supported                                                 |
|                                                                                                         |
|UMTS encryption algorithm UEA3 supported (octet 5, bit 5)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA3 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA3 supported                                                 |
|                                                                                                         |
|UMTS encryption algorithm UEA4 supported (octet 5, bit 4)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA4 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA4 supported                                                 |
|                                                                                                         |
|UMTS encryption algorithm UEA5 supported (octet 5, bit 3)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA5 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA5 supported                                                 |
|                                                                                                         |
|UMTS encryption algorithm UEA6 supported (octet 5, bit 2)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA6 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA6 supported                                                 |
|                                                                                                         |
|UMTS encryption algorithm UEA7 supported (octet 5, bit 1)                                                |
|0  |   |   |   |UMTS encryption algorithm UEA7 not supported                                             |
|1  |   |   |   |UMTS encryption algorithm UEA7 supported                                                 |
|                                                                                                         |
|UMTS integrity algorithms supported (octet 6)                                                            |
|                                                                                                         |
|Bit 8 of octet 6 is spare and shall be coded as zero.                                                    |
|                                                                                                         |
|UMTS integrity algorithm UIA1 supported (octet 6, bit 7)                                                 |
|0  |   |   |   |UMTS integrity algorithm UIA1 not supported                                              |
|1  |   |   |   |UMTS integrity algorithm UIA1 supported                                                  |
|                                                                                                         |
|UMTS integrity algorithm UIA2 supported (octet 6, bit 6)                                                 |
|0  |   |   |   |UMTS integrity algorithm UIA2 not supported                                              |
|1  |   |   |   |UMTS integrity algorithm UIA2 supported                                                  |
|                                                                                                         |
|UMTS integrity algorithm UIA3 supported (octet 6, bit 5)                                                 |
|0  |   |   |   |UMTS integrity algorithm UIA3 not supported                                              |
|1  |   |   |   |UMTS integrity algorithm UIA3 supported                                                  |
|                                                                                                         |
|UMTS integrity algorithm UIA4 supported (octet 6, bit 4)                                                 |
|0  |   |   |   |UMTS integrity algorithm UIA4 not supported                                              |
|1  |   |   |   |UMTS integrity algorithm UIA4 supported                                                  |
|                                                                                                         |
|UMTS integrity algorithm UIA5 supported (octet 6, bit 3)                                                 |
|0  |   |   |   |UMTS integrity algorithm UIA5 not supported                                              |
|1  |   |   |   |UMTS integrity algorithm UIA5 supported                                                  |
|                                                                                                         |
|UMTS integrity algorithm UIA6 supported (octet 6, bit 2)                                                 |
|0  |   |   |   |UMTS integrity algorithm UIA6 not supported                                              |
|1  |   |   |   |UMTS integrity algorithm UIA6 supported                                                  |
|                                                                                                         |
|UMTS integrity algorithm UIA7 supported (octet 6, bit 1)                                                 |
|0  |   |   |   |UMTS integrity algorithm UIA7 not supported                                              |
|1  |   |   |   |UMTS integrity algorithm UIA7 supported                                                  |
|                                                                                                         |
|GPRS encryption algorithms supported (octet 7)                                                           |
|                                                                                                         |
|Bit 8 of octet 7 is spare and shall be coded as zero.                                                    |
|                                                                                                         |
|GPRS encryption algorithm GEA1 supported (octet 7, bit 7)                                                |
|0  |   |   |   |GPRS encryption algorithm GEA1 not supported                                             |
|1  |   |   |   |GPRS encryption algorithm GEA1 supported                                                 |
|                                                                                                         |
|GPRS encryption algorithm GEA2 supported (octet 7, bit 6)                                                |
|0  |   |   |   |GPRS encryption algorithm GEA2 not supported                                             |
|1  |   |   |   |GPRS encryption algorithm GEA2 supported                                                 |
|                                                                                                         |
|GPRS encryption algorithm GEA3 supported (octet 7, bit 5)                                                |
|0  |   |   |   |GPRS encryption algorithm GEA3 not supported                                             |
|1  |   |   |   |GPRS encryption algorithm GEA3 supported                                                 |
|                                                                                                         |
|GPRS encryption algorithm GEA4 supported (octet 7, bit 4)                                                |
|0  |   |   |   |GPRS encryption algorithm GEA4 not supported                                             |
|1  |   |   |   |GPRS encryption algorithm GEA4 supported                                                 |
|                                                                                                         |
|GPRS encryption algorithm GEA5 supported (octet 7, bit 3)                                                |
|0  |   |   |   |GPRS encryption algorithm GEA5 not supported                                             |
|1  |   |   |   |GPRS encryption algorithm GEA5 supported                                                 |
|                                                                                                         |
|GPRS encryption algorithm GEA6 supported (octet 7, bit 2)                                                |
|0  |   |   |   |GPRS encryption algorithm GEA6 not supported                                             |
|1  |   |   |   |GPRS encryption algorithm GEA6 supported                                                 |
|                                                                                                         |
|GPRS encryption algorithm GEA7 supported (octet 7, bit 1)                                                |
|0  |   |   |   |GPRS encryption algorithm GEA7 not supported                                             |
|1  |   |   |   |GPRS encryption algorithm GEA7 supported                                                 |
|                                                                                                         |
|NOTE 1: For a UE supporting dual connectivity with NR. if the UE supports one of the encryption          |
|algorithms for E-UTRAN (bits 8 to 5 of octet 3), it shall support the same algorithm for NR-PDCP as      |
|specified in 3GPP TS 33.401 [19].                                                                        |
|                                                                                                         |
|NOTE 2: For a UE supporting dual connectivity with NR, if the UE supports one of the integrity algorithms|
|for E-UTRAN (bits 8 to 5 of octet 4), it shall support the same algorithm for NR-PDCP as specified in    |
|3GPP TS 33.401 [19].                                                                                     |



9.9.3.37	Emergency Number List

See subclause 10.5.3.13 in 3GPP TS 24.008 [13].


9.9.3.37A	Extended emergency number list

The purpose of this information element is to encode one or more local emergency number(s) together with a sub-services field containing zero ore more sub-services of the associated emergency service URN and a validity indication. An emergency service URN is a service URN with top level service type of "sos" as specified in IETF RFC 5031 [55].

  EXAMPLE 1:	If the associated emergency service URN is "urn:service:sos.gas", there is only one sub-service provided in the sub-services field which is "gas".

  EXAMPLE 2:	If the associated emergency service URN is "urn:service:sos", there is no sub-services provided in the sub-services field and the length of the sub-services field is "0".

  NOTE:	The associated emergency service URN can be a country-specific emergency service URN as defined in 3GPP TS 24.229 [13D].

The Extended emergency number list information element is coded as shown in figure 9.9.3.37A.1 and table 9.9.3.37A.1.

The Extended emergency number list IE is a type 6 information element with a minimum length of 6 octets and a maximum length of 65538 octets.

|8                                                                                       |7                   |
|Length of Extended emergency number list IE contents                                    |octet 2             |
|                                                                                        |octet 3             |
|0                                                                            |0         |0                   |
|Length of 1st Emergency Number information (Note 1)                                     |octet 5             |
|Number digit 2                             |Number digit 1                             |octet 6             |
|                                           |                                           |(Note 2)            |
|Number digit 4                             |Number digit 3                             |octet 7*            |
|                                           |                                           |                    |
|:                                          |:                                          |:                   |
|                                           |                                           |                    |
|(Note 3)                                   |                                           |octet j-1*          |
|                                           |                                           |                    |
|Length of 1st sub-services field (Note 4)                                               |octet j             |
|sub-services field                                                                      |octet j+1*          |
|                                                                                        |(Note 5)            |
|                                                                                        |octet k-1*          |
|Length of 2nd Emergency Number information (Note 1)                                     |octet k*            |
|Number digit 2                             |Number digit 1                             |octet k+1*          |
|                                           |                                           |(Note 2)            |
|Number digit 4                             |Number digit 3                             |octet k+2*          |
|                                           |                                           |                    |
|:                                          |:                                          |:                   |
|                                           |                                           |                    |
|(Note 3)                                   |:                                          |octet l-1*          |
|                                           |                                           |                    |
|Length of 2nd sub-services field (Note 4)                                               |octet l*            |
|sub-services field                                                                      |octet l+1*          |
|                                                                                        |(Note 5)            |
|                                                                                        |octet m-1*          |
|Length of 3rd Emergency Number information (Note 1)                                     |octet m*            |
|Number digit 2                             |Number digit 1                             |octet m+1*          |
|                                           |                                           |(Note 2)            |
|Number digit 4                             |Number digit 3                             |octet m+2*          |
|                                           |                                           |                    |
|:                                          |:                                          |:                   |
|                                           |                                           |                    |
|(Note 3)                                   |:                                          |octet n-1*          |
|                                           |                                           |                    |
|Length of 3rd sub-services field (Note 4)                                               |octet n*            |
|sub-services field                                                                      |octet n+1*          |
|                                                                                        |(Note 5)            |
|                                                                                        |octet o*            |


  NOTE 1:	The length shall contain the number of octets used to encode the number digits.
  NOTE 2:	The number digit(s) in octet 6 precedes the digit(s) in octet 7 etc. The number digit, which would be entered first, is located in octet 7, bits 1 to 4. The contents of the number digits are coded as shown in table 10.5.118/3GPP TS 24.008 [13].
  NOTE 3:	If the emergency number contains an odd number of digits, bits 5 to 8 of the last octet of the respective emergency number shall be filled with an end mark coded as "1111".
  NOTE 4:	The length shall contain the number of octets used to encode the sub-services field.
  NOTE 5:	The characters of the sub-services of the associated emergency service URN shall be coded in accordance to GSM 7 bit default alphabet (see 3GPP TS 23.038 [3]) and the first character starts in octet j+1, l+1 or n+1.


Figure 9.9.3.37A.1 Extended Emergency Number List IE

  EXAMPLE 3:	If the associated emergency service URN is "urn:service:sos.police.municipal", the sub-services field contains "police.municipal" and the first character is "p".

Table 9.9.3.37A.1: Extended Emergency Number List Validity information IE

|Extended Emergency Number List Validity (EENLV) (octet 4)                                                |
|Bit                                                                                                      |
|1  |   |   |   |                                                                                        |
|0  |   |   |   |Extended Local Emergency Numbers List is valid in the country of the PLMN from which    |
|   |   |   |   |this IE is received                                                                     |
|1  |   |   |   |Extended Local Emergency Numbers List is valid only in the PLMN from which this IE is   |
|   |   |   |   |received                                                                                |
|                                                                                                         |



9.9.3.38	CLI

The purpose of the CLI information element is to convey information about the calling line for a terminated call to a CS fallback capable UE.

The CLI information element is coded as shown in figure 9.9.3.38.1 and table 9.9.3.38.1.

The CLI is a type 4 information element with a minimum length of 3 octets and a maximum length of 14 octets.



|8                                                                                       |7                     |
|Length of CLI                                                                           |octet 2               |
|                                                                                        |octet 3               |
|CLI (value part)                                                                        |to                    |
|                                                                                        |octet 14              |

Figure 9.9.3.38.1: CLI information element

Table 9.9.3.38.1: CLI information element

|CLI (value part)                                                                                         |
|                                                                                                         |
|The coding of the CLI value part is the same as for octets 3 to 14 of the Calling party BCD number       |
|information element defined in subclause 10.5.4.9 of 3GPP TS 24.008 [13].                                |



9.9.3.39	SS Code

The purpose of the SS code information element is to convey information related to a network initiated supplementary service request to a CS fallback capable UE.

The SS Code information element is coded as shown in figure 9.9.3.39.1 and table 9.9.3.39.1.

The SS Code is a type 3 information element with 2 octets length.



|8                                                                                       |7                     |
|SS Code value                                                                           |octet 2               |

Figure 9.9.3.39.1: SS Code information element

Table 9.9.3.39.1: SS Code information element

|SS Code value                                                                                            |
|                                                                                                         |
|The coding of the SS Code value is given in subclause 17.7.5 of 3GPP TS 29.002 [15C].                    |



9.9.3.40	LCS indicator

The purpose of the LCS indicator information element is to indicate that the origin of the message is due to a LCS request and the type of this request to a CS fallback capable UE.

The LCS indicator information element is coded as shown in figure 9.9.3.40.1 and table 9.9.3.40.1.

The LCS indicator is a type 3 information element with 2 octets length.



|8                                                                                       |7                     |
|LCS indicator value                                                                     |octet 2               |

Figure 9.9.3.40.1: LCS indicator information element

Table 9.9.3.40.1: LCS indicator information element

|                                                                                                 |
|LCS indicator value                                                                              |
|Bits                                                                                             |
|8 7 6 5 4 3 2 1                                                                                  |
|0 0 0 0 0 0 0 0 Normal, unspecified in this version of the protocol.                             |
|0 0 0 0 0 0 0 1 MT-LR                                                                            |
|0 0 0 0 0 0 1 0                                                                                  |
|to Normal, unspecified in this version of the protocol                                           |
|1 1 1 1 1 1 1 1                                                                                  |



9.9.3.41	LCS client identity

The purpose of the LCS client identity information element is to convey information related to the client of a LCS request for a CS fallback capable UE.

The LCS client identity information element is coded as shown in figure 9.9.3.41.1 and table 9.9.3.41.1.

The LCI client identity is a type 4 information element with a minimum length of 3 octets and a maximum length of 257 octets.



|8                                                                                       |7                     |
|Length of LCS client identity                                                           |octet 2               |
|                                                                                        |octet 3               |
|LCS client identity (value part)                                                        |to                    |
|                                                                                        |octet 257             |

Figure 9.9.3.41.1: LCS client identity information element

Table 9.9.3.41.1: LCS client identity information element

|LCS client identity (value part)                                                                         |
|                                                                                                         |
|The coding of the value part of the LCS client identity is given in subclause 17.7.13 of                 |
|3GPP TS 29.002 [15C].                                                                                    |



9.9.3.42	Generic message container type

The purpose of the generic message container type information element is to specify the type of message contained in the generic message container IE.

The generic message container type information element is coded as shown in table 9.9.3.42.1.

Table 9.9.3.42.1: Generic message container type information element

|Bits                             |     |                                                          |
|8                                |7    |6                                                         |
|0                                |1    |1                                                         |
|1                                                                                                 |



9.9.3.43	Generic message container

This information element is used to encapsulate the application message transferred between the UE and the network.The generic message container information element is coded as shown in figure 9.9.3.43.1 and table 9.9.3.43.1.

The generic message container is a type 6 information element.



|8                                                                                       |7                     |
|Length of generic message container contents                                            |octet 2               |
|                                                                                        |octet 3               |
|                                                                                        |octet 4               |
|Generic message container contents                                                      |                      |
|                                                                                        |octet n               |

Figure 9.9.3.43.1: Generic message container information element

Table 9.9.3.43.1: Generic message container information element

|Generic message container contents (octet 4 to octet n); Max value of 65535 octets                       |
|                                                                                                         |
|The coding of the contents of the generic message container is dependent on the particular application.  |
|                                                                                                         |



9.9.3.44	Voice domain preference and UE's usage setting

See subclause 10.5.5.28 in 3GPP TS 24.008 [13].


9.9.3.45	GUTI type

The purpose of the GUTI type information element is to indicate whether the GUTI included in the same message in an information element of type EPS mobile identity represents a native GUTI or a mapped GUTI.

The GUTI type information element information element is coded as shown in figure 9.9.3.45.1 and table 9.9.3.45.1.

The GUTI type is a type 1 information element.



|8                                           |7         |6         |5         |4         |3                      |
|                                            |spare                          |          |                       |

Figure 9.9.3.45.1: GUTI type information element

Table 9.9.3.45.1: GUTI type information element

|GUTI type (octet 1)                                                                                    |
|Bit                                                                                                    |
|1  |   |   |   |                                                                                       |
|0  |   |   |   |Native GUTI                                                                            |
|1  |   |   |   |Mapped GUTI                                                                            |
|                                                                                                       |
|Bits 2 to 4 of octet 1 are spare and shall be coded as zero.                                           |
|                                                                                                       |



9.9.3.46	Extended DRX parameters

See subclause 10.5.5.32 in 3GPP TS 24.008 [13].


9.9.3.47	Control plane service type

The purpose of the Control plane service type information element is to specify the purpose of the CONTROL PLANE SERVICE REQUEST message.

The Control plane service type information element is coded as shown in figure 9.9.3.47.1 and table 9.9.3.47.1.

The Control plane service type is a type 1 information element.



|8         |7         |6         |5         |4          |3        |2         |1         |                      |
|Control plane service type               |"Active"   |Control plane service type    |octet 1               |
|IEI                                      |flag       |value                         |                      |

Figure 9.9.3.47.1: Control plane service type information element

Table 9.9.3.47.1: Control plane service type information element



|Control plane service type value (octet 1, bit 1 to 3)                                                  |
|                                                                                                        |
|Bits                                                                                                    |
|                                                                                                        |
|3  |2  |1  |   |                                                                                        |
|0  |0  |0  |   |mobile originating request                                                              |
|0  |0  |1  |   |mobile terminating request                                                              |
|0  |1  |0  |   |                                                                                        |
|   |to |   |   |unused; shall be interpreted as " mobile originating request", if received              |
|1  |1  |1  |   |by the network.                                                                         |
|                                                                                                        |
|"Active" flag (octet 1, bit 4)                                                                          |
|Bit                                                                                                     |
|                                                                                                        |
|4  |   |   |   |                                                                                        |
|0  |   |   |   |No radio bearer establishment requested                                                 |
|1  |   |   |   |Radio bearer establishment requested                                                    |
|                                                                                                        |



9.9.3.48	DCN-ID

See subclause 10.5.5.35 in 3GPP TS 24.008 [13].


9.9.3.49	Non-3GPP NW provided policies

See subclause 10.5.5.37 in 3GPP TS 24.008 [13].


9.9.3.50	HashMME

The purpose of the HashMME information element is to transfer a 64-bit hash value to the UE so the UE can check the MME calculated value against the value locally calculated by the UE to determine whether the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message sent by the UE has been modified.

The HashMME information element is coded as shown in figure 9.9.3.50.1 and table 9.9.3.50.1.

The HashMME is a type 4 information element with a length of 10 octets.

|8         |7         |6         |5         |4         |3         |2         |1         |                |
|HashMME IEI                                                                         |octet 1         |
|Length of HashMME                                                                   |octet 2         |
|                                                                                    |octet 3         |
|HashMME value                                                                       |                |
|                                                                                    |octet 10        |

Figure 9.9.3.50.1: HashMME information element

Table 9.9.3.50.1: HashMME information element

|HashMME value (octet 3 to 10)                                                                            |
|                                                                                                         |
|This field contains the binary representation of the HashMME. Bit 8 of octet 3 represents the most       |
|significant bit of the HashMME and bit 1 of octet 10 the least significant bit.                          |
|                                                                                                         |



9.9.3.51	Replayed NAS message container

The purpose of the Replayed NAS message containerIE is to, during an ongoing attach or tracking area updating procedure, re-send the ATTACH REQUEST or TRACKING AREA UPDATE REQUEST message with which the UE had initiated the procedure, if the MME has included a HASHMME in the SECURITY MODE COMMAND message and the HASHMME is different from the hash value locally calculated at the UE as described in 3GPP TS 33.401 [19]. If an ATTACH REQUEST message is included in this IE, the ATTACH REQUEST message shall be coded as specified in subclause 8.2.4, i.e. without NAS security header. If a TRACKING AREA UPDATE REQUEST message is included in this IE, the TRACKING AREA UPDATE REQUEST message shall be coded as specified in subclause 8.2.29, i.e. without NAS security header

The Replayed NAS message container information element is coded as shown in figure 9.9.3.51.1 and table 9.9.3.51.1.

The Replayed NAS message container is a type 6 information element.



|8                                                                                       |7                     |
|Length of Replayed NAS message container contents                                       |octet 2               |
|                                                                                        |octet 3               |
|                                                                                        |octet 4               |
|Replayed NAS message container contents                                                 |                      |
|                                                                                        |octet n               |

Figure 9.9.3.51.1: Replayed NAS message container information element

Table 9.9.3.51.1: Replayed NAS message container information element

|Replayed NAS message container contents (octet 4 to octet n); Max value of 65535 octets                  |
|                                                                                                         |
|This IE can contain an ATTACH REQUEST message as defined in subclause 8.2.4, or a TRACKING AREA UPDATE   |
|REQUEST message as defined in subclause 8.2.29.                                                          |
|                                                                                                         |



9.9.3.52	Network policy

The purpose of the Network policy information element is to provide network policy information to the UE during attach or tracking area updating procedure via the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message.

The Network policy information element is coded as shown in figure 9.9.3.52.1 and table 9.9.3.52.1.

The Network policy is a type 1 information element.

|8                                        |7         |6         |5         |4         |3               |

Figure 9.9.3.52.1: Network policy information element

Table 9.9.3.52.1: Network policy information element

|Network policy value                                                                                     |
|                                                                                                         |
|Redirection to GERAN security policy (redir-policy) (octet 1, bit 1)                                     |
|0  |   |   |   |Unsecured redirection to GERAN allowed                                                   |
|1  |   |   |   |Unsecured redirection to GERAN not allowed                                               |
|                                                                                                         |
|Bits 2 to 4 are spare and shall be set to "0".                                                           |
|                                                                                                         |



9.9.3.53	UE additional security capability

The UE additional security capability information element is used by the UE to indicate which additional security algorithms are supported by the UE.

The UE additional security capability information element is coded as shown in figure 9.9.3.53.1 and table 9.9.3.53.1.

The UE additional security capability is a type 4 information element with a length of 6 octets.



|8                                                                                    |7               |
|Length of UE additional security capability contents                                 |octet 2         |
|                                                                                                         |
|5G-EA0                                                                                                   |
|                                                                                                         |
|5GS encryption algorithm 5G-EA0 supported (octet 3, bit 8)                                               |
|0  |   |   |   |5GS encryption algorithm 5G-EA0 not supported                                            |
|1  |   |   |   |5GS encryption algorithm 5G-EA0 supported                                                |
|                                                                                                         |
|5GS encryption algorithm 128-5G-EA1 supported (octet 3, bit 7)                                           |
|0  |   |   |   |5GS encryption algorithm 128-5G-EA1 not supported                                        |
|1  |   |   |   |5GS encryption algorithm 128-5G-EA1 supported                                            |
|                                                                                                         |
|5GS encryption algorithm 128-5G-EA2 supported (octet 3, bit 6)                                           |
|0  |   |   |   |5GS encryption algorithm 128-5G-EA2 not supported                                        |
|1  |   |   |   |5GS encryption algorithm 128-5G-EA2 supported                                            |
|                                                                                                         |
|5GS encryption algorithm 128-5G-EA3 supported (octet 3, bit 5)                                           |
|0  |   |   |   |5GS encryption algorithm 128-5G-EA3 not supported                                        |
|1  |   |   |   |5GS encryption algorithm 128-5G-EA3 supported                                            |
|                                                                                                         |
|5GS encryption algorithm 5G-EA4 supported (octet 3, bit 4)                                               |
|0  |   |   |   |5GS encryption algorithm 5G-EA4 not supported                                            |
|1  |   |   |   |5GS encryption algorithm 5G-EA4 supported                                                |
|                                                                                                         |
|5GS encryption algorithm 5G-EA5 supported (octet 3, bit 3)                                               |
|0  |   |   |   |5GS encryption algorithm 5G-EA5 not supported                                            |
|1  |   |   |   |5GS encryption algorithm 5G-EA5 supported                                                |
|                                                                                                         |
|5GS encryption algorithm 5G-EA6 supported (octet 3, bit 2)                                               |
|0  |   |   |   |5GS encryption algorithm 5G-EA6 not supported                                            |
|1  |   |   |   |5GS encryption algorithm 5G-EA6 supported                                                |
|                                                                                                         |
|5GS encryption algorithm 5G-EA7 supported (octet 3, bit 1)                                               |
|0  |   |   |   |5GS encryption algorithm 5G-EA7 not supported                                            |
|1  |   |   |   |5GS encryption algorithm 5G-EA7 supported                                                |
|                                                                                                         |
|5GS encryption algorithms supported (octet 4)                                                            |
|                                                                                                         |
|5GS encryption algorithm 5G-EA8 supported (octet 4, bit 8)                                               |
|0  |   |   |   |5GS encryption algorithm 5G-EA8 not supported                                            |
|1  |   |   |   |5GS encryption algorithm 5G-EA8 supported                                                |
|                                                                                                         |
|5GS encryption algorithm 5G-EA9 supported (octet 4, bit 7)                                               |
|0  |   |   |   |5GS encryption algorithm 5G-EA9 not supported                                            |
|1  |   |   |   |5GS encryption algorithm 5G-EA9 supported                                                |
|                                                                                                         |
|5GS encryption algorithm 5G-EA10 supported (octet 4, bit 6)                                              |
|0  |   |   |   |5GS encryption algorithm 5G-EA10 not supported                                           |
|1  |   |   |   |5GS encryption algorithm 5G-EA10 supported                                               |
|                                                                                                         |
|5GS encryption algorithm 5G-EA11 supported (octet 4, bit 5)                                              |
|0  |   |   |   |5GS encryption algorithm 5G-EA11 not supported                                           |
|1  |   |   |   |5GS encryption algorithm 5G-EA11 supported                                               |
|                                                                                                         |
|5GS encryption algorithm 5G-EA12 supported (octet 4, bit 4)                                              |
|0  |   |   |   |5GS encryption algorithm 5G-EA12 not supported                                           |
|1  |   |   |   |5GS encryption algorithm 5G-EA12 supported                                               |
|                                                                                                         |
|5GS encryption algorithm 5G-EA13 supported (octet 4, bit 3)                                              |
|0  |   |   |   |5GS encryption algorithm 5G-EA13 not supported                                           |
|1  |   |   |   |5GS encryption algorithm 5G-EA13 supported                                               |
|                                                                                                         |
|5GS encryption algorithm 5G-EA14 supported (octet 4, bit 2)                                              |
|0  |   |   |   |5GS encryption algorithm 5G-EA14 not supported                                           |
|1  |   |   |   |5GS encryption algorithm 5G-EA14 supported                                               |
|                                                                                                         |
|5GS encryption algorithm 5G-EA15 supported (octet 4, bit 1)                                              |
|0  |   |   |   |5GS encryption algorithm 5G-EA15 not supported                                           |
|1  |   |   |   |5GS encryption algorithm 5G-EA15 supported                                               |
|                                                                                                         |
|5GS integrity algorithms supported (octet 5) (NOTE 2)                                                    |
|                                                                                                         |
|5GS integrity algorithm 5G-IA0 supported (octet 5, bit 8)                                                |
|0  |   |   |   |5GS integrity algorithm 5G-IA0 not supported                                             |
|1  |   |   |   |5GS integrity algorithm 5G-IA0 supported                                                 |
|                                                                                                         |
|5GS integrity algorithm 128-5G-IA1 supported (octet 5, bit 7)                                            |
|0  |   |   |   |5GS integrity algorithm 128-5G-IA1 not supported                                         |
|1  |   |   |   |5GS integrity algorithm 128-5G-IA1 supported                                             |
|                                                                                                         |
|5GS integrity algorithm 128-5G-IA2 supported (octet 5, bit 6)                                            |
|0  |   |   |   |5GS integrity algorithm 128-5G-IA2 not supported                                         |
|1  |   |   |   |5GS integrity algorithm 128-5G-IA2 supported                                             |
|                                                                                                         |
|5GS integrity algorithm 128-5G-IA3 supported (octet 5, bit 5)                                            |
|0  |   |   |   |5GS integrity algorithm 128-5G-IA3 not supported                                         |
|1  |   |   |   |5GS integrity algorithm 128-5G-IA3 supported                                             |
|                                                                                                         |
|5GS integrity algorithm 5G-IA4 supported (octet 5, bit 4)                                                |
|0  |   |   |   |5GS integrity algorithm 5G-IA4 not supported                                             |
|1  |   |   |   |5GS integrity algorithm 5G-IA4 supported                                                 |
|                                                                                                         |
|5GS integrity algorithm 5G-IA5 supported (octet 5, bit 3)                                                |
|0  |   |   |   |5GS integrity algorithm 5G-IA5 not supported                                             |
|1  |   |   |   |5GS integrity algorithm 5G-IA5 supported                                                 |
|                                                                                                         |
|5GS integrity algorithm 5G-IA6 supported (octet 5, bit 2)                                                |
|0  |   |   |   |5GS integrity algorithm 5G-IA6 not supported                                             |
|1  |   |   |   |5GS integrity algorithm 5G-IA6 supported                                                 |
|                                                                                                         |
|5GS integrity algorithm 5G-IA7 supported (octet 5, bit 1)                                                |
|0  |   |   |   |5GS integrity algorithm 5G-IA7 not supported                                             |
|1  |   |   |   |5GS integrity algorithm 5G-IA7 supported                                                 |
|                                                                                                         |
|5GS integrity algorithms supported (octet 6)                                                             |
|                                                                                                         |
|5GS integrity algorithm 5G-IA8 supported (octet 6, bit 8)                                                |
|0  |   |   |   |5GS integrity algorithm 5G-IA8 not supported                                             |
|1  |   |   |   |5GS integrity algorithm 5G-IA8 supported                                                 |
|                                                                                                         |
|5GS integrity algorithm 5G-IA9 supported (octet 6, bit 7)                                                |
|0  |   |   |   |5GS integrity algorithm 5G-IA9 not supported                                             |
|1  |   |   |   |5GS integrity algorithm 5G-IA9 supported                                                 |
|                                                                                                         |
|5GS integrity algorithm 5G-IA10 supported (octet 6, bit 6)                                               |
|0  |   |   |   |5GS integrity algorithm 5G-IA10 not supported                                            |
|1  |   |   |   |5GS integrity algorithm 5G-IA10 supported                                                |
|                                                                                                         |
|5GS integrity algorithm 5G-IA11 supported (octet 6, bit 5)                                               |
|0  |   |   |   |5GS integrity algorithm 5G-IA11 not supported                                            |
|1  |   |   |   |5GS integrity algorithm 5G-IA11 supported                                                |
|                                                                                                         |
|5GS integrity algorithm 5G-IA12 supported (octet 6, bit 4)                                               |
|0  |   |   |   |5GS integrity algorithm 5G-IA12 not supported                                            |
|1  |   |   |   |5GS integrity algorithm 5G-IA12 supported                                                |
|                                                                                                         |
|5GS integrity algorithm 5G-IA13 supported (octet 6, bit 3)                                               |
|0  |   |   |   |5GS integrity algorithm 5G-IA13 not supported                                            |
|1  |   |   |   |5GS integrity algorithm 5G-IA13 supported                                                |
|                                                                                                         |
|5GS integrity algorithm 5G-IA14 supported (octet 6, bit 2)                                               |
|0  |   |   |   |5GS integrity algorithm 5G-IA14 not supported                                            |
|1  |   |   |   |5GS integrity algorithm 5G-IA14 supported                                                |
|                                                                                                         |
|5GS integrity algorithm 5G-IA15 supported (octet 6, bit 1)                                               |
|0  |   |   |   |5GS integrity algorithm 5G-IA15 not supported                                            |
|1  |   |   |   |5GS integrity algorithm 5G-IA15 supported                                                |
|                                                                                                         |
|NOTE 1: For a UE supporting dual connectivity with NR. if the UE supports one of the encryption          |
|algorithms for 5GS in bits 8 to 5 of octet 3, it shall support the same algorithms for E-UTRAN as        |
|specified in 3GPP TS 33.401 [19].                                                                        |
|NOTE 2: For a UE supporting dual connectivity with NR. if the UE supports one of the integrity protection|
|algorithms for 5GS in bits 8 to 5 of octet 5, it shall support the same algorithms for E-UTRAN as        |
|specified in 3GPP TS 33.401 [19].                                                                        |



9.9.3.54	UE status

See subclause 9.11.3.56 in 3GPP TS 24.501 [54].


9.9.3.55	Additional information requested

The purpose of the Additional information requested information element is to enable the UE to request ciphering keys for deciphering of ciphered broadcast assistance data.

The Additional information requested information element is coded as shown in figure 9.9.3.55.1 and table 9.9.3.55.1.

The Additional information requested is a type 3 information element with a length of 2 octets.



|8                                                                                       |7                     |
|0                                                                            |0         |0                     |

Figure 9.9.3.55.1: Additional information requested information element

Table 9.9.3.55.1: Additional information requested information element

|Ciphering keys for ciphered broadcast assistance data (CipherKey) (octet 2, bit 1)                       |
|Bit                                                                                                      |
|1  |   |   |   |                                                                                        |
|0  |   |   |   |ciphering keys for ciphered broadcast assistance data not requested                     |
|1  |   |   |   |ciphering keys for ciphered broadcast assistance data requested                         |
|                                                                                                         |
|Bits 8 to 2 of octet 2 are spare and shall be coded as zero.                                             |
|                                                                                                         |



9.9.3.56	Ciphering key data

The purpose of the Ciphering key data information element is to transfer a list of ciphering data sets from the network to the UE for deciphering of ciphered assistance data.

The Ciphering key data information element is coded as shown in figure 9.9.3.56.1, figure 9.9.3.56.2 and table 9.9.3.56.1.

The Ciphering key data is a type 6 information element, with a minimum length of 35 octets and a maximum length of 2291 octets. The list can contain a maximum of 16 ciphering data sets.



|8         |7         |6         |5         |4         |3         |2         |1         |                   |
|Ciphering key data IEI                                                              |octet 1            |
|Length of ciphering key data contents                                               |octet 2            |
|                                                                                    |octet 3            |
|                                                                                    |octet 4            |
|Ciphering data set 1                                                                |                   |
|                                                                                    |octet i            |
|                                                                                    |octet i+1*         |
|Ciphering data set 2                                                                |                   |
|                                                                                    |octet l*           |
|                                                                                    |octet l+1*         |
|…                                                                                   |                   |
|                                                                                    |octet m*           |
|                                                                                    |octet m+1*         |
|Ciphering data set p                                                                |                   |
|                                                                                    |octet n*           |

Figure 9.9.3.56.1: Ciphering key data information element

|8         |7         |6         |5         |4         |3         |2         |1         |                   |
|Ciphering set ID                                                                    |octet 1            |
|                                                                                    |octet 2            |
|Ciphering key                                                                       |octet 3            |
|                                                                                    |                   |
|                                                                                    |                   |
|                                                                                    |octet 18           |
|0         |0         |0         |c0 length                                           |octet 19           |
|Spare                          |                                                    |                   |
|                                                                                    |octet 20           |
|c0                                                                                  |                   |
|                                                                                    |                   |
|                                                                                    |octet k            |
|PosSIBType|PosSIBType|PosSIBType|PosSIBType|PosSIBType|PosSIBType|PosSIBType|PosSIBType|octet k+1          |
|1-1       |1-2       |1-3       |1-4       |1-5       |1-6       |1-7       |2-1       |                   |
|          |          |          |          |          |          |          |          |                   |
|          |          |          |          |          |          |          |          |octet k+4          |
|PosSIBType|PosSIBType|PosSIBType|PosSIBType|PosSIBType|PosSIBType|PosSIBType|PosSIBType|                   |
|2-2       |2-3       |2-4       |2-5       |2-6       |2-7       |2-8       |2-9       |                   |
|PosSIBType|PosSIBType|PosSIBType|PosSIBType|PosSIBType|PosSIBType|PosSIBType|PosSIBType|                   |
|2-10      |2-11      |2-12      |2-13      |2-14      |2-15      |2-16      |2-17      |                   |
|PosSIBType|PosSIBType|PosSIBType|0         |0         |0         |0         |0         |                   |
|2-18      |2-19      |3-1       |Spare     |Spare     |Spare     |Spare     |Spare     |                   |
|                                                                                    |octet k+5          |
|Validity start time                                                                 |                   |
|                                                                                    |octet k+9          |
|Validity duration                                                                   |octet k+10         |
|                                                                                    |octet k+11         |
|                                                                                    |octet k+12         |
|TAIs list                                                                           |                   |
|                                                                                    |octet n            |

Figure 9.9.3.56.2: Ciphering data set

Table 9.9.3.56.1: Ciphering key data information element

|Value part of the Ciphering key data information element (octets 4 to n)                                 |
|                                                                                                         |
|The value part of the Ciphering key data information element consists of one or several ciphering data   |
|sets.                                                                                                    |
|The UE shall store the complete list received. If more than 16 ciphering data sets are included in this  |
|information element, the UE shall store the first 16 ciphering data sets and ignore the remaining octets |
|of the information element.                                                                              |
|                                                                                                         |
|                                                                                                         |
|Ciphering data set:                                                                                      |
|                                                                                                         |
|Ciphering set ID (octets 1 to 2)                                                                         |
|                                                                                                         |
|This field contains the binary encoding of the ID identifying the ciphering set.                         |
|                                                                                                         |
|Ciphering key (octets 3 to octet 18)                                                                     |
|                                                                                                         |
|This field contains the 128 bit ciphering key.                                                           |
|                                                                                                         |
|c0 length (octet 19, bits 5 to 1)                                                                        |
|                                                                                                         |
|This field contains the binary encoding of the length, in octets, of the c0 counter. The maximum value   |
|for the length of the c0 counter is 16 octets.                                                           |
|                                                                                                         |
|Bits 8 to 6 of octect 19 are spare and shall be coded as zero.                                           |
|                                                                                                         |
|                                                                                                         |
|c0 (octets 20 to k)                                                                                      |
|                                                                                                         |
|This field contains the binary encoding of the c0 counter.                                               |
|                                                                                                         |
|                                                                                                         |
|Positioning SIB types for which the ciphering data set is applicable (octets k+1 to k+4)                 |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 1-1 (octet k+1, bit 8)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 1-1                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 1-1                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 1-2 (octet k+1, bit 7)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 1-2                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 1-2                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 1-3 (octet k+1, bit 6)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 1-3                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 1-3                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 1-4 (octet k+1, bit 5)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 1-4                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 1-4                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 1-5 (octet k+1, bit 4)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 1-5                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 1-5                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 1-6 (octet k+1, bit 3)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 1-6                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 1-6                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 1-7 (octet k+1, bit 2)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 1-7                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 1-7                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-1 (octet k+1, bit 1)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-1                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-1                                |
|                                                                                                         |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-2 (octet k+2, bit 8)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-2                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-2                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-3 (octet k+2, bit 7)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-3                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-3                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-4 (octet k+2, bit 6)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-4                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-4                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-5 (octet k+2, bit 5)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-5                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-5                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-6 (octet k+2, bit 4)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-6                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-6                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-7 (octet k+2, bit 3)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-7                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-7                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-8 (octet k+2, bit 2)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-8                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-8                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-9 (octet k+2, bit 1)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-9                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-9                                |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-10 (octet k+3, bit 8)                           |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-10                           |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-10                               |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-11 (octet k+3, bit 7)                           |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-11                           |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-11                               |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-12 (octet k+3, bit 6)                           |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-12                           |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-12                               |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-13 (octet k+3, bit 5)                           |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-13                           |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-13                               |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-14 (octet k+3, bit 4)                           |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-14                           |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-14                               |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-15 (octet k+3, bit 3)                           |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-15                           |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-15                               |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-16 (octet k+3, bit 2)                           |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-16                           |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-16                               |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-17 (octet k+3, bit 1)                           |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-17                           |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-17                               |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-18 (octet k+4, bit 8)                           |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-18                           |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-18                               |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 2-19 (octet k+4, bit 7)                           |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 2-19                           |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 2-19                               |
|                                                                                                         |
|Ciphering data set applicable for positioning SIB type 3-1 (octet k+4, bit 6)                            |
|0  |   |   |   |Ciphering data set not applicable to positioning SIB type 3-1                            |
|1  |   |   |   |Ciphering data set applicable to positioning SIB type 3-1                                |
|                                                                                                         |
|Bits 5 to 1 of octet k+4 are spare and shall be coded as zero.                                           |
|                                                                                                         |
|                                                                                                         |
|Validity start time (octets k+5 to k+9)                                                                  |
|                                                                                                         |
|This field contains the UTC time when the ciphering data set becomes valid, encoded as octets 2 to 6 of  |
|the Time zone and time IE specified in 3GPP TS 24.008 [13].                                              |
|                                                                                                         |
|                                                                                                         |
|Validity duration (octets k+10 to k+11)                                                                  |
|                                                                                                         |
|This field contains the duration for which the ciphering data set is valid after the validity start time,|
|in units of minutes.                                                                                     |
|                                                                                                         |
|                                                                                                         |
|TAIs list (octets k+12 to n)                                                                             |
|                                                                                                         |
|This field contains the list of tracking areas for which the ciphering data set is applicable, encoded as|
|octets 2 to n of the Tracking area identity list IE as specified in subclause 9.9.3.33. If the TAIs list |
|is empty (as indicated by a zero length), the ciphering data set is applicable to the entire serving     |
|PLMN.                                                                                                    |
|                                                                                                         |



9.9.4	EPS Session Management (ESM) information elements


9.9.4.1	Access point name

See subclause 10.5.6.1 in 3GPP TS 24.008 [13].


9.9.4.2	APN aggregate maximum bit rate

The purpose of the APN aggregate maximum bit rate information element is to indicate the initial subscribed APN-AMBR when the UE establishes a PDN connection or to indicate the new APN-AMBR if it is changed by the network.

The APN aggregate maximum bit rate information element is coded as shown in figure 9.9.4.2.1 and table 9.9.4.2.1.

The APN aggregate maximum bit rate is a type 4 information element with a minimum length of 4 octets and a maximum length of 8 octets. Octets 5-8 are optional. If octet 5 is included, then octet 6 shall also be included, and octets 7-8 may be included. If octet 7 is included, then octet 8 shall also be included. The length of the APN-AMBR IE can be either 4 octets, 6 octets or 8 octets.



|8                                                                                       |7                     |
|Length of APN aggregate maximum bit rate contents                                       |octet 2               |
|APN-AMBR for downlink                                                                   |octet 3               |
|APN-AMBR for uplink                                                                     |octet 4               |
|APN-AMBR for downlink (extended)                                                        |octet 5*              |
|APN-AMBR for uplink (extended)                                                          |octet 6*              |
|APN-AMBR for downlink (extended-2)                                                      |octet 7*              |
|APN-AMBR for uplink (extended-2)                                                        |octet 8*              |

Figure 9.9.4.2.1: APN aggregate maximum bit rate information element

Table 9.9.4.2.1: APN aggregate maximum bit rate information element

|APN-AMBR for downlink, octet 3                                                                                                                    |
|                                                                                                                                                  |
|Bits                                                                                                                                              |
|8 7 6 5 4 3 2 1                                                                                                                                   |
|0 0 0 0 0 0 0 0 Reserved                                                                                                                          |
|                                                                                                                                                  |
|0 0 0 0 0 0 0 1 The APN-AMBR is binary coded in 8 bits, using a granularity of 1 kbps                                                             |
|to giving a range of values from 1 kbps to 63 kbps in 1 kbps increments.                                                                          |
|0 0 1 1 1 1 1 1                                                                                                                                   |
|                                                                                                                                                  |
|0 1 0 0 0 0 0 0 The APN-AMBR is 64 kbps + ((the binary coded value in 8 bits –01000000) * 8 kbps)                                                 |
|to giving a range of values from 64 kbps to 568 kbps in 8 kbps increments.                                                                        |
|0 1 1 1 1 1 1 1                                                                                                                                   |
|                                                                                                                                                  |
|1 0 0 0 0 0 0 0 The APN-AMBR is 576 kbps + ((the binary coded value in 8 bits –10000000) * 64 kbps)                                               |
|to giving a range of values from 576 kbps to 8640 kbps in 64 kbps increments.                                                                     |
|1 1 1 1 1 1 1 0                                                                                                                                   |
|                                                                                                                                                  |
|1 1 1 1 1 1 1 1 0kbps                                                                                                                             |
|                                                                                                                                                  |
|If the network wants to indicate an APN-AMBR for downlink higher than 8640 kbps, it shall set octet 3 to "11111110", i.e. 8640 kbps, and shall    |
|encode the value for the APN-AMBR in octet 5.                                                                                                     |
|                                                                                                                                                  |
|                                                                                                                                                  |
|APN-AMBR for uplink, octet 4                                                                                                                      |
|                                                                                                                                                  |
|Coding is identical to that of APN-AMBR for downlink.                                                                                             |
|                                                                                                                                                  |
|                                                                                                                                                  |
|APN-AMBR for downlink (extended), octet 5                                                                                                         |
|                                                                                                                                                  |
|Bits                                                                                                                                              |
|8 7 6 5 4 3 2 1                                                                                                                                   |
|0 0 0 0 0 0 0 0 Use the value indicated by the APN-AMBR for downlink in octet 3.                                                                  |
|                                                                                                                                                  |
|For all other values: Ignore the value indicated by the APN-AMBR for downlink in octet 3                                                          |
|and use the following value:                                                                                                                      |
|0 0 0 0 0 0 0 1 The APN-AMBR is 8600 kbps + ((the binary coded value in 8 bits) * 100 kbps),                                                      |
|to giving a range of values from 8700 kbps to 16000 kbps in 100 kbps increments.                                                                  |
|0 1 0 0 1 0 1 0                                                                                                                                   |
|                                                                                                                                                  |
|0 1 0 0 1 0 1 1 The APN-AMBR is 16 Mbps + ((the binary coded value in 8 bits - 01001010) * 1 Mbps),                                               |
|to giving a range of values from 17 Mbps to 128 Mbps in 1 Mbps increments.                                                                        |
|1 0 1 1 1 0 1 0                                                                                                                                   |
|                                                                                                                                                  |
|1 0 1 1 1 0 1 1 The APN-AMBR is 128 Mbps + ((the binary coded value in 8 bits - 10111010) * 2 Mbps),                                              |
|to giving a range of values from 130 Mbps to 256 Mbps in 2 Mbps increments.                                                                       |
|1 1 1 1 1 0 1 0                                                                                                                                   |
|                                                                                                                                                  |
|                                                                                                                                                  |
|                                                                                                                                                  |
|All other values shall be interpreted as '1 1 1 1 1 0 1 0'                                                                                        |
|                                                                                                                                                  |
|                                                                                                                                                  |
|APN-AMBR for uplink (extended), octet 6                                                                                                           |
|                                                                                                                                                  |
|This field is an extension of the APN-AMBR for uplink in octet 4. The coding is identical to that of the APN-AMBR for downlink (extended).        |
|                                                                                                                                                  |
|                                                                                                                                                  |
|APN-AMBR for downlink (extended-2), octet 7                                                                                                       |
|                                                                                                                                                  |
|Bits                                                                                                                                              |
|8 7 6 5 4 3 2 1                                                                                                                                   |
|0 0 0 0 0 0 0 0 Use the value indicated by the APN-AMBR for downlink and APN-AMBR for downlink (extended) in                                      |
|octets 3 and 5.                                                                                                                                   |
|                                                                                                                                                  |
|0 0 0 0 0 0 0 1 The APN-AMBR is (the binary coded value in 8 bits) * 256 Mbps + (the value indicated by                                           |
|to the APN-AMBR for downlink and APN-AMBR for downlink (extended) in octets 3 and 5),                                                             |
|1 1 1 1 1 1 1 0 giving a range of 264,64 Mbps to 65280 Mbps.                                                                                      |
|                                                                                                                                                  |
|1 1 1 1 1 1 1 1 This value shall be interpreted as '0 0 0 0 0 0 0 0' in this version of the specification.                                        |
|                                                                                                                                                  |
|If the network wants to indicate an APN-AMBR value for downlink higher than 65280 Mbps, it shall set octet 5 to "11111010" and octet 7 to         |
|"11111110", i.e. 65280 Mbps, and shall encode the higher value for the APN-AMBR in the extended APN aggregate maximum bit rate information element|
|specified in subclause 9.9.4.29.                                                                                                                  |
|                                                                                                                                                  |
|APN-AMBR for uplink (extended-2), octet 8                                                                                                         |
|                                                                                                                                                  |
|This field is an extension of the APN-AMBR for uplink and APN-AMBR for uplink (extended) in octets 4 and 6. The coding is identical to that of the|
|APN-AMBR for downlink (extended-2).                                                                                                               |
|                                                                                                                                                  |
|If the UE or the network wants to indicate an APN-AMBR value for uplink higher than 65280 Mbps, it shall set octet 8 to "11111110", i.e. 65280    |
|Mbps, and shall encode the higher value for the APN-AMBR in the extended APN aggregate maximum bit rate information element specified in          |
|subclause 9.9.4.29.                                                                                                                               |



9.9.4.2A	Connectivity type

See subclause 10.5.6.19 in 3GPP TS 24.008 [13].


9.9.4.3	EPS quality of service

The purpose of the EPS quality of service information element is to specify the QoS parameters for an EPS bearer context.

The EPS quality of service information element is coded as shown in figure 9.9.4.3.1 and table 9.9.4.3.1.

The EPS quality of service is a type 4 information element with a minimum length of 3 octets and a maximum length of 15 octets. Octets 4-15 are optional. If octet 4 is included, then octets 5-7 shall also be included, and octets 8-15 may be included. If octet 8 is included, then octets 4-11 shall also be included, and octets 12-15 may be included. If octet 12 is included, then octets 4-15 shall also be included. The length of the EPS QoS IE can be either 3 octets, 7 octets, 11 octets or 15 octets.

Refer to 3GPP TS 23.203 [7] for a detailed description of the QoS Class Identifier (QCI).



|8         |7         |6         |5         |4         |3         |2         |1         |                |
|EPS quality of service IEI                                                          |octet 1         |
|Length of EPS quality of service contents                                           |octet 2         |
|QCI                                                                                 |octet 3         |
|Maximum bit rate for uplink                                                         |octet 4*        |
|Maximum bit rate for downlink                                                       |octet 5*        |
|Guaranteed bit rate for uplink                                                      |octet 6*        |
|Guaranteed bit rate for downlink                                                    |octet 7*        |
|Maximum bit rate for uplink (extended)                                              |octet 8*        |
|Maximum bit rate for downlink (extended)                                            |octet 9*        |
|Guaranteed bit rate for uplink (extended)                                           |octet 10*       |
|Guaranteed bit rate for downlink (extended)                                         |octet 11*       |
|Maximum bit rate for uplink (extended-2)                                            |octet 12*       |
|Maximum bit rate for downlink (extended-2)                                          |octet 13*       |
|Guaranteed bit rate for uplink (extended-2)                                         |octet 14*       |
|Guaranteed bit rate for downlink (extended-2)                                       |octet 15*       |

Figure 9.9.4.3.1: EPS quality of service information element

Table 9.9.4.3.1: EPS quality of service information element

|Quality of Service Class Identifier (QCI), octet 3 (see 3GPP TS 23.203 [7] and 3GPP TS 29.212 [16B])                                             |
|Bits                                                                                                                                             |
|8 7 6 5 4 3 2 1                                                                                                                                  |
|                                                                                                                                                 |
|In UE to network direction:                                                                                                                      |
|0 0 0 0 0 0 0 0 no QCI requested (NOTE)                                                                                                          |
|                                                                                                                                                 |
|In network to UE direction:                                                                                                                      |
|0 0 0 0 0 0 0 0 Reserved                                                                                                                         |
|                                                                                                                                                 |
|In UE to network direction and in network to UE direction:                                                                                       |
|0 0 0 0 0 0 0 1 QCI 1                                                                                                                            |
|0 0 0 0 0 0 1 0 QCI 2                                                                                                                            |
|0 0 0 0 0 0 1 1 QCI 3                                                                                                                            |
|0 0 0 0 0 1 0 0 QCI 4                                                                                                                            |
|0 0 0 0 0 1 0 1 QCI 5                                                                                                                            |
|0 0 0 0 0 1 1 0 QCI 6                                                                                                                            |
|0 0 0 0 0 1 1 1 QCI 7                                                                                                                            |
|0 0 0 0 1 0 0 0 QCI 8                                                                                                                            |
|0 0 0 0 1 0 0 1 QCI 9                                                                                                                            |
|                                                                                                                                                 |
|0 0 0 0 1 0 1 0                                                                                                                                  |
|to Spare                                                                                                                                         |
|0 1 0 0 0 0 0 0                                                                                                                                  |
|0 1 0 0 0 0 0 1 QCI 65                                                                                                                           |
|0 1 0 0 0 0 1 0 QCI 66                                                                                                                           |
|0 1 0 0 0 0 1 1 QCI 67                                                                                                                           |
|                                                                                                                                                 |
|                                                                                                                                                 |
|0 1 0 0 0 1 0 0                                                                                                                                  |
|                                                                                                                                                 |
|to Spare                                                                                                                                         |
|0 1 0 0 0 1 0 0                                                                                                                                  |
|0 1 0 0 0 1 0 1 QCI 69                                                                                                                           |
|0 1 0 0 0 1 1 0 QCI 70                                                                                                                           |
|                                                                                                                                                 |
|0 1 0 0 0 1 1 1                                                                                                                                  |
|to Spare                                                                                                                                         |
|0 1 0 0 1 0 1 0                                                                                                                                  |
|0 1 0 0 1 0 1 1 QCI 75                                                                                                                           |
|                                                                                                                                                 |
|0 1 0 0 1 1 0 0                                                                                                                                  |
|to Spare                                                                                                                                         |
|0 1 0 0 1 1 1 0                                                                                                                                  |
|0 1 0 0 1 1 1 1 QCI 79                                                                                                                           |
|0 1 0 1 0 0 0 0 QCI 80                                                                                                                           |
|0 1 0 1 0 0 0 1 Spare                                                                                                                            |
|0 1 0 1 0 0 1 0 QCI 82                                                                                                                           |
|0 1 0 1 0 0 1 1 QCI 83                                                                                                                           |
|0 1 0 1 0 1 0 0 QCI 84                                                                                                                           |
|0 1 0 1 0 1 0 1 QCI 85                                                                                                                           |
|                                                                                                                                                 |
|0 1 0 1 0 1 1 0                                                                                                                                  |
|to Spare                                                                                                                                         |
|0 1 1 1 1 1 1 1                                                                                                                                  |
|1 0 0 0 0 0 0 0                                                                                                                                  |
|to Operator-specific QCIs                                                                                                                        |
|1 1 1 1 1 1 1 0                                                                                                                                  |
|1 1 1 1 1 1 1 1 Reserved                                                                                                                         |
|                                                                                                                                                 |
|The network shall consider all other values not explicitly defined in this version of the protocol as unsupported.                               |
|                                                                                                                                                 |
|NOTE: The UE shall use this value, if the information element has presence requirement "M" in a message, but the information element does not    |
|serve any useful purpose in the specific procedure for which the message is sent (see subclause 6.5.3.2).                                        |
|                                                                                                                                                 |
|QCI values 10-127 were reserved in earlier versions of the protocol.                                                                             |
|                                                                                                                                                 |
|If the UE receives a QCI value (excluding the reserved QCI values) that it does not understand, the UE shall choose a QCI value from the set of  |
|QCI values defined in this version of the protocol (see 3GPP TS 23.203 [7] and 3GPP TS 29.212 [16B]) and associated with:                        |
|                                                                                                                                                 |
|- GBR bearers if the IE includes a guaranteed bit rate value; and                                                                                |
|                                                                                                                                                 |
|- non-GBR bearers if the IE does not include a guaranteed bit rate value.                                                                        |
|                                                                                                                                                 |
|The UE shall use this chosen QCI value for internal operations only. The UE shall use the received QCI value in subsequent NAS signalling        |
|procedures.                                                                                                                                      |
|                                                                                                                                                 |
|For all non-GBR QCIs, the maximum and guaranteed bit rates shall be ignored.                                                                     |
|                                                                                                                                                 |
|                                                                                                                                                 |
|Maximum bit rate for uplink, octet 4 (see 3GPP TS 23.107 [5])                                                                                    |
|Bits                                                                                                                                             |
|8 7 6 5 4 3 2 1                                                                                                                                  |
|                                                                                                                                                 |
|In UE to network direction:                                                                                                                      |
|0 0 0 0 0 0 0 0 Subscribed maximum bit rate for uplink                                                                                           |
|                                                                                                                                                 |
|In network to UE direction:                                                                                                                      |
|0 0 0 0 0 0 0 0 Reserved                                                                                                                         |
|                                                                                                                                                 |
|In UE to network direction and in network to UE direction:                                                                                       |
|0 0 0 0 0 0 0 1 The maximum bit rate is binary coded in 8 bits, using a granularity of 1 kbps                                                    |
|to giving a range of values from 1 kbps to 63 kbps in 1 kbps increments.                                                                         |
|0 0 1 1 1 1 1 1                                                                                                                                  |
|                                                                                                                                                 |
|0 1 0 0 0 0 0 0 The maximum bit rate is 64 kbps + ((the binary coded value in 8 bits – 01000000) * 8 kbps)                                       |
|to giving a range of values from 64 kbps to 568 kbps in 8 kbps increments.                                                                       |
|0 1 1 1 1 1 1 1                                                                                                                                  |
|                                                                                                                                                 |
|1 0 0 0 0 0 0 0 The maximum bit rate is 576 kbps + ((the binary coded value in 8 bits – 10000000) * 64 kbps)                                     |
|to giving a range of values from 576 kbps to 8640 kbps in 64 kbps increments.                                                                    |
|1 1 1 1 1 1 1 0                                                                                                                                  |
|                                                                                                                                                 |
|1 1 1 1 1 1 1 1 0kbps                                                                                                                            |
|                                                                                                                                                 |
|If the sending entity wants to indicate a maximum bit rate for uplink higher than 8640 kbps, it shall set octet 4 to "11111110", i.e. 8640 kbps, |
|and shall encode the value for the maximum bit rate in octet 8.                                                                                  |
|                                                                                                                                                 |
|The network shall map all other values not explicitly defined onto one of the values defined in this version of the protocol. The network shall  |
|return a negotiated value which is explicitly defined in this version of the protocol.                                                           |
|                                                                                                                                                 |
|Maximum bit rate for downlink, octet 5 (see 3GPP TS 23.107 [5])                                                                                  |
|                                                                                                                                                 |
|Coding is identical to that of maximum bit rate for uplink.                                                                                      |
|                                                                                                                                                 |
|If the sending entity wants to indicate a maximum bit rate for downlink higher than 8640 kbps, it shall set octet 5 to "11111110", i.e. 8640     |
|kbps, and shall encode the value for the maximum bit rate in octet 9.                                                                            |
|                                                                                                                                                 |
|The network shall map all other values not explicitly defined onto one of the values defined in this version of the protocol. The network shall  |
|return a negotiated value which is explicitly defined in this version of the protocol.                                                           |
|                                                                                                                                                 |
|In this version of the protocol, for messages specified in the present document, the sending entity shall not request 0 kbps for both the maximum|
|bit rate for downlink and the maximum bit rate for uplink at the same time. Any entity receiving a request for 0 kbps in both the maximum bit    |
|rate for downlink and the maximum bit rate for uplink shall consider that as a syntactical error (see clause 8 of 3GPP TS 24.008 [13]).          |
|                                                                                                                                                 |
|                                                                                                                                                 |
|Guaranteed bit rate for uplink, octet 6 (see 3GPP TS 23.107 [5])                                                                                 |
|                                                                                                                                                 |
|Coding is identical to that of maximum bit rate for uplink.                                                                                      |
|                                                                                                                                                 |
|If the sending entity wants to indicate a guaranteed bit rate for uplink higher than 8640 kbps, it shall set octet 6 to "11111110", i.e. 8640    |
|kbps, and shall encode the value for the guaranteed bit rate in octet 10.                                                                        |
|                                                                                                                                                 |
|The network shall map all other values not explicitly defined onto one of the values defined in this version of the protocol. The network shall  |
|return a negotiated value which is explicitly defined in this version of the protocol.                                                           |
|                                                                                                                                                 |
|                                                                                                                                                 |
|Guaranteed bit rate for downlink, octet 7 (see 3GPP TS 23.107 [5])                                                                               |
|                                                                                                                                                 |
|Coding is identical to that of maximum bit rate for uplink.                                                                                      |
|                                                                                                                                                 |
|If the sending entity wants to indicate a guaranteed bit rate for downlink higher than 8640 kbps, it shall set octet 7 to "11111110", i.e. 8640  |
|kbps, and shall encode the value for the guaranteed bit rate in octet 11.                                                                        |
|                                                                                                                                                 |
|The network shall map all other values not explicitly defined onto one of the values defined in this version of the protocol. The network shall  |
|return a negotiated value which is explicitly defined in this version of the protocol.                                                           |
|                                                                                                                                                 |
|                                                                                                                                                 |
|Maximum bit rate for uplink (extended), octet 8                                                                                                  |
|Bits                                                                                                                                             |
|8 7 6 5 4 3 2 1                                                                                                                                  |
|                                                                                                                                                 |
|In UE to network direction and in network to UE direction:                                                                                       |
|0 0 0 0 0 0 0 0 Use the value indicated by the maximum bit rate for uplink in octet 4.                                                           |
|                                                                                                                                                 |
|For all other values: ignore the value indicated by the maximum bit rate for uplink in octet 4                                                   |
|and use the following value:                                                                                                                     |
|0 0 0 0 0 0 0 1 The maximum bit rate is 8600 kbps + ((the binary coded value in 8 bits) * 100 kbps),                                             |
|to giving a range of values from 8700 kbps to 16000 kbps in 100 kbps increments.                                                                 |
|0 1 0 0 1 0 1 0                                                                                                                                  |
|                                                                                                                                                 |
|0 1 0 0 1 0 1 1 The maximum bit rate is 16 Mbps + ((the binary coded value in 8 bits - 01001010) * 1 Mbps),                                      |
|to giving a range of values from 17 Mbps to 128 Mbps in 1 Mbps increments.                                                                       |
|1 0 1 1 1 0 1 0                                                                                                                                  |
|                                                                                                                                                 |
|1 0 1 1 1 0 1 1 The maximum bit rate is 128 Mbps + ((the binary coded value in 8 bits - 10111010) * 2 Mbps),                                     |
|to giving a range of values from 130 Mbps to 256 Mbps in 2 Mbps increments.                                                                      |
|1 1 1 1 1 0 1 0                                                                                                                                  |
|                                                                                                                                                 |
|If the sending entity wants to indicate a Maximum bit rate for uplink higher than 256 Mbps, it shall set octet 8 to "11111010", i.e. 256 Mbps,   |
|and shall encode the value for the Maximum bit rate in octet 12.                                                                                 |
|                                                                                                                                                 |
|The network shall map all other values not explicitly defined onto one of the values defined in this version of the protocol. The network shall  |
|return a negotiated value which is explicitly defined in this version of the protocol.                                                           |
|                                                                                                                                                 |
|                                                                                                                                                 |
|Maximum bit rate for downlink (extended), octet 9                                                                                                |
|                                                                                                                                                 |
|This field is an extension of the maximum bit rate for downlink in octet 5. The coding is identical to that of the maximum bit rate for uplink   |
|(extended).                                                                                                                                      |
|                                                                                                                                                 |
|If the sending entity wants to indicate a Maximum bit rate for downlink higher than 256 Mbps, it shall set octet 9 to "11111010", i.e. 256 Mbps, |
|and shall encode the value for the Maximum bit rate in octet 13.                                                                                 |
|                                                                                                                                                 |
|The network shall map all other values not explicitly defined onto one of the values defined in this version of the protocol. The network shall  |
|return a negotiated value which is explicitly defined in this version of the protocol.                                                           |
|                                                                                                                                                 |
|                                                                                                                                                 |
|Guaranteed bit rate for uplink (extended), octet 10                                                                                              |
|Bits                                                                                                                                             |
|8 7 6 5 4 3 2 1                                                                                                                                  |
|                                                                                                                                                 |
|In UE to network direction and in network to UE direction:                                                                                       |
|0 0 0 0 0 0 0 0 Use the value indicated by the guaranteed bit rate for uplink in octet 6.                                                        |
|                                                                                                                                                 |
|For all other values: ignore the value indicated by the guaranteed bit rate for uplink in octet 6                                                |
|and use the following value:                                                                                                                     |
|0 0 0 0 0 0 0 1 The guaranteed bit rate is 8600 kbps + ((the binary coded value in 8 bits) * 100 kbps),                                          |
|to giving a range of values from 8700 kbps to 16000 kbps in 100 kbps increments.                                                                 |
|0 1 0 0 1 0 1 0                                                                                                                                  |
|                                                                                                                                                 |
|0 1 0 0 1 0 1 1 The guaranteed bit rate is 16 Mbps + ((the binary coded value in 8 bits - 01001010) * 1 Mbps),                                   |
|to giving a range of values from 17 Mbps to 128 Mbps in 1 Mbps increments.                                                                       |
|1 0 1 1 1 0 1 0                                                                                                                                  |
|                                                                                                                                                 |
|1 0 1 1 1 0 1 1 The guaranteed bit rate is 128 Mbps + ((the binary coded value in 8 bits - 10111010) * 2 Mbps),                                  |
|to giving a range of values from 130 Mbps to 256 Mbps in 2 Mbps increments.                                                                      |
|1 1 1 1 1 0 1 0                                                                                                                                  |
|                                                                                                                                                 |
|If the sending entity wants to indicate a Guaranteed bit rate for uplink higher than 256 Mbps, it shall set octet 10 to "11111010", i.e. 256     |
|Mbps, and shall encode the value for the Maximum bit rate in octet 14.                                                                           |
|                                                                                                                                                 |
|The network shall map all other values not explicitly defined onto one of the values defined in this version of the protocol. The network shall  |
|return a negotiated value which is explicitly defined in this version of the protocol.                                                           |
|                                                                                                                                                 |
|                                                                                                                                                 |
|Guaranteed bit rate for downlink (extended), octet 11                                                                                            |
|                                                                                                                                                 |
|This field is an extension of the guaranteed bit rate for downlink in octet 7. The coding is identical to that of guaranteed bit rate for uplink |
|(extended).                                                                                                                                      |
|                                                                                                                                                 |
|If the sending entity wants to indicate a Guaranteed bit rate for downlink higher than 256 Mbps, it shall set octet 11 to "11111010", i.e. 256   |
|Mbps, and shall encode the value for the Maximum bit rate in octet 15.                                                                           |
|                                                                                                                                                 |
|The network shall map all other values not explicitly defined onto one of the values defined in this version of the protocol. The network shall  |
|return a negotiated value which is explicitly defined in this version of the protocol.                                                           |
|                                                                                                                                                 |
|                                                                                                                                                 |
|Maximum bit rate for uplink (extended-2), octet 12                                                                                               |
|Bits                                                                                                                                             |
|8 7 6 5 4 3 2 1                                                                                                                                  |
|In UE to network direction and in network to UE direction:                                                                                       |
|0 0 0 0 0 0 0 0 Use the value indicated by the Maximum bit rate for uplink in octet 4 and octet 8.                                               |
|                                                                                                                                                 |
|For all other values: Ignore the value indicated by the Maximum bit rate for upink in octet 4 and                                                |
|octet 8 and use the following value:                                                                                                             |
|0 0 0 0 0 0 0 1 The maximum bit rate is 256 Mbps + ((the binary coded value in 8 bits) * 4 Mbps),                                                |
|0 0 1 1 1 1 0 1 giving a range of values from 260 Mbps to 500 Mbps in 4 Mbps increments.                                                         |
|                                                                                                                                                 |
|0 0 1 1 1 1 1 0 The maximum bit rate is 500 Mbps + ((the binary coded value in 8 bits - 00111101) * 10 Mbps),                                    |
|1 0 1 0 0 0 0 1 giving a range of values from 510 Mbps to 1500 Mbps in 10 Mbps increments.                                                       |
|                                                                                                                                                 |
|1 0 1 0 0 0 1 0 The maximum bit rate is 1500 Mbps + ((the binary coded value in 8 bits - 10100001) * 100 Mbps),                                  |
|1 1 1 1 0 1 1 0 giving a range of values from 1600 Mbps to 10 Gbps in 100 Mbps increments.                                                       |
|                                                                                                                                                 |
|If the sending entity wants to indicate a Maximum bit rate for uplink higher than 10 Gbps, it shall set octet 12 to "11110110", i.e. 10 Gbps, and|
|shall encode the value for the maximum bit rate in the Extended quality of service information element specified in subclause 9.9.4.30.          |
|                                                                                                                                                 |
|The network shall map all other values not explicitly defined onto one of the values defined in this version of the protocol. The network shall  |
|return a negotiated value which is explicitly defined in this version of the protocol.                                                           |
|                                                                                                                                                 |
|The UE shall map all other values not explicitly defined onto the maximum value defined in this version of the protocol.                         |
|                                                                                                                                                 |
|Maximum bit rate for downlink (extended-2), octet 13                                                                                             |
|                                                                                                                                                 |
|This field is an extension of the Maximum bit rate for downlink in octet 9. The coding is identical to that of the Maximum bit rate for uplink   |
|(extended-2).                                                                                                                                    |
|                                                                                                                                                 |
|If the sending entity wants to indicate a Maximum bit rate for downlink higher than 10 Gbps, it shall set octet 13 to "11110110", i.e. 10 Gbps,  |
|and shall encode the value for the maximum bit rate in the Extended quality of service information element specified in subclause 9.9.4.30.      |
|                                                                                                                                                 |
|The network shall map all other values not explicitly defined onto one of the values defined in this version of the protocol. The network shall  |
|return a negotiated value which is explicitly defined in this version of the protocol.                                                           |
|                                                                                                                                                 |
|The UE shall map all other values not explicitly defined onto the maximum value defined in this version of the protocol.                         |
|                                                                                                                                                 |
|Guaranteed bit rate for uplink (extended-2), octet 14                                                                                            |
|Bits                                                                                                                                             |
|8 7 6 5 4 3 2 1                                                                                                                                  |
|In UE to network direction and in network to UE direction:                                                                                       |
|0 0 0 0 0 0 0 0 Use the value indicated by the Guaranteed bit rate for uplink in octet 6 and octet 10.                                           |
|                                                                                                                                                 |
|For all other values: Ignore the value indicated by the Guaranteed bit rate for uplink in octet 6 and                                            |
|octet 10 and use the following value:                                                                                                            |
|0 0 0 0 0 0 0 1 The guaranteed bit rate is 256 Mbps + ((the binary coded value in 8 bits) * 4 Mbps),                                             |
|0 0 1 1 1 1 0 1 giving a range of values from 260 Mbps to 500 Mbps in 4 Mbps increments.                                                         |
|                                                                                                                                                 |
|0 0 1 1 1 1 1 0 The guaranteed bit rate is 500 Mbps + ((the binary coded value in 8 bits - 00111101) * 10 Mbps),                                 |
|1 0 1 0 0 0 0 1 giving a range of values from 510 Mbps to 1500 Mbps in 10 Mbps increments.                                                       |
|                                                                                                                                                 |
|1 0 1 0 0 0 1 0 The guaranteed bit rate is 1500 Mbps + ((the binary coded value in 8 bits - 10100001) * 100 Mbps),                               |
|1 1 1 1 0 1 1 0 giving a range of values from 1600 Mbps to 10 Gbps in 100 Mbps increments.                                                       |
|                                                                                                                                                 |
|If the sending entity wants to indicate a Guaranteed bit rate for uplink higher than 10 Gbps, it shall set octet 14 to "11110110", i.e. 10 Gbps, |
|and shall encode the value for the guaranteed bit rate in the Extended quality of service information element specified in subclause 9.9.4.30.   |
|                                                                                                                                                 |
|The network shall map all other values not explicitly defined onto one of the values defined in this version of the protocol. The network shall  |
|return a negotiated value which is explicitly defined in this version of the protocol.                                                           |
|                                                                                                                                                 |
|The UE shall map all other values not explicitly defined onto the maximum value defined in this version of the protocol.                         |
|                                                                                                                                                 |
|Guaranteed bit rate for downlink (extended-2), octet 15                                                                                          |
|                                                                                                                                                 |
|This field is an extension of the Guaranteed bit rate for downlink in octet 11. The coding is identical to that of the Guaranteed bit rate for   |
|uplink (extended-2).                                                                                                                             |
|                                                                                                                                                 |
|If the sending entity wants to indicate a Guaranteed bit rate for downlink higher than 10 Gbps, it shall set octet 15 to "11110110", i.e. 10     |
|Gbps, and shall encode the value for the guaranteed bit rate in the Extended quality of service information element specified in                 |
|subclause 9.9.4.30.                                                                                                                              |
|                                                                                                                                                 |
|The network shall map all other values not explicitly defined onto one of the values defined in this version of the protocol. The network shall  |
|return a negotiated value which is explicitly defined in this version of the protocol.                                                           |
|                                                                                                                                                 |
|The UE shall map all other values not explicitly defined onto the maximum value defined in this version of the protocol.                         |



9.9.4.4	ESM cause

The purpose of the ESM cause information element is to indicate the reason why a session management request is rejected.

The ESM cause information element is coded as shown in figure 9.9.4.4.1 and table 9.9.4.4.1.

The ESM cause is a type 3 information element with 2 octets length.



|8                                                                                       |7                     |
|Cause value                                                                             |octet 2               |

Figure 9.9.4.4.1: ESM cause information element

Table 9.9.4.4.1: ESM cause information element

|Cause value (octet 2)                                                                                     |
|                                                                                                          |
|Bits                                                                                                      |
|8                                                                                                         |
|                                                                                                          |
|NOTE 1: The listed cause values are defined in annex B.                                                   |
|NOTE 2: This value was allocated in earlier versions of this protocol, but there is no situation where    |
|this value can be used. If received by the network, it shall be treated as 0110 1111, "protocol error,    |
|unspecified".                                                                                             |



9.9.4.5	ESM information transfer flag

The purpose of the ESM information transfer flag information element is to indicate whether ESM information, i.e. protocol configuration options or APN or both, is to be transferred security protected.

The ESM information transfer flag information element is coded as shown in figure 9.9.4.5.1 and table 9.9.4.5.1.

The ESM information transfer flag is a type 1 information element.



|8                                           |7         |6         |5         |4         |3                      |
|                                            |spare                          |          |                       |

Figure 9.9.4.5.1: ESM information transfer flag information element

Table 9.9.4.5.1: ESM information transfer flag information element

|EIT (ESM information transfer)                                                             |
|                                                                                           |
|Bit                                                                                        |
|1   |     |                                                                                 |
|0   |     |security protected ESM information transfer not required                         |
|1   |     |security protected ESM information transfer required                             |
|    |     |                                                                                 |



9.9.4.6	Linked EPS bearer identity

The purpose of the Linked EPS bearer identity IE is to identify the default bearer that is associated with a dedicated EPS bearer or to identify the EPS bearer (default or dedicated) with which one or more packet filters specified in a traffic flow aggregate are associated.

The Linked EPS bearer identity information element is coded as shown in figure 9.9.4.6.1 and table 9.9.4.6.1.

The Linked EPS bearer identity is a type 1 information element.



|8                                           |7                                        |6                      |

Figure 9.9.4.6.1: Linked EPS bearer identity information element

Table 9.9.4.6.1: Linked EPS bearer identity information element

|Linked EPS bearer identity (bits 1-4)                                                                    |
|                                                                                                         |
|4  |3  |2  |1  |                                                                                        |
|0  |0  |0  |0  |Reserved                                                                                |
|0  |0  |0  |1  |EPS bearer identity value 1                                                             |
|0  |0  |1  |0  |EPS bearer identity value 2                                                             |
|0  |0  |1  |1  |EPS bearer identity value 3                                                             |
|0  |1  |0  |0  |EPS bearer identity value 4                                                             |
|0  |1  |0  |1  |EPS bearer identity value 5                                                             |
|0  |1  |1  |0  |EPS bearer identity value 6                                                             |
|0  |1  |1  |1  |EPS bearer identity value 7                                                             |
|1  |0  |0  |0  |EPS bearer identity value 8                                                             |
|1  |0  |0  |1  |EPS bearer identity value 9                                                             |
|1  |0  |1  |0  |EPS bearer identity value 10                                                            |
|1  |0  |1  |1  |EPS bearer identity value 11                                                            |
|1  |1  |0  |0  |EPS bearer identity value 12                                                            |
|1  |1  |0  |1  |EPS bearer identity value 13                                                            |
|1  |1  |1  |0  |EPS bearer identity value 14                                                            |
|1  |1  |1  |1  |EPS bearer identity value 15                                                            |
|                                                                                                         |



9.9.4.7	LLC service access point identifier

See subclause 10.5.6.9 in 3GPP TS 24.008 [13].


9.9.4.7A	Notification indicator

The purpose of the Notification indicator information element is to inform the UE about an event which is relevant for the upper layer using an EPS bearer context or having requested a procedure transaction.

The Notification indicator information element is coded as shown in figure 9.9.4.7A.1 and table 9.9.4.7A.1.

The Notification indicator is a type 4 information element with 3 octets length.



|8                                                                                       |7                     |
|Length of notification indicator contents                                               |octet 2               |
|Notification indicator value                                                            |octet 3               |

Figure 9.9.4.7A.1: Notification indicator information element

Table 9.9.4.7A.1: Notification indicator information element

|Notification indicator value (octet 3)                                                                    |
|                                                                                                          |
|Bits                                                                                                      |
|8                                |7        |6                                                             |
|0                                                                                                         |
|All other values are reserved.                                                                            |
|                                                                                                          |



9.9.4.8	Packet flow identifier

See subclause 10.5.6.11 in 3GPP TS 24.008 [13].


9.9.4.9	PDN address

The PDN address information element can assign an IPv4 address to the UE associated with a packet data network and provide the UE with an interface identifier to be used to build the IPv6 link local address.

The PDN address information element is coded as shown in figure 9.9.4.9.1 and table 9.9.4.9.1.

The PDN address is a type 4 information element with minimum length of 7 octets and a maximum length of 15 octets.



|8         |7         |6         |5         |4         |3         |2         |1         |                |
|PDN address IEI                                                                     |octet 1         |
|Length of PDN address contents                                                      |octet 2         |
|0         |0         |0         |0         |0         |PDN type value                 |octet 3         |
|spare                                               |                               |                |
|                                                                                    |octet 4         |
|PDN address information                                                             |                |
|                                                                                    |octet 15        |

Figure 9.9.4.9.1: PDN address information element

Table 9.9.4.9.1: PDN address information element

|PDN type value (octet 3)                                                                                 |
|Bits                                                                                                     |
|3  |2  |1  |   |                                                                                        |
|0  |0  |1  |   |IPv4                                                                                    |
|0  |1  |0  |   |IPv6                                                                                    |
|0  |1  |1  |   |IPv4v6                                                                                  |
|1  |0  |1  |   |non IP                                                                                  |
|                                                                                                         |
|All other values are reserved.                                                                           |
|                                                                                                         |
|Bit 4 to 8 of octet 3 are spare and shall be coded as zero.                                              |
|                                                                                                         |
|                                                                                                         |
|PDN address information (octet 4 to 15)                                                                  |
|                                                                                                         |
|If PDN type value indicates IPv4, the PDN address information in octet 4 to octet 7 contains an IPv4     |
|address. Bit 8 of octet 4 represents the most significant bit of the IPv4 address and bit 1 of octet 7   |
|the least significant bit.                                                                               |
|                                                                                                         |
|If PDN type value indicates IPv6, the PDN address information in octet 4 to octet 11 contains an IPv6    |
|interface identifier. Bit 8 of octet 4 represents the most significant bit of the IPv6 interface         |
|identifier and bit 1 of octet 11 the least significant bit.                                              |
|                                                                                                         |
|If PDN type value indicates IPv4v6, the PDN address information in octet 4 to octet 15 contains an IPv6  |
|interface identifier and an IPv4 address. Bit 8 of octet 4 represents the most significant bit of the    |
|IPv6 interface identifier and bit 1 of octet 11 the least significant bit. Bit 8 of octet 12 represents  |
|the most significant bit of the IPv4 address and bit 1 of octet 15 the least significant bit.            |
|                                                                                                         |
|If PDN type value indicates IPv4 or IPv4v6 and DHCPv4 is to be used to allocate the IPv4 address, the    |
|IPv4 address shall be coded as 0.0.0.0.                                                                  |
|                                                                                                         |
|If PDN type value indicates non IP, the PDN address information in octet 4 to octet 7 are spare and shall|
|be coded as zero.                                                                                        |
|                                                                                                         |



9.9.4.10	PDN type

The purpose of the PDN type information element is to indicate:

  -	the IP version capability of the IP stack associated with the UE; or

  -	non IP.

The PDN type information element is coded as shown in figure 9.9.4.10.1 and table 9.9.4.10.1.

The PDN type is a type 1 information element.



|8                                           |7         |6                              |5                      |

Figure 9.9.4.10.1: PDN type information element

Table 9.9.4.10.1: PDN type information element

|PDN type value (octet 1)                                                                                 |
|Bits                                                                                                     |
|3  |2  |1  |   |                                                                                        |
|0  |0  |1  |   |IPv4                                                                                    |
|0  |1  |0  |   |IPv6                                                                                    |
|0  |1  |1  |   |IPv4v6                                                                                  |
|1  |0  |0  |   |unused; shall be interpreted as "IPv6" if received by the network                       |
|1  |0  |1  |   |non IP                                                                                  |
|                                                                                                         |
|All other values are reserved.                                                                           |
|                                                                                                         |
|Bit 4 of octet 1 is spare and shall be coded as zero.                                                    |
|                                                                                                         |



9.9.4.11	Protocol configuration options

See subclause 10.5.6.3 in 3GPP TS 24.008 [13].


9.9.4.12	Quality of service

See subclause 10.5.6.5 in 3GPP TS 24.008 [13].


9.9.4.13	Radio priority

See subclause 10.5.7.2 in 3GPP TS 24.008 [13].


9.9.4.13A	Re-attempt indicator

The purpose of the Re-attempt indicator information element is to indicate a condition under which the UE is allowed, in the current PLMN for the same APN, to re-attempt a session management procedure (see 3GPP TS 24.008 [13]) corresponding to the EPS session management procedure which was rejected by the network.

The Re-attempt indicator information element is coded as shown in figure 9.9.4.13A/3GPP TS 24.301 and table 9.9.4.13A/3GPP TS 24.301.

|8                                                                                         |7           |
|Length of Reattempt indicator contents                                                    |octet 2     |
|0                                                                                                        |
|Spare                                                                                                    |



9.9.4.14	Request type

See subclause 10.5.6.17 in 3GPP TS 24.008 [13].


9.9.4.15	Traffic flow aggregate description

The purpose of the Traffic flow aggregate description information element is to specify the aggregate of one of more packet filters and their related parameters and operations. The traffic flow aggregate description may contain the aggregate of packet filters for the downlink direction, the uplink direction or packet filters that apply for both directions. The packet filters determine the traffic mapping to EPS bearer contexts. The downlink packet filters shall be applied by the network, and the uplink packet filters shall be applied by the UE. A packet filter that applies for both directions shall be applied by the network as a downlink packet filter and by the UE as an uplink packet filter.

When the traffic flow aggregate description is used in the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure, it is associated to a particular procedure identified by a procedure transaction identity (PTI). Therefore, the UE shall release the traffic flow aggregate description when the UE requested bearer resource allocation procedure or the UE requested bearer resource modification procedure is completed. The UE shall not include the packet filters of a particular traffic flow aggregate description in any other traffic flow aggregate description when multiple UE requested bearer resource allocation procedures and/or UE requested bearer resource modification procedures are ongoing in parallel.

The Traffic flow aggregate description information element is encoded using the same format as the Traffic flow template (TFT) information element (see subclause 10.5.6.12 in 3GPP TS 24.008 [13]). When sending this IE in the BEARER RESOURCE ALLOCATION REQUEST message or the BEARER RESOURCE MODIFICATION REQUEST message, the UE shall set the packet filter identifier values to 0 if the packet filters are newly created; otherwise, the UE shall set the packet filter identifier values from those of already assigned packet filter identifiers of the existing EPS bearer, so that they are unique across all packet filters for the EPS bearer context indicated by the EPS bearer identity IE.


9.9.4.16	Traffic flow template

See subclause 10.5.6.12 in 3GPP TS 24.008 [13].


9.9.4.17	Transaction identifier

The purpose of the Transaction identifier information element is to represent the corresponding PDP context in A/Gb mode or Iu mode which is mapped from the EPS bearer context.

The Transaction identifier information element is coded as the Linked TI information element in 3GPP TS 24.008 [13], subclause 10.5.6.7.


9.9.4.18	WLAN offload acceptability

See subclause 10.5.6.20 in 3GPP TS 24.008 [13].


9.9.4.19	NBIFOM container

See subclause 10.5.6.21 in 3GPP TS 24.008 [4].


9.9.4.20	Remote UE context list

The purpose of the Remote UE context list information element is to provide identity and optionally IP address of a remote UE connected to, or disconnected from, a UE acting as a ProSe UE-to-network relay.

The Remote UE context list information element is coded as shown in figure 9.9.4.20.1 and table 9.9.4.20.1.

The Remote UE context list is a type 6 information element with a minimum length of 5 octets and a maximum length of 65538 octets.

|8                                                                                   |7               |
|Length of remote UE context list contents                                           |octet 2 to 3    |
|                                                                                    |                |
|Number of remote UE contexts                                                        |octet 4         |
|                                                                                    |octet 5 to a    |
|Remote UE context 1                                                                 |                |
|                                                                                    |                |
|                                                                                    |                |
|                                                                                    |                |
|…                                                                                   |                |
|                                                                                    |octet b         |
|Remote UE context k                                                                 |                |
|                                                                                    |                |
|                                                                                    |octet m         |

Figure 9.9.4.20.1: Remote UE context list

Table 9.9.4.20.1: Remote UE context list

|Remote UE context (octet 5 etc)                                                                     |
|                                                                                                    |
|The contents of remote UE context are applicable for one individual UE and are coded as shown in    |
|figure 9.9.4.20.2 and table 9.9.4.20.2.                                                             |
|                                                                                                    |


|8                                                                                   |7               |
|Number of user identities                                                           |octet 2         |
|Length of user identity 1                                                           |octet 3         |
|                                         |odd/      |                               |octet 4         |
|User identity 1 digit 1                  |even      |Type of user identity 1        |                |
|                                         |indic     |                               |                |
|                                         |                                         |octet 5*        |
|User identity 1 digit p+1                |User identity 1 digit p                  |                |
|                                                                                    |                |
|…                                                                                   |                |
|Length of user identity v                                                           |                |
|                                                                                    |octet m         |
|                                         |odd/      |                               |octet m+1       |
|User identity v digit 1                  |even      |Type of user identity v        |                |
|                                         |indic     |                               |                |
|                                         |                                         |octet m+2*      |
|User identity v digit p+1                |User identity v digit p                  |                |
|Spare                                               |Address type                   |octet j         |
|                                                                                    |octet j+1       |
|Address information                                                                 |                |
|                                                                                    |octet j+k       |

Figure 9.9.4.20.2: Remote UE context

Table 9.9.4.20.2: Remote UE context list information element

|Odd/even indication (octet 4)                                                                       |
|Bit                                                                                                 |
|4  |   |   |                                                                                        |
|0  |   |   |even number of identity digits                                                          |
|1  |   |   |odd number of identity digits                                                           |
|                                                                                                    |
|Type of user identity (octet 4)                                                                     |
|Bits                                                                                                |
|3  |2  |1  |                                                                                        |
|0  |0  |1  |Encrypted IMSI                                                                          |
|0  |1  |0  |IMSI                                                                                    |
|0  |1  |1  |MSISDN                                                                                  |
|1  |0  |0  |IMEI                                                                                    |
|1  |0  |1  |IMEISV                                                                                  |
|                                                                                                    |
|All other values are reserved.                                                                      |
|                                                                                                    |
|Identity digits (octet 4 etc)                                                                       |
|                                                                                                    |
|For the Encrypted IMSI, this field is coded as a 128-bit string. Bits 5 to 8 of octet 4 are not part|
|of the encrypted IMSI and shall be coded as zero. Bit 8 of octet 5 represents the most significant  |
|bit of the encrypted IMSI and bit 1 of octet 21 the least significant bit.                          |
|For the IMSI, this field is coded using BCD coding. If the number of identity digits is even then   |
|bits 5 to 8 of the last octet shall be filled with an end mark coded as "1111". The format of IMSI  |
|is described in 3GPP TS 23.003 [2].                                                                 |
|                                                                                                    |
|For the MSISDN, this field is coded using BCD coding. The format of MSISDN is described in          |
|3GPP TS 23.003 [2].                                                                                 |
|                                                                                                    |
|For the IMEI, this field is coded using BCD coding. The format of the IMEI is described in          |
|3GPP TS 23.003 [2].                                                                                 |
|                                                                                                    |
|For the IMEISV, this field is coded using BCD coding. Bits 5 to 8 of the last octet shall be filled |
|with an end mark coded as "1111". The format of the IMEISV is described in 3GPP TS 23.003 [2].      |
|                                                                                                    |
|Bits 4 to 8 of octet j are spare and shall be coded as zero.                                        |
|                                                                                                    |
|Address type (octet j)                                                                              |
|Bits                                                                                                |
|3  |2  |1  |                                                                                        |
|0  |0  |0  |No IP Info                                                                              |
|0  |0  |1  |IPv4                                                                                    |
|0  |1  |0  |IPv6                                                                                    |
|                                                                                                    |
|All other values are reserved.                                                                      |
|                                                                                                    |


If Address type indicates IPv4, the Address information in octet j+1 to octet j+6 contains the IPv4 address and port number. Bit 8 of octet j+1 represents the most significant bit of the IP address and bit 1 of octet j+4 the least significant bit. Bit 8 of octet j+5 represents the most significant bit of the port number and bit 1 of octet j+6 the least significant bit.

If Address type indicates IPv6, the Address information in octet j+1 to octet j+8 contains the /64 IPv6 prefix of a remote UE. Bit 8 of octet j+1 represents the most significant bit of the /64 IPv6 prefix and bit 1 of octet j+8 the least significant bit.

If Address type indicates No IP info, the Address information octets are not included.


9.9.4.21	PKMF address

The purpose of the PKMF address information element is to provide IP address of a ProSe Key Management Function associated with remote UEs connected to or disconnected from a UE acting as a ProSe UE-to-network relay.

The PKMF address information element is coded as shown in figure 9.9.4.21.1 and table 9.9.4.21.1.

The PKMF address is a type 4 information element with a minimum length of 3 octets and a maximum length of 19 octets.



|8                                                                                   |7               |
|Length of PKMF address contents                                                     |octet 2         |
|Spare                                               |Address type                   |octet 3         |
|                                                                                    |octet 4         |
|Address information                                                                 |                |
|                                                                                    |octet 4+k       |

Figure 9.9.4.21.1: PKMF Address

Table 9.9.4.21.1: PKMF Address information element

|Bits 4 to 8 of octet 1 are spare and shall be coded as zero.                                        |
|                                                                                                    |
|Address type (octet 1)                                                                              |
|Bits                                                                                                |
|3  |2  |1  |                                                                                        |
|0  |0  |1  |IPv4                                                                                    |
|0  |1  |0  |IPv6                                                                                    |
|                                                                                                    |
|All other values are reserved.                                                                      |
|                                                                                                    |


If Address type indicates IPv4, the Address information in octet 4 to octet 7 contains the IPv4 address. Bit 8 of octet 4 represents the most significant bit of the IP address and bit 1 of octet 7 the least significant bit.

If Address type indicates IPv6, the Address information in octet 4 to octet 19 contains the IPv6 address. Bit 8 of octet 4 represents the most significant bit of the IP address and bit 1 of octet 19 the least significant bit.


9.9.4.22	Header compression configuration

The purpose of the Header compression configuration information element is to negotiate ROHC channel setup parameters specified in IETF RFC 5795 [37] and, optionally, provide additional header compression context setup parameters.

The Header compression configuration information element is coded as shown in figure 9.9.4.22.1 and table 9.9.4.22.1.

The Header compression configuration is a type 4 information element with a minimum length of 5 octets and a maximum length of 257 octets.

The optional Additional header compression parameters container field conveys the additional header compression context setup parameters as specified in 3GPP TS 23.401 [10] in a generic container. This field corresponds to the profile-specific information in the header of the ROHC IR packet type in IETF RFC 5795 [37].



|8                                                                                                   |7         |
|Length of Header compression configuration contents                                                 |octet 2   |
|Spare                                                                                               |P0x0104   |
|                                                                                                    |octet 5   |
|Additional header compression context setup parameters type                                         |octet 6*  |
|Additional header compression context setup parameters container                                    |octet 7*  |
|                                                                                                    |          |
|                                                                                                    |octet n*  |

Figure 9.9.4.22.1: Header compression configuration information element



Table 9.9.4.22.1: Header compression configuration information element

|ROHC Profiles (octet 3)                                                                                                                           |
|                                                                                                                                                  |
|The ROHC Profiles shall indicate which of the ROHC profiles is supported. When a particular bit is set to 1, this indicates that the corresponding|
|profile is supported. The No Compression profile 0x0000 (see IETF RFC 5795 [37]) shall always be supported. When all the bits are set to 0, this  |
|indicates that only the No Compression profile 0x0000 is supported.                                                                               |
|                                                                                                                                                  |
|Profile 0x0002 support indicator (see IETF RFC 3095 [40] and IETF RFC 4815 [42]) (octet 3 bit 1)                                                  |
|                                                                                                                                                  |
|0 RoHC profile 0x0002 (UDP/IP) is not supported                                                                                                   |
|1 RoHC profile 0x0002 (UDP/IP) is supported                                                                                                       |
|                                                                                                                                                  |
|Profile 0x0003 support indicator (see IETF RFC 3095 [40] and IETF RFC 4815 [42]) (octet 3 bit 2)                                                  |
|                                                                                                                                                  |
|0 RoHC profile 0x0003 (ESP/IP) is not supported                                                                                                   |
|1 RoHC profile 0x0003 (ESP/IP) is supported                                                                                                       |
|                                                                                                                                                  |
|Profile 0x0004 support indicator (see IETF RFC 3843 [41] and IETF RFC 4815 [42]) (octet 3 bit 3)                                                  |
|                                                                                                                                                  |
|0 RoHC profile 0x0004 (IP) is not supported                                                                                                       |
|1 RoHC profile 0x0004 (IP) is supported                                                                                                           |
|                                                                                                                                                  |
|Profile 0x0006 support indicator (see IETF RFC 6846 [39]) (octet 3 bit 4)                                                                         |
|                                                                                                                                                  |
|0 RoHC profile 0x0006 (TCP/IP) is not supported                                                                                                   |
|1 RoHC profile 0x0006 (TCP/IP) is supported                                                                                                       |
|                                                                                                                                                  |
|Profile 0x0102 support indicator (see IETF RFC 5225 [43]) (octet 3 bit 5)                                                                         |
|                                                                                                                                                  |
|0 RoHC profile 0x0102 (UDP/IP) is not supported                                                                                                   |
|1 RoHC profile 0x0102 (UDP/IP) is supported                                                                                                       |
|                                                                                                                                                  |
|Profile 0x0103 support indicator (see IETF RFC 5225 [43]) (octet 3 bit 6)                                                                         |
|                                                                                                                                                  |
|0 RoHC profile 0x0103 (ESP/IP) is not supported                                                                                                   |
|1 RoHC profile 0x0103 (ESP/IP) is supported                                                                                                       |
|                                                                                                                                                  |
|Profile 0x0104 support indicator (see IETF RFC 5225 [43]) (octet 3 bit 7)                                                                         |
|                                                                                                                                                  |
|0 RoHC profile 0x0104 (IP) is not supported                                                                                                       |
|1 RoHC profile 0x0104 (IP) is supported                                                                                                           |
|                                                                                                                                                  |
|Bits 8 is spare and shall be set to 0.                                                                                                            |
|                                                                                                                                                  |
|                                                                                                                                                  |
|MAX_CID (octet 4 and octet 5)                                                                                                                     |
|                                                                                                                                                  |
|This is the MAX_CID value as specified in 3GPP TS 36.323 [38]. It is encoded in binary coding with a value in the range from 1 to 16383.          |
|                                                                                                                                                  |
|                                                                                                                                                  |
|Additional header compression context parameters type (octet 6).                                                                                  |
|                                                                                                                                                  |
|The Additional header compression context parameters type octet indicates the profile associated with the profile-specific information in the     |
|Additional header compression context parameters container.                                                                                       |
|                                                                                                                                                  |
|Bits                                                                                                                                              |
|8 7 6 5 4 3 2 1 Type                                                                                                                              |
|                                                                                                                                                  |
|0 0 0 0 0 0 0 0 0x0000 (No Compression)                                                                                                           |
|0 0 0 0 0 0 0 1 0x0002 (UDP/IP)                                                                                                                   |
|0 0 0 0 0 0 1 0 0x0003 (ESP/IP)                                                                                                                   |
|0 0 0 0 0 0 1 1 0x0004 (IP)                                                                                                                       |
|0 0 0 0 0 1 0 0 0x0006 (TCP/IP)                                                                                                                   |
|0 0 0 0 0 1 0 1 0x0102 (UDP/IP)                                                                                                                   |
|0 0 0 0 0 1 1 0 0x0103 (ESP/IP)                                                                                                                   |
|0 0 0 0 0 1 1 1 0x0104 (IP)                                                                                                                       |
|0 0 0 0 1 0 0 0 Other                                                                                                                             |
|0 0 0 0 1 0 0 1                                                                                                                                   |
|to                                                                                                                                                |
|1 1 1 1 1 1 1 1 Spare                                                                                                                             |
|                                                                                                                                                  |
|                                                                                                                                                  |
|Additional header compression context parameters container (octets 7 to n).                                                                       |
|                                                                                                                                                  |
|Additional header compression context parameters container carries the profile-specific information (see IETF RFC 5795 [37]). The maximum size is |
|251 octets.                                                                                                                                       |



9.9.4.23	Control plane only indication

The purpose of the Control plane only indication information element is to indicate that a PDN connection is only for control plane CIoT EPS optimization, e.g. the PDN connection is with an SCEF (see 3GPP TS 23.401 [10]).

The Control plane only indication information element is coded as shown in figure 9.9.4.23.1.

The Control plane only indication is a type 1 information element.



|8                                        |7         |6         |5         |4         |3               |

Figure 9.9.4.23.1: Control plane only indication information element

Table 9.9.4.23.1: Control plane only indication information element

|Control plane only indication value (CPOI) (octet 1)                                                     |
|Bit                                                                                                      |
|1  |                                                                                                    |
|0  |reserved                                                                                            |
|1  |PDN connection can be used for control plane CIoT EPS optimization only                             |
|                                                                                                         |
|The value 0 is reserved. If received, it shall be interpreted as if the Control plane indication IE was  |
|not included in the message.                                                                             |
|Bits 4 to 2 of octet 1 are spare and shall be all encoded as zero.                                       |
|                                                                                                         |


9.9.4.24	User data container

This information element is used to encapsulate the user data transferred between the UE and the MME. The User data container information element is coded as shown in figure 9.9.4.24.1 and table 9.9.4.24.1.

The User data container is a type 6 information element.

|8                                                                                       |7                     |
|Length of User data container contents                                                  |octet 2               |
|                                                                                        |octet 3               |
|                                                                                        |octet 4               |
|User data container contents                                                            |                      |
|                                                                                        |octet n               |

Figure 9.9.4.24.1: User data container information element

Table 9.9.4.24.1: User data container information element

|User data container contents (octet 4 to octet n)                                                        |
|                                                                                                         |
|These octets include user data to be delivered between UE and MME.                                       |
|                                                                                                         |



9.9.4.25	Release assistance indication

The purpose of the Release assistance indication IE is to inform the network whether

  -	no further uplink or downlink data transmission is expected; or

  -	only a single downlink data transmission (e.g. acknowledgement or response to uplink data) and no further uplink data transmission subsequent to the uplink data transmission is expected.

The Release assistance indication information element is coded as shown in figure 9.9.4.25.1 and table 9.9.4.25.1.

The Release assistance indication is a type 1 information element.



|8                                        |7          |6        |5                      |4                  |


Figure 9.9.4.25.1: Release assistance indication information element

Table 9.9.4.25.1: Release assistance indication information element

|Release assistance indication value                                                                      |
|                                                                                                         |
|Downlink data expected (DDX)                                                                             |
|                                                                                                         |
|Bits                                                                                                     |
|2  |1  |                                                                                                |
|0  |0  |No information regarding DDX is conveyed by the information element. If received it shall be    |
|   |   |interpreted as 'neither value "01" nor "10" applies'                                            |
|0  |1  |No further uplink or downlink data transmission subsequent to the uplink data transmission is   |
|   |   |expected                                                                                        |
|1  |0  |Only a single downlink data transmission and no further uplink data transmission subsequent to  |
|   |   |the uplink data transmission is expected                                                        |
|1  |1  |reserved                                                                                        |
|   |   |                                                                                                |
|Bits 3 and 4 of octet 1 are spare and shall be encoded as zero.                                          |
|                                                                                                         |



9.9.4.26	Extended protocol configuration options

See subclause 10.5.6.3A in 3GPP TS 24.008 [13].


9.9.4.27	Header compression configuration status

The purpose of the Header compression configuration status information element is to indicate the status of the Header compression configuration for each EPS bearer using Control plane CIoT EPS optimisation that can be identified by an EPS bearer identity.

The Header compression confguration status information element is a type 4 information element with 4 the length of 4 octets.



|8                                                                                   |7               |
|Length of Header compression configuration status contents                          |octet 2         |
|EBI                                                                                                                                   |
|(7)                                                                                                                                   |



9.9.4.28	Serving PLMN rate control

The purpose of the Serving PLMN rate control information element is to indicate the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send via a PDN connection per 6 minute interval (see 3GPP TS 23.401 [10]).

The Serving PLMN rate control information element is coded as shown in figure 9.9.4.28.1.

The Serving PLMN rate control is a type 4 information element with 4 octets length.



|8                                                                                       |7                     |
|Length of serving PLMN rate control contents                                            |octet 2               |
|Serving PLMN rate control value                                                         |octet 3               |
|                                                                                        |octet 4               |

Figure 9.9.4.28.1: Serving PLMN rate control information element

Serving PLMN rate control value (octet 3 to octet 4) is a binary encoded integer indicating the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send per 6 minute interval. The Serving PLMN rate control value is an integer equal to or higher than 10. The Serving PLMN rate control value FFFFH indicates that the maximum number of uplink ESM DATA TRANSPORT messages including User data container IEs the UE is allowed to send per 6 minute interval is not restricted.


9.9.4.29	Extended APN aggregate maximum bit rate

The purpose of the extended APN aggregate maximum bit rate information element is to indicate the initial subscribed APN-AMBR with a value higher than 65280 Mbps when the UE establishes a PDN connection or to indicate the new APN-AMBR with a value higher than 65280 Mbps if it is changed by the network.

The receiving entityshall ignore the bit rate values which are included in the extended APN aggregate maximum bit rate information element and not higher than 65280 Mbps.

The extended APN aggregate maximum bit rate information element is coded as shown in figure 9.9.4.29.1 and table 9.9.4.29.1.

The extended APN aggregate maximum bit rate is a type 4 information element with a length of 8 octets.

|8         |7         |6         |5         |4         |3         |2         |1         |                |
|Extended APN aggregate maximum bit rate IEI                                         |octet 1         |
|Length of extended APN aggregate maximum bit rate contents                          |octet 2         |
|Unit for extended APN-AMBR for downlink                                             |octet 3         |
|Extended APN-AMBR for downlink                                                      |octet 4         |
|Extended APN-AMBR for downlink (continued)                                          |octet 5         |
|Unit for extended APN-AMBR for uplink                                               |octet 6         |
|Extended APN-AMBR for uplink                                                        |octet 7         |
|Extended APN-AMBR for uplink (continued)                                            |octet 8         |

Figure 9.9.4.29.1: Extended APN aggregate maximum bit rate information element

Table 9.9.4.29.1: Extended APN aggregate maximum bit rate information element

|Unit for extended APN-AMBR for downlink (octet 3)                                                   |
|                                                                                                    |
|0 0 0 0 0 0 0 0 value is not used                                                                   |
|0 0 0 0 0 0 0 1 value is not used                                                                   |
|0 0 0 0 0 0 1 0 value is not used                                                                   |
|0 0 0 0 0 0 1 1 value is incremented in multiples of 4 Mbps                                         |
|0 0 0 0 0 1 0 0 value is incremented in multiples of 16 Mbps                                        |
|0 0 0 0 0 1 0 1 value is incremented in multiples of 64 Mbps                                        |
|0 0 0 0 0 1 1 0 value is incremented in multiples of 256 Mbps                                       |
|0 0 0 0 0 1 1 1 value is incremented in multiples of 1 Gbps                                         |
|0 0 0 0 1 0 0 0 value is incremented in multiples of 4 Gbps                                         |
|0 0 0 0 1 0 0 1 value is incremented in multiples of 16 Gbps                                        |
|0 0 0 0 1 0 1 0 value is incremented in multiples of 64 Gbps                                        |
|0 0 0 0 1 0 1 1 value is incremented in multiples of 256 Gbps                                       |
|0 0 0 0 1 1 0 0 value is incremented in multiples of 1 Tbps                                         |
|0 0 0 0 1 1 0 1 value is incremented in multiples of 4 Tbps                                         |
|0 0 0 0 1 1 1 0 value is incremented in multiples of 16 Tbps                                        |
|0 0 0 0 1 1 1 1 value is incremented in multiples of 64 Tbps                                        |
|0 0 0 1 0 0 0 0 value is incremented in multiples of 256 Tbps                                       |
|0 0 0 1 0 0 0 1 value is incremented in multiples of 1 Pbps                                         |
|0 0 0 1 0 0 1 0 value is incremented in multiples of 4 Pbps                                         |
|0 0 0 1 0 0 1 1 value is incremented in multiples of 16 Pbps                                        |
|0 0 0 1 0 1 0 0 value is incremented in multiples of 64 Pbps                                        |
|0 0 0 1 0 1 0 1 value is incremented in multiples of 256 Pbps                                       |
|                                                                                                    |
|Other values shall be interpreted as multiples of 256 Pbps in this version of the protocol.         |
|                                                                                                    |
|Extended APN-AMBR for downlink (octets 4 and 5)                                                     |
|                                                                                                    |
|Octets 4 and 5 represent the binary coded value of extended APN-AMBR for downlink in units defined  |
|by octet 3                                                                                          |
|                                                                                                    |
|Unit for extended APN-AMBR for uplink (octet 6)                                                     |
|                                                                                                    |
|The coding is identical to that of the unit for extended APN-AMBR for downlink (octet 3)            |
|                                                                                                    |
|Extended APN-AMBR for uplink (octets 7 and 8)                                                       |
|                                                                                                    |
|Octets 7 and 8 represent the binary coded value of extended APN-AMBR for uplink in units defined by |
|octet 6.                                                                                            |



9.9.4.30	Extended quality of service

The purpose of the Extended quality of service information element is to indicate for an EPS bearer context the maximum bit rates for uplink and downlink and the guaranteed bit rates for uplink and downlink, if at least one of the bit rates has a value higher than 10 Gbps.

The Extended quality of service information element is coded as shown in figure 9.9.4.30.1 and table 9.9.4.30.1. For uplink and downlink, if the sending entity only has to indicate one bit rate (i.e, with a value higher than 10 Gbps), it shall encode the other bit rate (i.e., with a value smaller or equal to 10 Gbps) as "00000000". The receiving entity shall ignore a bit rate which is included in the extended quality of service information element and has a value smaller or equal to 10 Gbps.

The Extended quality of service is a type 4 information element with a length of 12 octets.

|8         |7         |6         |5         |4         |3         |2         |1         |                |
|Extended quality of service IEI                                                     |octet 1         |
|Length of Extended quality of service contents                                      |octet 2         |
|Unit for maximum bit rate                                                           |octet 3         |
|Maximum bit rate for uplink                                                         |octet 4         |
|Maximum bit rate for uplink (continued)                                             |octet 5         |
|Maximum bit rate for downlink                                                       |octet 6         |
|Maximum bit rate for downlink (continued)                                           |octet 7         |
|Unit for guaranteed bit rate                                                        |octet 8         |
|Guaranteed bit rate for uplink                                                      |octet 9         |
|Guaranteed bit rate for uplink (continued)                                          |octet 10        |
|Guaranteed bit rate for downlink                                                    |octet 11        |
|Guaranteed bit rate for downlink (continued)                                        |octet 12        |


Figure 9.9.4.30.1: Extended quality of service information element

Table 9.9.4.30.1: Extended quality of service information element

|Unit for maximum bit rate (octet 3)                                                                 |
|                                                                                                    |
|0 0 0 0 0 0 0 0 value is not used                                                                   |
|0 0 0 0 0 0 0 1 value is incremented in multiples of 200 kbps                                       |
|0 0 0 0 0 0 1 0 value is incremented in multiples of 1 Mbps                                         |
|0 0 0 0 0 0 1 1 value is incremented in multiples of 4 Mbps                                         |
|0 0 0 0 0 1 0 0 value is incremented in multiples of 16 Mbps                                        |
|0 0 0 0 0 1 0 1 value is incremented in multiples of 64 Mbps                                        |
|0 0 0 0 0 1 1 0 value is incremented in multiples of 256 Mbps                                       |
|0 0 0 0 0 1 1 1 value is incremented in multiples of 1 Gbps                                         |
|0 0 0 0 1 0 0 0 value is incremented in multiples of 4 Gbps                                         |
|0 0 0 0 1 0 0 1 value is incremented in multiples of 16 Gbps                                        |
|0 0 0 0 1 0 1 0 value is incremented in multiples of 64 Gbps                                        |
|0 0 0 0 1 0 1 1 value is incremented in multiples of 256 Gbps                                       |
|0 0 0 0 1 1 0 0 value is incremented in multiples of 1 Tbps                                         |
|0 0 0 0 1 1 0 1 value is incremented in multiples of 4 Tbps                                         |
|0 0 0 0 1 1 1 0 value is incremented in multiples of 16 Tbps                                        |
|0 0 0 0 1 1 1 1 value is incremented in multiples of 64 Tbps                                        |
|0 0 0 1 0 0 0 0 value is incremented in multiples of 256 Tbps                                       |
|0 0 0 1 0 0 0 1 value is incremented in multiples of 1 Pbps                                         |
|0 0 0 1 0 0 1 0 value is incremented in multiples of 4 Pbps                                         |
|0 0 0 1 0 0 1 1 value is incremented in multiples of 16 Pbps                                        |
|0 0 0 1 0 1 0 0 value is incremented in multiples of 64 Pbps                                        |
|0 0 0 1 0 1 0 1 value is incremented in multiples of 256 Pbps                                       |
|                                                                                                    |
|Other values shall be interpreted as multiples of 256 Pbps in this version of the protocol.         |
|                                                                                                    |
|Maximum bit rate for uplink (octets 4 and 5)                                                        |
|                                                                                                    |
|Octets 4 and 5 represent the binary coded value of maximum bit rate for uplink in units defined by  |
|octet 3.                                                                                            |
|                                                                                                    |
|Maximum bit rate for downlink (octets 6 and 7)                                                      |
|                                                                                                    |
|Octets 6 and 7 represent the binary coded value of maximum bit rate for downlink in units defined by|
|octet 3.                                                                                            |
|                                                                                                    |
|Unit for guaranteed bit rate (octet 8)                                                              |
|                                                                                                    |
|The coding is identical to that of the unit for maximum bit rate (octet 3).                         |
|                                                                                                    |
|Guaranteed bit rate for uplink (octets 9 and 10)                                                    |
|                                                                                                    |
|Octets 9 and 10 represent the binary coded value of guaranteed bit rate for uplink in units defined |
|by octet 8.                                                                                         |
|                                                                                                    |
|Guaranteed bit rate for downlink (octets 11 and 12)                                                 |
|                                                                                                    |
|Octets 11 and 12 represent the binary coded value of guaranteed bit rate for downlink in units      |
|defined by octet 8.                                                                                 |



10	List of system parameters


10.1	General

The description of timers in the following tables should be considered a brief summary.


10.2	Timers of EPS mobility management

Table 10.2.1: EPS mobility management timers – UE side

|TIMER NUM.    |TIMER VALUE   |STATE                 |CAUSE OF START                         |NORMAL STOP             |ON                      |
|              |              |                      |                                       |                        |EXPIRY                  |
|T3402         |Default 12    |EMM-DEREGISTERED      |At attach failure and the attempt      |ATTACH REQUEST sent     |Initiation of the attach|
|              |min.          |EMM-REGISTERED        |counter is equal to 5.                 |TRACKING AREA UPDATE    |procedure, if still     |
|              |NOTE 1        |                      |At tracking area updating failure and  |REQUEST sent            |required or TAU         |
|              |              |                      |the attempt counter is equal to 5.     |NAS signalling          |procedure               |
|              |              |                      |ATTACH ACCEPT with EMM cause #16 or #17|connection released     |                        |
|              |              |                      |and the attempt counter is equal to 5  |                        |                        |
|              |              |                      |for CS/PS mode 2 UE, or ATTACH ACCEPT  |                        |                        |
|              |              |                      |with EMM cause #22, as described in    |                        |                        |
|              |              |                      |subclause 5.5.1.3.4.3.                 |                        |                        |
|              |              |                      |TRACKING AREA UPDATE ACCEPT with EMM   |                        |                        |
|              |              |                      |cause #16 or #17 and the attempt       |                        |                        |
|              |              |                      |counter is equal to 5 for CS/PS mode 2 |                        |                        |
|              |              |                      |UE, TRACKING AREA UPDATE ACCEPT with   |                        |                        |
|              |              |                      |EMM cause #16 or #17 and the attempt   |                        |                        |
|              |              |                      |counter is equal to 5 for CS/PS mode 1 |                        |                        |
|              |              |                      |UE with "IMS voice not available" and  |                        |                        |
|              |              |                      |with a persistent EPS bearer context,  |                        |                        |
|              |              |                      |or TRACKING AREA UPDATE ACCEPT with EMM|                        |                        |
|              |              |                      |cause #22, as described in             |                        |                        |
|              |              |                      |subclause 5.5.3.3.4.3.                 |                        |                        |
|              |              |                      |ATTACH ACCEPT and the attempt counter  |                        |                        |
|              |              |                      |is equal to 5 as described in          |                        |                        |
|              |              |                      |subclause 5.5.1.2.4A and 5.5.1.2.6A.   |                        |                        |
|              |              |                      |TRACKING AREA UPDATE ACCEPT and the    |                        |                        |
|              |              |                      |attempt counter is equal to 5 as       |                        |                        |
|              |              |                      |described in subclause 5.5.3.2.4A and  |                        |                        |
|              |              |                      |5.5.3.2.6A.                            |                        |                        |
|              |              |                      |DETACH REQUEST with other EMM cause    |                        |                        |
|              |              |                      |values than those treated in           |                        |                        |
|              |              |                      |subclause 5.5.2.3.2 or no EMM cause IE |                        |                        |
|              |              |                      |and Detach type IE indicates "re-attach|                        |                        |
|              |              |                      |not required" as described in subclause|                        |                        |
|              |              |                      |5.5.2.3.4.                             |                        |                        |
|T3410         |15s           |EMM-REGISTERED-INITIAT|ATTACH REQUEST sent                    |ATTACH ACCEPT received  |Start T3411 or T3402 as |
|              |NOTE 7        |ED                    |                                       |ATTACH REJECT received  |described in            |
|              |NOTE 8        |                      |                                       |                        |subclause 5.5.1.2.6     |
|              |In WB-S1/CE   |                      |                                       |                        |                        |
|              |mode, 85s     |                      |                                       |                        |                        |
|T3411         |10s           |EMM-DEREGISTERED.     |At attach failure due to lower layer   |ATTACH REQUEST sent     |Retransmission of the   |
|              |              |ATTEMPTING-TO-ATTACH  |failure, T3410 timeout or attach       |TRACKING AREA UPDATE    |ATTACH REQUEST, if still|
|              |              |                      |rejected with other EMM cause values   |REQUEST sent            |required as described in|
|              |              |EMM-REGISTERED.       |than those treated in                  |EMM-CONNECTED mode      |subclause 5.5.1.2.6 or  |
|              |              |ATTEMPTING-TO-UPDATE  |subclause 5.5.1.2.5.                   |entered (NOTE 6)        |retransmission of       |
|              |              |                      |                                       |                        |TRACKING AREA UPDATE    |
|              |              |EMM-REGISTERED.       |At tracking area updating failure due  |                        |REQUEST                 |
|              |              |NORMAL-SERVICE        |to lower layer failure, T3430 timeout  |                        |                        |
|              |              |                      |or TAU rejected with other EMM cause   |                        |                        |
|              |              |                      |values than those treated in           |                        |                        |
|              |              |                      |subclause 5.5.3.2.5.                   |                        |                        |
|              |              |                      |ATTACH ACCEPT and the attempt counter  |                        |                        |
|              |              |                      |is less than 5 as described in         |                        |                        |
|              |              |                      |subclause 5.5.1.2.4A and 5.5.1.2.6A.   |                        |                        |
|              |              |                      |TRACKING AREA UPDATE ACCEPT and the    |                        |                        |
|              |              |                      |attempt counter is less than 5 as      |                        |                        |
|              |              |                      |described in subclause 5.5.3.2.4A and  |                        |                        |
|              |              |                      |5.5.3.2.6A.                            |                        |                        |
|T3412         |Default 54    |EMM-REGISTERED        |In EMM-REGISTERED, when EMM-CONNECTED  |When entering state     |Initiation of the       |
|              |min.          |                      |mode is left.                          |EMM-DEREGISTERED or when|periodic TAU procedure  |
|              |NOTE 2        |                      |                                       |entering EMM-CONNECTED  |if the UE is not        |
|              |NOTE 5        |                      |                                       |mode.                   |attached for emergency  |
|              |              |                      |                                       |                        |bearer services or T3423|
|              |              |                      |                                       |                        |started under the       |
|              |              |                      |                                       |                        |conditions as specified |
|              |              |                      |                                       |                        |in subclause 5.3.5.     |
|              |              |                      |                                       |                        |                        |
|              |              |                      |                                       |                        |Implicit detach from    |
|              |              |                      |                                       |                        |network if the UE is    |
|              |              |                      |                                       |                        |attached for emergency  |
|              |              |                      |                                       |                        |bearer services.        |
|T3416         |30s           |EMM-REGISTERED-INITIAT|RAND and RES stored as a result of an  |SECURITY MODE COMMAND   |Delete the stored RAND  |
|              |NOTE 7        |ED                    |EPS authentication challenge           |received                |and RES                 |
|              |NOTE 8        |EMM-REGISTERED        |                                       |SERVICE REJECT received |                        |
|              |In WB-S1/CE   |EMM-DEREGISTERED-INITI|                                       |TRACKING AREA UPDATE    |                        |
|              |mode, 48s     |ATED                  |                                       |ACCEPT received         |                        |
|              |              |EMM-TRACKING-AREA-UPDA|                                       |AUTHENTICATION REJECT   |                        |
|              |              |TING-INITIATED        |                                       |received                |                        |
|              |              |EMM-SERVICE-REQUEST-IN|                                       |AUTHENTICATION FAILURE  |                        |
|              |              |ITIATED               |                                       |sent                    |                        |
|              |              |                      |                                       |EMM-DEREGISTERED,       |                        |
|              |              |                      |                                       |EMM-NULL or             |                        |
|              |              |                      |                                       |EMM-IDLE mode entered   |                        |
|T3417         |5s            |EMM-SERVICE-REQUEST-IN|SERVICE REQUEST sent                   |Bearers have been set up|Abort the procedure     |
|              |NOTE 7        |ITIATED               |EXTENDED SERVICE REQUEST sent in case  |SERVICE REJECT received |                        |
|              |NOTE 8        |                      |f, g, i and j in subclause 5.6.1.1     |SERVICE ACCEPT received |                        |
|              |In WB-S1/CE   |                      |EXTENDED SERVICE REQUEST sent with     |Indication of system    |                        |
|              |mode, 51s     |                      |service type set to "packet services   |change from lower layer |                        |
|              |              |                      |via S1" in case a, b, c, h and k in    |received                |                        |
|              |              |                      |subclause 5.6.1.1                      |cdma2000® 1xCS fallback |                        |
|              |              |                      |CONTROL PLANE SERVICE REQUEST sent as  |rejection received      |                        |
|              |              |                      |specified in subclause 5.6.1.2.2       |see subclause 5.6.1.4.2 |                        |
|T3417ext      |10s           |EMM-SERVICE-REQUEST-IN|EXTENDED SERVICE REQUEST sent in case d|Inter-system change from|Select GERAN or UTRAN   |
|              |              |ITIATED               |in subclause 5.6.1.1                   |S1 mode to A/Gb mode or |                        |
|              |              |                      |                                       |Iu mode is completed    |                        |
|              |              |                      |                                       |Inter-system change from|                        |
|              |              |                      |                                       |S1 mode to A/Gb mode or |                        |
|              |              |                      |                                       |Iu mode is failed       |                        |
|              |              |                      |                                       |SERVICE REJECT received |                        |
|T3417ext-mt   |4s            |EMM-SERVICE-REQUEST-IN|EXTENDED SERVICE REQUEST sent in case e|Inter-system change from|Select GERAN or UTRAN   |
|              |              |ITIATED               |in subclause 5.6.1.1 and the CSFB      |S1 mode to A/Gb mode or |                        |
|              |              |                      |response was set to "CS fallback       |Iu mode is completed    |                        |
|              |              |                      |accepted by the UE"                    |Inter-system change from|                        |
|              |              |                      |                                       |S1 mode to A/Gb mode or |                        |
|              |              |                      |                                       |Iu mode is failed       |                        |
|              |              |                      |                                       |SERVICE REJECT received |                        |
|T3418         |20s           |EMM-REGISTERED-INITIAT|AUTHENTICATION FAILURE (EMM cause = #20|AUTHENTICATION REQUEST  |On first expiry, the UE |
|              |NOTE 7        |ED                    |"MAC failure" or #26 "non-EPS          |received or             |should consider the     |
|              |NOTE 8        |EMM-REGISTERED        |authentication unacceptable") sent     |AUTHENTICATION REJECT   |network as false and    |
|              |In WB-S1/CE   |EMM-TRACKING-AREA-UPDA|                                       |received                |follow item f of        |
|              |mode, 38s     |TING-INITIATED        |                                       |or                      |subclause 5.4.2.7, if   |
|              |              |EMM-DEREGISTERED-INITI|                                       |SECURITY MODE COMMAND   |the UE is not attached  |
|              |              |ATED                  |                                       |received                |for emergency bearer    |
|              |              |EMM-SERVICE-REQUEST-IN|                                       |                        |services.               |
|              |              |ITIATED               |                                       |when entering EMM-IDLE  |                        |
|              |              |                      |                                       |mode                    |On first expiry, the UE |
|              |              |                      |                                       |                        |will follow             |
|              |              |                      |                                       |indication of           |subclause 5.4.2.7 under |
|              |              |                      |                                       |transmission failure of |"For items c, d, and    |
|              |              |                      |                                       |AUTHENTICATION FAILURE  |e:", if the UE is       |
|              |              |                      |                                       |message from lower      |attached for emergency  |
|              |              |                      |                                       |layers                  |bearer services.        |
|T3420         |15s           |EMM-REGISTERED-INITIAT|AUTHENTICATION FAILURE (cause = #21    |AUTHENTICATION REQUEST  |On first expiry, the UE |
|              |NOTE 7        |ED                    |"synch failure") sent                  |received or             |should consider the     |
|              |NOTE 8        |EMM-REGISTERED        |                                       |AUTHENTICATION REJECT   |network as false and    |
|              |In WB-S1/CE   |EMM-DEREGISTERED-INITI|                                       |received                |follow item f of        |
|              |mode, 33s     |ATED                  |                                       |or                      |subclause 5.4.2.7, if   |
|              |              |EMM-TRACKING-AREA-UPDA|                                       |SECURITY MODE COMMAND   |the UE is not attached  |
|              |              |TING-INITIATED        |                                       |received                |for emergency bearer    |
|              |              |EMM-SERVICE-REQUEST-IN|                                       |                        |services.               |
|              |              |ITIATED               |                                       |when entering EMM-IDLE  |                        |
|              |              |                      |                                       |mode                    |On first expiry, the UE |
|              |              |                      |                                       |                        |will follow             |
|              |              |                      |                                       |indication of           |subclause 5.4.2.7 under |
|              |              |                      |                                       |transmission failure of |"For items c, d, and    |
|              |              |                      |                                       |AUTHENTICATION FAILURE  |e:", if the UE is       |
|              |              |                      |                                       |message from lower      |attached for emergency  |
|              |              |                      |                                       |layers                  |bearer services.        |
|T3421         |15s           |EMM-DEREGISTERED-INITI|DETACH REQUEST sent with               |DETACH ACCEPT received  |Retransmission of DETACH|
|              |NOTE 7        |ATED                  |the Detach type IE not indicating      |                        |REQUEST                 |
|              |NOTE 8        |EMM-                  |"switch off"                           |                        |                        |
|              |In WB-S1/CE   |REGISTERED.           |                                       |                        |                        |
|              |mode, 45s     |IMSI-DETACH-          |                                       |                        |                        |
|              |              |INITIATED             |                                       |                        |                        |
|T3423         |NOTE 3        |EMM-REGISTERED        |T3412 expires while ISR is activated   |When entering state     |Set TIN to "P-TMSI".    |
|              |              |                      |and either T3346 is running or the UE  |EMM-DEREGISTERED or when|For A/Gb mode or Iu     |
|              |              |                      |is in one of the following states:     |entering EMM-CONNECTED  |mode, see               |
|              |              |                      |- EMM-REGISTERED.NO-CELL-AVAILABLE;    |mode.                   |3GPP TS 24.008 [13]     |
|              |              |                      |- EMM-REGISTERED.PLMN-SEARCH;          |                        |                        |
|              |              |                      |-EMM-REGISTERED.UPDATE-NEEDED; or      |                        |                        |
|              |              |                      |-EMM-REGISTERED.LIMITED-SERVICE.       |                        |                        |
|T3430         |15s           |EMM-TRACKING-AREA-UPDA|TRACKING AREA UPDATE REQUEST sent      |TRACKING AREA UPDATE    |Start T3411 or T3402 as |
|              |NOTE 7        |TING-INITIATED        |                                       |ACCEPT received         |described in            |
|              |NOTE 8        |                      |                                       |TRACKING AREA UPDATE    |subclause 5.5.3.2.6     |
|              |In WB-S1/CE   |                      |                                       |REJECT received         |                        |
|              |mode, 77s     |                      |                                       |                        |                        |
|T3440         |10s           |EMM-REGISTERED-INITIAT|ATTACH REJECT, DETACH REQUEST, TRACKING|NAS signalling          |Release the NAS         |
|              |              |ED                    |AREA UPDATE REJECT with any of the EMM |connection released     |signalling connection   |
|              |              |EMM-TRACKING-AREA-UPDA|cause #7, #8, #11, #12, #13, #14, #15  |Bearers have been set up|for the cases a), b) and|
|              |              |TING-INITIATED        |or #35                                 |or a request for PDN    |c) as described in      |
|              |              |EMM-DEREGISTERED-INITI|SERVICE REJECT received with any of the|connection for emergency|subclause 5.3.1.2       |
|              |              |ATED                  |EMM cause #7, #8, #11, #12, #13, #15,  |bearer services or a CS |                        |
|              |              |EMM-SERVICE-REQUEST-IN|35 or #39                              |emergency call is       |                        |
|              |              |ITIATED               |TRACKING AREA UPDATE ACCEPT received   |started                 |                        |
|              |              |EMM-REGISTERED        |after the UE sent TRACKING AREA UPDATE |Upon receipt of ESM DATA|                        |
|              |              |                      |REQUEST in EMM-IDLE mode without the   |TRANSPORT message as    |                        |
|              |              |                      |"active" flag set and without the      |described in            |                        |
|              |              |                      |"signalling active" flag set, and the  |subclause 5.3.1.2.1     |                        |
|              |              |                      |user-plane radio bearers have not been |(NOTE 9)                |                        |
|              |              |                      |setup                                  |                        |                        |
|              |              |                      |DETACH ACCEPT received after the UE    |                        |                        |
|              |              |                      |sent DETACH REQUEST with detach type to|                        |                        |
|              |              |                      |"IMSI detach"                          |                        |                        |
|              |              |                      |Upon receipt of ESM DATA TRANSPORT     |                        |                        |
|              |              |                      |message as described in                |                        |                        |
|              |              |                      |subclause 5.3.1.2.1 (NOTE 9)           |                        |                        |
|              |              |EMM-DEREGISTERED      |TRACKING AREA UPDATE REJECT, SERVICE   |NAS signalling          |Release the NAS         |
|              |              |EMM-DEREGISTERED.NORMA|REJECT with any of the EMM cause #9,   |connection released     |signalling connection   |
|              |              |L-SERVICE             |#10 or #40                             |                        |for the cases d) and e) |
|              |              |                      |                                       |                        |as described in         |
|              |              |                      |                                       |                        |subclause  5.3.1.2 and  |
|              |              |                      |                                       |                        |initiation of the attach|
|              |              |                      |                                       |                        |procedure as specified  |
|              |              |                      |                                       |                        |in subclause 5.5.3.2.5, |
|              |              |                      |                                       |                        |5.5.3.3.5 or 5.6.1.5    |
|T3442         |NOTE 4        |EMM-REGISTERED        |SERVICE REJECT received with EMM cause |TRACKING AREA UPDATE    |None                    |
|              |              |                      |#39 "CS service temporarily not        |REQUEST sent            |                        |
|              |              |                      |available" with a non-zero T3442 value |                        |                        |
|T3444         |NOTE 11       |All except EMM-NULL   |- UE configured for eCall only mode    |- Removal of eCall only |Perform eCall inactivity|
|              |              |and 5GMM-NULL (defined|enters EMM-IDLE mode after an eCall    |restriction             |procedure in EPS as     |
|              |              |in                    |over IMS                               |- Intersystem change    |described in            |
|              |              |3GPP TS 24.501 [54])  |- UE configured for eCall only mode    |from S1 mode to A/Gb or |subclause 5.5.4.        |
|              |              |                      |moves from GERAN/UTRAN to E-UTRAN with |Iu mode                 |Perform eCall inactivity|
|              |              |                      |timer T3242 (see 3GPP TS 24.008 [13])  |                        |procedure in 5GS as     |
|              |              |                      |running                                |                        |described in            |
|              |              |                      |- UE configured for eCall only mode    |                        |3GPP TS 24.501 [54].    |
|              |              |                      |enters 5GMM-IDLE mode (defined in      |                        |                        |
|              |              |                      |3GPP TS 24.501 [54]) after an eCall    |                        |                        |
|              |              |                      |over IMS                               |                        |                        |
|T3445         |NOTE 12       |All except EMM-NULL   |- UE configured for eCall only mode    |Removal of eCall only   |Perform eCall inactivity|
|              |              |and 5GMM-NULL (defined|enters EMM-IDLE mode after a call to a |restriction             |procedure  in EPS as    |
|              |              |in                    |non-emergency MSISDN or URI for test or|- Intersystem change    |described in            |
|              |              |3GPP TS 24.501 [54])  |terminal reconfiguration service       |from S1 mode to A/Gb or |subclause 5.5.4.        |
|              |              |                      |- UE configured for eCall only mode    |Iu mode                 |Perform eCall inactivity|
|              |              |                      |moves from GERAN/UTRAN to E-UTRAN with |                        |procedure in 5GS as     |
|              |              |                      |timer T3243 (see 3GPP TS 24.008 [13])  |                        |described in            |
|              |              |                      |running                                |                        |3GPP TS 24.501 [54].    |
|              |              |                      |- UE configured for eCall only mode    |                        |                        |
|              |              |                      |enters 5GMM-IDLE mode (defined in      |                        |                        |
|              |              |                      |3GPP TS 24.501 [54]) after a call to a |                        |                        |
|              |              |                      |non-emergency MSISDN or URI for test or|                        |                        |
|              |              |                      |terminal reconfiguration service       |                        |                        |
|T3447         |NOTE 2        |All except EMM-NULL   |NAS signalling connection release that |ATTACH ACCEPT or        |Allowed to initiate     |
|              |              |                      |was not established for paging, attach |TRACKING AREA UPDATE    |transfer of uplink user |
|              |              |                      |without PDN connection or tracking area|ACCEPT without the T3447|data                    |
|              |              |                      |update request without "active" or     |value IE.               |                        |
|              |              |                      |"signalling active" flag set.          |Inter-system change from|                        |
|              |              |                      |                                       |S1 mode to A/Gb mode, Iu|                        |
|              |              |                      |                                       |mode or N1 mode is      |                        |
|              |              |                      |                                       |completed               |                        |
|T3448         |NOTE 10       |All except EMM-NULL   |ATTACH ACCEPT message or TRACKING AREA |SERVICE ACCEPT message  |Allowed to initiate     |
|              |              |                      |UPDATE ACCEPT message or SERVICE ACCEPT|or TRACKING AREA UPDATE |transfer of user data   |
|              |              |                      |message received with a non-zero T3448 |ACCEPT message received |via the control plane   |
|              |              |                      |value.                                 |without T3448 value     |                        |
|              |              |                      |SERVICE REJECT message received with   |                        |                        |
|              |              |                      |EMM cause #22 "Congestion" and a       |                        |                        |
|              |              |                      |non-zero T3448 value.                  |                        |                        |
|T3449         |5s            |EMM-REGISTERED        |Bearers have been set up               |SERVICE ACCEPT message  |SERVICE ACCEPT message  |
|              |NOTE 7        |                      |SECURITY MODE COMMAND message received |received                |considered as a protocol|
|              |NOTE 8        |                      |                                       |Security protected ESM  |error and EMM STATUS    |
|              |In WB-S1/CE   |                      |                                       |message or a security   |returned                |
|              |mode, 51s     |                      |                                       |protected EMM message   |                        |
|              |              |                      |                                       |not related to an EMM   |                        |
|              |              |                      |                                       |common procedure        |                        |
|              |              |                      |                                       |received                |                        |
|NOTE 1: The cases in which the default value of this timer is used are described in subclause 5.3.6.                                           |
|NOTE 2: The value of this timer is provided by the network operator during the attach and tracking area updating procedures.                   |
|NOTE 3: The value of this timer may be provided by the network in the ATTACH ACCEPT message and TRACKING AREA UPDATE ACCEPT message. The       |
|default value of this timer is identical to the value of T3412.                                                                                |
|NOTE 4: The value of this timer is provided by the network operator when a service request for CS fallback is rejected by the network with EMM |
|cause #39 "CS service temporarily not available".                                                                                              |
|NOTE 5: The default value of this timer is used if the network does not indicate a value in the TRACKING AREA UPDATE ACCEPT message and the UE |
|does not have a stored value for this timer.                                                                                                   |
|NOTE 6: The conditions for which this applies are described in subclause 5.5.3.2.6.                                                            |
|NOTE 7: In NB-S1 mode, the timer value shall be calculated as described in subclause 4.7.                                                      |
|NOTE 8: In WB-S1 mode, if the UE supports CE mode B and operates in either CE mode A or CE mode B, then the timer value is as described in this|
|table for the case of WB-S1/CE mode (see subclause 4.8).                                                                                       |
|NOTE 9: It is possible that the UE does not stop or start timer T3440 upon receipt of ESM DATA TRANSPORT message as described in               |
|subclause 5.3.1.2.1.                                                                                                                           |
|NOTE 10: The timer value is provided by the network in the ATTACH ACCEPT, TRACKING AREA UPDATE ACCEPT, SERVICE ACCEPT or SERVICE REJECT        |
|message, or chosen randomly from a default value range of 15 – 30 minutes.                                                                     |
|NOTE 11: If the timer is started due to a UE configured for eCall only mode moving from GERAN/UTRAN to E-UTRAN with timer T3242 (see           |
|3GPP TS 24.008 [13]) running, the UE starts the timer with a value set to the time left on timer T3242. Otherwise the UE starts the timer with |
|a value set to 12 hours.                                                                                                                       |
|NOTE 12: If the timer is started due to a UE configured for eCall only mode moving from GERAN/UTRAN to E-UTRAN with timer T3243 (see           |
|3GPP TS 24.008 [13]) running, the UE starts the timer with a value set to the time left on timer T3243. Otherwise the UE starts the timer with |
|a value set to 12 hours.                                                                                                                       |


Table 10.2.2: EPS mobility management timers – network side

|TIMER NUM.    |TIMER VALUE   |STATE                 |CAUSE OF START                         |NORMAL STOP             |ON THE                  |
|              |              |                      |                                       |                        |1st, 2nd, 3rd, 4th      |
|              |              |                      |                                       |                        |EXPIRY (NOTE 1)         |
|T3413         |NOTE 2        |EMM-REGISTERED        |Paging procedure for EPS services      |Paging procedure for EPS|Network dependent       |
|NOTE 8        |              |                      |initiated                              |services completed      |                        |
|NOTE 10       |              |                      |                                       |Paging procedure is     |                        |
|              |              |                      |                                       |aborted                 |                        |
|T3415         |NOTE 6        |EMM-REGISTERED        |Paging procedure for EPS services      |Paging procedure for EPS|Paging procedure is     |
|NOTE 8        |              |                      |initiated for a UE which the network   |services completed      |aborted and the network |
|NOTE 10       |              |                      |accepted the request to use eDRX and   |Paging procedure is     |proceeds as specified in|
|              |              |                      |the UE does not have a PDN connection  |aborted                 |3GPP TS 23.401 [10]     |
|              |              |                      |for emergency bearer services          |                        |                        |
|T3422         |6s            |EMM-DEREGISTERED-INITI|DETACH REQUEST sent                    |DETACH ACCEPT received  |Retransmission of DETACH|
|NOTE 7        |In WB-S1/CE   |ATED                  |                                       |                        |REQUEST                 |
|NOTE 9        |mode, 24s     |                      |                                       |                        |                        |
|T3447         |NOTE 2        |All                   |UE transitions from EMM-CONNECTED mode |None                    |Allow the UE to initiate|
|              |              |                      |to EMM-IDLE mode except when UE was in |                        |a connection for        |
|              |              |                      |EMM-CONNECTED mode due to paging,      |                        |transfer of uplink user |
|              |              |                      |attach without PDN connection or       |                        |data.                   |
|              |              |                      |tracking area update request without   |                        |                        |
|              |              |                      |"active" or "signalling active" flag   |                        |                        |
|              |              |                      |set                                    |                        |                        |
|T3450         |6s            |EMM-COMMON-PROC-INIT  |ATTACH ACCEPT sent                     |ATTACH COMPLETE received|Retransmission of the   |
|NOTE 7        |In WB-S1/CE   |                      |                                       |TRACKING AREA UPDATE    |same message type, i.e. |
|NOTE 9        |mode, 18s     |                      |TRACKING AREA UPDATE ACCEPT sent with  |COMPLETE received       |ATTACH ACCEPT, TRACKING |
|              |              |                      |GUTI                                   |GUTI REALLOCATION       |AREA UPDATE ACCEPT or   |
|              |              |                      |                                       |COMPLETE received       |GUTI REALLOCATION       |
|              |              |                      |TRACKING AREA UPDATE ACCEPT sent with  |                        |COMMAND                 |
|              |              |                      |TMSI                                   |                        |                        |
|              |              |                      |                                       |                        |                        |
|              |              |                      |GUTI REALLOCATION COMMAND sent         |                        |                        |
|T3460         |6s            |EMM-COMMON-PROC-INIT  |AUTHENTICATION REQUEST sent            |AUTHENTICATION RESPONSE |Retransmission of the   |
|NOTE 7        |In WB-S1/CE   |                      |                                       |received                |same message type, i.e. |
|NOTE 9        |mode, 24s     |                      |SECURITY MODE COMMAND sent             |AUTHENTICATION FAILURE  |AUTHENTICATION REQUEST  |
|              |              |                      |                                       |received                |or SECURITY MODE COMMAND|
|              |              |                      |                                       |SECURITY MODE COMPLETE  |                        |
|              |              |                      |                                       |received                |                        |
|              |              |                      |                                       |SECURITY MODE REJECT    |                        |
|              |              |                      |                                       |received                |                        |
|T3470         |6s            |EMM-COMMON-PROC-INIT  |IDENTITY REQUEST sent                  |IDENTITY RESPONSE       |Retransmission of       |
|NOTE 7        |In WB-S1 mode,|                      |                                       |received                |IDENTITY REQUEST        |
|NOTE 9        |24s           |                      |                                       |                        |                        |
|Mobile        |NOTE 4        |All except            |Entering EMM-IDLE mode                 |NAS signalling          |Network dependent, but  |
|reachable     |              |EMM-DEREGISTERED      |                                       |connection established  |typically paging is     |
|              |              |                      |                                       |                        |halted on 1st expiry if |
|              |              |                      |                                       |                        |the UE is not attached  |
|              |              |                      |                                       |                        |for emergency bearer    |
|              |              |                      |                                       |                        |services.               |
|              |              |                      |                                       |                        |                        |
|              |              |                      |                                       |                        |Implicitly detach the UE|
|              |              |                      |                                       |                        |which is attached for   |
|              |              |                      |                                       |                        |emergency bearer        |
|              |              |                      |                                       |                        |services.               |
|Implicit      |NOTE 3        |All except            |The mobile reachable timer expires     |NAS signalling          |Implicitly detach the UE|
|detach timer  |              |EMM-DEREGISTERED      |while the network is in EMM-IDLE mode  |connection established  |on 1st expiry           |
|active timer  |NOTE 5        |All except            |Entering EMM-IDLE mode                 |NAS signalling          |Network dependent, but  |
|              |              |EMM-DEREGISTERED      |                                       |connection established  |typically paging is     |
|              |              |                      |                                       |                        |halted on 1st expiry    |
|NOTE 1: Typically, the procedures are aborted on the fifth expiry of the relevant timer. Exceptions are described in the corresponding         |
|procedure description.                                                                                                                         |
|NOTE 2: The value of this timer is network dependent.                                                                                          |
|NOTE 3: The value of this timer is network dependent. If ISR is activated, the default value of this timer is 4 minutes greater than T3423.    |
|NOTE 4: The default value of this timer is 4 minutes greater than T3412. If T3346 is larger than T3412 and the MME includes timer T3346 in the |
|TRACKING AREA UPDATE REJECT message or SERVICE REJECT message, the value of the mobile reachable timer and implicit detach timer is set such   |
|that the sum of the timer values is greater than T3346. If the UE is attached for emergency bearer services, the value of this timer is set    |
|equal to T3412.                                                                                                                                |
|NOTE 5: If the MME includes timer T3324 in the ATTACH ACCEPT message or TRACKING AREA UPDATE ACCEPT message and if the UE is not attached for  |
|emergency bearer services and has no PDN connection for emergency bearer services, the value of this timer is equal to the value of timer      |
|T3324.                                                                                                                                         |
|NOTE 6: The value of this timer is smaller than the value of timer T3-RESPONSE (see 3GPP TS 29.274 [16D]).                                     |
|NOTE 7: In NB-S1 mode, then the timer value shall be calculated as described in subclause 4.7.                                                 |
|NOTE 8: In NB-S1 mode, then the timer value shall be calculated by using an NAS timer value which is network dependent.                        |
|NOTE 9: In WB-S1 mode, if the UE supports CE mode B and operates in either CE mode A or CE mode B, then the timer value is as described in this|
|table for the case of WB-S1/CE mode (see subclause 4.8).                                                                                       |
|NOTE 10: In WB-S1 mode, if the UE supports CE mode B, then the timer value shall be calculated by using an NAS timer value which value is      |
|network dependent.                                                                                                                             |



10.3	Timers of EPS session management

Table 10.3.1: EPS session management timers – UE side

|TIMER NUM.    |TIMER VALUE   |STATE               |CAUSE OF START                           |NORMAL STOP             |ON THE                  |
|              |              |                    |                                         |                        |1st, 2nd, 3rd, 4th      |
|              |              |                    |                                         |                        |EXPIRY (NOTE 1)         |
|T3480         |8s            |PROCEDURE           |BEARER RESOURCE ALLOCATION REQUEST sent  |ACTIVATE DEDICATED EPS  |Retransmission of BEARER|
|NOTE 2        |In WB-S1/CE   |TRANSACTION PENDING |                                         |BEARER CONTEXT REQUEST  |RESOURCE ALLOCATION     |
|NOTE 3        |mode, 16s     |                    |                                         |received or MODIFY EPS  |REQUEST                 |
|              |              |                    |                                         |BEARER CONTEXT REQUEST  |                        |
|              |              |                    |                                         |received or BEARER      |                        |
|              |              |                    |                                         |RESOURCE ALLOCATION     |                        |
|              |              |                    |                                         |REJECT received         |                        |
|T3481         |8s            |PROCEDURE           |BEARER RESOURCE MODIFICATION REQUEST sent|ACTIVATE DEDICATED EPS  |Retransmission of BEARER|
|NOTE 2        |In WB-S1/CE   |TRANSACTION PENDING |                                         |BEARER CONTEXT REQUEST  |RESOURCE MODIFICATION   |
|NOTE 3        |mode, 16s     |                    |                                         |received or MODIFY EPS  |REQUEST                 |
|              |              |                    |                                         |BEARER CONTEXT REQUEST  |                        |
|              |              |                    |                                         |received or DEACTIVATE  |                        |
|              |              |                    |                                         |EPS BEARER CONTEXT      |                        |
|              |              |                    |                                         |REQUEST received or     |                        |
|              |              |                    |                                         |BEARER RESOURCE         |                        |
|              |              |                    |                                         |MODIFICATION REJECT     |                        |
|              |              |                    |                                         |received                |                        |
|T3482         |8s            |PROCEDURE           |An additional PDN connection is requested|ACTIVE DEFAULT EPS      |Retransmission of PDN   |
|NOTE 2        |In WB-S1/CE   |TRANSACTION PENDING |by the UE which is not combined in attach|BEARER CONTEXT REQUEST  |CONNECTIVITY REQUEST    |
|NOTE 3        |mode, 16s     |                    |procedure                                |received or PDN         |                        |
|              |              |                    |                                         |CONNECTIVITY REJECT     |                        |
|              |              |                    |                                         |received                |                        |
|T3492         |6s            |PROCEDURE           |PDN DISCONNECT REQUEST sent              |DEACTIVATE EPS BEARER   |Retransmission of PDN   |
|NOTE 2        |In WB-S1/CE   |TRANSACTION PENDING |                                         |CONTEXT REQUEST received|DISCONNECT REQUEST      |
|NOTE 3        |mode, 14s     |                    |                                         |or PDN DISCONNECT REJECT|                        |
|              |              |                    |                                         |received                |                        |
|T3493         |4s            |PROCEDURE           |REMOTE UE REPORT sent                    |REMOTE UE REPORT        |Retransmission of REMOTE|
|NOTE 2        |In WB-S1/CE   |TRANSACTION PENDING |                                         |RESPONSE received       |UE REPORT               |
|              |mode, 12s     |                    |                                         |                        |                        |
|Back-off timer|              |                    |defined in 3GPP TS 24.008 [13]           |                        |                        |
|NOTE 1: Typically, the procedures are aborted on the fifth expiry of the relevant timer. Exceptions are described in the corresponding         |
|procedure description.                                                                                                                         |
|NOTE 2: In NB-S1 mode, then the timer value shall be calculated as described in subclause 4.7.                                                 |
|NOTE 3: In WB-S1 mode, if the UE supports CE mode B and operates in either CE mode A or CE mode B, then the timer value is as described in this|
|table for the case of WB-S1/CE mode (see subclause 4.8).                                                                                       |


  NOTE 1:	The back-off timer is used to describe a logical model of the required UE behaviour. This model does not imply any specific implementation, e.g. as a timer or timestamp.

  NOTE 2:	Reference to back-off timer in this section can either refer to use of timer T3396 or to use of a different packet system specific timer within the UE. Whether the UE uses T3396 as a back-off timer or it uses different packet system specific timers as back-off timers is left up to UE implementation.



Table 10.3.2: EPS session management timers – network side

|TIMER NUM.    |TIMER VALUE   |STATE               |CAUSE OF START                           |NORMAL STOP             |ON THE                  |
|              |              |                    |                                         |                        |1st, 2nd, 3rd, 4th      |
|              |              |                    |                                         |                        |EXPIRY (NOTE 1)         |
|T3485         |8s            |BEARER CONTEXT      |ACTIVATE DEFAULT EPS BEARER CONTEXT      |ACTIVATE DEFAULT EPS    |Retransmission of the   |
|NOTE 2        |In WB-S1/CE   |ACTIVE PENDING      |REQUEST sent                             |BEARER CONTEXT ACCEPT   |same message            |
|NOTE 3        |mode, 16s     |                    |                                         |received                |                        |
|              |              |                    |ACTIVATE DEDICATED EPS BEARER CONTEXT    |or ACTIVATE DEFAULT EPS |                        |
|              |              |                    |REQUEST sent                             |BEARER CONTEXT REJECT   |                        |
|              |              |                    |                                         |received                |                        |
|              |              |                    |                                         |or ACTIVATE DEDICATED   |                        |
|              |              |                    |                                         |EPS BEARER CONTEXT      |                        |
|              |              |                    |                                         |ACCEPT received         |                        |
|              |              |                    |                                         |or ACTIVATE DEDICATED   |                        |
|              |              |                    |                                         |EPS BEARER CONTEXT      |                        |
|              |              |                    |                                         |REJECT received         |                        |
|T3486         |8s            |BEARER CONTEXT      |MODIFY EPS BEARER CONTEXT REQUEST sent   |MODIFY EPS BEARER       |Retransmission of MODIFY|
|NOTE 2        |In WB-S1/CE   |MODIFY PENDING      |                                         |CONTEXT ACCEPT received |EPS BEARER CONTEXT      |
|NOTE 3        |mode, 16s     |                    |                                         |or MODIFY EPS BEARER    |REQUEST                 |
|              |              |                    |                                         |CONTEXT REJECT received |                        |
|T3489         |4s            |PROCEDURE           |ESM INFORMATION REQUEST sent             |ESM INFORMATION RESPONSE|Retransmission of ESM   |
|NOTE 2        |In WB-S1/CE   |TRANSACTION PENDING |                                         |received                |INFORMATION REQUEST on  |
|NOTE 3        |mode, 12s     |                    |                                         |                        |1st and 2nd expiry only |
|T3495         |8s            |BEARER CONTEXT      |DEACTIVATE EPS BEARER CONTEXT REQUEST    |DEACTIVATE EPS BEARER   |Retransmission of       |
|NOTE 2        |In WB-S1/CE   |INACTIVE PENDING    |sent                                     |CONTEXT ACCEPT received |DEACTIVATE EPS BEARER   |
|NOTE 3        |mode, 16s     |                    |                                         |                        |CONTEXT REQUEST         |
|NOTE 1: Typically, the procedures are aborted on the fifth expiry of the relevant timer. Exceptions are described in the corresponding         |
|procedure description.                                                                                                                         |
|NOTE 2: In NB-S1 mode, then the timer value shall be calculated as described in subclause 4.7.                                                 |
|NOTE 3: In WB-S1 mode, if the UE supports CE mode B and operates in either CE mode A or CE mode B, then the timer value is as described in this|
|table for the case of WB-S1/CE mode (see subclause 4.8).                                                                                       |




Annex A (informative):
Cause values for EPS mobility management


A.1	Causes related to UE identification

Cause #2 – IMSI unknown in HSS

    	This EMM cause is sent to the UE if the UE is not known (registered) in the HSS or if the UE has packet only subscription. This EMM cause does not affect operation of the EPS service, although is may be used by an EMM procedure.

Cause #3 – Illegal UE

    	This EMM cause is sent to the UE when the network refuses service to the UE either because an identity of the UE is not acceptable to the network or because the UE does not pass the authentication check, i.e. the RES received from the UE is different from that generated by the network.

Cause #6 – Illegal ME

    	This EMM cause is sent to the UE if the ME used is not acceptable to the network, e.g. blacklisted.

Cause #9 – UE identity cannot be derived by the network.

    	This EMM cause is sent to the UE when the network cannot derive the UE's identity from the GUTI/S-TMSI/P-TMSI and RAI e.g. no matching identity/context in the network or failure to validate the UE's identity due to integrity check failure of the received message.

Cause #10 – Implicitly detached

    	This EMM cause is sent to the UE either if the network has implicitly detached the UE, e.g. after the implicit detach timer has expired, or if the EMM context data related to the subscription does not exist in the MME e.g. because of a MME restart, or because of a periodic tracking area update request routed to a new MME.


A.2	Cause related to subscription options

Cause #5 – IMEI not accepted

    	This cause is sent to the UE if the network does not accept an attach procedure for emergency bearer services using an IMEI.

Cause #7 – EPS services not allowed

    	This EMM cause is sent to the UE when it is not allowed to operate EPS services.

Cause #8 – EPS services and non-EPS services not allowed

    	This EMM cause is sent to the UE when it is not allowed to operate either EPS or non-EPS services.

Cause #11 – PLMN not allowed

    	This EMM cause is sent to the UE if it requests service, or if the network initiates a detach request, in a PLMN where the UE, by subscription or due to operator determined barring, is not allowed to operate.

Cause #12 – Tracking area not allowed

    	This EMM cause is sent to the UE if it requests service, or if the network initiates a detach request, in a tracking area where the HPLMN determines that the UE, by subscription, is not allowed to operate.

  NOTE 1:	If EMM cause #12 is sent to a roaming subscriber the subscriber is denied service even if other PLMNs are available on which registration was possible.

Cause #13 – Roaming not allowed in this tracking area

    	This EMM cause is sent to an UE which requests service, or if the network initiates a detach request, in a tracking area of a PLMN which by subscription offers roaming to that UE but not in that tracking area.

Cause #14 – EPS services not allowed in this PLMN

    	This EMM cause is sent to the UE which requests service, or if the network initiates a detach request, in a PLMN which does not offer roaming for EPS services to that UE.

  NOTE 2:	Since only one list of forbidden PLMNs for packet services is maintained in the UE, then the "forbidden PLMNs for GPRS service" is the maintained list and the forbidden PLMNs for EPS service is equivalent to it.

Cause #15 – No suitable cells in tracking area

    	This EMM cause is sent to the UE if it requests service, or if the network initiates a detach request, in a tracking area where the UE, by subscription, is not allowed to operate, but when it should find another allowed tracking area or location area in the same PLMN or an equivalent PLMN.

  NOTE 3:	Cause #15 and cause #12 differ in the fact that cause #12 does not trigger the UE to search for another allowed tracking area on the same PLMN.

Cause #25 – Not authorized for this CSG

    	This EMM cause is sent to the UE if it requests access, or if the network initiates a detach request, in a CSG cell with CSG ID where the UE either has no subscription to operate or the UE's subscription has expired and it should find another cell in the same PLMN or an equivalent PLMN.

Cause #35 – Requested service option not authorized in this PLMN

    	This EMM cause is sent to the UE if it requests in a PLMN a service option for which it is not authorized, e.g. if it attempts to attach for relay node operation in a PLMN with a USIM which does not belong to a relay node-specific subscription.

Cause #40 – No EPS bearer context activated

    	This EMM cause is sent to the UE, if during a tracking area updating procedure or a service request, the MME detects that there is no active EPS bearer context in the network.


A.3	Causes related to PLMN specific network failures and congestion/authentication failures

Cause #16 – MSC temporarily not reachable

    	This EMM cause is sent to the UE if it requests a combined EPS attach or tracking area updating in a PLMN where the MSC is temporarily not reachable via the EPS part of the network.

Cause #17 – Network failure

    	This EMM cause is sent to the UE if the MME cannot service an UE generated request because of PLMN failures.

Cause #18 – CS domain not available

    	This EMM cause is sent to the UE if the MME cannot service an UE generated request because CS domain is not available and SMS in MME is not supported.

Cause #19 – ESM failure

    	This EMM cause is sent to the UE when there is a failure in the ESM message contained in the EMM message.

Cause #20 – MAC failure

    	This EMM cause is sent to the network if the USIM detects that the MAC in the AUTHENTICATION REQUEST message is not fresh (see 3GPP TS 33.401 [19]).

Cause #21 – Synch failure

    	This EMM cause is sent to the network if the USIM detects that the SQN in the AUTHENTICATION REQUEST message is out of range (see 3GPP TS 33.401 [19]).

Cause #22 – Congestion

    	This EMM cause is sent to the UE because of congestion in the network (e.g. no channel, facility busy/congested etc.).

Cause #23 – UE security capabilities mismatch

    	This EMM cause is sent to the network if the UE detects that the UE security capability does not match the one sent back by the network.

Cause #24 – Security mode rejected, unspecified

    	This EMM cause is sent to the network if the security mode command is rejected by the UE if the UE detects that the nonceUE does not match the one sent back by the network or for unspecified reasons.

Cause #26 – Non-EPS authentication unacceptable

    	This EMM cause is sent to the network in S1 mode if the "separation bit" in the AMF field of AUTN is set to 0 in the AUTHENTICATION REQUEST message (see 3GPP TS 33.401 [19]).

Cause #39 – CS service temporarily not available

    	This EMM cause is sent to the UE when the CS fallback or 1xCS fallback request cannot be served temporarily due to O&M reasons or a mobile terminating CS fallback call is aborted by the network during call establishment (see 3GPP TS 29.118 [16A]).

Cause #42 – Severe network failure

    	This EMM cause is sent to the UE when the network has determined that the requested procedure cannot be completed successfully due to network failure. The failure is not expected to be temporary and repeated request is not likely to succeed in near future.


A.4	Causes related to nature of request

  NOTE:	This subclause has no entries in this version of the specification


A.5	Causes related to invalid messages

Cause value #95 – Semantically incorrect message.

    	See 3GPP TS 24.008 [13], annex H, subclause H.5.5.

Cause value #96 – Invalid mandatory information.

    	See 3GPP TS 24.008 [13], annex H, subclause H.6.1.

Cause value #97 – Message type non-existent or not implemented.

    	See 3GPP TS 24.008 [13], annex H, subclause H.6.2.

Cause value #98 – Message type not compatible with protocol state.

    	See 3GPP TS 24.008 [13], annex H, subclause H.6.3.

Cause value #99 – Information element non-existent or not implemented.

    	See 3GPP TS 24.008 [13], annex H, subclause H.6.4.

Cause value #100 – Conditional IE error.

    	See 3GPP TS 24.008 [13], annex H, subclause H.6.5.

Cause value #101 – Message not compatible with protocol state.

    	See 3GPP TS 24.008 [13], annex H, subclause H.6.6.

Cause value #111 – Protocol error, unspecified.

    	See 3GPP TS 24.008 [13], annex H, subclause H.6.8.



Annex B (informative):
Cause values for EPS session management


B.1	Causes related to nature of request

Cause #8 – Operator Determined Barring

    	This ESM cause is used by the network to indicate that the requested service was rejected by the MME due to Operator Determined Barring.

Cause #26 – Insufficient resources

    	This ESM cause is used by the UE or by the network to indicate that the requested service cannot be provided due to insufficient resources.

Cause #27 – Missing or unknown APN

    	This ESM cause is used by the network to indicate that the requested service was rejected by the external packet data network because the access point name was not included although required or if the access point name could not be resolved.

Cause #28 – Unknown PDN type

    	This ESM cause is used by the network to indicate that the requested service was rejected by the external packet data network because the PDN type could not be recognised.

Cause #29 – User authentication or authorization failed

    	This ESM cause is used by the network to indicate that the requested service was rejected by the external packet data network due to a failed user authentication or revoked by the external packet data network.

Cause #30 – Request rejected by Serving GW or PDN GW

    	This ESM cause is used by the network to indicate that the requested service or operation or the request for a resource was rejected by the Serving GW or PDN GW.

Cause #31 – Request rejected, unspecified

    	This ESM cause is used by the network or by the UE to indicate that the requested service or operation or the request for a resource was rejected due to unspecified reasons.

Cause #32 – Service option not supported

    	This ESM cause is used by the network when the UE requests a service which is not supported by the PLMN.

Cause #33 – Requested service option not subscribed

    	This ESM cause is sent when the UE requests a service option for which it has no subscription.

Cause #34 – Service option temporarily out of order

    	This ESM cause is sent when the network cannot service the request because of temporary outage of one or more functions required for supporting the service.

Cause #35 – PTI already in use

    	This ESM cause is used by the network to indicate that the PTI included by the UE is already in use by another active UE requested procedure for this UE.

Cause #36 – Regular deactivation

    	This ESM cause is used to indicate a regular UE or network initiated release of EPS bearer resources.

Cause #37 – EPS QoS not accepted

    	This ESM cause is used by the network if the new EPS QoS cannot be accepted that was indicated in the UE request.

Cause #38 – Network failure

    	This ESM cause is used by the network to indicate that the requested service was rejected due to an error situation in the network.

Cause #39 – Reactivation requested

    	This ESM cause is used by the network to request a PDN connection reactivation.

Cause #41 – Semantic error in the TFT operation.

    	This ESM cause is used by the network or the UE to indicate that the requested service was rejected due to a semantic error in the TFT operation included in the request.

Cause #42 – Syntactical error in the TFT operation.

    	This ESM cause is used by the network or the UE to indicate that the requested service was rejected due to a syntactical error in the TFT operation included in the request.

Cause #43 – Invalid EPS bearer identity

    	This ESM cause is used by the network or the UE to indicate that the EPS bearer identity value provided to it is not a valid value for the received message or the EPS bearer context identified by the linked EPS bearer identity IE in the request is not active.

Cause #44 – Semantic errors in packet filter(s)

    	This ESM cause is used by the network or the UE to indicate that the requested service was rejected due to one or more semantic errors in packet filter(s) of the TFT included in the request.

Cause #45 – Syntactical error in packet filter(s)

    	This ESM cause is used by the network or the UE to indicate that the requested service was rejected due to one or more syntactical errors in packet filter(s) of the TFT included in the request.

Cause #47 – PTI mismatch

    	This ESM cause is used by the UE to indicate that the PTI value which is included in the ESM message that the UE receives does not match a PTI in use.

Cause #49 – Last PDN disconnection not allowed

    	This ESM cause is used by the network, in case of EMM-REGISTERED without PDN connection is not supported by the UE or the MME, to indicate that the UE requested PDN disconnection procedure on the last remaining PDN connection is not allowed.

Cause #50 – PDN type IPv4 only allowed

    	This ESM cause is used by the network to indicate that only PDN type IPv4 is allowed for the requested PDN connectivity.

Cause #51 – PDN type IPv6 only allowed

    	This ESM cause is used by the network to indicate that only PDN type IPv6 is allowed for the requested PDN connectivity.

Cause #52 – single address bearers only allowed

    	This ESM cause is used by the network to indicate that the requested PDN connectivity is accepted with the restriction that only single IP version bearers are allowed.

Cause #53 – ESM information not received

    	This ESM cause is used by the network to indicate that the PDN connectivity procedure was rejected due to the ESM information was not received.

Cause #54 – PDN connection does not exist

    	This ESM cause is used by the network at handover from a non-3GPP access network to indicate that the MME does not have any information about the requested PDN connection.

Cause #55 – Multiple PDN connections for a given APN not allowed

    	This ESM cause is used by the network to indicate that the PDN connectivity procedure was rejected due to multiple PDN connections for a given APN are not allowed.

Cause #56 – Collision with network initiated request

    	This ESM cause is used by the network to indicate that the network has already initiated the activation, modification or deactivation of bearer resources which was requested by the UE.

Cause #57 – PDN type IPv4v6 only allowed

    	This ESM cause is used by the network to indicate that only PDN types IPv4, IPv6 or IPv4v6 are allowed for the requested PDN connectivity.

Cause #58 – PDN type non IP only allowed

    	This ESM cause is used by the network to indicate that only PDN type non IP is allowed for the requested PDN connectivity.

Cause #59 – Unsupported QCI value

    	This ESM cause is used by the network if the QCI indicated in the UE request cannot be supported.

Cause #60 – Bearer handling not supported

    	This ESM cause is used by the network to indicate that the procedure requested by the UE was rejected because the bearer handling is not supported.

Cause #65 – Maximum number of EPS bearers reached

    	This ESM cause is used by the network to indicate that the procedure requested by the UE was rejected as the network has reached the maximum number of simultaneously active EPS bearer contexts for the UE.

Cause #66 – Requested APN not supported in current RAT and PLMN combination

    	This ESM cause is used by the network to indicate that the procedure requested by the UE was rejected as the requested APN is not supported in the current RAT and PLMN.

Cause #81 – Invalid PTI value

    	This ESM cause is used by the network or UE to indicate that the PTI provided to it is unassigned or reserved.

Cause #112 – APN restriction value incompatible with active EPS bearer context.

    	This ESM cause is used by the network to indicate that the EPS bearer context(s) have an APN restriction value that is not allowed in combination with a currently active EPS bearer context. Restriction values are defined in 3GPP TS 23.060 [4].

Cause #113 –Multiple accesses to a PDN connection not allowed

    	This ESM cause is used by the network to indicate that multiple accesses to a PDN connection for NBIFOM is not allowed.


B.2	Protocol errors (e.g., unknown message) class

Cause #95 – Semantically incorrect message

    	This ESM cause is used to report receipt of a message with semantically incorrect contents.

Cause #96 – Invalid mandatory information

    	This ESM cause indicates that the equipment sending this ESM cause has received a message with a non-semantical mandatory IE error.

Cause #97 – Message type non-existent or not implemented

    	This ESM cause indicates that the equipment sending this ESM cause has received a message with a message type it does not recognize either because this is a message not defined, or defined but not implemented by the equipment sending this ESM cause.

Cause #98 – Message type not compatible with protocol state

    	This ESM cause indicates that the equipment sending this ESM cause has received a message not compatible with the protocol state.

Cause #99 – Information element non-existent or not implemented

    	This ESM cause indicates that the equipment sending this ESM cause has received a message which includes information elements not recognized because the information element identifier is not defined or it is defined but not implemented by the equipment sending the ESM cause. However, the information element is not required to be present in the message in order for the equipment sending the ESM cause to process the message.

Cause #100 – Conditional IE error

    	This ESM cause indicates that the equipment sending this cause has received a message with conditional IE errors.

Cause #101 – Message not compatible with protocol state

    	This ESM cause indicates that a message has been received which is incompatible with the protocol state.

Cause #111 – Protocol error, unspecified

    	This ESM cause is used to report a protocol error event only when no other ESM cause in the protocol error class applies.



Annex C (normative):
Storage of EMM information

The following EMM parameters shall be stored on the USIM if the corresponding file is present:

  -	GUTI;

  -	last visited registered TAI;

  -	EPS update status;

  -	Allowed CSG list;

  -	Operator CSG list; and

  -	EPS security context parameters from a full native EPS security context (see 3GPP TS 33.401 [19]).

  The presence and format of corresponding files on the USIM is specified in 3GPP TS 31.102 [17].

If the corresponding file is not present on the USIM, these EMM parameters except allowed CSG list are stored in a non-volatile memory in the ME together with the IMSI from the USIM. The allowed CSG list is stored in a non-volatile memory in the ME if the UE supports CSG selection. These EMM parameters can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory; else the UE shall delete the EMM parameters.

The following EMM parameters shall be stored in a non-volatile memory in the ME together with the IMSI from the USIM:

  -	TIN; and

  -	DCN-ID list.

The TIN parameter can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME; else the UE shall delete the TIN parameter.

The DCN-ID list consists of DCN-IDs stored together with a PLMN identity. The list can have zero or more entries and the maximum length shall be at least 32 entries. When the maximum length is reached any new entry shall replace the oldest entry in the list. There shall be no duplicated PLMN identities in the list and any existing DCN-ID shall be deleted when a new DCN-ID is added for the same PLMN.

The DCN-ID list can only be used if the IMSI from the USIM matches the IMSI stored in the non-volatile memory of the ME; else the UE shall delete the DCN-ID list. The UE shall delete the stored DCN-ID list if the default standardized DCN-ID in the UE is changed.

If the UE is attached for emergency bearer services, the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE is detached.

If the UE is configured for eCall only mode as specified in 3GPP TS 31.102 [17], the UE shall not store the EMM parameters described in this annex on the USIM or in non-volatile memory. Instead the UE shall temporarily store these parameters locally in the ME and the UE shall delete these parameters when the UE enters EMM-DEREGISTERED.eCALL-INACTIVE state, the UE is switched-off or the USIM is removed.


Annex D (normative):
Establishment cause (S1 mode only)


D.1	Mapping of NAS procedure to RRC establishment cause (S1 mode only)

When EMM requests the establishment of a NAS-signalling connection, or when EMM requests the lower layers to resume a NAS signalling connection, the RRC establishment cause used by the UE shall be selected according to the NAS procedure as specified in table D.1.1. The EMM shall also indicate to the lower layer for the purpose of access control, the call type associated with the RRC establishment cause as specified in table D.1.1. If the UE is configured for EAB (see the "ExtendedAccessBarring" leaf of NAS configuration MO in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]), the EMM shall indicate to the lower layer for the purpose of access control that EAB applies for this request except for the following cases:

  -	the UE is a UE configured to use AC11 – 15 in selected PLMN;

  -	the UE is answering to paging;

  -	the RRC Establishment cause is set to "Emergency call";

  -	the UE is configured to allow overriding EAB (see the "Override_ExtendedAccessBarring" leaf of the NAS configuration MO as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) and receives an indication from the upper layers to override EAB; or

  -	the UE is configured to allow overriding EAB (see the "Override_ExtendedAccessBarring" leaf of the NAS configuration MO as specified in 3GPP TS 24.368 [15A] or 3GPP TS 31.102 [17]) and already has a PDN connection that was established with EAB override.

Table D.1.1: Mapping of NAS procedure to establishment cause and call type

|NAS procedure                     |RRC establishment cause (according 3GPP TS 36.331 [22])                      |Call type                   |
|Attach                            |If an ATTACH REQUEST has EPS attach type not set to "EPS emergency attach",  |"originating signalling"    |
|                                  |the RRC establishment cause shall be set to MO signalling except when the UE |                            |
|                                  |initiates attach procedure to establish emergency bearer services.           |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |Iif an ATTACH REQUEST contains the Device properties IE with low priority    |"originating signalling"    |
|                                  |indicator set to "MS is configured for NAS signalling low priority", the RRC |                            |
|                                  |establishment cause shall be set to Delay tolerant.                          |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If an ATTACH REQUEST has EPS attach type set to "EPS emergency attach", or if|"emergency calls"           |
|                                  |the ATTACH REQUEST has EPS attach type not set to "EPS emergency attach" but |                            |
|                                  |the UE initiates the attach procedure either on receiving request from upper |                            |
|                                  |layer to establish emergency bearer services or with a PDN CONNECTIVITY      |                            |
|                                  |REQUEST that has request type set to "handover of emergency bearer services",|                            |
|                                  |the RRC establishment cause shall be set to Emergency call.                  |                            |
|                                  |(See Note 1, Note 4)                                                         |                            |
|                                  |If the UE is allowed to use exception data reporting (see the                |"originating signalling"    |
|                                  |ExceptionDataReportingAllowed leaf of the NAS configuration MO in            |                            |
|                                  |3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]) and|                            |
|                                  |the attach procedure has been initiated upon receiving a request from upper  |                            |
|                                  |layers to transmit user data related to an exceptional event, the RRC        |                            |
|                                  |establishment cause shall be set to MO exception data.                       |                            |
|                                  |(See Note 1)                                                                 |                            |
|Tracking Area Update              |If the UE does not have a PDN connection established for emergency bearer    |"originating signalling"    |
|                                  |services and is not initiating a PDN CONNECTIVITY REQUEST that has request   |                            |
|                                  |type set to "emergency" or "handover of emergency bearer services", and MO   |                            |
|                                  |MMTEL voice call is not started, MO MMTEL video call is not started, MO      |                            |
|                                  |SMSoIP is not started, MO SMS over NAS or MO SMS over S102 is not requested, |                            |
|                                  |the RRC establishment cause shall be set to MO signalling.                   |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If the UE does not have a PDN connection established for emergency bearer    |"originating MMTEL voice"   |
|                                  |services and is not initiating a PDN CONNECTIVITY REQUEST that has request   |                            |
|                                  |type set to "emergency" or "handover of emergency bearer services", and an MO|                            |
|                                  |MMTEL voice call is started, the RRC establishment cause shall be set to MO  |                            |
|                                  |signalling.                                                                  |                            |
|                                  |(See Note 1, Note 3)                                                         |                            |
|                                  |If the UE does not have a PDN connection established for emergency bearer    |"originating MMTEL video"   |
|                                  |services and is not initiating a PDN CONNECTIVITY REQUEST that has request   |                            |
|                                  |type set to "emergency" or "handover of emergency bearer services", and an MO|                            |
|                                  |MMTEL video call is started, the RRC establishment cause shall be set to MO  |                            |
|                                  |signalling.                                                                  |                            |
|                                  |(See Note 1, Note 3)                                                         |                            |
|                                  |If the UE does not have a PDN connection established for emergency bearer    |"originating SMSoIP"        |
|                                  |services and is not initiating a PDN CONNECTIVITY REQUEST that has request   |                            |
|                                  |type set to "emergency" or "handover of emergency bearer services", and an MO|                            |
|                                  |SMSoIP is started, the RRC establishment cause shall be set to MO signalling.|                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If the UE does not have a PDN connection established for emergency bearer    |"originating SMS"           |
|                                  |services and is not initiating a PDN CONNECTIVITY REQUEST that has request   |                            |
|                                  |type set to "emergency" or "handover of emergency bearer services", and an MO|                            |
|                                  |SMS over NAS or MO SMS over S102 is requested, the RRC establishment cause   |                            |
|                                  |shall be set to MO signalling.                                               |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If the UE does not have a PDN connection established for emergency bearer    |"originating signalling"    |
|                                  |services and is not initiating a PDN CONNECTIVITY REQUEST that has request   |                            |
|                                  |type set to "emergency" or "handover of emergency bearer services", the      |                            |
|                                  |tracking area update procedure is not triggered due to paging, a TRACKING    |                            |
|                                  |AREA UPDATE REQUEST contains the Device properties IE with low priority      |                            |
|                                  |indicator set to "MS is configured for NAS signalling low priority", and MO  |                            |
|                                  |MMTEL voice call is not started, MO MMTEL video call is not started, MO      |                            |
|                                  |SMSoIP is not started, MO SMS over NAS or MO SMS over S102 is not requested, |                            |
|                                  |the RRC establishment cause shall be set to Delay tolerant.                  |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If the UE does not have a PDN connection established for emergency bearer    |"originating MMTEL voice"   |
|                                  |services and is not initiating a PDN CONNECTIVITY REQUEST that has request   |                            |
|                                  |type set to "emergency" or "handover of emergency bearer services", an MO    |                            |
|                                  |MMTEL voice call is started, and a TRACKING AREA UPDATE REQUEST contains the |                            |
|                                  |Device properties IE with low priority indicator set to "MS is configured for|                            |
|                                  |NAS signalling low priority", the RRC establishment cause shall be set to MO |                            |
|                                  |signalling.                                                                  |                            |
|                                  |(See Note 1, Note 3)                                                         |                            |
|                                  |If the UE does not have a PDN connection established for emergency bearer    |"originating MMTEL video"   |
|                                  |services and is not initiating a PDN CONNECTIVITY REQUEST that has request   |                            |
|                                  |type set to "emergency" or "handover of emergency bearer services", an MO    |                            |
|                                  |MMTEL video call is started, and a TRACKING AREA UPDATE REQUEST contains the |                            |
|                                  |Device properties IE with low priority indicator set to "MS is configured for|                            |
|                                  |NAS signalling low priority", the RRC establishment cause shall be set to MO |                            |
|                                  |signalling.                                                                  |                            |
|                                  |(See Note 1, Note 3)                                                         |                            |
|                                  |If the UE does not have a PDN connection established for emergency bearer    |"originating SMSoIP"        |
|                                  |services and is not initiating a PDN CONNECTIVITY REQUEST that has request   |                            |
|                                  |type set to "emergency" or "handover of emergency bearer services", an MO    |                            |
|                                  |SMSoIP is started, and a TRACKING AREA UPDATE REQUEST contains the Device    |                            |
|                                  |properties IE with low priority indicator set to "MS is configured for NAS   |                            |
|                                  |signalling low priority", the RRC establishment cause shall be set to MO     |                            |
|                                  |signalling.                                                                  |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If the UE does not have a PDN connection established for emergency bearer    |"originating SMS"           |
|                                  |services and is not initiating a PDN CONNECTIVITY REQUEST that has request   |                            |
|                                  |type set to "emergency" or "handover of emergency bearer services", an MO SMS|                            |
|                                  |over NAS or MO SMS over S102 is requested, and a TRACKING AREA UPDATE REQUEST|                            |
|                                  |contains the Device properties IE with low priority indicator set to "MS is  |                            |
|                                  |configured for NAS signalling low priority", the RRC establishment cause     |                            |
|                                  |shall be set to MO signalling.                                               |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If the UE does not have a PDN connection established for emergency bearer    |"terminating calls"         |
|                                  |services and is not initiating a PDN CONNECTIVITY REQUEST that has request   |                            |
|                                  |type set to "emergency" or "handover of emergency bearer services", and a    |                            |
|                                  |TRACKING AREA UPDATE REQUEST is a response to paging where the CN domain     |                            |
|                                  |indicator is set to "PS" or "CS", the RRC establishment cause shall be set to|                            |
|                                  |MT access.                                                                   |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If the UE has CS fallback emergency call or 1xCS fallback emergency call     |"emergency calls"           |
|                                  |pending, the RRC establishment cause shall be set to Emergency call.         |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If the UE has a PDN connection established for emergency bearer services or  |"emergency calls"           |
|                                  |is initiating a PDN CONNECTIVITY REQUEST that has request type set to        |                            |
|                                  |"emergency" or "handover of emergency bearer services", the RRC establishment|                            |
|                                  |cause shall be set to Emergency call.                                        |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If the UE is allowed to use exception data reporting (see the                |"originating signalling"    |
|                                  |ExceptionDataReportingAllowed leaf of the NAS configuration MO in            |                            |
|                                  |3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]) and|                            |
|                                  |there is a pending request from upper layers to transmit user data related to|                            |
|                                  |an exceptional event, the RRC establishment cause shall be set to MO         |                            |
|                                  |exception data.                                                              |                            |
|                                  |If the UE is requesting resources for V2X communication over PC5, the RRC    |"originating signalling"    |
|                                  |establishment cause shall be set to MO signalling.                           |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If the UE is requesting resources for V2X communication over PC5 and a       |"originating signalling"    |
|                                  |TRACKING AREA UPDATE REQUEST contains the Device properties IE with low      |                            |
|                                  |priority indicator set to "MS is configured for NAS signalling low priority",|                            |
|                                  |the RRC establishment cause shall be set to Delay tolerant.                  |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If the UE is requesting resources for ProSe direct discovery or ProSe direct |"originating signalling"    |
|                                  |communication as specified in 3GPP TS 36.331 [22], the RRC establishment     |                            |
|                                  |cause shall be set to MO signalling.                                         |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If the UE is requesting resources for ProSe direct discovery or ProSe direct |"originating signalling"    |
|                                  |communication as specified in 3GPP TS 36.331 [22] and a TRACKING AREA UPDATE |                            |
|                                  |REQUEST contains the Device properties IE with low priority indicator set to |                            |
|                                  |"MS is configured for NAS signalling low priority", the RRC establishment    |                            |
|                                  |cause shall be set to Delay tolerant.                                        |                            |
|                                  |(See Note 1)                                                                 |                            |
|Detach                            |MO signalling                                                                |"originating signalling"    |
|                                  |(See Note 1)                                                                 |                            |
|Service Request                   |If a SERVICE REQUEST is to request user plane radio resources and MO MMTEL   |"originating calls"         |
|                                  |voice call is not started, MO MMTEL video call is not started and MO SMSoIP  |                            |
|                                  |is not started, the RRC establishment cause shall be set to MO data.         |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a SERVICE REQUEST is to request user plane radio resources and an MO MMTEL|"originating MMTEL voice"   |
|                                  |voice call is started, the RRC establishment cause shall be set to MO data.  |                            |
|                                  |(See Note 1, Note 3)                                                         |                            |
|                                  |If a SERVICE REQUEST is to request user plane radio resources and an MO MMTEL|"originating MMTEL video"   |
|                                  |video call is started, the RRC establishment cause shall be set to MO data.  |                            |
|                                  |(See Note 1, Note 3)                                                         |                            |
|                                  |If a SERVICE REQUEST is to request user plane radio resources and an MO      |"originating SMSoIP"        |
|                                  |SMSoIP is started, the RRC establishment cause shall be set to MO data.      |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a SERVICE REQUEST is to request user plane radio resources for emergency  |"emergency calls"           |
|                                  |bearer services, the RRC establishment cause shall be set to Emergency call. |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a SERVICE REQUEST is to request resources for UL signalling and not for MO|"originating calls"         |
|                                  |SMS over NAS or MO SMS over S102, the RRC establishment cause shall be set to|                            |
|                                  |MO data.                                                                     |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a SERVICE REQUEST is to request resources for UL signalling for MO SMS    |"originating SMS"           |
|                                  |over NAS or MO SMS over S102, the RRC establishment cause shall be set to MO |                            |
|                                  |data.                                                                        |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a SERVICE REQUEST is to request user plane radio resources or to request  |"originating calls"         |
|                                  |resources for UL signalling and the UE is configured for dual priority and   |                            |
|                                  |the NAS signalling low priority indicator is overridden, the RRC             |                            |
|                                  |establishment cause shall be set to MO data.                                 |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a SERVICE REQUEST is triggered by a PDN CONNECTIVITY REQUEST that has     |"emergency calls"           |
|                                  |request type set to "emergency" or "handover of emergency bearer services",  |                            |
|                                  |the RRC establishment cause shall be set to Emergency call.                  |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a SERVICE REQUEST is to request user plane radio resources or to request  |"originating calls"         |
|                                  |resources for UL signalling, the UE is configured for NAS signalling low     |                            |
|                                  |priority, and MO MMTEL voice call is not started, MO MMTEL video call is not |                            |
|                                  |started and MO SMSoIP is not started, MO SMS over NAS or MO SMS over S102 is |                            |
|                                  |not requested, the RRC establishment cause shall be set to Delay tolerant.   |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a SERVICE REQUEST is to request user plane radio resources, an MO MMTEL   |"originating MMTEL voice"   |
|                                  |voice call is started, and the UE is configured for NAS signalling low       |                            |
|                                  |priority, the RRC establishment cause shall be set to MO data.               |                            |
|                                  |(See Note 1, Note 3)                                                         |                            |
|                                  |If a SERVICE REQUEST is to request user plane radio resources, an MO MMTEL   |"originating MMTEL video"   |
|                                  |video call is started, and the UE is configured for NAS signalling low       |                            |
|                                  |priority, the RRC establishment cause shall be set to MO data.               |                            |
|                                  |(See Note 1, Note 3)                                                         |                            |
|                                  |If a SERVICE REQUEST is to request user plane radio resources, an MO SMSoIP  |"originating SMSoIP"        |
|                                  |is started, and the UE is configured for NAS signalling low priority, the RRC|                            |
|                                  |establishment cause shall be set to MO data.                                 |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a SERVICE REQUEST is to request resources for UL signalling for MO SMS    |"originating SMS"           |
|                                  |over NAS or MO SMS over S102 and the UE is configured for NAS signalling low |                            |
|                                  |priority, the RRC establishment cause shall be set to MO data.               |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a SERVICE REQUEST is a response to paging where the CN domain indicator is|"terminating calls"         |
|                                  |set to "PS", the RRC establishment cause shall be set to MT access.          |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a SERVICE REQUEST is triggered to request resources for ProSe direct      |"originating calls"         |
|                                  |discovery or ProSe direct communication as specified in 3GPP TS 36.331 [22], |                            |
|                                  |the RRC establishment cause shall be set to MO data.                         |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a SERVICE REQUEST is triggered to request resources for ProSe direct      |"originating calls"         |
|                                  |discovery or ProSe direct communication as specified in 3GPP TS 36.331 [22]  |                            |
|                                  |and the UE is configured for NAS signalling low priority, the RRC            |                            |
|                                  |establishment cause shall be set to Delay tolerant.                          |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a SERVICE REQUEST is triggered to request resources for V2X communication |"originating calls"         |
|                                  |over PC5, the RRC establishment cause shall be set to MO data.               |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a SERVICE REQUEST is triggered to request resources for V2X communication |"originating calls"         |
|                                  |over PC5 and the UE is configured for NAS signalling low priority, the RRC   |                            |
|                                  |establishment cause shall be set to Delay tolerant.                          |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If an EXTENDED SERVICE REQUEST has service type set to "packet services via  |"emergency calls"           |
|                                  |S1" and is to request user plane radio resources for emergency bearer        |                            |
|                                  |services, the RRC establishment cause shall be set to Emergency call.        |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If an EXTENDED SERVICE REQUEST has service type set to "packet services via  |"emergency calls"           |
|                                  |S1" and is triggered by a PDN CONNECTIVITY REQUEST that has request type set |                            |
|                                  |to "emergency" or "handover of emergency bearer services", the RRC           |                            |
|                                  |establishment cause shall be set to Emergency call.                          |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If an EXTENDED SERVICE REQUEST has service type set to "packet services via  |"terminating calls"         |
|                                  |S1" and is a response to paging where the CN domain indicator is set to "PS",|                            |
|                                  |the RRC establishment cause shall be set to MT access.                       |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If an EXTENDED SERVICE REQUEST has service type set to "mobile originating CS|"originating calls"         |
|                                  |fallback or 1xCS fallback" and is to request mobile originating 1xCS         |                            |
|                                  |fallback, or if an EXTENDED SERVICE REQUEST is a response to paging for 1xCS |                            |
|                                  |fallback received over cdma2000® 1xRTT and has service type set to "mobile   |                            |
|                                  |terminating CS fallback or 1xCS fallback", the RRC establishment cause shall |                            |
|                                  |be set to MO data.                                                           |                            |
|                                  |(See Note 1).                                                                |                            |
|                                  |If an EXTENDED SERVICE REQUEST has service type set to "mobile originating CS|"mobile originating CS      |
|                                  |fallback or 1xCS fallback" and is to request mobile originating CS fallback, |fallback"                   |
|                                  |the RRC establishment cause shall be set to MO data.                         |                            |
|                                  |(See Note 1).                                                                |                            |
|                                  |If an EXTENDED SERVICE REQUEST is a response to paging for CS fallback,      |"terminating calls"         |
|                                  |service type set to "mobile terminating CS fallback or 1xCS fallback", the   |                            |
|                                  |RRC establishment cause shall be set to MT access.                           |                            |
|                                  |(See Note1, Note 2).                                                         |                            |
|                                  |If an EXTENDED SERVICE REQUEST has service type set to "mobile originating CS|"emergency calls"           |
|                                  |fallback emergency call or 1xCS fallback emergency call", the RRC            |                            |
|                                  |establishment cause shall be set to Emergency call.                          |                            |
|                                  |(See Note 1).                                                                |                            |
|                                  |If an EXTENDED SERVICE REQUEST contains the Device properties IE with low    |"originating calls"         |
|                                  |priority indicator set to "MS is not configured for NAS signalling low       |                            |
|                                  |priority", and MO MMTEL voice call is not started, MO MMTEL video call is not|                            |
|                                  |started and MO SMSoIP is not started, MO SMS over NAS or MO SMS over S102 is |                            |
|                                  |not requested, the RRC establishment cause shall be set to MO data.          |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If an EXTENDED SERVICE REQUEST contains the Device properties IE with low    |"originating MMTEL voice"   |
|                                  |priority indicator set to "MS is not configured for NAS signalling low       |                            |
|                                  |priority" and an MO MMTEL voice call is started, the RRC establishment cause |                            |
|                                  |shall be set to MO data.                                                     |                            |
|                                  |(See Note 1, Note 3)                                                         |                            |
|                                  |If an EXTENDED SERVICE REQUEST contains the Device properties IE with low    |"originating MMTEL video"   |
|                                  |priority indicator set to "MS is not configured for NAS signalling low       |                            |
|                                  |priority" and an MO MMTEL video call is started, the RRC establishment cause |                            |
|                                  |shall be set to MO data.                                                     |                            |
|                                  |(See Note 1, Note 3)                                                         |                            |
|                                  |If an EXTENDED SERVICE REQUEST contains the Device properties IE with low    |"originating SMSoIP"        |
|                                  |priority indicator set to "MS is not configured for NAS signalling low       |                            |
|                                  |priority" and an MO SMSoIP is started, the RRC establishment cause shall be  |                            |
|                                  |set to MO data.                                                              |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If an EXTENDED SERVICE REQUEST contains the Device properties IE with low    |"originating SMS"           |
|                                  |priority indicator set to "MS is not configured for NAS signalling low       |                            |
|                                  |priority" and an MO SMS over NAS or MO SMS over S102 is requested, the RRC   |                            |
|                                  |establishment cause shall be set to MO data.                                 |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If an EXTENDED SERVICE REQUEST contains the Device properties IE with low    |"originating calls"         |
|                                  |priority indicator set to "MS is configured for NAS signalling low priority",|                            |
|                                  |and MO MMTEL voice call is not started, MO MMTEL video call is not started   |                            |
|                                  |and MO SMSoIP is not started, MO SMS over NAS or MO SMS over S102 is not     |                            |
|                                  |requested, the RRC establishment cause shall be set to Delay tolerant.       |                            |
|                                  |(See Note 1).                                                                |                            |
|                                  |If an EXTENDED SERVICE REQUEST contains the Device properties IE with low    |"originating MMTEL voice"   |
|                                  |priority indicator set to "MS is configured for NAS signalling low priority" |                            |
|                                  |and an MO MMTEL voice call is started, the RRC establishment cause shall be  |                            |
|                                  |set to MO data.                                                              |                            |
|                                  |(See Note 1, Note 3)                                                         |                            |
|                                  |If an EXTENDED SERVICE REQUEST contains the Device properties IE with low    |"originating MMTEL video"   |
|                                  |priority indicator set to "MS is configured for NAS signalling low priority" |                            |
|                                  |and an MO MMTEL video call is started, the RRC establishment cause shall be  |                            |
|                                  |set to MO data.                                                              |                            |
|                                  |(See Note 1, Note 3)                                                         |                            |
|                                  |If an EXTENDED SERVICE REQUEST contains the Device properties IE with low    |"originating SMSoIP"        |
|                                  |priority indicator set to "MS is configured for NAS signalling low priority" |                            |
|                                  |and an MO SMSoIP is started, the RRC establishment cause shall be set to MO  |                            |
|                                  |data.                                                                        |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If an EXTENDED SERVICE REQUEST contains the Device properties IE with low    |"originating SMS"           |
|                                  |priority indicator set to "MS is configured for NAS signalling low priority" |                            |
|                                  |and an MO SMS over NAS or MO SMS over S102 is requested, the RRC             |                            |
|                                  |establishment cause shall be set to MO data.                                 |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If an EXTENDED SERVICE REQUEST contains the Device properties IE with low    |"originating calls"         |
|                                  |priority indicator set to "MS is not configured for NAS signalling low       |                            |
|                                  |priority" and is triggered to request resources for ProSe direct discovery or|                            |
|                                  |ProSe direct communication, the RRC establishment cause shall be set to MO   |                            |
|                                  |data.                                                                        |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If an EXTENDED SERVICE REQUEST contains the Device properties IE with low    |"originating calls"         |
|                                  |priority indicator set to "MS is configured for NAS signalling low priority" |                            |
|                                  |and is triggered to request resources for ProSe direct discovery or ProSe    |                            |
|                                  |direct communication, the RRC establishment cause shall be set to Delay      |                            |
|                                  |tolerant.                                                                    |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If an EXTENDED SERVICE REQUEST contains the Device properties IE with low    |"originating calls"         |
|                                  |priority indicator set to "MS is not configured for NAS signalling low       |                            |
|                                  |priority" and is triggered to request resources for V2X communication over   |                            |
|                                  |PC5, the RRC establishment cause shall be set to MO data.                    |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If an EXTENDED SERVICE REQUEST contains the Device properties IE with low    |"originating calls"         |
|                                  |priority indicator set to "MS is configured for NAS signalling low priority" |                            |
|                                  |and is triggered to request resources for V2X communication over PC5, the RRC|                            |
|                                  |establishment cause shall be set to Delay tolerant.                          |                            |
|                                  |(See Note 1)                                                                 |                            |
|                                  |If a CONTROL PLANE SERVICE REQUEST is a response to paging where the Control |"terminating calls"         |
|                                  |plane service type is set to "mobile terminating request", the RRC           |                            |
|                                  |establishment cause shall be set to MT access. (see Note 1)                  |                            |
|                                  |If a CONTROL PLANE SERVICE REQUEST is to transfer user data or to request    |"originating calls"         |
|                                  |resources for UL signalling , the RRC establishment cause shall be set to MO |                            |
|                                  |data.                                                                        |                            |
|                                  |(see Note 1)                                                                 |                            |
|                                  |If a CONTROL PLANE SERVICE REQUEST is to transfer user data or to request    |"originating calls"         |
|                                  |resources for UL signalling and contains the Device properties IE with low   |                            |
|                                  |priority indicator set to "MS is configured for NAS signalling low priority",|                            |
|                                  |the RRC establishment cause shall be set to Delay tolerant.                  |                            |
|                                  |(see Note 1)                                                                 |                            |
|                                  |In WB-S1 Mode, if a CONTROL PLANE SERVICE REQUEST is to transfer MO SMS, the |"originating SMS"           |
|                                  |RRC establishment cause shall be set to MO data.                             |                            |
|                                  |(see Note 1)                                                                 |                            |
|                                  |                                                                             |                            |
|                                  |In NB-S1 Mode, if a CONTROL PLANE SERVICE REQUEST is to transfer MO SMS, the |"originating calls"         |
|                                  |RRC establishment cause shall be set to MO data.                             |                            |
|                                  |In NB-S1 Mode, if a CONTROL PLANE SERVICE REQUEST is to transfer MO SMS and  |"originating calls"         |
|                                  |contains the Device properties IE with low priority indicator set to "MS is  |                            |
|                                  |configured for NAS signalling low priority", the RRC establishment cause     |                            |
|                                  |shall be set to Delay tolerant.                                              |                            |
|                                  |If the UE is allowed to use exception data reporting (see the                |"originating calls"         |
|                                  |ExceptionDataReportingAllowed leaf of the NAS configuration MO in            |                            |
|                                  |3GPP TS 24.368 [15A] or the USIM file EFNASCONFIG in 3GPP TS 31.102 [17]) and|                            |
|                                  |a CONTROL PLANE SERVICE REQUEST is to perform initial data transfer related  |                            |
|                                  |to an exceptional event, the RRC establishment cause shall be set to MO      |                            |
|                                  |exception data.                                                              |                            |
|Note 1: For these NAS procedures in WB-S1 mode initiated by UEs of access class 12, 13 or 14 in their home country, the RRC establishment    |
|cause will be set to "High priority access AC 11 – 15". For this purpose, the home country is defined as the country to which the MCC part of|
|the IMSI is associated, see 3GPP TS 23.122 [6] for the definition of country.                                                                |
|For these NAS procedures in WB-S1 mode initiated by UE of access class 11 or 15 in their HPLMN (if the EHPLMN list is not present or is      |
|empty) or EHPLMN (if the EHPLMN list is present), the RRC establishment cause will be set to "High priority access AC 11 – 15".              |
|Note 2: This row is not applicable for mobile terminating 1xCS fallback with 1xCS paging request received over E-UTRAN.                      |
|Note 3: For these NAS procedures, the lower layers can change the RRC establishment cause from "MO data" or from "MO Signalling" to "MO Voice|
|Call", if the serving cell requests the UE to use the RRC establishment cause "MO voice call" (see 3GPP TS 36.331 [22]).                     |
|Note 4: It is an implementation option to initiate attach request carrying a PDN CONNECTIVITY REQUEST with request type "handover of         |
|emergency bearer services" to support access transfer of an ongoing emergency session from non-3GPP access to 3GPP access when the UE is not |
|already in EMM_REGISTERED state.                                                                                                             |


  NOTE:	The RRC establishment cause can be used by the network to prioritise the connection establishment request from the UE at high load situations in the network.





Annex E (informative):
Guidelines for enhancements to MS network capability IE and UE network capability IE

The UE uses the information elements MS network capability and UE network capability to inform the core network about its network related capabilities. Both information elements can be signalled in any of the modes: A/Gb mode, Iu mode and S1 mode.

The purpose of the present annex is to give some guidelines how to select the information element(s) to be enhanced if new capabilities need to be added.

  1)	If a capability is related to a feature that can be used in a network supporting A/Gb mode only or Iu mode only or both, the capability will be signalled in the MS network capability IE.

  2)	If a capability is related to a feature that can be used in network supporting S1 mode only, the capability will be signalled in the UE network capability IE.

  3)	If a capability is related to a feature that can be used only in a network supporting both S1 mode and at least one of the two modes A/Gb mode and Iu mode, the capability is added only to one of the two information elements:

    a)	If the information is used by the MME only, the capability will be signalled in the UE network capability IE.

    b)	If the information is used by the SGSN only or both by the SGSN and by the MME, the capability will be signalled in the MS network capability IE.

  NOTE:	The reason for rules 1 and 2 is that a UE not supporting A/Gb mode and Iu mode will not provide the MS network capability IE to the network and a UE not supporting S1 mode will not provide the UE network capability IE. In some cases, due to rules 1 and 2 the capability indicator will be included in both information elements.

  EXAMPLE 1:	The support indicator for UCS2 is included in both information elements.

  EXAMPLE 2:	The "SRVCC to GERAN/UTRAN capability" is included in the MS network capability IE, as it is used both by the MME for SRVCC from E-UTRAN to GERAN/UTRAN and by the SGSN for SRVCC from UTRAN HSPA to GERAN/UTRAN.



Annex F (normative):
Application specific Congestion control for Data Communication (ACDC)

The UE may support the procedures in this annex.

If the UE supports ACDC, the EMM layer shall determine the ACDC category applicable to the request based on the application identifier received from the upper layers and the configuration information in the "ACDCConf" leaf of ACDC MO as specified in 3GPP TS 24.105 [35] or in the USIM EFACDC as specified in 3GPP TS 31.102 [17].

  NOTE 1:	As an implementation option, the upper layers can determine the ACDC category and send it to the EMM layer. Then the EMM layer need not read the ACDC MO or USIM to determine the ACDC category.

The EMM sublayer shall indicate to the lower layers, for the purpose of access control:

  -	the ACDC category that applies to this request if only one ACDC category is applicable;

  -	the highest ranked ACDC category among the ACDC categories that applies to this request if multiple ACDC categories are applicable; or

  -	this request is for an uncategorized application if an application identifier received from the upper layers is not mapped to any ACDC category,

except for the following cases:

  -	the UE is a UE configured to use AC11 – 15 in selected PLMN;

  -	the UE is answering to paging;

  -	the RRC Establishment cause is set to "Emergency call"; or

  -	if conditions MO MMTEL voice call is started or MO MMTEL video call is started or MO SMSoIP is started, is satisfied.

  NOTE 2:	The request from the EMM sublayer refers to either a request to establish an initial NAS signalling connection or a request to re-establish a NAS signalling connection.

If the UE supports ACDC and access is barred because of ACDC, the EMM layer shall keep track of the ACDC category for which access is barred and it shall not send a request for the same ACDC category or a lower ACDC category until access is granted.

If the UE supports ACDC and access is barred because of ACDC, the EMM layer shall not send a request for any uncategorized application until access is granted.



Annex G (informative):
Change history



|Change history                                                                                                                              |
|Date                                                                                                                                            |


Date |Meeting |TDoc |CR |Rev |Cat |Subject/Comment |New version | |2016-09 |CT#73 |CP-160516 |2459 |2 |F |Handling of MO/MT CSFB in EMM-REGISTERED.ATTEMPTING-TO-UPDATE-MM |14.1.0 | |2016-09 |CT#73 |CP-160516 |2462 | |D |Incorrectly formatted bullet list of PDN type values |14.1.0 | |2016-09 |CT#73 |CP-160488 |2464 |1 |A |NAS timer handling for eMTC |14.1.0 | |2016-09 |CT#73 |CP-160470 |2466 |2 |A |Addition of DelayTolerant RRC establishment cause for NB-IoT |14.1.0 | |2016-09 |CT#73 |CP-160488 |2475 |2 |A |Extended Wait Time for non-low access priority UEs in NB-IoT |14.1.0 | |2016-09 |CT#73 |CP-160486 |2477 |3 |A |Clarification for EMM-REGISTERED without PDN connection |14.1.0 | |2016-09 |CT#73 |CP-160493 |2478 | |A |Message type for REMOTE UE REPORT and REMOTE UE REPORT RESPONSE message |14.1.0 | |2016-09 |CT#73 |CP-160486 |2481 | |A |Correction of ePCO indication IE |14.1.0 | |2016-09 |CT#73 |CP-160488 |2483 |2 |A |Indication of Support of CIOT EPS optimizations |14.1.0 | |2016-09 |CT#73 |CP-160488 |2485 |2 |A |piggyback ESM data transport in CP service request |14.1.0 | |2016-09 |CT#73 |CP-160525 |2492 |3 |A |When to send service accept message |14.1.0 | |2016-09 |CT#73 |CP-160489 |2495 |1 |A |Preferred CIoT network behaviour when CIoT optimization is not supported |14.1.0 | |2016-09 |CT#73 |CP-160486 |2497 |1 |A |Alignment on Control Plane Service Request related usage |14.1.0 | |2016-09 |CT#73 |CP-160488 |2501 |1 |A |Non IP PDN type in the PDN address |14.1.0 | |2016-09 |CT#73 |CP-160492 |2507 | |A |Wrong ordering of and repeated requirements on eDRX parameters handling |14.1.0 | |2016-09 |CT#73 |CP-160512 |2508 |1 |B |Introduction of eCall over IMS in TS 24.301 |14.1.0 | |2016-09 |CT#73 |CP-160527 |2510 |2 |A |Multiple DRB capability handling |14.1.0 | |2016-09 |CT#73 |CP-160489 |2512 |1 |A |Resolution of editor's note on abnormal cases during service request procedure |14.1.0 | |2016-09 |CT#73 |CP-160486 |2514 |1 |A |Correction of use of broadcast support indications of CIoT optimizations |14.1.0 | |2016-09 |CT#73 |CP-160486 |2518 |1 |A |Alignment for consistent use of term "Control plane"and "User plane" |14.1.0 | |2016-09 |CT#73 |CP-160487 |2520 | |A |Correction to NAS timer extension multiplier to support NB-S1 mode |14.1.0 | |2016-09 |CT#73 |CP-160487 |2522 | |A |EMM NAS timers for applying extension to support NB-S1 mode |14.1.0 | |2016-09 |CT#73 |CP-160487 |2524 |1 |A |Editor's note in sub-clauses 5.5.1.2.4 and 5.5.3.2.4 |14.1.0 | |2016-09 |CT#73 |CP-160487 |2528 | |A |Correction to requirement on requesting CIoT EPS optimizations |14.1.0 | |2016-09 |CT#73 |CP-160487 |2530 | |A |Correction to procedure to inform the UE of any local serving PLMN rate control |14.1.0 | |2016-09 |CT#73 |CP-160487 |2532 | |A |Correction to the use of NB-IoT RAT |14.1.0 | |2016-09 |CT#73 |CP-160492 |2534 | |A |Paging for EPS service for UE using eDRX |14.1.0 | |2016-09 |CT#73 |CP-160488 |2536 | |A |Partial ciphering for SMS transfer over CIoT CP optimization |14.1.0 | |2016-09 |CT#73 |CP-160516 |2537 |1 |F |Clarification on general description of ESM procedrue |14.1.0 | |2016-09 |CT#73 |CP-160486 |2543 |3 |A |Correction on usage of extended protocol configuration options |14.1.0 | |2016-09 |CT#73 |CP-160488 |2545 |2 |A |ePCO support by UEs supporting NB-S1 mode or Non-IP PDN type  |14.1.0 | |2016-09 |CT#73 |CP-160487 |2547 | |A |Editor's note in sub-clause 5.5.2.3.4 |14.1.0 | |2016-09 |CT#73 |CP-160570 |2553 |4 |A |Correction on T3440 when "signalling active" flag is used |14.1.0 | |2016-09 |CT#73 |CP-160487 |2559 |1 |A |Corrections to Table D.1.1 regarding exception data reporting |14.1.0 | |2016-09 |CT#73 |CP-160489 |2561 |1 |A |Remove duplication in triggering the establishment of UP bearers in EMM-CONNECTED for a UE using CP CIoT optimization |14.1.0 | |2016-09 |CT#73 |CP-160488 |2565 |1 |A |Encoding of additional header compression context setup parameters |14.1.0 | |2016-09 |CT#73 |CP-160489 |2567 |1 |A |Release Assistance Information Alignment |14.1.0 | |2016-09 |CT#73 |CP-160486 |2569 |2 |A |Attach reject due to incompatibility between CIoT features supported by the UE and the network |14.1.0 | |2016-09 |CT#73 |CP-160487 |2571 |1 |A |DL NAS prioritization |14.1.0 | |2016-12 |CT#74 |CP-160723 |2516 |2 |A |Removal of options related to CP/UP switch |14.2.0 | |2016-12 |CT#74 |CP-160722 |2573 |3 |A |MME behavior when accepting control plane service request |14.2.0 | |2016-12 |CT#74 |CP-160723 |2579 |1 |A |Synchronization for EPS bearer contexts associated with CP only indication |14.2.0 | |2016-12 |CT#74 |CP-160798 |2580 |2 |B |Handover of emergency PDN connection from non-3GPP access to 3GPP access |14.2.0 | |2016-12 |CT#74 |CP-160722 |2584 |6 |A |PDN connection restriction due to subscription restriction  (Alt4) |14.2.0 | |2016-12 |CT#74 |CP-160720 |2586 |2 |A |Control Plane "pinning" and CP to UP switching |14.2.0 | |2016-12 |CT#74 |CP-160726 |2589 |2 |A |Paging with TMSI for eDRX UE |14.2.0 | |2016-12 |CT#74 |CP-160753 |2591 |3 |F |Reduce running NAS time in the MME  |14.2.0 | |2016-12 |CT#74 |CP-160721 |2594 |2 |A |Correction of the use of broadcasted CIoT optimization support indications  |14.2.0 | |2016-12 |CT#74 |CP-160738 |2595 |4 |B |Addition of DCN ID handling for eDecor |14.2.0 | |2016-12 |CT#74 |CP-160720 |2597 |1 |A |Addition of Non-IP related cause values |14.2.0 | |2016-12 |CT#74 |CP-160749 |2598 |1 |F |Improved clarification on general description of ESM procedure |14.2.0 | |2016-12 |CT#74 |CP-160723 |2602 |1 |A |Updates to Handle multiple DRB Capability |14.2.0 | |2016-12 |CT#74 |CP-160738 |2606 |2 |F |DCN-ID in GUTI Reallocation Command Message |14.2.0 | |2016-12 |CT#74 |CP-160739 |2607 | |F |Removal of Editor's note on normal emergency call by UE in eCall only mode |14.2.0 | |2016-12 |CT#74 |CP-160739 |2608 |1 |F |Correction of eCall timer names |14.2.0 | |2016-12 |CT#74 |CP-160720 |2610 |2 |A |Abnormal case for ESM DATA TRANSPORT |14.2.0 | |2016-12 |CT#74 |CP-160723 |2616 |1 |A |Restarting T3440 when CP optimisation applied |14.2.0 | |2016-12 |CT#74 |CP-160722 |2618 |2 |A |Exception data handling |14.2.0 | |2016-12 |CT#74 |CP-160723 |2620 |5 |A |RRC Establishment cause and Call Type corrections.  |14.2.0 | |2016-12 |CT#74 |CP-160753 |2621 |2 |F |Correction of local deactivation of EPS bearer context handling |14.2.0 | |2016-12 |CT#74 |CP-160721 |2625 |5 |A |Correction to the implementation of the PNB/SNB framework |14.2.0 | |2016-12 |CT#74 |CP-160721 |2629 |2 |A |Correction to the definitions related to CIOT |14.2.0 | |2016-12 |CT#74 |CP-160721 |2633 |2 |A |Correction on CPSR usage for user plane establishment |14.2.0 | |2016-12 |CT#74 |CP-160720 |2635 | |A |Correction of partial encryption of CPSR |14.2.0 | |2016-12 |CT#74 |CP-160722 |2637 |2 |A |Initial NAS message discard at successful RRC Resume |14.2.0 | |2016-12 |CT#74 |CP-160722 |2639 |3 |A |Re-insert ePCO IE in PDN Connectivity Request |14.2.0 | |2016-12 |CT#74 |CP-160722 |2641 |1 |A |Further alignment on Control plane service type usage |14.2.0 | |2016-12 |CT#74 |CP-160721 |2645 |4 |A |Correction to the setting of the Control plane only indication |14.2.0 | |2016-12 |CT#74 |CP-160723 |2647 |2 |A |TAU reject upon inter-RAT mobility involving NB-S1 mode |14.2.0 | |2016-12 |CT#74 |CP-160722 |2654 |2 |A |Exception data reporting initiation when T3346 is running |14.2.0 | |2016-12 |CT#74 |CP-160721 |2658 | |A |Correction on the length of Header Compression Configuration IE |14.2.0 | |2016-12 |CT#74 |CP-160754 |2659 | |F |New QCI values for V2X services |14.2.0 | |2016-12 |CT#74 |CP-160735 |2661 |4 |A |Traffic flow aggregate IE |14.2.0 | |2016-12 |CT#74 |CP-160721 |2663 |1 |A |Correction to EPS MM and SM timers in NB-S1 mode |14.2.0 | |2016-12 |CT#74 |CP-160723 |2665 |2 |A |Correction to EPS MM and SM timers in WB-S1 mode |14.2.0 | |2016-12 |CT#74 |CP-160753 |2666 |2 |D |Editorials and minor correction on CIoT |14.2.0 | |2016-12 |CT#74 |CP-160718 |2669 |3 |A |Correction to cases which all EPS bearer contexts to a given APN are deactivated |14.2.0 | |2016-12 |CT#74 |CP-160753 |2670 | |F |Detach procedure triggered due to USIM removal |14.2.0 | |2016-12 |CT#74 |CP-160749 |2671 | |F |Correction to initiation of TAU when the EPS update status is set to EU2 NOT UPDATED |14.2.0 | |2016-12 |CT#74 |CP-160749 |2672 |1 |F |Correction to network cases to release the NAS signalling connection |14.2.0 | |2016-12 |CT#74 |CP-160749 |2673 | |F |Correction to EPS attach counter after successful registration |14.2.0 | |2016-12 |CT#74 |CP-160754 |2674 |2 |B |Introduction ofV2X capability in ATTACH REQUEST and TRACKING AREA UPDATE REQUEST messages |14.2.0 | |2016-12 |CT#74 |CP-160754 |2675 |4 |B |New trigger conditions for service request and tracking area updating procedures due to V2X |14.2.0 | |2016-12 |CT#74 |CP-160720 |2677 |3 |A |Correction of the abnormal case handling for EMM-REGISTERED without PDN connection |14.2.0 | |2016-12 |CT#74 |CP-160722 |2679 | |A |Removal of editor's note for CP service request |14.2.0 | |2016-12 |CT#74 |CP-160721 |2681 |1 |A |Correction to encoding of UE network capability IE and TAU initiation  |14.2.0 | |2016-12 |CT#74 |CP-160753 |2682 | |F |Information on RRC establishment cause change at MMTEL Video |14.2.0 | |2016-12 |CT#74 |CP-160723 |2684 |1 |A |Synchronisation of CP only EPS bearers |14.2.0 | |2016-12 |CT#74 |CP-160720 |2686 |1 |A |Alignment of MTU for CP user data |14.2.0 | |2016-12 |CT#74 |CP-160722 |2690 | |A |NAS message container successfully deciphered |14.2.0 | |2016-12 |CT#74 |CP-160738 |2691 |1 |B |Trigger TAU at Default DCN-ID change |14.2.0 | |2016-12 |CT#74 |CP-160718 |2697 |1 |A |Indication to upper layers on first expiry of T3482 for emergency bearer services |14.2.0 | |2016-12 |CT#74 |CP-160720 |2701 |3 |A |APN rate Control and Emergency bearer services |14.2.0 | |2016-12 |CT#74 |CP-160720 |2703 | |A |Alignment of the ROHC support requirements |14.2.0 | |2016-12 |CT#74 |CP-160753 |2707 |3 |D |Correction to the handling of the Link MTU parameters |14.2.0 | |2016-12 |CT#74 |CP-160721 |2709 |2 |A |Enabling SMS over SGs for NB-IoT only UEs |14.2.0 | |2016-12 |CT#74 |CP-160749 |2710 | |F |Alignment on UE's behaviour for CS fallback failure |14.2.0 | |2016-12 |CT#74 |CP-160749 |2711 |1 |F |Clarification to EMM-REGISTERED.UPDATE-NEEDED state |14.2.0 | |2016-12 |CT#74 |CP-160749 |2712 |1 |F |Service request initiated for CS fallback - abnormal case in the UE |14.2.0 | |2016-12 |CT#74 |CP-160720 |2715 |2 |A |Alignment of CP Service Request for abnormal case |14.2.0 | |2016-12 |CT#74 |CP-160723 |2719 |1 |A |Service Request Counter  |14.2.0 | |2016-12 |CT#74 |CP-160721 |2723 | |A |Correction on NAS timer usage condition for CE mode B  |14.2.0 | |2016-12 |CT#74 |CP-160753 |2725 | |F |Aligning definitions of EMM_DEREGISTERED.PLMN-SEARCH and EMM_DEREGISTERED.NO-IMSI |14.2.0 | |2016-12 |CT#74 |CP-160753 |2726 |1 |F |Clarification to the CIOT EPS optimisation procedure |14.2.0 | |2017-03 |CT#75 |CP-170136 |2490 |4 |F |Voice domain preference change during "CSFB not available", "CSFB not preferred" or "SMS only" |14.3.0 | |2017-03 |CT#75 |CP-170136 |2724 |1 |F |Handling paging in EMM-REGISTERED.ATTEMPTING-TO-UPDATE |14.3.0 | |2017-03 |CT#75 |CP-170136 |2730 |2 |F |Correction for the Additional update result IE in Tracking Area Update Accept message |14.3.0 | |2017-03 |CT#75 |CP-170136 |2734 |1 |D |Correction to the usage of the Control plane only indication |14.3.0 | |2017-03 |CT#75 |CP-170110 |2736 |2 |A |Correction to the UE behavior for completion of the service request procedure |14.3.0 | |2017-03 |CT#75 |CP-170110 |2742 | |A |Release of NAS signalling due to service reject to CPSR |14.3.0 | |2017-03 |CT#75 |CP-170136 |2746 |1 |F |Correction of Additional update type inclusion criteria in TAU |14.3.0 | |2017-03 |CT#75 |CP-170110 |2748 |1 |A |Encryption at resume of NAS signalling connection |14.3.0 | |2017-03 |CT#75 |CP-170136 |2751 |1 |F |Addition of TAU triggers for ProSe in table D.1.1 |14.3.0 | |2017-03 |CT#75 |CP-170121 |2752 |1 |B |TAU support for NB-S1 |14.3.0 | |2017-03 |CT#75 |CP-170121 |2762 |2 |B |Restriction of use of Coverage Enhancement |14.3.0 | |2017-03 |CT#75 |CP-170130 |2763 |7 |B |Introduction of 3GPP PS data off UE status and 3GPP PS data off support indicator |14.3.0 | |2017-03 |CT#75 |CP-170110 |2765 |4 |A |Values for the EPS MM and SM timers in WB-S1 mode |14.3.0 | |2017-03 |CT#75 |CP-170121 |2768 |1 |B |Interaction between PSM and MBMS |14.3.0 | |2017-03 |CT#75 |CP-170110 |2771 |3 |A |Failure case handling of SMS over SGs for NB-IoT only UEs |14.3.0 | |2017-03 |CT#75 |CP-170136 |2773 |1 |F |Correction on multiple DRB Capability handling |14.3.0 | |2017-03 |CT#75 |CP-170133 |2774 |1 |F |Skip back-off timer for emergency CSFB call |14.3.0 | |2017-03 |CT#75 |CP-170136 |2775 |3 |F |Clarification to the Suspend and Resume procedure |14.3.0 | |2017-03 |CT#75 |CP-170136 |2781 |1 |F |SGi PDN connections for CP to UP switching |14.3.0 | |2017-03 |CT#75 |CP-170136 |2783 |3 |F |Exception data handling in Attempting to Update or Attach state. |14.3.0 | |2017-03 |CT#75 |CP-170122 |2791 |3 |F |Resolve DCN-ID length |14.3.0 | |2017-03 |CT#75 |CP-170119 |2793 | |A |Further corrections of handling of NAS reject messages without integrity protection |14.3.0 | |2017-03 |CT#75 |CP-170110 |2795 | |A |Extended wait time for CPSR with low priority indicator |14.3.0 | |2017-03 |CT#75 |CP-170136 |2797 |1 |F |Correction to the handling ot Serving PLMN rate control values |14.3.0 | |2017-03 |CT#75 |CP-170136 |2798 |1 |F |UE configuration for exception data reporting via USIM |14.3.0 | |2017-03 |CT#75 |CP-170136 |2801 |1 |F |UE getting detached when last PDN connection moved to non-3GPP access |14.3.0 | |2017-03 |CT#75 |CP-170136 |2803 |2 |F |Multiple bearer capability handling independent of CIoT user plane optimization |14.3.0 | |2017-03 |CT#75 |CP-170119 |2807 | |A |Correction to the handling of non-integrity proctected reject messages |14.3.0 | |2017-03 |CT#75 |CP-170136 |2808 |1 |F |Local EPS bearer context deactivation |14.3.0 | |2017-03 |CT#75 |CP-170136 |2810 |2 |F |Service accept message for CPSR with active flag |14.3.0 | |2017-03 |CT#75 |CP-170133 |2813 |1 |F |Emergency CS/PS call handling when T3440 started due to g) in subclause 5.3.1.2.1 |14.3.0 | |2017-03 |CT#75 |CP-170121 |2815 |2 |B |Intra-MME mobility enhancements for DL data transmission for NB-IoT |14.3.0 | |2017-03 |CT#75 |CP-170136 |2817 |2 |F |(Sol A) Extended DRX parameters handling |14.3.0 | |2017-03 |CT#75 |CP-170121 |2822 |2 |B |Mobility enhancements for UL data transmission for NB-IoT |14.3.0 | |2017-03 |CT#75 |CP-170134 |2823 | |B |Support of handovers of emergency sessions over WLAN to 3GPP access |14.3.0 | |2017-06 |CT#76 |CP-171089 |2761 |3 |B |Indicating policy related to emergency numbers/types received via non-3GPP access |14.4.0 | |2017-06 |CT#76 |CP-171073 |2766 |4 |B |Congestion control for transport of user data via the control plane |14.4.0 | |2017-06 |CT#76 |CP-171089 |2796 |4 |B |Inclusion of Local Emergency Numbers List over non-3GPP access |14.4.0 | |2017-06 |CT#76 |CP-171069 |2826 |2 |A |Correction of ePCO for EPS |14.4.0 | |2017-06 |CT#76 |CP-171088 |2827 |1 |F |Correction to the handling of paging in EMM-REGISTERED.ATTEMPTING-TO-UPDATE |14.4.0 | |2017-06 |CT#76 |CP-171088 |2828 |1 |F |Handling of IMS voice not available in substate ATTEMPTING-TO-UPDATE-MM |14.4.0 | |2017-06 |CT#76 |CP-171062 |2830 |1 |A |Handling of UE initiated PDN connectivity request for emergency bearer services |14.4.0 | |2017-06 |CT#76 |CP-171085 |2831 |1 |F |Corrections on PS data off |14.4.0 | |2017-06 |CT#76 |CP-171092 |2832 |1 |F |Correction in Service Request procedure for ACB handling in NB-S1 mode |14.4.0 | |2017-06 |CT#76 |CP-171068 |2838 |2 |A |TAU procedure initiation following CSFB failure or CSFB cancellation |14.4.0 | |2017-06 |CT#76 |CP-171062 |2840 |1 |A |Correction of description of ePCO IE in PDN Connectivity Request |14.4.0 | |2017-06 |CT#76 |CP-171075 |2841 |1 |F |Correction on subclause of eCall inactivity procedure |14.4.0 | |2017-06 |CT#76 |CP-171073 |2848 |1 |F |T3440 timer and CP Data BO timer. |14.4.0 | |2017-06 |CT#76 |CP-171092 |2850 |1 |F |The UE behavior for successful completion of the service request procedure |14.4.0 | |2017-06 |CT#76 |CP-171088 |2853 |2 |B |Protecting against the modification of Attach/TAU Request attacks |14.4.0 | |2017-06 |CT#76 |CP-171062 |2855 |1 |A |Assign IEI for SMS services status IE |14.4.0 | |2017-06 |CT#76 |CP-171092 |2857 |1 |F |Support of Data volume reporting in User Plane CIoT EPS optimization |14.4.0 | |2017-06 |CT#76 |CP-171062 |2859 |1 |A |Correction of TAU triggering after paging for Control Plane CIoT Optimization |14.4.0 | |2017-06 |CT#76 |CP-171073 |2860 |4 |F |UE support of restriction on enhanced coverage |14.4.0 | |2017-06 |CT#76 |CP-171073 |2861 |1 |F |Correction to mobility enhancement for UL CP data |14.4.0 | |2017-06 |CT#76 |CP-171092 |2862 | |F |Correction to local context deactivation |14.4.0 | |2017-06 |CT#76 |CP-171062 |2865 | |A |EPS network feature support length |14.4.0 | |2017-06 |CT#76 |CP-171085 |2867 |1 |F |Removal of editor's note [WI PS_DATA_OFF-CT CR#2763] on when the user activates or deactivates 3GPP PS data off while connected via WLAN access only |14.4.0 | |2017-06 |CT#76 |CP-171085 |2868 |1 |B |XCAP over Ut interface - new case for except service |14.4.0 | |2017-06 |CT#76 |CP-171092 |2869 | |F |Paging procedure for eDRX |14.4.0 | |2017-06 |CT#76 |CP-171092 |2870 |1 |F |EMM-REGISTERED without PDN connection in attach procedure |14.4.0 | |2017-06 |CT#76 |CP-171092 |2871 |2 |F |Correction of handling of MO detach without integrity protection |14.4.0 | |2017-06 |CT#76 |CP-171092 |2873 |2 |F |Correction on header compression configuration re-negotiation |14.4.0 | |2017-06 |CT#76 |CP-171062 |2875 | |A |Correction to add ESM #57 and ESM#58 to ESM cause IE |14.4.0 | |2017-06 |CT#76 |CP-171075 |2879 |1 |F |Storage of EMM parameters for eCall only UE |14.4.0 | |2017-06 |CT#76 |CP-171073 |2880 |1 |F |Change Editorial Note to Note for DL data transmission for NB-IoT in inter-MME mobility cases |14.4.0 | |2017-06 |CT#76 |CP-171073 |2881 |1 |B |Support for reliable data service |14.4.0 | |2017-06 |CT#76 |CP-171073 |2883 |4 |B |Correction of the condition to initiate the setup of the user plane radio bearers |14.4.0 | |2017-06 |CT#76 |CP-171092 |2885 |1 |F |Correction in EMM-REGISTERED.UPDATE-NEEDED state description |14.4.0 | |2017-06 |CT#76 |CP-171069 |2887 |5 |A |Further corrections to the handling of NAS reject messages without integrity protection |14.4.0 | |2017-06 |CT#76 |CP-171088 |2889 |1 |F |Correction to TAU trigger case with pending IMSI detach procedure |14.4.0 | |2017-09 |CT#77 |CP-172114 |2843 |6 |F |Enhanced correction of procedures for CIoT Control Plane optimization |14.5.0 | |2017-09 |CT#77 |CP-172098 |2894 |2 |F |Update of eCall inactivity procedure |14.5.0 | |2017-09 |CT#77 |CP-172097 |2896 |1 |F |Paging response when T3448 running |14.5.0 | |2017-09 |CT#77 |CP-172106 |2898 | |F |Definition of ePCO is given in 24.008 (Rel-14 onwards) |14.5.0 | |2017-09 |CT#77 |CP-172111 |2899 | |F |Aligning IE name to Non-3GPP NW provided policies |14.5.0 | |2017-09 |CT#77 |CP-172097 |2901 |2 |F |Stop of CP backoff timer |14.5.0 | |2017-09 |CT#77 |CP-172114 |2902 |3 |F |Extending time for sending DETACH REQUEST in NB-S1 and WB-S1 (EC) |14.5.0 | |2017-09 |CT#77 |CP-172098 |2905 |2 |F |Handling of inter-RAT mobility for UE in eCall only mode capable of eCall over IMS |14.5.0 | |2017-09 |CT#77 |CP-172114 |2908 | |F |Stopping timer T3440 upon receiving signalling from network for UE using only CP CIoT |14.5.0 | |2017-09 |CT#77 |CP-172114 |2909 | |F |Keep forbidden PLMN after receiving integrity protected EMM #11,14,35  |14.5.0 | |2017-09 |CT#77 |CP-172114 |2910 |1 |F |Update to ROHC RFCs |14.5.0 | |2017-09 |CT#77 |CP-172097 |2912 |1 |F |Correction to RRC establishment cause for Control Plane Service Request |14.5.0 | |2017-09 |CT#77 |CP-172097 |2914 |2 |F |Synchronizaton between UE and MME regarding CP congestion situation. |14.5.0 | |2017-09 |CT#77 |CP-172114 |2915 |1 |F |Removing redundant information related to RAI |14.5.0 | |2017-09 |CT#77 |CP-172155 |2891 |6 |F |Extending maximum bitrate in EPS QoS IE |15.0.0 | |2017-09 |CT#77 |CP-172116 |2892 |1 |B |Addition of UE NAS capability for support of dual connectivity with NR |15.0.0 | |2017-09 |CT#77 |CP-172116 |2893 |1 |B |Addition of NAS indication for dual connectivity with NR being restricted |15.0.0 | |2017-09 |CT#77 |CP-172122 |2895 | |F |Clarification on eDRX handling with assigning a new GUTI |15.0.0 | |2017-09 |CT#77 |CP-172120 |2900 |1 |C |Handling of timer expiry during extended service request procedure for MT CSFB |15.0.0 | |2017-09 |CT#77 |CP-172120 |2913 |1 |F |Correction to MT CSFB call failure problem in CONNECTED mode |15.0.0 | |2017-09 |CT#77 |CP-172120 |2916 | |F |UE behaviour in #18 for persistent EPS bearer context |15.0.0 | |2017-09 |CT#77 |CP-172122 |2917 | |F |Ignoring EWT for UE using AC11-15 in NB-S1 mode |15.0.0 | |2017-09 |CT#77 | | | | |addition of missing IEI value |15.0.1 | |2017-12 |CT#78 |CP-173078 |2897 |1 |F |Correction of inconsistency in EMM timers table |15.1.0 | |2017-12 |CT#78 |CP-173072 |2919 |1 |F |Handling of extended EPS quality of service IE and extended APN-AMBR IE |15.1.0 | |2017-12 |CT#78 |CP-173067 |2921 |1 |A |Correction to attempting to ATTACH/TAU for exception data |15.1.0 | |2017-12 |CT#78 |CP-173050 |2924 |1 |A |No support for dedicated bearers in NB-IoT RAT |15.1.0 | |2017-12 |CT#78 |CP-173067 |2925 |1 |A |T3440 starting for UE attaching without PDN connections |15.1.0 | |2017-12 |CT#78 |CP-173078 |2926 | |F |Correction of the handling of counters for "SIM/USIM considered invalid" events |15.1.0 | |2017-12 |CT#78 |CP-173078 |2931 |4 |F |Correction of Additional update type for CIoT |15.1.0 | |2017-12 |CT#78 |CP-173050 |2932 |1 |A |Service request handling for EMM-REGISTERED without PDN connection |15.1.0 | |2017-12 |CT#78 |CP-173067 |2935 | |A |Correction for support of multiple TAC in shared network deployments |15.1.0 | |2017-12 |CT#78 |CP-173078 |2936 |1 |F |Attach and Detach Collision |15.1.0 | |2017-12 |CT#78 |CP-173078 |2937 |1 |F |Attempting EPS Attach for Emergency Bearer Services |15.1.0 | |2017-12 |CT#78 |CP-173077 |2938 |1 |F |Alignment on ESM cause #66 on back-off timer handling |15.1.0 | |2017-12 |CT#78 |CP-173078 |2939 | |F |Correction on UE behaviour of CP back-off timer |15.1.0 | |2017-12 |CT#78 |CP-173078 |2940 |1 |F |Adding missing abnormal case handling for T3448 |15.1.0 | |2017-12 |CT#78 |CP-173060 |2944 |2 |A |CP data back-off timer for EWT CP data received from lower layers |15.1.0 | |2017-12 |CT#78 |CP-173067 |2947 |2 |A |Correction to SERVICE ACCEPT handling at control plane CIoT case |15.1.0 | |2017-12 |CT#78 |CP-173072 |2949 | |F |Correction of Extended EPS quality of service IE naming |15.1.0 | |2017-12 |CT#78 |CP-173077 |2950 | |F |Bit allocation correction in EPS bearer context status |15.1.0 | |2017-12 |CT#78 |CP-173078 |2951 |3 |B |Network policy indication on LTE call redirection to GERAN |15.1.0 | |2017-12 |CT#78 |CP-173077 |2952 | |F |Correction on TAI list coding |15.1.0 | |2017-12 |CT#78 |CP-173078 |2953 |1 |F |Storing CE Mode B in MME |15.1.0 | |2017-12 |CT#78 |CP-173078 |2955 |1 |B |UE behaviour on congestion for MO MMtel voice call |15.1.0 | |2017-12 |CT#78 |CP-173078 |2956 |1 |F |Handling IMS calls when starting timer T3325 |15.1.0 | |2017-12 |CT#78 |CP-173060 |2942 |3 |A |Enhancement of APN rate control for MO exception data |15.1.0 | |2017-12 |CT#78 |CP-173072 |2954 |2 |B |Signalling of UE's additional security capabilities |15.1.0 | |2017-12 |CT#78 |CP-173078 |2961 |1 |C |Support for Reliable Data Service with PtP SGi Tunneling |15.1.0 | |2017-12 |CT#78 |CP-173072 |2960 |2 |B |Security algorithm support for Dual Connectivity |15.1.0 | |2018-01 |CT#78 | | | | |Assigning IEI values for new IEs by Rapporteur |15.1.1 | |2018-03 |CT#79 |CP-180089 |2963 |1 |F |Correction of network policy indication on LTE call redirection to GERAN |15.2.0 | |2018-03 |CT#79 |CP-180104 |2964 |4 |F |Correction of Extended EPS QoS IE |15.2.0 | |2018-03 |CT#79 |CP-180077 |2965 |4 |B |Handling of S-NSSAI and PDU session ID during mobility between EPS and 5GS |15.2.0 | |2018-03 |CT#79 |CP-180077 |2968 |3 |B |Intersystem change from N1 mode to S1 in Idle mode using TAU procedure |15.2.0 | |2018-03 |CT#79 |CP-180075 |2969 |1 |B |Including NG-RAN in the Scope |15.2.0 | |2018-03 |CT#79 |CP-180081 |2972 | |F |Addition of new QCIs |15.2.0 | |2018-03 |CT#79 |CP-180088 |2973 |1 |F |Updates to UE behaviour in state ATTEMPTING-TO-UPDATE |15.2.0 | |2018-03 |CT#79 |CP-180065 |2975 |3 |A |Data support for "voice centric" UE supporting CE mode B |15.2.0 | |2018-03 |CT#79 |CP-180089 |2976 |2 |F |Updating periodic TAU timer and PSM during service request |15.2.0 | |2018-03 |CT#79 |CP-180077 |2977 |2 |B |QoS provision for interworking with 5GS |15.2.0 | |2018-03 |CT#79 |CP-180077 |2979 |2 |B |Mode selection for inter-system change between EPS and 5GS |15.2.0 | |2018-03 |CT#79 |CP-180089 |2981 | |F |Correction to EMM/GMM coordination |15.2.0 | |2018-03 |CT#79 |CP-180089 |2982 |2 |B |Introduction of Service Gap Control; basics and feature negotiation |15.2.0 | |2018-03 |CT#79 |CP-180089 |2983 |2 |B |Service Gap Control feature; non supporting UEs |15.2.0 | |2018-03 |CT#79 |CP-180089 |2984 |2 |B |Service Gap Control; UE behaviour service gap timer is running |15.2.0 | |2018-03 |CT#79 |CP-180069 |2990 | |A |Hash-MME extended usage |15.2.0 | |2018-03 |CT#79 |CP-180076 |2993 |1 |C |Update the UE's usage setting to be applicable to 5GS. |15.2.0 | |2018-03 |CT#79 |CP-180065 |2995 | |A |Remove Editor's note on HASHMME computation |15.2.0 | |2018-03 |CT#79 |CP-180089 |2996 |1 |F |Adding back UP CIoT indication in PNB-CIoT |15.2.0 | |2018-03 |CT#79 |CP-180077 |2998 |3 |B |Emergency numbers list with URN formats |15.2.0 | |2018-03 |CT#79 |CP-180089 |2999 |3 |F |Enabling E-UTRA capability triggered by emergency call |15.2.0 | |2018-03 |CT#79 |CP-180089 |3000 | |F |S1-u data capability indication correction |15.2.0 | |2018-03 |CT#79 |CP-180065 |3002 |1 |A |Numbering of timer Txy |15.2.0 | |2018-03 |CT#79 |CP-180077 |3003 |1 |B |Coordination between ESM and 5GSM |15.2.0 | |2018-06 |CT#80 |CP-181059 |3006 |1 |F |Supporting ePCO for N1 mode capable UE and network supporting 5GS interworking |15.3.0 | |2018-06 |CT#80 |CP-181076 |3007 | |F |Applying EAB for attach and detach and skiping EAB for paging |15.3.0 | |2018-06 |CT#80 |CP-181075 |3008 | |F |Keep PTI during UE initiated PDN disconnect procedure |15.3.0 | |2018-06 |CT#80 |CP-181069 |3009 |7 |B |Support of 15 EPS Bearer IDs in NAS |15.3.0 | |2018-06 |CT#80 |CP-181076 |3010 |2 |B |Service Gap Control feature cleanup and corrections |15.3.0 | |2018-06 |CT#80 |CP-181063 |3011 | |F |Correction to the length of UE additional security capability IE |15.3.0 | |2018-06 |CT#80 |CP-181059 |3012 |2 |B |Extended and local emergency numbers and applicable domain for call initiation |15.3.0 | |2018-06 |CT#80 |CP-181059 |3013 |3 |B |Storage of extended local emergency numbers |15.3.0 | |2018-06 |CT#80 |CP-181059 |3014 | |B |Update of eCall timers start and stop conditions to support eCall over IMS in 5GS |15.3.0 | |2018-06 |CT#80 |CP-181069 |3015 |3 |B |Addition of UE and network NAS capabilities for support of 15 EPS bearers |15.3.0 | |2018-06 |CT#80 |CP-181059 |3017 | |D |Remove "-" between N1 and mode |15.3.0 | |2018-06 |CT#80 |CP-181049 |3023 |2 |A |Receipt of the EPS network feature support IE |15.3.0 | |2018-06 |CT#80 |CP-181075 |3024 | |C |Handling of PDN Connectivity Reject (cause #66) during an attach procedure |15.3.0 | |2018-06 |CT#80 |CP-181059 |3026 |3 |F |Secondary authentication/authorization revocation by DN-AAA server after intersystem change from N1 mode to S1. |15.3.0 | |2018-06 |CT#80 |CP-181074 |3027 |1 |B |Enabling 3GPP PS data off in roaming |15.3.0 | |2018-06 |CT#80 |CP-181059 |3028 |4 |B |EPS mobile identity and UE status in the ATTACH REQUEST message |15.3.0 | |2018-06 |CT#80 |CP-181059 |3030 |3 |C |Intersystem interworking improvement |15.3.0 | |2018-06 |CT#80 |CP-181075 |3031 |1 |F |Correction of APN-AMBR |15.3.0 | |2018-06 |CT#80 |CP-181059 |3032 |2 |F |Disabling and re-enabling S1 mode |15.3.0 | |2018-06 |CT#80 |CP-181059 |3033 |2 |B |Extended Emergency Number List IE |15.3.0 | |2018-06 |CT#80 |CP-181076 |3035 |3 |B |Extended EMM cause for NB-IoT |15.3.0 | |2018-06 |CT#80 |CP-181076 |3036 |2 |C |Service Gap Control, attach without PDN connection for supporting UEs |15.3.0 | |2018-06 |CT#80 |CP-181063 |3037 |1 |F |MSB & LSB in the coding of Extended QoS and Extended APN AMBR IE |15.3.0 | |2018-06 |CT#80 |CP-181076 |3038 |2 |F |UE Radio Capability Update using TAU procedure |15.3.0 | |2018-06 |CT#80 |CP-181076 |3039 |1 |F |Corrections to handling of timer T3402 |15.3.0 | |2018-06 |CT#80 |CP-181076 |3042 | |F |Correction on service request as paging response |15.3.0 | |2018-06 |CT#80 |CP-181076 |3043 | |F |Correction on EPS network feature support IE |15.3.0 | |2018-06 |CT#80 |CP-181063 |3044 |1 |F |Removal of Extended EPS QoS IE |15.3.0 | |2018-06 |CT#80 |CP-181059 |3047 |1 |B |5GMM parameter handling for TAU rejected with EMM cause #9 |15.3.0 | |2018-06 |CT#80 |CP-181075 |3050 | |F |Non-semantical mandatory information element errors for EMM |15.3.0 | |2018-06 |CT#80 |CP-181076 |3041 |1 |B |Ciphering keys delivery for broadcast of ciphered assistance data |15.3.0 | |2018-09 |CT#81 |CP-182129 |3054 |1 |F |Pass (Extended) Emergency Number List to upper layers |15.4.0 | |2018-09 |CT#81 |CP-182129 |3055 |2 |F |Correct Extended Emergency Number List |15.4.0 | |2018-09 |CT#81 |CP-182129 |3056 |1 |F |Correcting ambiguities when detecting an emergency number not provided using EENL |15.4.0 | |2018-09 |CT#81 |CP-182158 |3058 | |F |Code points split into “unused values” and “reserved values” |15.4.0 | |2018-09 |CT#81 |CP-182158 |3059 |1 |D |Message sequence charts should be documented in the correct subclause |15.4.0 | |2018-09 |CT#81 |CP-182158 |3060 | |B |QCIs for URLLC |15.4.0 | |2018-09 |CT#81 |CP-182129 |3061 |1 |F |Correcting message definition of messages including EENL |15.4.0 | |2018-09 |CT#81 |CP-182129 |3063 |1 |B |5GMM context handling |15.4.0 | |2018-09 |CT#81 |CP-182158 |3065 | |F |Handling IMS calls while timer T3325 is running |15.4.0 | |2018-09 |CT#81 |CP-182158 |3068 |2 |F |Correction on S1-u data capability indication and handling  |15.4.0 | |2018-09 |CT#81 |CP-182129 |3069 | |B |Including UE additional security capability IE in Attach/TAU Request for UE supporting N1 mode |15.4.0 | |2018-09 |CT#81 |CP-182129 |3070 | |B |Update of UE identity used for attach in S1 mode for single-registered UE without N26 |15.4.0 | |2018-09 |CT#81 |CP-182129 |3071 | |B |First TAU in EPS after initial registration in 5GS |15.4.0 | |2018-09 |CT#81 |CP-182158 |3072 | |F |Update of the Ciphering key data IE |15.4.0 | |2018-09 |CT#81 |CP-182129 |3073 |3 |F |Provision of IWK N26 indication in TAU procedures |15.4.0 | |2018-09 |CT#81 |CP-182124 |3075 | |A |NAS-MAC calculation for RRC connection reestablishment for NB-IoT CP optimisation |15.4.0 | |2018-09 |CT#81 |CP-182157 |3076 | |F |Handling of T3346 for paging for MT CS call |15.4.0 | |2018-09 |CT#81 |CP-182158 |3077 | |F |Checking emergency for stopping the back-off timer |15.4.0 | |2018-09 |CT#81 |CP-182158 |3078 | |F |Correction on transmission failure of IDENTITY RESPONSE message |15.4.0 | |2018-09 |CT#81 |CP-182148 |3080 | |B |New QCI for MCVideo |15.4.0 | |2018-09 |CT#81 |CP-182121 |3082 |1 |A |TFT operation for header compression re-negotiation and PS data off |15.4.0 | |2018-09 |CT#81 |CP-182158 |3083 |1 |F |Correction for the RRC Resume procedure |15.4.0 | |2018-09 |CT#81 |CP-182158 |3087 | |F |Incorrect IEI for Ciphering Key Data |15.4.0 | |2018-09 |CT#81 |CP-182129 |3088 | |F |Correct 5GMM reference used in the handling of the emergency numbers procedures |15.4.0 | |2018-09 |CT#81 |CP-182129 |3089 |1 |D |Correct conditions for invoking tracking area updating procedure (S1 mode only) |15.4.0 | |2018-09 |CT#81 |CP-182129 |3094 | |B |Addition of TAU trigger for change of NG-RAN radio capability |15.4.0 | |2018-09 |CT#81 |CP-182158 |3095 |1 |F |Handling of change of UE radio capability information in EMM-IDLE mode with suspend indication |15.4.0 | |2018-09 |CT#81 |CP-182129 |3098 |1 |F |Authentication response parameter IE to be of fixed length (24.301) |15.4.0 | |2018-09 |CT#81 |CP-182158 |3099 | |D |Error in EPS network feature support IE due to wrong styles |15.4.0 | |2018-09 |CT#81 |CP-182129 |3100 |1 |B |Establishment of a mapped EPS security context during inter-system handover from N1 mode |15.4.0 | |2018-09 |CT#81 |CP-182158 |3101 |1 |F |Correction on wrong sub-clause reference, terminology and editorial correction |15.4.0 | |2018-09 |CT#81 |CP-182158 |3102 |4 |F |Corrections on Extended EMM cause for NB-IoT |15.4.0 | |2018-09 |CT#81 |CP-182129 |3103 |1 |F |ESM protocol impacts to support interworking with 5GS |15.4.0 | |2018-09 |CT#81 |CP-182129 |3106 |2 |B |Tracking area update request from S1 mode to N1 mode |15.4.0 | |2018-12 |CT#82 |CP-183031 |3097 |4 |F |Correct Extended Local Emergency Numbers List deletion upon PLMN change |15.5.0 | |2018-12 |CT#82 |CP-183031 |3110 |1 |F |Correction for selection of PDU session ID for EPS |15.5.0 | |2018-12 |CT#82 |CP-183066 |3112 |1 |A |Correction for 3GPP PS data off and non-IP user data packets |15.5.0 | |2018-12 |CT#82 |CP-183031 |3115 |1 |F |Update of handling of 5GMM parameters in EPS |15.5.0 | |2018-12 |CT#82 |CP-183031 |3116 |1 |F |Correction for KSI name for mapped EPS security context during inter-system handover from 5GS to EPS |15.5.0 | |2018-12 |CT#82 |CP-183031 |3117 | |F |Correction to a reference for the UE status IE |15.5.0 | |2018-12 |CT#82 |CP-183031 |3118 |1 |F |Correction on TAU trigger for UEs in single-registration mode |15.5.0 | |2018-12 |CT#82 |CP-183031 |3119 |2 |F |Correction on inclusion of GUTI for UE in single-registration mode |15.5.0 | |2018-12 |CT#82 |CP-183076 |3122 |2 |F |Reset of PLMN's maximum number of EPS bearer contexts |15.5.0 | |2018-12 |CT#82 |CP-183031 |3124 | |F |UL NAS COUNT when TAU is constructed for S1 to N1 intersystem change |15.5.0 | |2018-12 |CT#82 |CP-183031 |3125 |2 |D |Terminology alignment regarding support for interworking without N26 |15.5.0 | |2018-12 |CT#82 |CP-183031 |3126 |1 |D |Corrections on the TAU procedure not accepted by the network due to EMM cause value #7 or #22 |15.5.0 | |2018-12 |CT#82 |CP-183066 |3128 |1 |A |Correction for indicating 3GPP PS data off status |15.5.0 | |2018-12 |CT#82 |CP-183031 |3130 | |F |Reset of attach attempt counter |15.5.0 | |2018-12 |CT#82 |CP-183031 |3131 |1 |F |5GMM parameters handling for 5GC interworking |15.5.0 | |2018-12 |CT#82 |CP-183031 |3132 | |F |Protection of EPS attach for 5GC interworking |15.5.0 | |2018-12 |CT#82 |CP-183031 |3133 | |F |TAU trigger for EPC interworking in connected mode |15.5.0 | |2018-12 |CT#82 |CP-183070 |3134 |1 |F |Correction of TAU abnormal case for the network |15.5.0 | |2018-12 |CT#82 |CP-183070 |3135 |1 |F |Collision between paging for CS fallback and UE initiated NAS procedures |15.5.0 | |2018-12 |CT#82 |CP-183031 |3136 | |F |Clarification for abnormal case handling of TAU procedure after inter-system change from N1 mode to S1 mode |15.5.0 | |2018-12 |CT#82 |CP-183031 |3138 |1 |F |Handling of attempt counter upon receipt of the ATTACH ACCEPT message |15.5.0 | |2018-12 |CT#82 |CP-183031 |3139 |1 |F |Establishment of secure exchange of NAS messages during inter-system change from N1 mode to S1 mode |15.5.0 | |2018-12 |CT#82 |CP-183070 |3140 | |F |Correction on network behavior in paging |15.5.0 | |2018-12 |CT#82 |CP-183076 |3141 |1 |F |Correction on ePCO support |15.5.0 | |2018-12 |CT#82 |CP-183076 |3142 |2 |F |MO signaling and data with service gap control timer running in connected mode |15.5.0 | |2018-12 |CT#82 |CP-183028 |3108 |3 |F |GUMMEI mapped from 5G GUTI with indication at 5G interworking |15.5.0 | |2019-03 |CT#83 |CP-190100 |3144 |4 |F |EDT-CP - CPSR provided at time of RRC connection establishment |15.6.0 | |2019-03 |CT#83 |CP-190099 |3146 |1 |F |Starting time of Serving PLMN rate control at the MME |15.6.0 | |2019-03 |CT#83 |CP-190100 |3147 |2 |F |Service Gap control, attach without PDN connection and allow MO signalling |15.6.0 | |2019-03 |CT#83 |CP-190100 |3148 |3 |F |Service Gap control, clarifications |15.6.0 | |2019-03 |CT#83 |CP-190083 |3152 |3 |F |Use of 5G-GUTI in creation of an ATTACH REQUEST message |15.6.0 | |2019-03 |CT#83 |CP-190100 |3153 | |F |Correction to criteria to start retransmission timers |15.6.0 | |2019-03 |CT#83 |CP-190100 |3154 | |F |Stop T3416 when authentication reject received |15.6.0 | |2019-03 |CT#83 |CP-190100 |3156 |1 |F |Establishment of a PDN connection of non-IP type using the default APN based on indication from ESMS entity |15.6.0 | |2019-03 |CT#83 |CP-190099 |3159 |2 |F |Handling when the UE indicated security capabilities are invalid or unacceptable |15.6.0 | |2019-03 |CT#83 |CP-190083 |3165 | |F |Removal of wrong description on deriving mapped EPS security context for EPC interworking in connected mode |15.6.0 | |2019-03 |CT#83 |CP-190083 |3167 | |F |Encoding of characters of the sub-services of the associated emergency service URN |15.6.0 | |2019-03 |CT#83 |CP-190083 |3169 |1 |F |Cases where 5G NAS security context is used to integrity protect an ATTACH REQUEST message |15.6.0 | |2019-03 |CT#83 |CP-190083 |3171 | |F |QoS rules and QoS flow descriptions with the length of two octets  |15.6.0 | |2019-06 |CT#84 |CP-191121 |3183 | |F |Correction on security protection for TAU after inter-system change from N1 mode to S1 mode |15.7.0 | |2019-06 |CT#84 |CP-191121 |3185 | |F |Correction on PLMN ID determination during AKA |15.7.0 | |2019-06 |CT#84 |CP-191121 |3203 |1 |F |Correction of EMM cause #12, 13, 15 |15.7.0 | |2019-06 |CT#84 |CP-191121 |3220 |2 |F |Alignment of the 5G ciphering and integrity algorithm identifiers |15.7.0 | |2019-12 |CT#86 |CP-193084 |3306 | |F |NAS Count setting during idle mode mobility from N1 mode to S1 mode |15.8.0 | |

